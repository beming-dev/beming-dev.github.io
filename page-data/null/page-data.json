{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-tsx","path":"/null/","result":{"data":{"markdownRemark":{"html":"<p>본 포스팅은 단순히 환경 구성 기록용 입니다.</p>\n<h1>필수 패키지 설치, 시스템 설정</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 업데이트 및 필수 도구 설치</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> <span class=\"token punctuation\">\\</span>\n  apt-transport-https <span class=\"token punctuation\">\\</span>\n  ca-certificates <span class=\"token punctuation\">\\</span>\n  <span class=\"token function\">curl</span> <span class=\"token punctuation\">\\</span>\n  gnupg <span class=\"token punctuation\">\\</span>\n  lsb-release\n\n<span class=\"token comment\"># bridge 네트워크용 커널 모듈 활성화</span>\n<span class=\"token function\">sudo</span> modprobe br_netfilter\n\n<span class=\"token comment\"># iptables 설정 영구 적용</span>\n<span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF<span class=\"token bash punctuation\"> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/sysctl.d/k8s.conf</span>\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward                 = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">sysctl</span> <span class=\"token parameter variable\">--system</span>\n</code></pre></div>\n<ul>\n<li>Kubernetes 저장소를 HTTPS로 안전하게 조회</li>\n<li>GPG 키 검증에 필요한 도구들</li>\n<li>lsb-release: 배포판 정보를 조회</li>\n<li>modprobe br_netfilter: CNI 플러그인이 Pod 간 트래픽을 브리지로 처리할 때 필수입니다.</li>\n<li>\n<ul>\n<li>\n<ul>\n<li><code class=\"language-text\">net.bridge.bridge-nf-call-iptables = 1</code> → 브리지 인터페이스의 트래픽도 iptables 체인(FILTER/NAT)에 걸리도록 허용</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><code class=\"language-text\">net.ipv4.ip_forward = 1</code> → 노드가 IP 패킷을 다른 인터페이스로 포워딩하도록 허용 (클러스터 내부 라우팅)</li>\n<li><code class=\"language-text\">/etc/sysctl.d/k8s.conf</code>에 저장해 재부팅 후에도 유지되게 하고, <code class=\"language-text\">sysctl --system</code>으로 즉시 적용</li>\n</ul>\n<h1>컨테이너 런타임 설정</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># containerd 설치</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> containerd\n\n<span class=\"token comment\"># 기본 설정 파일 생성</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /etc/containerd\n<span class=\"token function\">sudo</span> containerd config default <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/containerd/config.toml\n\n<span class=\"token comment\"># systemd cgroup 사용하도록 변경</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'s/SystemdCgroup = false/SystemdCgroup = true/'</span> /etc/containerd/config.toml\n\n<span class=\"token comment\"># 재시작</span>\n<span class=\"token function\">sudo</span> systemctl restart containerd\n<span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> containerd\n</code></pre></div>\n<p>containerd 설치</p>\n<ul>\n<li>Kubernetes가 직접 통신하는 CRI(Container Runtime Interface) 호환 런타임입니다.</li>\n<li>Docker 엔진보다 가볍고, Docker가 내부적으로 사용하는 런타임 자체이기도 합니다.</li>\n</ul>\n<h1>Kubernetes 컴포넌트 설치</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># GPG 키 가져오기</span>\n<span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSL</span> https://pkgs.k8s.io/core:/stable:/v1.30/deb/Release.key <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> gpg <span class=\"token parameter variable\">--dearmor</span> <span class=\"token parameter variable\">-o</span> /etc/apt/keyrings/kubernetes-apt-keyring.gpg\n\n<span class=\"token comment\"># 리포지터리 등록</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.30/deb/ /\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> <span class=\"token function\">tee</span> /etc/apt/sources.list.d/kubernetes.list\n\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update\n\n<span class=\"token comment\"># 컴포넌트 설치</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> kubelet kubeadm kubectl\n\n<span class=\"token comment\"># 버전 업데이트 방지</span>\n<span class=\"token function\">sudo</span> apt-mark hold kubelet kubeadm kubectl\n</code></pre></div>\n<ul>\n<li>GPG 키를 가져오고, kubernetes 공식 바이너리의 APT 저장소 추가</li>\n<li>자동 업그레이드 시 버전 충돌을 막기 위해, 이 세 패키지를 고정</li>\n</ul>\n<h1>램스왑 끄기</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token assign-left variable\">KUBELET_EXTRA_ARGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"--fail-swap-on=false\"</span></code></pre></div>\n<p>kubernetes는 기본적으로 swap 메모리를 허용하지 않습니다. 위 플래그를 주어 swap 메모리를 허용하거나, swap메모리를 삭제합시다.</p>\n<h1>마스터 노드 초기화</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> kubeadm init <span class=\"token punctuation\">\\</span>\n  --pod-network-cidr<span class=\"token operator\">=</span><span class=\"token number\">10.244</span>.0.0/16 <span class=\"token punctuation\">\\</span>\n  --apiserver-advertise-address<span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">hostname</span> <span class=\"token parameter variable\">-i</span><span class=\"token variable\">)</span></span></code></pre></div>\n<h1>Kubectl 설정 (비 root 사용자용)</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 일반 사용자 홈 디렉터리로 설정 복사</span>\n<span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> <span class=\"token environment constant\">$HOME</span>/.kube\n<span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> <span class=\"token parameter variable\">-i</span> /etc/kubernetes/admin.conf <span class=\"token environment constant\">$HOME</span>/.kube/config\n<span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> <span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> <span class=\"token parameter variable\">-u</span><span class=\"token variable\">)</span></span><span class=\"token builtin class-name\">:</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">id</span> <span class=\"token parameter variable\">-g</span><span class=\"token variable\">)</span></span> <span class=\"token environment constant\">$HOME</span>/.kube/config</code></pre></div>\n<h1>CNI 배포</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl apply <span class=\"token parameter variable\">-f</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</code></pre></div>\n<h1>단일 노드에 워커 스케줄링 허용</h1>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">kubectl taint nodes <span class=\"token parameter variable\">--all</span> node-role.kubernetes.io/master-</code></pre></div>","frontmatter":{"date":null,"title":""},"tableOfContents":"<ul>\n<li><a href=\"#%ED%95%84%EC%88%98-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%84%A4%EC%B9%98-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EC%84%A4%EC%A0%95\">필수 패키지 설치, 시스템 설정</a></li>\n<li><a href=\"#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EB%9F%B0%ED%83%80%EC%9E%84-%EC%84%A4%EC%A0%95\">컨테이너 런타임 설정</a></li>\n<li><a href=\"#kubernetes-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8-%EC%84%A4%EC%B9%98\">Kubernetes 컴포넌트 설치</a></li>\n<li><a href=\"#%EB%9E%A8%EC%8A%A4%EC%99%91-%EB%81%84%EA%B8%B0\">램스왑 끄기</a></li>\n<li><a href=\"#%EB%A7%88%EC%8A%A4%ED%84%B0-%EB%85%B8%EB%93%9C-%EC%B4%88%EA%B8%B0%ED%99%94\">마스터 노드 초기화</a></li>\n<li><a href=\"#kubectl-%EC%84%A4%EC%A0%95-%EB%B9%84-root-%EC%82%AC%EC%9A%A9%EC%9E%90%EC%9A%A9\">Kubectl 설정 (비 root 사용자용)</a></li>\n<li><a href=\"#cni-%EB%B0%B0%ED%8F%AC\">CNI 배포</a></li>\n<li><a href=\"#%EB%8B%A8%EC%9D%BC-%EB%85%B8%EB%93%9C%EC%97%90-%EC%9B%8C%EC%BB%A4-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%A7%81-%ED%97%88%EC%9A%A9\">단일 노드에 워커 스케줄링 허용</a></li>\n</ul>"}},"pageContext":{"id":"4ad7a0d6-76ca-57db-9548-0f1f4bf00cbb","frontmatter__slug":null,"__params":{"frontmatter__slug":"null"}}},"staticQueryHashes":["2018336255","2540505676","2678393935","2810064759","3398502926"],"slicesMap":{}}