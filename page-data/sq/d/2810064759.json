{"data":{"site":{"siteMetadata":{"title":"Beming-dev Blog"}},"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>포트폴리오 만들기</h1>\n<h2>기술 스택</h2>\n<ul>\n<li>React.js</li>\n<li>Next.js</li>\n<li>Express.js</li>\n<li>Nest.js</li>\n<li>Spring</li>\n<li>Kafka</li>\n<li>Redis</li>\n<li>webpack, vite</li>\n<li>Docker, kubernetes</li>\n</ul>\n<h2>프론트</h2>\n<ul>\n<li>해커톤</li>\n<li>Graduos</li>\n</ul>\n<h2>백엔드</h2>\n<ul>\n<li>About</li>\n<li>Stock Simulator</li>\n</ul>\n<h2>기타</h2>\n<ul>\n<li>Architecture</li>\n<li>HTTP</li>\n<li>Linux</li>\n</ul>\n<h2>자격증</h2>\n<ul>\n<li>정처기</li>\n<li>SQLD</li>\n</ul>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>더 적은 인력으로, 더 결함율이 낮고 더 빠르게 개발할 수 있는 코드를 작성하자.</p>\n<p>의존: 다른 코드를 참조하여 이용하는 것. Java의 import, Javascript의 require import, C의 include\nB모듈이 A모듈을 import 한다면, B 모듈은 A모듈에 의존하는 것입니다.</p>\n<p>B모듈은 여러 모듈을 import해서 사용하고 있고 아무도 B를 import하지 않습니다. A모듈은 아무것도 import 하지 않지만 여러 모듈이 A를 import합니다.</p>\n<p>이 때, A를 안정적이라고 합니다. 안정적인 모듈은 변경이 어렵습니다. B모듈은 불안정하다고 합니다. 우리는 B 모듈을 마음껏 변경할 수 있습니다.</p>\n<p>우리는 코드를 불안정한 부분과 안정한 부분 두 부분으로 분리해야 합니다.</p>\n<h1>DIP 의존성 역전 원칙</h1>\n<p>구현체는 자주 변하지만, 추상화는 변하지 않습니다.\n=> 구현체를 불안정한 모듈, 추상화를 안정된 모듈로 만들면 좋은 코드를 만들수 있을까요?</p>\n<p>모든 코드는 구현체가 아닌 추상화에 의존해야 합니다.</p>\n<p>여기까진 좋지만 그러면 추상화에 의존하는 코드는 구현체를 어떻게 알까요? 알 방법이 없습니다.\n누군가는 구현체의 내용을 알려줘야 합니다.</p>\n<p>이 역할을 하는 것이 바로 EntryPoint 입니다 보통 main 이라고 합니다.\nmain이 모든 모듈들의 구현체를 만든 뒤, 의존성을 잘 주입한 다음 구현체에게 제어권을 넘겨주면 됩니다.\nmain은 구현체에 직접 의존하게 되지만, main이 모두 감당하면 다른 코드가 좋아지므로 괜찮습니다.</p>\n<h1>정책</h1>\n<p>모든 코드는 정책을 담고 있습니다.\n이 정책은 중요한 정책과 덜 중요한 정책으로 나눌 수 있습니다.\n중요한 정책은 업무 규칙, 덜 중요한 정책은 세부사항 이라고 부릅니다.</p>\n<p>애플리케이션을 만들 때, 세부사항까지 모두 미리 고려하여 제작할 수 있을까요?\n절대 불가능합니다. 결정은 언제나 바뀔 수 있습니다.\n세부사항을 먼저 결정하는 일이 발생하면, 결정이 바뀌었을 때 모든 코드를 수정해야 할지도 모릅니다.\n오히려 이런 세부사항의 결정은 끝까지 미루는것이 바람직합니다.\n여기서의 세부사항에는, 프레임워크, 웹서버, 데이터베이스 등을 포함할 수 있습니다.</p>\n<p>그렇다면 이런 세부사항은 정책에 어떻게 결합해야 될까요?\n클린 아키텍처에서 제안하는 방식은 \"플러그인 아키텍처\" 방식입니다.\n\"프레임워크나 데이터베이스 등 세부사항은 나중에 결정하고, 유즈케이스 먼저 구현하라\"</p>\n<p>소프트웨어는 유즈케이스를 위해 존재합니다.\n좋은 아키텍처라면 유즈케이스가 핵심적인 위치에 존재해야 합니다.</p>\n<h1>클린 아키텍처</h1>\n<p>클린 아키텍처의 핵심은 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">소스코드 의존성은 반드시 안쪽으로, 고수준의 정책을 향해야 한다.</code></pre></div>\n<p>내부의 원에 속한 요소는, 외부 원에 대해 어떤것도 알지 못해야 합니다.\n원의 개수는 중요하지 않습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 772px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGklEQVR42jVSC08iVxjl//YXNGna3SZtNDAODA/RFdeyul2ooisBBB1lQZgX82IY5gkzAyMyzFOrMX2k7WW3e3Lz5ebmnJx895zYbDYzDMOyLMO0rNnctm1DHRmqoEtDTRHB1MesLgsTZWSZa9oXmCZgWzFFURzHcT0v9L3F3VwzbYIgGKqv8r07ZWBrvDmmLJmeyfRqee+6nvsZnufJshzTNA1cA2+FjyYlbPmmu/yFfdjD/SM8aAu2464eHp/88MEPo6/C/8XAFYh1d7Ws9sT09TzHcbB4vimVE2IlK/RhVH9TJcFCQeC7Ky8IgjAMv8woitZiY6I2MeG74idkXC38U01Lhbf9fJbZ2f3zLDs72bzgKoTp3C8c1zbNqfEVYGFJkmI0y+ZbE3iA7v9bPyOKUiouvvpR3txA67v7f9Xz1mUGnWHseD5mif4tQZLUZ5AkORgMYrU2mevNdqLGoVF6QNKrd9kJWZiUkZdEsnyVT4Ul6BNz2pEZiWz3OhiGdbodhmFARoIgxEpNEkL5ZFA+reV8aEuk95ZhZTp/7+0h1EFq5++PW3iv2BwLls6JIs9xHM/zw+FisdB1PVa6wOGbUeaxcoruRoktvpvzX841vejnU+SH7PYfpymKPEKVcOVEQRQG678Cww+CdVS16z7SNuDJcVos3GeRcBvRzpC7QvIFyWQq8ddCLttXDq6wt+LRnvArodBc6bd2IiE1GipwZphBriZ+Xzn+gUkm6jCbgxwI1tLwbin+apiBmY/xinBL06w9xFV6OjOn1AA7qRgsq2pazDQmF+1+oqZA+EXc2N9+Ok0b73LBceaxDLHHyRurjNLBavnsPT8vn8JFpJ032hCktVprZ12feKv7epdJNU2ow28S5z8z7zeok0QXg1vWUYuZW4bre1MbuFhLy5nzAlGtGoKwdgZFAWXzXadHMYfo6KcD9JvXO98iJ/tNsXU7sOfWY/T72FLy0mFuWMRUWvhQ7mxsyLW6rKrAWQe5DQVhLI44mry5vmo0m5dXlxTRH4/A8wjEw3IsRuLgAOYA1APHKRzXNO0/c/fFNRx0/ScAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250314203710\"\n        title=\"\"\n        src=\"/static/e0f1f90e1b97a08e2a6ab29308781c77/940c5/20250314203710.png\"\n        srcset=\"/static/e0f1f90e1b97a08e2a6ab29308781c77/772e8/20250314203710.png 200w,\n/static/e0f1f90e1b97a08e2a6ab29308781c77/e17e5/20250314203710.png 400w,\n/static/e0f1f90e1b97a08e2a6ab29308781c77/940c5/20250314203710.png 772w\"\n        sizes=\"(max-width: 772px) 100vw, 772px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2>엔티티</h2>\n<p>애플리케이션의 핵심 중의 핵심이 되는 업무 객체입니다.\n예들 들어, 배달 서비스라면 음식점과 주문자 의 존재 정책이 엔티티가 될 수 있습니다.</p>\n<h2>유즈케이스</h2>\n<p>유즈케이스는 애플리케이션의 핵심 업무 객체입니다.\n앤티티는 애플리케이션이 없어도 존재해야 하지만, 유즈케이스는 애플리케이션에서 제공하는 기능입니다.\n\"예를 들면 장바구니에 음식을 담는다\" 와 같은 행위입니다.</p>\n<h2>어댑터</h2>\n<p>유즈케이스가 올바르게 동작하기 위해서는, 사용자 인터페이스와 데이터베이스가 소통해야 합니다. 유즈케이스가 GUI와 데이터베이스 사이에서 브릿지 역할을 해 주는 것이 어댑터 레이어입니다.\ncontroller의 코드가 어댑터가 될 수 있습니다.</p>\n<h2>세부사항</h2>\n<p>웹, 데이터베이스, 프레임워크 등입니다.\n업무규칙보다 중요하지 않습니다.</p>\n<h1>Nest.js가 클린 아키텍처 개념 적용을 어떻게 도와줄까?</h1>\n<h2>모듈 기반 구조</h2>\n<p>기능 단위로 모듈을 분리해, 관련된 관심사만 다루게 됩니다.9\n기능별 응집도가 높아지고, 모듈간 결합도는 낮아져 도메인 로직을 독립적으로 유지하기 쉬워집니다.</p>\n<h2>의존성 주입</h2>\n<p>의존성 주입 컨테이너를 제공하여, 클래스 사이의 결합을 낮추고 테스트 유지보수가 쉬워진다.\nController, Service에서 DB접근, 외부 API 호출 등을 직접 구현 불가. Provider 인터페이스 주입받아 사용.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>안녕하세요 서울시립대 컴퓨터과학부 재학중이고 이번에 네이버 신입 공채에 백엔드 포지션으로 지원하게 된 채민관입니다.\n저는 유지보수성이 좋은 아키텍처를 설계하고 사용자의 요구사항을 잘 반영하는 개발자를 목표로 공부하고 있습니다. 최근에는 <strong>시스템의 확장성과 유지보수성</strong>을 고려한 아키텍처 설계에 큰 관심을 두고 있습니다.\n국내에서 가장 많은 수준의 트래픽을 보유하고 있고, 대용량 데이터를 다루는 네이버에서라면, 다양한 문제상황을 직접 경험하고 해결해나가며 배울 수 있을 것이라 생각하여 지원하게 됐습니다.\n네이버에서 주도적으로 학습하며 회사와 함께 성장하고 싶습니다.</p>\n<h1>졸업은 어떻게 돼요?</h1>\n<p>졸업은 2026년 2월에 할 예정입니다.\n원래 이번학기에 졸업 예정이었는데 졸업에 문제가 생겨서, 이번학기 수업을 다음학기로 미루고 다음학기에 수강하거나 취업계를 쓸 계획 하고있습니다.\n현재는 인턴을 하며 휴학중이고, 다음학기에 수업이 두개정도 남아서 취업이 된다면 취업계를 사용할 계획입니다.</p>\n<h1>질문</h1>\n<p>입사초기에는 주로 어떤 과제를 맡아서 진행하나요?\n네이버에서는 주니어 개발자는 보통 어떤식으로 코드에 기여를 하게 되나요?\n사내 스터디 같은 것들이 있나요?</p>\n<h1>마지막으로 하고싶은말</h1>\n<p>먼저 면접 시간 내주셔서 감사합니다. 팀네이버에 합류하게 된다면, 대규모 트래픽과 대용량 데이터를 다룰 때 발생할 수 있는 문제들을 주도적으로 학습하며 팀에 기여하고, 회사와 함께 성장할 수 있는 개발자가 되겠습니다. 감사합니다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h3>이런 일을 해요</h3>\n<ul>\n<li>초당 수천 개의 요청과 메시지 트래픽을 효율적이고 안정적으로 처리하는 Event-Driven 아키텍처를 고민해요</li>\n<li>OOP, FP, Resolver 패턴을 적재적소에 활용하여  구인·구직 도메인의 복잡한 문제를 해결해요</li>\n<li>구인구직 서비스에 필요한 다양한 GraphQL API 를 개발하고 유지 보수해요</li>\n<li>구인·구직 서비스의 운영을 자동화하고, 데이터 기반 의사결정을 돕는 효율적인 백오피스를 구축해요</li>\n<li>로그 분석, 실험 분석 등 데이터 기반의 의사결정에 필요한 데이터를 정제하고 가공해요</li>\n</ul>\n<h3>이런 분을 찾고 있어요</h3>\n<ul>\n<li>내가 만드는 제품을 통해 유저에게 가치를 전달하는 것에 동기부여가 되시는 분</li>\n<li>제품 중심으로 생각하며 그에 맞는 문제 정의 및 해결책을 도출하시는 분</li>\n<li>자기 주도적이며 빠른 실행력을 가지신 분</li>\n<li>하나 이상의 프로그래밍 언어를 깊게 탐구해 보신 분</li>\n<li>RDBMS, NoSQL 등 데이터베이스를 활용해본 경험이 있으며 이에 대한 이해가 있으신 분</li>\n</ul>\n<h3>이런 분이면 더 좋아요!</h3>\n<ul>\n<li>\n<p>Node.js, Go를 활용해 본 경험이 있으신 분</p>\n</li>\n<li>\n<p>GraphQL을 활용해 본 경험이 있으시거나 관심이 있으신 분</p>\n</li>\n<li>\n<p>React 기반 클라이언트 개발이 가능하신 분</p>\n</li>\n<li>\n<p>Node.js, Go</p>\n</li>\n<li>\n<p>MongoDB, Redis, Kafka</p>\n</li>\n<li>\n<p>GraphQL, gRPC이렇게 합류해요</p>\n</li>\n</ul>\n<h1>Event Driven Architecture</h1>\n<p>이벤트를 중심으로 데이터 흐름과 처리를 구성하는 아키텍처\n어떤 이벤트가 발생하면, 발행한다.\n소비자가 구독 형태로 이를 받는다.</p>\n<p>기능 확장 시 다른 컴포넌트에 영향을 주지 않아 확장성이 좋다.\n새로운 이벤트 추가, 구독 추가 확장이 쉽다.\n이벤트 발생과 처리 시점이 분리되므로, 다양한 이벤트를 동시에 효율적으로 관리 가능하다.</p>\n<p>이벤트가 많아질수록 이벤트 플로우를 추적하기가 어려워진다.\n비동기 처리가 주가 되므로 즉각적인 일관성 보장이 어렵다.</p>\n<h2>트래픽이 많은 경우 EDA가 유리한가?</h2>\n<p>많은 요청을 한번에 처리하려면, 요청을 빠르게 큐에 쌓고 비동기적으로 처리할 수 있어야한다.\nEDA에서 Kafka, Redis stream을 이용해 소비자가 이를 빠르게 처리하도록 구성이 가능합니다.</p>\n<p>트래픽 증가 시, Producer만 혹은 Consumer만 확장이 가능합니다. 트래픽 증가에 유연하게 대처 가능합니다.</p>\n<p>이벤트 메시지가 저장되어 있으면 장애가 나도 재처리가 가능합니다.</p>\n<p>이벤트 흐름이 잘 파악된다면, 병목지점을 찾을 수 있습니다.</p>\n<p>Kafka, RabbitMQ등 개념 알아두면 좋음\n(Kafka의 파티션, 오프셋 개념, RabbitMQ의 Exchange 타입(Direct, Topic, Fanout 등), 큐 바인딩 등.)</p>\n<p>메시지를 발행하고, 동시에 어떻게 응답 반환할지 고민</p>\n<h2>+</h2>\n<p>저는 전체시스템을 EDA로 구성해본 적은 없지만, 알림기능을 메시지 큐를 활용한다던가, Spring에서 Java의 이벤트 방식을 사용해본 경험이 있습니다. EDA 아키텍처가 장애 재처리가 가능하고 여러 요청을 수용 가능하다는 점에서 매력적이라 당근에서 제대로 한번 경험해보고 싶습니다.</p>\n<p>Consumer의 스케일 조절도 중요할것 같습니다. 비동기 프로세스 모니터링. 갑작스럽게 요청 증가했을 때 대응할 수 있도록.\nKubernetes를 사용한다던가, 하면 좋을듯.</p>\n<h1>OOP</h1>\n<p>클래스로 표현하고, 필요한 속성과 메서드를 묶어 캡슐화.\n추상화, 상속, 다형성등을 통해 비즈니스 로직을 정리 (예를 들어 ‘정규직 채용공고’와 ‘프리랜서 채용공고’가 상속 관계로 구성되어, 공통된 속성은 상위 클래스에 정의하고, 구체적인 차이는 하위 클래스가 구현하는 식으로 복잡도를 줄일 수 있어요.)\n객체간 협력으로 로직 분산</p>\n<h1>FP (Functional Programming)</h1>\n<p>순수 함수, 불변 데이터를 지향합니다.\n함수는 입력 -> 출력이 명확해야하고, 사이드 이펙트를 최소화 해야합니다.</p>\n<p>구직자와 채용공고 데이터를 한꺼번에 매칭할 때, 특정 조건으로 필터링할 때, 맵/필터/리듀서 등의 함수형 스타일이 오류를 줄여줄 수 있다.</p>\n<p>병렬 처리에 유리. 상태 공유가 적어, 이벤트 스트리밍 환경에서 병렬처리가 유리하다.</p>\n<h1>Resolver 패턴</h1>\n<p>GraphQL에서 데이터를 가져오기 위한 함수.\nQuery 또는 Mutation이 들어오면, 해당하는 함수를 Resolver라고 부른다.</p>\n<p>의존성을 주입하거나 어떤 객체가 처리할지 정하는것도 Resolver</p>\n<h1>GraphQL</h1>\n<p>클라이언트가 필요한 데이터만 정확히 요청하여 응답받을 수 있다.\n쿼리 언어이제 스펙</p>\n<p>OverFetching, UnderFetching 해결\nRestful API에서는 /users, /users/:id/posts 등 쪼개서 받는 경우가 많다.</p>\n<p>GraphQL에서는 한번의 쿼리로 데이터 구조를 자유롭게 정의해서 받을 수 있다.\n요청과 응답 구조가 스키마로 명확히 정의된다.</p>\n<h2>스키마</h2>\n<p>GraphQL 서버가 제공하는 데이터 구조와 API 명세를 정의.\nQuery: 데이터 조회\nMutation: 데이터 수정\nSubscription: 실시간 이벤트 전송</p>\n<h2>타입</h2>\n<p>스키마에서 각 객체가 어떤 필드를 가지고, 필드 타입이 무엇인지 정의</p>\n<h2>Query &#x26; Mutation</h2>\n<h2>Resolver</h2>\n<p>쿼리, 뮤테이션을 처리하는 함수\n<code class=\"language-text\">jobPosting(id: ID!)</code> 이라는 쿼리에 대해, DB에서 해당 <code class=\"language-text\">id</code>의 채용공고를 가져오는 로직이 Resolver에 존재.</p>\n<ul>\n<li>나는 왜 당근에 지원했는가?</li>\n<li>인간관계 내 갈등이 있었다면 어떻게 해결을 했는가?</li>\n<li>나의 장, 단점은 무엇인가</li>\n<li>직무 인터뷰때 아쉬웠던 점에 대한 복기</li>\n<li>동료에게 피드백을 어떻게 하는 편이고 피드백을 잘 수용하는 편인가?</li>\n<li>토스에서 이루고 싶은 목표는 무엇인가?</li>\n</ul>\n<p>제장점은 의사소통에 강점이 있다는 것입니다. 제 의견을 설득력있게 잘 전달할 수 있고, 다양한 환경에서 예를 들면 교환학생 의사소통 해본 경험이 있습니다.</p>\n<p>제 단점은 모든걸 완벽하게 하려고 하는 것입니다. 예를 들면, 기술을 적요할때도 적용해보면서 배우는 방법이 효율적인데 완벽히 알고 사용해보려 해서 시간이 지체 된다거나하는 일이 종종 있습니다.</p>\n<h1>Redis란 무엇인가요?</h1>\n<p>메모리 기반의 데이터 저장소로, 높은 처리량과 빠른 성능을 제공하기 위한 Key-Value 방식의 NoSQL 데이터베이스입니다.\nList, Set, Sorted Set, Hash 등 다양한 자료구조를 지원합니다.\nIn-Mamory 구조이므로 매우빠른 읽기, 쓰기 속도를 가집니다.</p>\n<ul>\n<li>캐싱</li>\n<li>Session저장소</li>\n<li>Pub/sub</li>\n<li>레디스 클러스터</li>\n</ul>\n<p>로 사용가능합니다.</p>\n<p>메모리 기반이라 매우 빠르지만, 메모리 비용이 많이 듭니다.\n싱글 스레드로 작동합니다.\n디스크에 작성하는 시점에 따라 장애 발생 시 일부 손실 가능성이 있습니다.</p>\n<h1>Kafka란 무엇인가요?</h1>\n<p>분산 스트리밍 플랫폼으로, 대용량의 데이터를 안정적으로 실시간으로 처리하고 전달하기 위해 사용합니다.</p>\n<p>Publish, Subscribe 패턴을 기반으로 하는 메시지 보로커이며, 분산 환경에 적합하도록 높은 확장성과 내결함성을 제공합니다.</p>\n<p>데이터는 토픽 단위로 저장되고, 각 토픽은 여러 파티션으로 나뉘어 병렬 처리와 확장성을 극대화합니다.</p>\n<p>Producer: 메시지를 작성하여 특정 토픽에 전송\nBroker: 메시지를 저장, 관리하는 Kafka 서버. 보통 여러 Broker로 구성하여 클러스터 형태로 동작\nConsumer: 토픽으로부터 메시지를 구독하고, 필요한 데이터를 가져가는 역할\nTopic: 메시지가 저장되는 논리적인 개념. 각 토픽은 파티션을 가지고 파티션은 물리적으로 메시지를 저장\nZookeeper: 클러스터 메타데이터 관리. Kraft 추가됨</p>\n<p>메시지를 가져간다고 삭제되지 않음. 메시지는 설정된 기간동안 보관됨.\nConsumer는 Consumer Group 단위로 오프셋을 관리. 어떤 Consumer Group이 어느 시점까지 읽었는가를 추적.</p>\n<h1>GraphQL이란 무엇인가요?</h1>\n<p>Facebook이 개발한 쿼리 언어. 클라이언트가 필요한 데이터만 선택적으로 요청할 수 있는 API 규격.\nREST API는 엔트포인트별로 정해진 형식의 데이터 응답을 제공하지만, GraphQL은 단일 엔드포인트에서 다양한 형태의 요청과 응답을 처리</p>\n<ul>\n<li>Schema 정의. 데이터 타입과 관계를 정의하는 스키마 가진다.</li>\n<li>Query: 읽기 전용 요청</li>\n<li>Mutation: 데이터 변경</li>\n<li>Resolver: Query나 Mutation에서 요청된 필드별로 실제 데이터를 어떻게 가져올지를 정의한 함수.</li>\n<li>단일 엔드포인트로 모든 요청을 처리</li>\n</ul>\n<p>단점은</p>\n<ul>\n<li>캐싱이 어렵다.</li>\n<li>클라이언트가 복잡하거나 중첩된 쿼리 요청하면 부하가 커짐.</li>\n<li>N+1문제. Data Resolver로 해결.</li>\n</ul>\n<h1>gPRC란?</h1>\n<p>Google에서 개발한 범용 원격 프로시저 호출.\nTelefunc라는걸 사용해본 경험이 있습니다.\nMicroService가 늘어나면서, 서비스 간 통신을 좀 더 효율적이고 표준화된 방식으로 처리할 필요가 생김.\n바이너리 직렬화 포맷 및 HTTP/2 기반 스트리밍을 결합한 gRPC 등장</p>\n<p>클라이언트 스텁과 서버스텁이 내부적으로 프로세스 진행</p>\n<h2>장 점</h2>\n<p>고성능, 저오버헤드\n엄격한 스키마와 타입 안전성: .proto 파일에 메시지 구조와 RPC함수를 정의하고, 이를 바탕으로 서버/클라 코드를 자동생성\n개발시점에 타입에러 잡을 수 있다.</p>\n<p>엄격한 스키마 덕에 대규모 팀 프로젝트에서 협업, 버전 관리에 용이</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>시립대에서 \"서울시 공공데이터를 활용해 편의를 제공하는 서비스\"를 주제로 해커톤에 참여했습니다. 팀에 프론트 개발자가 없어 프론트 개발자로 참여하게 됐습니다. 디자이너와 협업을 통해 프론트엔드 개발을 했습니다.\nNext.js를 사용하였기에, api route를 사용하여 cors 문제 등을 우회하여 사용하였고 직접 생성형 AI API를 사용하여 추천 시스템을 구성했습니다.</p>\n<p>또한 Tailwindcss를 사용하여 디자인의 일관성을 유지했습니다.</p>\n<p>디자이너와 커뮤니케이션하며 협업한 경험이 있습니다.\nNext.js를 사용해서 간단한 백엔드 기능을 같이 구현했습니다.\n생성형 API를 사용하여 프롬프팅을 작성하여 도서관 프로그램을 추천해주는 기능을 만들었습니다.</p>\n<h1>CORS</h1>\n<p>브라우저 보안 정책이고 서버 간에는 적용되지 않음.\nOrigin: 프로토콜 + 도메인 + 포트\n다른 Origin이 리소스 접근 못함.\n예외를 허용해줌</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>제가 주식에 관심이 많은데, Spring과 Mysql을 공부하면서 해볼만한 개인 프로젝트를 떠올리다가 주식 시뮬레이션 프로그램이 딱이라 생각하여 개발을 시작하게 됐습니다.</p>\n<p>Spring을 이용한 API 개발 경험을 쌓았습니다.</p>\n<p>Inversion Of Control:  객체의 생성, 생명주기 관리를 프레임워크가 담당\nDI: IOC의 핵심 개념. 의존 객체를 외부에서 주입받아 사용.</p>\n<p>스프링 컨테이너: 스프링 프레임워크의 핵심 개념. Bean을 생성, 관리, 소멸 등 라이프사이클을 담당함 EX) Application Context.\n빈 생명주기(생성-> 의존관계 주입 -> 초기화 -> 사용 -> 소멸) 전 과정을 관리</p>\n<p>빈: 컨테이너를 생성하고 관리하는 객체</p>\n<p>AOP: 애플리케이션 전반에 걸쳐 반복되는 기능을 Aspect로 분리해 관리하자. \"어디서\", \"언제\" 적용할지를 비즈니스 로직 코드와 분리하여 관리함. 코드를 깔끔하고 재사용 가능하게 만듦.</p>\n<p>Aspect: 관심사를 모듈화한것\nAdvice: 공통 기능이 실행되는 지점\nPointCut: 어느 메스드에 대해 Advice를 적용할지 결정\nJoin Point: Advice가 삽입될 수 있는 모든 지점\nWeaving: AOP를 적용하여 Aspect를 연결하는 과정</p>\n<p>스프링은 프록시 기반 AOP방식을 사용.</p>\n<p>MVC 패턴: 역할과 책임을 분리하여 유지보수성, 확장성을 높인다.</p>\n<p>Model: 데이터, 비즈니스 로직\nView: 사용자에게 보여지는 화면\nController: 사용자 요청을 받고, 적절한 Service, Model 로직을 수행한 뒤 결과를 View에 전달.</p>\n<p>DispatcherServlet: 스프링 MVC의 프론트 컨트롤러. 모든 요청을 받아 Controller로 매핑\n핸들러 매핑: 어떤 URL 요청이 어느 컨트롤러 클래스로 전달될지 매핑 정보 관리</p>\n<p>스프링부트: 스프링 프레임워크를 간편하게 사용하도록 도와줌\n톰캣 등 내장 웹 서버 제공, 자동 설정, 스타터 의존성 관리 등을 통해 간단한 설정으로 바로 실행 가능</p>\n<p>트랜잭션: 선언적 트랜잭션을 통해 쉽게 적용가능. Transactional 어노테이션으로, 해당 메서드 실행 지점에서 프록시로 트랜잭션 시작하고, 메서드가 정상 종료되면 커밋, 예외 발생 시 롤백</p>\n<h1>WebSocket</h1>\n<p>하나의 TCP 연결로 클라이언트와 서버가 지속적으로 실시간 데이터를 전송할 수 있는 프로토콜\n실시간 양방향 데이터 전송 프로토콜</p>\n<p>HTTP는 매 요청마다 연결과 응답이 끝나면 다시 연결을 맺어야 함.\npolling 방식은 서버의 자원을 많이 사용한다.</p>\n<ol>\n<li>WebSocket 핸드쉐이크:HTTP request를 보내면서 WebScoket 프로토콜로 업그레이드를 요청</li>\n<li>WebSocket Frame 형태로 데이터 주고받음.</li>\n<li>연결 종료 시, Close Frame을 보내 연결을 끊는다.</li>\n</ol>\n<p>주식 데이터와 같이 빠른 실시간 데이터 전달이 중요할 때 WebSocket 사용가능</p>\n<p>처음 구조를 설계했을 때, 여러명의 클라이언트가 같은 주식 페이지에 접속하면, 같은 WebSocket 연결이 여러개 생성되어서 같은 데이터가 중복으로 전송되는 문제가 있었습니다.</p>\n<p>이 문제를 해결하기 위해, 서버와 외부 api와의 연결이 여러개 생성되지 않도록, 구독 형태를 구현했습니다.\n먼저 클라이언트가 특정 주식데이터 구독을 요청하면, 어떤 주식인지와 어떤 요청인지 정보를 합쳐 key를 만듭니다. 그 key를 기반으로 그 키에 해당하는 서버, 외부 사이의 websocket 연결이 없다면, 새로 연결을 생성하고, 요청을 보낸 클라이언트를 첫 구독자로 둡니다. 만약 이미 연결이 존재한다면, 그 요청을 구독합니다. 그리고 WebSocket을 통해 데이터가 전송되면 서버가 구독자들에게 데이터를 뿌려줍니다.</p>\n<h1>React 상태관리</h1>\n<p>React의 Context API를 사용하여 인증상태, WebSocket 연결을 관리했습니다.</p>\n<p>context를 생성하고, Provider로 앱 전체에서 공유할 수 있게 함.</p>\n<h1>Jenkins</h1>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>Nest.js</h1>\n<p>DIP(의존성 역정 원칙)\n고수준 모듈은 저수준 모듈에 의존해서는 안된다.\n둘 다 추상화에 의존해야 한다.\n추상화는 구체적인 세부 사항에 의존해서는 안된다.</p>\n<p>하위 모듈을 직접 인스턴스를 가져다 쓰지 말아라.</p>\n<p>이를 위해서는 의존성 주입(DI)개념도 필요.\n생성자에서 주입, or spring과 같은 컨테이너가 자동 주입해줌</p>\n<p>Nest.js를 사용하여 데이터베이스에 접근하는 Repository 코드의 인터페이스를 작성하고, 의존성 주입 받아 사용. 데이터베이스의 의존성을 분리하여 사용중임.\n원래 Service 코드도 분리하였으나, 개발 코스트 증가가 영향이 더 크다 생각하여 삭제하고 현재는 DB만 분리하여 사용중.\n추후 DB를 변경할 일이 생기면 사용해볼 예정</p>\n<h1>MongoDB</h1>\n<p>About은 처음에 2명이 시작한 서비스로, 따로 기획자가 있지 않았습니다. 그때그때 요구사항을 반영하고, 생각나는 것들을 바로바로 적용하는 일이 잦다보니 데이터베이스 스키마의 변경도 잦았습니다. MongoDB는 문서 지향 DB로, JSON 형태로 데이터를 저장하고 NoSQL이기 때문에 데이터 구조 변경이 유연하고 빠릅니다. 그래서 잘 맞는다 생각하여 MongoDB를 결정하였습니다.</p>\n<p>MongoDB를 직접 사용해보니, MySQL처럼 복잡하게 DB를 설계하지 않아도 되는 점이 좋았습니다. Join과 같은 연산을 많이 사용하지 않아 쿼리도 복잡하지 않았습니다.</p>\n<p>하지만 한 Collection에 많은 데이터가 들어갈수록 관리에 부담이 느껴지고, populate 연산이 많아질수록 속도가 느려지고, 한번의 GET 요청에 너무 큰 데이터가 전송되는 문제도 있었습니다.</p>\n<p>Mongoose라는 javascript mongoDB라이브러리에서 제공하는 기능들을 많이 사용했는데, DB의존성이 강하게 생긴다고 느껴서, 최근에는 Entity를 분리하고, Entity에 핵심 로직을 넣고 DB는 단순 CRUD기능 위주로 작동하게 리팩토링하는 작업을 진행하고 있습니다.</p>\n<h1>ELK</h1>\n<p>에러로그를 시각화하여 웹상에서 빠르게 확인 및 대응을 하고, 로그를 분석해 응답이 많이 들어오는 api, 응답이 느린 api등을 발견하기 위해 사용하고 있습니다.</p>\n<p>Filebeat가 Docker log를 수집하면 Logstash에서 데이터를 가공하고, Elastic Search를 통해 인덱싱하면, Kibana에서 시각화된걸 분석하여 확인하고 있습니다.</p>\n<p>ElasticSearch는 기본적으로 분산 처리에 특화된 구조를 가지고 있습니다. 인덱싱 요청을 여러 노드가 나누어 처리할 수 있습니다. 색인을 생성할 때 샤드 단위로 나누어 데이터를 저장합니다. 샤드 수를 적절히 선정하면 좋습니다.\n병렬 인덱싱: 데이터를 동시에 여러 채널에서 인덱싱 요청을 통해 전송해서 처리 속도를 극대화 합니다. Kafka등 메시지 큐 시스템과 연동해서, 여러 소비자가 동시에 데이터를 보내도록 설계할 수 있습니다.</p>\n<h1>Docker</h1>\n<p>컨테이너 기반의 환경 일관성 제공\n빠른 배포 속도와 손쉬운 롤백\n개발,테스트,운영이 동일한 환경에서 동작\n컨테이너 간 격리\n가상머신 대비 자원을 효율적으로 사용.\nDocker와 image만 있으면 어디서나 동일한 환경 제공 가능</p>\n<p>가상머신은 호스트 OS 위에 하이퍼바이저가 별도의 게스트 OS를 구동시킵니다.\nDocker는 호스트 OS의 커널을 공유하여 필요한 라이브러리, 런타임만 포함해 경량화되어 작동합니다.</p>\n<h1>AWS</h1>\n<p>codepipeline, codebuild, codedeploy, IAM, EC2, ECR 등 사용해보았습니다.</p>\n<p>AWS에 codepipeline이라는 기능을 사용했습니다. git의 main브랜치가 업데이트 되면, source단계를 트리거합니다. 그러면 소스 코드를 가져와서, build 단계에서 제가 정의해둔 buildspec에 따라 코드를 이미지로 빌드 합니다. 빌드된 이미지는 ECR로 전송되어 저장되고, deploy 단계에서는 EC2가 ECR의 이미지를 가져온 뒤, 컨테이너 형태로 배포합니다.</p>\n<ul>\n<li>codepipeline: 소스-빌드-배포 단계를 각각 커스텀하여 하나의 CI/CD 파이프라인을 구성하게 해줍니다.</li>\n<li>codebuild: 스스 코드를 컴파일, 테스트하여 배포 가능한 패키지를 생성합니다.</li>\n<li>codedeploy: 코드 빌드 후 자동 배포를 도와줍니다.</li>\n<li>IAM: 리소스 접근 제어 및 보안 관리를 위한 서비스입니다. AWS 자원에 접근할 수 있는 권한을 세부적으로 정의하고 관리합니다.</li>\n<li>EC2: 컴퓨팅환경을 제공합니다.</li>\n<li>ECR: 컨테이너 이미지를 관리하고 저장하는완전 관리형 도케 레지스트리 서비스. Docker 이미지를 저장하고 관리하여 ECS, EC2등으로 컨테이너를 배포할 때 사용.</li>\n</ul>\n<h1>DBSCAN</h1>\n<p>About은 스터디 기능을 제공합니다.\n기존의 스터디 기능은 복잡했습니다.\n1지망 2지망 선택이 가능하고 스터디 장소를 직접 선택할 수 있고, 참여 시간도 선택할 수 있었습니다.\n그러면 각 장소마다 참여 시간과 1,2지망을 고려해서 스터디가 열릴 수 있다고 판단되면 OPEN 하는 자체 제작 알고리즘을 사용했습니다.</p>\n<p>그러나 스터디 참여율이 점점 낮아지며 다른 방식을 고려하게 됐습니다.\n다양한 유저의 피드백을 들어본 결과, 다음과 같은 문제점이 있었습니다.</p>\n<ol>\n<li>유저가 선택할 사항이 너무 많다.</li>\n<li>1,2 지망이 겹치지 않아 가까운 거리임에도 매칭이 잘 안이루어진다.</li>\n<li>유저가 장소를 선택하므로 투표에 눈치가 보인다.</li>\n</ol>\n<p>그래서 떠올린 방식이 클러스터링 방식입니다. 유저가 선택할 사항을 줄이고, 위의 문제사항들을 전부 해결할 수 있겠다 생각했습니다.</p>\n<p>DBSCAN과 K-MEANS 알고리즘이 후보였는데, K-MEANS는 cluster의 개수를 미리 정해줘야 하는 점에서 저희 서비스와 맞지 않았습니다.</p>\n<p>그래서 유저가 스터디를 하겠다고 투표 버튼을 누르면, 미리 정해둔 선호 장소를 바탕으로 위도 경도 정보만 전송하고, 그 위도 경도 데이터를 기반으로 DBSCAN 알고리즘을 돌리도록 적용했습니다.</p>\n<p>DBSCAN에서는 클러스터 범위와 최소인원만 선택이 가능한데, 알고리즘 결과가 특정 인원을 넘으면 재귀적으로 범위를 줄여서 다시 클러스터링 하는 방식으로 알고리즘을 활용하여 적용했습니다.</p>\n<p>이 방식을 사용하면, 최소거리를 직접 조정하며 상황에 맞게 클러스터 범위를 조절할 수 있고, 유저가 할 행동이 줄어서 많은 장점이 있습니다.</p>\n<h1>Docker</h1>\n<p>컨테이너라는 경량화된 가상 환경에서 애플리케이션을 개발, 배포하도록 도와주는 플랫폼.\n애플리케이션과 실행되는 환경을 하나의 패키지로 묶어 어느 환경에서든 동일하게 동작하도록 합니다.</p>\n<p>가상머신은 하이퍼바이저라는 OS위에 가상 머신을 직접 설치해서 사용하는 방면, Docker는 OS 커널을 공유한다.</p>\n<p>볼륨: 컨테이너가 데이터를 영구적으로 저장할 수 있도록 하는 저장소.\n컨테이너가 종료되더라도 데이터 유지 가능</p>\n<p>네트워크: 컨테이너 간의 통신을 관리</p>\n<h1>Redis</h1>\n<p>최근에, 모든 요청에 대해 처리시간을 로깅하고,  ELK스택으로 url별로 평균 처리시간을 분석하여 시간이 오래 걸리는 API를 분석했습니다.\n분석결과 시간이 오래 걸리는 이유가 큰 데이터를 읽어와 처리하기 때문이라 생각했고, 처리 결과를 Redis에 캐싱하여 처리속도를 200ms대에서 100ms 초반으로 1/2가량 줄이는 경험을 해보았습니다.</p>\n<h1>트러블슈팅</h1>\n<p>Nest.js로 서비스를 포팅한 후, 예기치 못한 에러에 서비스가 계속 종료되는 일이 발생했습니다.\nHandling이 안되는 에러가 발생하면 서비스가 종료되는 것이었습니다. 그래서 그런 에러가 발생하면 파악해서 처리하려 했으나 말처럼 쉽지 않았습니다.\n먼저, 서비스가 종료되는 문제는 Nest.js에서 제공하는 unhandled Error에 대한 Error handling을 달아주어 해결했습니다.</p>\n<p>그러나 지속적인 모니터링과 에러로깅의 중요성을 깨달았습니다.</p>\n<p>그래서 winston이라는 로깅 라이브러리로 앱에서 발생하는 모든 로그를 json형식으로 정형화 한 후, ELK 스택을 적용하여 web에서 모니터링할 수 있게 했습니다.</p>\n<p>그 결과 현재는 에러가 발생하면 간단히 web에 접속하여 확인할 수 있습니다.\n여기서 멈추지 않고, 시간이 오래걸리는 api를 분석하거나 요청이 많이 들어오는 api를 분석하는 등 사용하고 있습니다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>Express.js</h1>\n<p>Node.js환경에서 많이 사용.\n간결한 API및 웹 앱 개발</p>\n<h2>middleware</h2>\n<p>요청과 응답 사이에서 실행되는 함수.\n요청을 처리하거나 변형하고, 다음 미들웨어로 넘김\n파싱, 쿠키/세션관리, 인증/권한처리, 로깅, 에러처리 등 가능</p>\n<h2>라우팅</h2>\n<p>요청을 특정 엔드포인트와 HTTP메서드에 따라 처리하는 방법을 정의</p>\n<h2>에러처리</h2>\n<p>매개변수를 4개 받는 미들웨어를 둔다.</p>\n<h2>라우터</h2>\n<p>라우터를 모듈화하여 구조화할 수 있다.</p>\n<ul>\n<li>미들웨어 동작원리와 순서: 요청이 도착하면 정의된 미들웨어를 순서대로 실행.</li>\n</ul>\n<p>각 미들웨어는 next()를 호출하여 다음 미들웨어로 흐름을 넘긴다.\n마지막 미들웨어가 응답을 클라이언트로 보냅니다.</p>\n<ul>\n<li>Express에서 비동기 오류 처리방법: 비동기 오류를 자동으로 처리하지 않는다. 콜백함수에서 에러 응답. catch에서 에러 처리</li>\n</ul>\n<h1>Nest.js</h1>\n<p>Typescript기반\nMVC 구조와 유사한 모듈식 아키텍처\nDependency Injection\nExpress.또는 Fastify 사용가능\nDecorator 기반 선언적 프로그래밍</p>\n<p>모듈: Nest의 기본 블록. 컨트롤러, 서비스 프로바이더 관리\n컨트롤러: 요청을 서비스로 전달하고 응답 처리\n서비스: 비즈니스 로직 처리, DB와 상호작용\n프로바이더: Nest에서 의존성 주입 담당하는 객체. 서비스, 리포지토리, 팩토리 등 제공 가능\n파이프: 데이터 유효성 검사 및 변환 담당\n가드: 인증 및 권한 확인 용도\n인터셉터: 요청 전후로 작업 수행 가능\n미들웨어: Express.js와 동일하게 동작.</p>\n<p>Nest.js선택 이유: Typescript기반으로 안정성이 뛰어나다. 명확한 구조와 모듈화된 아키텍처를 제공한다. DI, 인터셉터등 기능을 제공하여 의존성 분리, 생산성을 높일 수 있다.</p>\n<p>의존성 주입: 객체를 직접 생성하지 않고, 외부에서 제공받는 설계 패턴입니다. 의존성 역전을 위해 필요합니다. 세부 구현을 직접 참조하지 않고 상위 인터페이스를 참조하도록 하여 변화에 영향을 덜 받도록 설계할 수 있습니다.</p>\n<p>Pipe의 역할: 데이터 유효성 검사와 데이터 변환을 담당합니다. 주로 요청 데이터가 올바른지 검증하거나, 필요한 타입으로 변환할 때 사용합니다.</p>\n<h1>MySQL</h1>\n<p>인덱스는 데이터 조회 속도를 높이기 위해 사용되는 자료구조입니다.\nB-Tree 구조를 사용하여 데이터를 빠르게 탐색합니다.\nB-Tree: 모든 리프가 같은 레벨 가질 수 있도록 자동 조정하는 트리\n검색 조건, 정렬, JOIN에 사용되는 컬럼에 인덱스 설정하면 성능이 향상된다.\n데이터의 추가/수정/삭제가 빈번한 컬럼에 과도한 인덱스를 설정하면 성능이 저하될 수 있다.</p>\n<p>자주 조회되는 컬럼에 우선적으로 적용하고, 카디널리티가 낮은 컬럼에 선택\n복합 인덱스는 컬럼의 순서가 중요\n너무 많은 인덱스는 저장공간 증가, INS/UPD성능 저하시킬 수 있다.</p>\n<p>JOIN 컬럼에 인덱스를 설정하여 JOIN 성능을 크게 개성할 수 있습니다.\nJOIN 전 필터링을 먼저 수행하여 JOIN 시 처리해야 할 데이터 양을 최소화합니다.\n필요 없는 데이터는 JOIN 이전에 WHERE 조건으로 필터링합니다.\n복잡한 JOIN 쿼리는 서브쿼리나 임시 테이블을 사용하여 단계적으로 수행합니다.</p>\n<p>트랜잭션: 원자성, 일관성, 고립성, 지속성</p>\n<p>MySQL의 락</p>\n<ul>\n<li>공유 락: 데이터 읽기 작업에 사용.</li>\n<li>베타적 락: 데이터 변경 시 사용</li>\n<li>낙관적 락: 충돌이 적은 환경에서 주로 사용. 버전 번호 등을 통해 충돌을 감지하여 제어.</li>\n</ul>\n<p>데드 락: 두 개 이상의 트랜잭션이 서로 상대가 보유한 리소스를 기다리며 무한 대기하는 상황</p>\n<ul>\n<li>일정한 순서로 리소스를 확보하도록 함.</li>\n<li>락 타임아웃을 설정하여 오래 기다리지 않게 함.</li>\n<li>트랜잭션을 작게 하여 락 보유 시간을 최소화</li>\n</ul>\n<p>데이터 무결성을 위해 할 수 있는것: 기본키, 외래키, 데이터 타입 제한 및 제약조건 설정. Trigger를 사용한 데이터 무결성 검사 로직 구현</p>\n<h1>MongoDB</h1>\n<p>Document기반의 비관계형 데이터베이스</p>\n<p>Document-oriented: JSON 형태로 데이터 저장\n스키마가 고정되지 않아 자유롭게 추가, 변경 가능\nSharding과 Replica Set으로 수평 확장 가능\nAggregation Framework: 복잡한 데이터 집계 및 분석 처리 제공\n빠른 개발 속도: 복잡한 JOIN 없이 데이터를 직관적으로 저장하고 조회 가능</p>\n<p>Document: 데이터의 기본 단위\nCollection: Document를 모아놓은 곳\nDatabase: Collection을 담는 컨테이너\nField: 키-값 형태의 데이터 항목\nIndex</p>\n<p>여러 단계의 데이터 처리 작업을 수행할 수 있는 파이프라인 방식의 데이터 처리 기능입니다.</p>\n<p>사용자의 스터디 참여 통계 등을 계산할 때 Aggregation Pipeline을 구성하였습니다.</p>\n<p>자주 조회되거나 필터링에 사용되는 필드에 인덱스를 설정합니다.</p>\n<p>복합 인덱스로 여러 필드를 결합하여 조회 성능을 높일 수 있습니다.</p>\n<p>Replica Set: 데이터 복사본을 여러 노드에 복제하여 주 노드가 장애 발생 시 보조 노드가 자동으로 인계받아 서비스 연속성을 보장합니다.\nSharding: 데이터를 여러 서버에 분산 저장하여 데이터 처리 및 확장성을 극대화 하는 방법입니다.</p>\n<p>MongoDB 스키마 설계시 고려할 것</p>\n<ul>\n<li>쿼리 성능을 우선적으로 고려합니다.</li>\n<li>JOIN 사용을 줄이고, 자주 사용하는 데이터를 가능한 Document 내에 임베딩 합니다.</li>\n<li>데이터 중복을 허용하되, 자주 바뀌는 데이터는 임베딩하지 않고 참조 합니다.</li>\n<li>Document 크기가 16MB를 넘지 않게 설계합니다.</li>\n</ul>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<ul>\n<li>CodePipeline을 사용하여 Git에서 코드를 가져와 CodeBuild에서 빌드하고, Docker 이미지를 ECR에 저장한 후, CodeDeploy를 통해 EC2에서 컨테이너를 배포하는 방식으로 구성했습니다.</li>\n<li>기존 Heroku서비스의 비용이 높았다. 해결방안을 위해 AWS 비용을 분석했고, 더 여유로운 memory를 더 저렴한 가격에 이용할 수 있어서 선택했다. CodePipeline을 이용하면 단계별 배포 과정을 시각적으로 모니터링할 수 있어 유지보수도 용이합니다.</li>\n<li>ECR은 - AWS 내에서 관리되므로 EC2, ECS, EKS 등과의 연동이 용이함 IAM을 이용한 보안 설정이 쉬움. Docker Hub보다 네트워크 전송 비용 절감 가능</li>\n</ul>\n<h2>EC2에서 배포하는 방식이 ECS, EKS 등과 비교했을 때 어떤 장점과 단점이 있다고 생각하나요?</h2>\n<h2>CodeBuild의 역할이 무엇인가요?</h2>\n<h2>어떤 배포 방식</h2>\n<p>In-Place 배포 방식 사용. 기존 컨테이너 종료, 새로운 컨테이너 실행.\n중간에 서비스 끊김이 발생할 수 있어, 그 부분은 load balancer와 같은 개념을 적용할 수 있다면 적용해 볼 예정</p>\n<h2>배포 실패시</h2>\n<p>자동 롤백으로 복구\ncodedeploy와 cloudwatch의 로그 분석</p>\n<h2>향후 개선방안</h2>\n<p>EKS/ECS와 비교해 보고 싶다.</p>\n<p>EC2기반이라 오토스케일링이 어렵다. 자주 사용되는 route들을 MSA로 분리해보려고 ELK에서 url당 요청이 얼마나 들어왔는지 분석해뒀다.</p>\n<p>다운타임 최소화</p>\n<ul>\n<li>Docker 이미지를 빌드할 때, 변경된 부분만 다시 빌드하도록 <code class=\"language-text\">--cache-from</code> 옵션을 사용하여 <strong>레이어 캐싱</strong>을 적용했습니다.</li>\n</ul>\n<h1>마이크로 서비스</h1>\n<p>한대의 물리 서버에 여러 컨테이너를 띄우고 Kubernetes 같은 컨테이너 오케스트레이션 툴로 관리한다.\n서버 리소스를 효율적으로 사용할 수 있지만 논리적으로는 격리돼있음.\n서비스간 충돌이 줄어들고, 리소스 효율적으로 사용할 수 있음.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<ul>\n<li>Epsilon: Cluster 구성하는 최소 거리</li>\n<li>Min Points: Cluster 구성 시, 필요한 최소 데이터 포인트 수</li>\n</ul>\n<p>임의 포인트 선택, Epsilon 거리 내에 있는 모든 데이터 포인트 찾음.\n데이터 포인트 갯수가 Min Points 이상이면, Cluster 생성.\nCluster에 존재하는 점 중, 다른 Cluster의 중심이 되는 점이 있다면 합침\n반복\n최종적으로 포함 안되면 이상치</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>시스템 장애를 빠르게 대응하기 위함.\n응답이 늦는 API도 찾아내기 위해 적용해보는중</p>\n<ul>\n<li>\n<p>ElasticSearch: 로그 저장 및 검색</p>\n</li>\n<li>\n<p>Logstash: 로그 수집</p>\n</li>\n<li>\n<p>Kibana: 로그 시각화 및 관리</p>\n</li>\n<li>\n<p>Filebeat: 로그 파일을 경량 에이전트 형태로 수집. Logstash와 달리 자원이 많이 소모되지 않으므로, 서버 측에서 로그 수집 오버헤드를 줄일 수 있다. 추후 로그 수집 설정을 바꿀 때, Beats의 설정만 조정하면 돼서 확장에 유리하다.\n로그 수집 역할을 분리했다고 생각하면 좋을듯.</p>\n</li>\n</ul>\n<p>Beat에는 로그 파일 담당 Filebeat 뿐 아니라, Metric 담당 MEtricbeat, 네트워크 담당 Packetbeat</p>\n<ul>\n<li>오픈소스라 프로젝트에 적용해보기가 좋았다.</li>\n<li>Docker의 Log를 수집하기 편리하고, ElasticSearch의 속도가 매우 빠르다.</li>\n</ul>\n<p>ElasticSearch\n역색인 구조 => 검색어 기준으로 문서 목록을 빠르게 찾을 수 있게 하는 자료구조\n데이터를 여러 샤드에 나눠 저장함. 노드 수에 따라 데이터를 병렬로 처리함.\n내부적으로 OS 레벨의 파일 시스템 캐시, segment단위로 활용 가능한 캐시를 활용함.</p>\n<h2>Prometheus, Grafana</h2>\n<p>kubernetes 환경에서는 애플리케이션 상태, 노드/POD 자원 사용량, 네트워크 트래픽 등 모니터링이 중요.\nPrometheus는 kubernetes의 API server와 직접 연동하여 메트릭을 수집 가능.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>Kafka의 경우, topic에 pub 되는 메시지를 저장하지만, Redis는 pub 메시지를 저장하지 않는다. 그래서 Subscriber가 존재하지 않으면 메시지가 사라진다.\n메시지 저장, 수신확인이 필요하지 않은 경우에 사용하면 좋다.</p>\n<p>알고보니 전 Redis의 Pub/Sub을 사용하지 않았습니다.\nPub/Sub은 데이터를 따로 저장하지 않고, Pub에서 바로 Sub으로 보냅니다. 그래서 재전송등이 불가능하고, 전송 여부도 확인 불가능 합니다.</p>\n<p>저는 Bull과 Redis를 사용했습니다.\nBull은 Redis 기반의 Job Q 라이브러리 입니다.\nBull에 의해, Redis가 메시지 큐 역할로 저장소 역할을 합니다.\n이 구조에서는 재전송 등의 로직도 실행 가능합니다.</p>\n<p>원래는 메시지큐의 Consumer역할도 분리해야, 서버의 부하를 줄이거나 원래 요청이 영향을 덜 받는 등 메시지 큐의 목적을 온전히 달성할 수 있습니다.\n그러나 한정된 자원때문에 공부 차원에서 같은 서비스에서 Producer와 Consumer를 구성하여 사용해보았습니다.</p>\n<p>현재 ELK를 사용하여 요청이 많이 들어오는 Route를 분석하였고, 이를 따로 분리하여 MSA 형태로 서비스를 운영하는걸 적용해보려 하고 있습니다. 이 과정에서 알림서버도 분리하여 운영해보겠습니다.</p>\n<p>publish, subscribe구조를 하고있어 pubsub을 썼다 생각했습니다. 근데 생각해보니 pub/sub은 재시도 기능을 지원하지 않는데 제 코드는 재시도 로직을 쓰고있어서 좀 더 알아보니 Bull Module이 Redis 기반 메시지 큐 기능을 지원하는 친구여서 저는 그냥 redis를 메시지 큐로 사용하는 구조를 만든거구나 라는걸 알았습니다. 이력서가 아직 업데이트 중이라, 잘못 기재한게 있는점 죄송합니다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>Javascript를 완전히 포함하며 추가적인 타입 안정성을 제공합니다.\n컴파일 타입까지의 타입 오류를 방지할 수 있고, IDE가 제공하는 자동완성 등을 이용할 수 있어서 개발 생산성이 증가합니다.</p>\n<p>타입 명시도 가능하고 타입 추론을 하기도 합니다.</p>\n<p>any: 어떤 타입도 상관없음\nunknown: 타입을 미리 알 수 없을 때 사용. 실제 사용 시점에 타입 체크해야 함.</p>\n<p>never: 절대 반환되지 않는 함수의 반환 타입</p>\n<p>인터페이스: 객체, 클래스의 형태를 정의. 객체의 구조를 기술하거나 클래스가 가져야 할 맴버를 정의\n타입 별칭: 특정 타입에 대한 별칭을 부여.</p>\n<p>인터페이스는 확장 가능</p>\n<p>클래스 문법에 접근 제어자 추가. Public, Private, Protected\n생성자의 매개변수에 접근 제어자를 명시해 자동으로 맴버 변수 초기화</p>\n<p>제네릭: 재사용 가능한 컴포넌트 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">function identity&lt;T>(arg: T): T {\n\treturn arg;\n}</code></pre></div>\n<p>열거형 사용하면 상구 그룹을 명명된 형태로 관리</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">enum Direction{\n\tUP, \n\tDOWN\n}</code></pre></div>\n<p>데코레이터: Annotation 형태로 기능 확장 가능.</p>\n<p>타입 유틸리티</p>\n<ul>\n<li>Partial<T></li>\n<li>Required<T></li>\n<li>Pick&#x3C;T, K extends keyof T></li>\n<li>Omit &#x3C;T, K extends keyof T></li>\n<li>ReadOnly<T></li>\n<li>Record&#x3C;K, T></li>\n<li>ReturnType<T></li>\n<li>InstanceType<T></li>\n</ul>\n<p>tsconfig.json: 컴파일 옵션이나, 파일포함/제외 등 전반적 설정을 관리</p>\n<h1>TypeScript 왜쓰나요</h1>\n<p>Javascript가 동적 타이핑 언어이기 때문에, 런타임까지 타입 에러를 알 수가 없다.\nTS를 사용하면 컴파일 단계에서 타입 오류를 해결할 수 있다 또한 IDE의 자동 완성 기능으로 생산성을 높일 수 있다.</p>\n<h1>Interface 와 type 차이</h1>\n<p>Interface는 주로 객체의 구조를 정의할 때 쓰입니다. Type은 새로운 타입 정의, 유니온 등에 쓰입니다.\nInterface는 같은 이름으로 여러번 선언하면 타입 병합이 가능하지만, type은 붉능합니다.</p>\n<h1>Generic</h1>\n<p>제네릭은 하나의 선언으로 다양한 타입을 처리할 수 있게 하기 위해 사용됩니다. 코드 재사용성을 높입니다.</p>\n<h1>Never</h1>\n<p>절대 발생할 수 없는 타입을 의미합니다. 예를들면 무조건 error를 throw하는 함수는 반환값으로 never를 가집니다.</p>\n<h1>abstract와 interface 차이</h1>\n<p>abstract는 추상 메서드를 포함할 수 있는 클래스입니다.\n상속받은 클래스에서 추상 메서드를 구현해야 합니다.\ninterface는 클래스의 형태를 정의하거나, 객체 구조를 정의합니다. 구현체가 없고, implements하여 사용할 수 있습니다.</p>\n<h1>Decorator</h1>\n<p>데코레이터는 동작을 수정하거나 확장할 수 있게 해줍니다.</p>\n<h1>tsconfig</h1>\n<p>target: javascript의 버전 선택\nmodule: 모듈 시스템 설정\nstrict: 엄격한 타입 체킹\noutdir, rootdir: 컴파일된 파일이 출력될 폴더와 소스 폴더 지정</p>\n<h1>any는 언제 사용하나요?</h1>\n<p>안사용하는게 좋지만, 정말 타입 알 수 없거나, 타이핑 안되는 외부 라이브러리를 임시로 연동할 때 사용할 수 있습니다.</p>\n<h1>Typescript 에러가 없다고 좋나요?</h1>\n<p>너무 느슨하거나 너무 엄격하면 좋지 않을 수 있다.\n도메인을 잘 표현하는 타입 설계하고 유지보수를 편하게 하는게 좋다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>Docker는 컨테이너 기반 가상화 방식으로, 호스트 커널을 공유하며 프로세스 수준으로 격리.\n전통적인 VM과 달리, Guest OS 전체를 올리지 않고, 필요한 런타임/라이브러리만 독립된 컨테이너로 띄워서 훨씬 가볍고 빠른 실행/배포가 가능하다.</p>\n<p>Call By Value: 함수를 호출할 때, 인수 복사본을 파라미터로 전달. 함수 내 변경이 원본에 영향 x\nCall By Reference:  함수를 호출할때 인수의 주소를 넘김. 변경이 원본에 반영</p>\n<ul>\n<li>C, C++: 모두 Call By Value이나 포인터 써서 reference 가능</li>\n<li>Java: 모두 Call By Value이나, 객체 변수가 참조를 값으로 가지고 있음.</li>\n<li>Python: 공식적으로는 Call By Object Reference. 객체 참조가 복사되어 함수로 넘어감</li>\n</ul>\n<p>모든 언어가 명확히 가지는것은 아님. Python, Java처럼 중간 형태를 갖는 언어도 있음.</p>\n<h1>순수함수, 함수형 프로그래밍</h1>\n<p>순수함수: 동일한 입력에 대해 항상 동일 결과를 반환. 외부상태를 변경하거나 의존하지 않음.\nex) f(x): x^2\n함수형 프로그래밍 철학은 순수 함수를 많이 사용해서, 부작용을 최소화하고 프로그램의 예측 가능성과 안정성을 높이는 것이다.</p>\n<h2>Side Effect</h2>\n<p>함수가 실행되면서 외부에 영향을 주거나, 외부 상태에 의해 결과가 달라지는 현상.\n전역변수 변경, 파일 I/O, 네트워크 통신, 콘솔 출력 등</p>\n<p>핵심 로직은 순수 함수로 작성하고, 부수적인 I/O나 전역상태 변화는 제한된 구역에서만 처리하자</p>\n<ol>\n<li>테스트, 디버깅 용이</li>\n<li>동시성에 유리</li>\n<li>가독성 향상</li>\n</ol>\n<p>순수함수는 Thread Safe 하다.\n어떤 스레드가 언제 호출해도 외부 상태에 영향 없이 결과만 반환.</p>\n<p>고차함수: 함수를 인자로 받거나, 함수를 반환하는 함수.\nmap, filter, reduce</p>\n<h1>MVC 패턴</h1>\n<p>Model: 데이터와 로직.\nView: 사용자 인터페이스, Model의 데이터를 화면에 렌더링\nController: 사용자의 요청을 받고, Model과 View를 연결시킴</p>\n<h1>디자인 패턴</h1>\n<p>소프트웨어 설계 시, 반복적으로 나타나는 문제에 대해 재사용 가능한 해법을 정형화한 것.\n생성패턴, 구조패턴, 행위패턴</p>\n<p>Singleton에서 하나의 객체 생성 보장하는 방법\nPrivate 생성자: 외부에서 new 불가능\nstatic 메서드: 내부에서 인스턴스가 있는지 확인하고 없으면 생성\n멀티 스레드 환경에서는 동기화 처리 필요.</p>\n<h1>GC</h1>\n<p>동적으로 할당된 객체/메모리를 자동 해제하는 기법.</p>\n<p>메모리 해제 실수를 방지\n개발자 생산성 향상.</p>\n<p>런타임 오버헤드\n메모리 사용량 여유 있어야 함.</p>\n<p>일반적으로 Heap영역의 동적 할당된 객체를 관리.\n스택은 함수 호출 시점에서 자동 관리.</p>\n<p>Reference Counting: 각 객체의 참조 카운트가 0이 되면 해제.\n순환참조 발생 시, 참조 카운트가 0이 되지 않아 메모리 누수.</p>\n<h1>32bit vs 64bit</h1>\n<p>CPU/OS가 한번에 처리할 수 있는 레지스터 크기가 32냐 64냐.</p>\n<p>메모리 주소를 표현할 수 있는 공간을 의미하기도 함.</p>\n<p>32bit에서는 2^32 : 4GB까지 직접 주소화 가능\n-> 가용 메모리가 4GB?</p>\n<p>CPU가 직접 접근할 수 있는 메모리가 최대 4GB\nPhysical Address Extension기술.</p>\n<h1>인증과 인가의 차이</h1>\n<p>인증은 사용자가 누구인가를 식별.\n인가는 접근 권한이 있는지 판단.</p>\n<h2>OAuth란</h2>\n<p>3rd-party 애플리케이션이 사용자 리소스에 접근할 수 있도록 인가를 위임해주는 오픈 표준 프로토콜.</p>\n<p>소셜 로그인에 이용되지만, 권한 위임 프레임워크</p>\n<p>인증 기능도 구현 가능하지만, 기본 개념은 인가 로직</p>\n<h1>JWT</h1>\n<p>JSON포맷의 Claim을 담아 서버가 클라이언트에 발행하는 토큰\nAccess Token으로 사용. HTTP Authorization 필드\nHeader, Payload, Signature로 구성</p>\n<p>서버가 Header + Payload부분을 비밀키또는 비대칭키로 서명 생성\n클라이언트는 토큰 전체 보관했다가 요청 시 전송. 서버는 다시 서명을 검증해 토큰 무결성 체크.</p>\n<p>Access Token이 탈취된 경우 대응.\nAccess Token이 유효기간 내에 탈취되면, 공격자가 해당 토큰으로 리소스 접근 가능.</p>\n<ul>\n<li>토큰 강제 무효화</li>\n<li>Refresh Token으로 재발급 시도 시 이상 감지.</li>\n<li>만료시간이 짧은 Access Token 사용.</li>\n</ul>\n<h1>암호화 알고리즘</h1>\n<p>대칭키 암호: 하나의 키로 암호화, 복호화 둘 다 수행 간단하지만 키 공유 문제</p>\n<p>비대칭키 암호: 공개키로 암호화, 개인키로 복호화. 키 공유 문제 해결</p>\n<p>해시 함수:입력 데이터를 고정 길이 해시값으로 매핑. 복호화 불가, 무결성 검증, 서명 등에 사용.</p>\n<p>비대칭키로 세션키 교환하고, 이후에는 대칭키로 빠르게 암호화 가능.</p>\n<h1>문자열 인코딩</h1>\n<p>텍스트를 어떤 규칙에 따라 바이트 시퀀스로 변환하는 것.</p>\n<p>Base64 인코딩: 바이너리 데이터를 ASCII 범위 문자로 안전하게 변환.\n이진 파일을 텍스트 프로토콜에 삽입할 때 깨짐 없이 전송</p>\n<p>ASCII에 제어문자가 있어서 64개가 가장 크게 ASCII로 표현 가능</p>\n<h1>GIT</h1>\n<p>분산 버전 관리 시스템.\n로컬 저장소, 원격 저장소 구분.\n변경 이력을 관리하고, 브랜치로 분기해서 개발 후 통합.</p>\n<h2>브랜치 합치기</h2>\n<p>Merge: 한 브랜치가 다른 브랜치의 끝을 이어받아 히스토리를 직선으로 합침.</p>\n<p>rebase: 한 브랜치의 커밋들을 다른 브랜치 위로 차례대로 재적용. 히스토리 깔끔해지지만 force push 필요해질수도 있음.</p>\n<p>squash and merge; 여러 커밋을 하나로 합쳐서 Merge</p>\n<p>Cherry-pick: 특정 커밋만 골라서 다른 브랜치에 적용.\n모든 커밋을 합치는게 아니라, 필요한 부분만 가져올 때</p>\n<h1>OAuth</h1>\n<p>Resource Owner: 사용자\nClient: 자원 소유자의 데이터에 접근하려는 3자 애플리케이션\nAuthorization Server: 자원 소유자를 대신해 권한 부여를 담장하는 서버\nResource Server: 실제 자원을 호스팅하는 서버.</p>\n<ul>\n<li>클라이언트 -> 사용자 OAuth 서버로 이동할 수 있는 URL 제공</li>\n<li>클라이언트 -> 인가 서버 브라우저 리다이렉트로 보냄. client_id, redirect_uri, scope 등 포함</li>\n<li>사용자 인증, 동의: 인가 서버가 먼저 로그인 했는지 확인. 안됐으면 로그인 시키고, scope 동의 물어봄.</li>\n<li>사용자가 동의하면 인가서버가 Authorization Code 발급</li>\n<li>클라이언트는 전달받은 인가 코드와 함께 client_id, client_secret 등 정보를 Authorization server에게 요청 -> AccessToken, Refresh Token받음.</li>\n<li>클라이언트가 Access Token으로 Resource Server에 API 요청</li>\n</ul>\n<h1>JWT</h1>\n<ol>\n<li>JSON 형태의 데이터를 담은 토큰. Header, Payload, Signature로 구성</li>\n</ol>\n<p>Header: 어떤 알고리즘으로 서명을 생성했는지.\nPayload: 실제 인증/인가 정보가 JSON 형태로 포함.\nSignature: Header + Payload기반으로 비밀키로 생성한 서명. 토큰이 변조되지 않았음 보장.</p>\n<p>Header와 Payload는 JSON -> base64url로 인코딩, Signature도 마찬가지\n토큰 내부에 식별 정보, 만료시간, 권한 범위 등 담을 수 있음.</p>\n<ol>\n<li>사용자 로그인. 성공하면 JWT의 payload를 구성</li>\n<li>서명 생성 &#x26; 토큰 발급 -> 클라이언트에 전달</li>\n<li>클라이언트가 Http 쿠키나 Localstorage에 저장.</li>\n<li>서버는 토큰의 Signature 검증. 유효하면 Payload 디코딩해서 정보 확인.</li>\n</ol>\n<p>토큰 무효화, 블랙리스트를 위해 토큰이 유효한지를 DB에 저장해 확인할 수 있음.</p>\n<p>서버 부담 없이 여러대로 확장 가능.\n요청마다 정보가 토큰에 담김\n클라이언트 분산.</p>\n<p>토큰 탈취 위험.\nPayload 커질 수 있음.\n즉각적 로그아웃/권한 철회가 어려움.</p>\n<h2>Refresh token</h2>\n<p>AccessToken보내다가 만료 시 RefreshToken을 전송. 서버가 유효한지 확인 후 새로운 Access Token발급함.</p>\n<h1>쿠키</h1>\n<p>XSS로 인해 쿠키 탈취당할 수 있다. 쿠키에 HttpOnly 속성 부여하면, JS에서 읽을 수 없다.</p>\n<p>Cross-Site Request Forgery: 악성 사이트, 스크립트가 사용자 브라우저를 통해 쿠키를 포함한 요청을 보냄.</p>\n<ul>\n<li>SameSite 쿠키 속성으로 타 도메인에서 쿠키 전송 막기</li>\n<li>CORS 정책</li>\n</ul>\n<p>HTTP로 전송되면 탈취 가능</p>\n<p>기존 세션ID를 공격자가 미리 알아낸 후, 사용자가 그 세션 ID로 로그인하도록 유도 -> 공격자가 동일 세션 ID로 접근 가능.</p>\n<p>로그인 시 새로운 세션 ID 재발급. 쿠키 재설정</p>\n<p>LocalStorage는 XSS에 취약.</p>\n<p>쿠키를 사용하되, 여러 설정 적절히 설정.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>컴퓨터 아키텍처</h1>\n<h2>하드웨어</h2>\n<p>시스템버스</p>\n<ul>\n<li>데이터 버스: 중앙처리장치 - Others</li>\n<li>주소 버스: 중앙처리장치가 주소 전달</li>\n<li>제어 버스: 중앙이 제어신호 전달</li>\n</ul>\n<p>CPU - 중앙처리장치</p>\n<ul>\n<li>연산 장치: 산술, 논리연산</li>\n<li>제어 장치: 명령어를 순서대로 실행할 수 있도록 제어</li>\n<li>레지스터: 고속 기억장치. 명령어 주소, 코드, 연산에 필요한 데이터, 결과 등 임시 저장</li>\n</ul>\n<ol>\n<li>주기억장치는 입력장치에서 받은 데이터 또는 보조기억장치에 저장된 프로그램 읽어옴.</li>\n<li>CPU는 프로그램을 실행하기 위해 주기억장치에 저장된 프로그램 명령어와 데이터를 읽어와 처리.</li>\n<li>주기억장치는 처리 결과를 보조기억장치에 저장 혹은 출럭장치로 전송</li>\n<li>제어장치는 1~3 제어</li>\n</ol>\n<p>명령어 set: 연산코드 + 피연산자</p>\n<h2>캐시 메모리</h2>\n<p>캐시미스</p>\n<ul>\n<li>\n<p>cold miss</p>\n</li>\n<li>\n<p>conflict miss</p>\n</li>\n<li>\n<p>capacity miss</p>\n</li>\n<li>\n<p>Direct mapped cache: 뒷자리 같은애들 같은 캐시로</p>\n</li>\n<li>\n<p>Fully Associative cache: 비어있는 캐시 메모리가 있으면, 마음대로 주소를 저장.</p>\n</li>\n</ul>\n<h2>고정 소수점, 부동 소수점</h2>\n<p>고정 소수점\n소수점이 찍힐 위치 미리 정해놓음\n부호(1)/정수부(15)/소수부(16)</p>\n<p>부동소수점\n지수의 값에 따라 소수점이 움직이는 방식\n부호(1)/지수부(8)/가수부(23)</p>\n<h2>패리티 비트, 해밍코드</h2>\n<p>패리티비트\n정보 전달 과정에서 오류 생겼는지 검사\n짝수, 홀수 개 맞춰줌</p>\n<p>해밍코드</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>대규모 트래픽을 어떻게 처리할 수 있을까요?</h1>\n<p>수십 혹은 수백만 명의 동시 접속이 발생하는 상황에서 시스템 확장을 위해 어떤 방안을 고려해야 할까요?</p>\n<ul>\n<li>수평 확장: 서버 인스턴스를 여러 대 늘려 부하를 분산시킴. 마이크로서비스 아키텍처.</li>\n<li>수직 확장: 서버의 CPU, 메모리와 같은 리소스를 추가해 성능을 높임.</li>\n</ul>\n<p>로드 밸런싱\nNginx, 클라우드 서비스 이용해 서버로 가는 트래픽 균등 분배</p>\n<p>캐싱 전약\nRedis, Memcache 등 이용해 DB 부하 줄이고 응답 속도 빠르게 함.</p>\n<p>DB 분산\n샤딩/레플리카 구성으로 읽기/쓰기에 대한 부담을 분산</p>\n<p>오토 스케일링\n클라우드 환경에서 트래픽 추이에 맞춰 동적으로 서버 인스턴스를 추가/제거</p>\n<p>CQRS, Event-driven 등의 분산 시스템 패턴</p>\n<h1>분산 환경에서 데이터 일관성 문제 해결?</h1>\n<p>CAP: Consistency, Availability, Partition tolerance\n분산 시스템에서 CAP를 완벽 충적은 어려움</p>\n<h2>데이터 일관성</h2>\n<ul>\n<li>트랜잭션 단위의 강한 일관성</li>\n<li>EventualConsistency: NoSQL에서 결과적인 일관성 보장</li>\n</ul>\n<h2>2PC, 3PC 기법</h2>\n<h2>분산 락</h2>\n<p>Redis, Zookeeper등 활용해 임계구역 제어</p>\n<h1>데이터베이스에 대한 설계 및 선택 기준</h1>\n<p>RDBMS\n트랜잭션이 중요하고 스키마가 명확할 때 사용.\nJOIN이 빈번하거나 강한 일관성이 필요한 경우</p>\n<p>NoSQL: 고성능 읽기 쓰기 필요한 경우. 스키마가 유연한 경우</p>\n<h1>캐싱 계층을 어떻게 구성, 사용?</h1>\n<p>대규모 트래픽 감당하기 위해 캐싱 전략 어떤거 사용?\nDB부하 줄이고, 응답 속도 최소화</p>\n<p>LRU, LFU, TTL 등으로 만료 정책 세워야 함.</p>\n<h1>로그 수집과 모니터링 시스템</h1>\n<p>Logstash, Kafka 이용해 로그 중앙화.\nES로 검색과 시각화 구현\nGrafana, Prometheus 활용해 여러 지표 모니터링</p>\n<h1>서버 장애 발생 시 대응 방법과 재해 복구</h1>\n<p>Monitoring Alerts -> 로그 분석 -> 원인 파일 -> 서비스 임시 우회, 롤백 -> 장애조치 -> 사후 분석</p>\n<p>Active-Passive: 메인 데이터센터 다운 시 백업 데이터센터로 트래픽 넘겨 복구</p>\n<p>Active-Active:  여러 지역에서 동시에 서비스, 한 쪽에 장애 발생 시 나머지 쪽이 즉시 처리</p>\n<p>데이터 백업: 지속적인 백업, 스냅샷, 로그 기반 복구</p>\n<h1>마이크로 서비스 아키텍처 도입 시 고려사항은?</h1>\n<p>장점</p>\n<ul>\n<li>각 서비스가 독립적으로 배포, 스케일링 가능</li>\n<li>특정 서비스의 장애가 전체에 영향 덜미침</li>\n<li>기술 스택을 서비스마다 다르게 가져갈 수 있음</li>\n</ul>\n<p>단점</p>\n<ul>\n<li>서비스 간 통신이 복잡해진다.</li>\n</ul>\n<p>통신</p>\n<ul>\n<li>HTTP/REST</li>\n<li>gRPC</li>\n<li>메시지 큐</li>\n</ul>\n<h1>애플리케이션 성능 테스트와 튜닝</h1>\n<p>성능 테스트 종류</p>\n<ul>\n<li>LoadTest: 정상 범위 트래픽</li>\n<li>StressTest: 전상 범위를 넘ㅇ는 과부화 상황에서 시스템의 한계 확인</li>\n<li>SpikeTest:  갑작스런 트래픽 증가 시 시스템의 반응 측정</li>\n</ul>\n<p>CPU, 메모리 사용량, 네트워크 대역폭, 응답 시간, 에러율, DB 쿼리 성능\nAPM 툴 사용 -> 성능 병목 지점 파악</p>\n<h1>보안 측면에서 고려할 사항은?</h1>\n<p>OWASP Top 10\nSQL Injection, XSS, CSRF, Broken Auth 등 주요 취약점 인지 및 방어</p>\n<p>인프라 보안\n네트워크 세그멘테이션, 방화벽 설정, 보안 그룹 설정\n서버/서비스 간의 최소 권한 원칙</p>\n<p>데이터 암호화\nHTTPS/TLS로 데이터 전송 구간 암호화\n민감한 데이터는 암호화 저장</p>\n<p>로그인 및 인증\nOAUTH, JWT, Session 기반 인증\n2FA 적용</p>\n<h1>CI/CD 파이프라인을 어떻게 구성하고, 어떤 자동화 도구를 사용하나요?</h1>\n<p>CI: 코드를 자주 통합하고, 자동화된 빌드, 테스트 실행\nCD: 검증된 코드를 자동 혹은 반자동으로 프로덕션에 배포</p>\n<p>자동화 도구\nJenkins, Gitlab, Github Actions, CircleCI등</p>\n<p>배포 전략\nBlue-Green, Canary Release, Rolling Update</p>\n<p>무중단 배포, 트래픽을 점진적으로 새 버전에 할당해 위험성 최소화</p>\n<p>단위 테스트, 통합 테스트, E2E 테스트를 CI 파이프라인에 포함해 품질 확보</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>시스템 콜</h1>\n<p>사용자 프로그램이 운영체제의 서비스를 요청하는 인터페이스\n파일I/O, 프로세스 생성/종료, 메모리 할당 등 하드웨어 자원 접근이나 OS 내부 기능을 사용하기 위해 호출</p>\n<p>ex) 파일/디렉토리 관련, 프로세스 관리 fork, exec, 메모리관리: mmap, brk, 소켓/네트워크 디바이스 컨트롤</p>\n<ol>\n<li>유저 모드에서 시스템 콜 함수 호출</li>\n<li>라이브러리 함수가 내부적으로 특수한 소프트웨어 인터럽트 발생 -> CPU를 커널 모드로 전환</li>\n<li>커널이 시스템 콜 번호, 인자 확인하고 적절한 커널 함수로 진입</li>\n<li>커널 함수가 하드웨어 자원 접근, 처리 등 OS 기능을 수행</li>\n<li>처리 완료 후 커널 모드에서 유저 모드로 복귀 &#x26; 결과를 유저에게 전달</li>\n</ol>\n<h2>모드</h2>\n<p>커널모드: CPU가 제한 없이 모든 명령어와 자원 접근\n유저모드: 제한된 명령어만 실행 가능</p>\n<p>구분 이유</p>\n<ul>\n<li>사용자 프로그램이 직접 하드웨어나 OS 데이터를 무제한으로 접근하면 위험하다.</li>\n<li>잘못된 접근을 방지, 커널만이 자원을 통제</li>\n<li>프로세스 간 보호: 메모리 보호</li>\n</ul>\n<p>서로 다른 시스템 콜을 어떻게 구분할 수 있을까?\n시스템 콜 진입 시, 레지스터나 스택에 시스템 콜 번호, 인자 전달</p>\n<h1>인터럽트</h1>\n<p>CPU가 실행 중, 하드웨어 소프트웨어가 특정 이벤트를 알려와 현재 실행 중단하고 이벤트 처리 루틴으로 넘어가는 메커니즘</p>\n<p>인터럽트 발생 -> CPI는 PC와 상태 저장\n인터럽트 벡터 참조해 적절한 주소 확인\nInterrupt Service Routine 실행. 완료 후 복원</p>\n<p>Polling: 인터럽트가 아닌, CPU가 특정 I/O 장치를 주기적으로 검사 해 이벤트 발생 여부를 확인하는 방식.</p>\n<p>CPU 시간이 낭비될 수 있다. 인터업트 방식이 일반적으로 더 효율적이다.\nHW 인터럽트: 하드웨어 신호(키보드 입력, 디스크 I/O)\nSW 인터럽트: 소프트웨어적으로 발생.(0나눗셈, 페이지 폴트, 시스템 콜 명령)\n인터럽트 간 우선순위 존재</p>\n<h1>프로세스</h1>\n<p>실행중인 프로그램 + 실행 상태\n프로그램: 실행 코드를 담은 정적 파일\n프로세스: OS 상에서 실행 중인 프로그램 인스턴스\n스레드: 프로세스 내에서 코드/데이터/힙 공유하지만 독립된 실행 흐름 가짐</p>\n<p>PCB(Process Control Block)\n프로세스 상태를 저장하는 자료구조, 프로세스 식별자, 프로그램 카운터, 레지스터 값, 메모리 정보, 스케줄링 우선순위, 파일 디스크립터 테이블 등</p>\n<p>리눅스에서\n프로세스는 for()로 복제 -> exec()으로 새 프로그램 실행\n스레드는 pthread_creat() 나 clone() syscall로 생성</p>\n<p>자식 프로세스가 상태를 알리지 않고 죽거나, 부모 프로세스가 먼저 죽으면?\n자식이 부모에게 exit 알려주지 못하면, 자식은 좀비 프로세스 됨.\n부모가 먼저 종료하면 자식은 고아 프로세스가 되어, init 프로세스가 자식 인수하여 wait()대신 호출</p>\n<h2>주소공간</h2>\n<p>초기화되지 않은 변수들은 어디 저장?\nBulk Storage Start 영역에 저장. 아직 초기값이 설정되지 않은 지역/정적 변수</p>\n<p>Stack, Heap은 프로그램 실행 시 운영체제가 가상 메모리를 할당하고, 필요에 따라 확장/축소 함.</p>\n<p>스택: 메모리 접근이 지역변수, 함수 호출 스택 프레임 구조. 캐시 친화적이고 주소 단순 계산 -> 힙보다 빠름</p>\n<p>힙: 동적으로 할당된 공간을 포인터를 통해 접근</p>\n<p>코드 데이터 힙 스택 왜 분리할까?\n관리 편의.\n힙과 스택을 양쪽에 두면, 서로 충돌하지 않으며 한쪽이 커질 때 유연하게 사용 가능</p>\n<p>스레드의 주소공간\n프로세스 주소공간 공유하지만, 스택은 스레드마다 독립\ntext영역, 전역 데이터, 힙 등은 모두 공유</p>\n<p>힙은 마구잡이 라는 뜻임</p>\n<h2>IPC의 shared Memory 기법</h2>\n<p>SHared Memory는 mmap()과 같은 시스템 콜로 힙영역에 매핑\n커널이 해당 가상 주소 범위를 여러 프로세스의 페이지 테이블에 동일 물리 메모리로 매핑해 공유</p>\n<p>스택, 힙 크기는 OS/런타임에 의해 동적으로 결정</p>\n<h1>단기 중기 장기 스케줄러</h1>\n<p>장기 스케줄러: 어느 프로그램을 메모리에 올려서 프로세스로 만들 것인가?\n시분할 시스템ㅇ메서 명시적 장기 스케줄러는 잘 없음</p>\n<p>중기 스케줄러: 프로세스를 통째로 스왑 아웃/인 하는 결정. 메모리 부족 시 일부 프로세스 임시 중단</p>\n<p>단기 스케줄러: Ready Q 에 있는 프로세스 중 어떤 것을 CPU 할당할지 결정</p>\n<h2>스케줄링 상태</h2>\n<p>New (생성 중)\nReady (CPU 할당 대기)\nRunning (CPU 점유)\nBlocked (I/O나 이벤트 대기, CPU 미사용)\nTerminated (실행 종료)</p>\n<h2>preemptive/non-preemptive에서 존재할 수 없는 상태</h2>\n<p>non-preemptive에서는 프로세스가 스스로 종료하기 전까지 CPU 뺏지 않음 -> Running -> Ready 상태 전이 일어나지 않음.</p>\n<h2>메모리가 부족하다면?</h2>\n<p>중기 스케줄러가 프로세스를 Suspend상태로 바꿔 디스크로 스왑</p>\n<h1>컨텍스트 스위칭</h1>\n<p>실행 중인 프로세스의 레지스터, PC, 상태 정보를 PCB/TCB에 저장.\n스케줄러가 다음에 실행할 프로세스를 선정\n선택된 프로세스의 PCB/TCB에 저장된 레지스터/PC 정보를 CPU 레지스터에 로드\n메모리 주소공간도 교체\nCPU가 새 프로세스로 실행 재게</p>\n<p>프로세스는 주소공간, PCB를 교체하여 상대적으로 무겁다\n스레드는 같은 프로세스 내 스레드라면 주소공간 공유하므로, PC, 레지스터, 스택포인터 교체로 충분하다.</p>\n<p>기존 프로세스 정보는 PCB/TCB 구조체나 커널 스택에 현재 레지스터, PC, 상태 레이블 등 저장</p>\n<p>컨텍스트 스위칭 시점</p>\n<ol>\n<li>시분할 타이머 인터럽트</li>\n<li>I/O 대기로 Blocked</li>\n<li>우선순위가 높은 프로세스가 Ready상태로 진입</li>\n<li>시스템 콜 중 스케줄러가 의도적으로 선점할 때</li>\n</ol>\n<h1>프로세스 스케줄링 알고리즘</h1>\n<p>FCFS: First-Come, First-Served\nShortest Job First, Shortest Remaining Time First\nPriority 스케줄링\nRound Robin\nMulti-level Queue / Multi-level Feedback Queue</p>\n<h2>RR에서 Time Slice에 따른 Trade-off</h2>\n<p>Time slice 짧으면 응답 좋아지지만, 문맥 전환 자주 발생 - 오버헤드\n길명, 문맥 전환 횟수 작아짐. 대기 시간이 길어짐</p>\n<h2>싱글 스레드 CPU에서 상시 돌아가야 하는 프로세스 있다면?</h2>\n<p>Priority 스케줄링 또는 무한 우선순위로 배정</p>\n<p>동시성과 병렬성 차이\n동시선: 실제로는 순차적\n병렬성: 멀트코어/프로세서에서 물리적으로 동시 실행</p>\n<h2>Multi-level Feedback Queue</h2>\n<p>여러 우선순위 큐 사용. 프로세스 성격에 따라 동적으로 우선순위를 조정</p>\n<h2>유저 스레드와 커널 스레드의 스케줄링 알고리즘</h2>\n<p>CPU 스케줄링은 커널이 담당\n유저스레드는 라이브러리 수준에서 관리</p>\n<h1>동기화: 뮤텍스, 세마포어</h1>\n<h2>뮤텍스</h2>\n<ul>\n<li>상호 배타적 접근을 보장하는 잠금 개념</li>\n<li>단 한개의 프로세스/스레드만 lock을 얻고, 사용 후 unlock</li>\n<li>Lock을 소유한 스레드가 unlock 해야 하는 ownership 개념이 있음</li>\n</ul>\n<h2>세마포어</h2>\n<ul>\n<li>공유 자원 개수가 의미하는 카운터 혹은 0/1</li>\n<li>카운팅 세마포어는 여러 자원을 동시에 관리 가능</li>\n<li>소유 개념이 명확하지 않고, P, V로 카운터를 증가/감소</li>\n</ul>\n<p>이진세마포어: 뮤텍스처럼 동작\nBut,  뮤텍스는 소유한 스레드만 해제 가능</p>\n<h2>Spin Lock</h2>\n<ol>\n<li>임계 구역이 매우 짧을 때, 대기 중 문맥전환 오버헤드보다 바쁜 대기(spin)이 효율적</li>\n<li>멀티코어 환경에서 lock을 곧바로 해제할 스레드가 다른 CPU에서 돌고 있으면 빠르게 획득 가능</li>\n</ol>\n<p>대기 시간동안 CPU  계속 소모</p>\n<p>짧은 임계구역에서만 사용. 일정 시간만 spin</p>\n<h2>뮤텍스/세마포어는 커널이 관리 -> 시스템 콜 호출 필요</h2>\n<p>커널이 관장하므로, 임계 구역 접근을 확실하게 보장\n블로킹 시 OS 스케줄러가 다른 태스크를 CPU에 배정 -> 자원 활용 효율</p>\n<p>시스템 콜 오버헤드가 있고\n짧은 임계구역에서는 잦은 모드 전환이 비효율적이다.</p>\n<h1>Deadlock</h1>\n<p>둘 이상의 프로세스가 서로의 자원 기다리며 무한 대기</p>\n<ul>\n<li>상호배제: 한 프로세스만 자원을 점유 가능</li>\n<li>점유 대기: 한 자원 점유한 상태에서 얻기 위해 대기</li>\n<li>비선점: 자원 강제로 못뺐음</li>\n<li>순환 대기: 고리 형태로 자원 대기</li>\n</ul>\n<p>네가지 동시게 성립해야함 가능</p>\n<ul>\n<li>자원을 공유 가능하도록</li>\n<li>요청할 때 필요한 자원 모두 미리 확보 -> 낭비 큼</li>\n<li>자원을 선점 가능하도록</li>\n<li>자원에 일정 순서 부여</li>\n</ul>\n<h2>현대 OS는 Deadlock 처리하지 않음</h2>\n<p>완벽한 예방, 회피 어려움.\n관리자가 수동으로 킬해라</p>\n<h2>Wait Free, Lock free</h2>\n<p>Lock-free: 하나의 스레드가 중단돼도 전체 시스템의 진행이 보장.\nCAS등 원자적 연산 활용</p>\n<p>Wait-free: 모든 스레드가 유한 시간 안에 연산 완료</p>\n<h1>컴파일</h1>\n<ol>\n<li>소스코드를 컴파일러가 어휘 분석, 구문 분석, 최적화 -> 목적 코드 생성</li>\n<li>링커가 여러 목적 파일, 라이브러리 결합 -> 실행파일</li>\n<li>로더가 실행 파일을 메모리에 적재, 런타임 환경을 설정, 프로그램의 시작점으로 점프</li>\n</ol>\n<h2>링커, 로더</h2>\n<p>링커: 컴파일된 목적 파일 합쳐서 실행 파일 만듦\n로더: 실행 파일을 메모리에 적재 하고, 필요한 동적 링킹 실행.</p>\n<h2>컴파일, 인터프리터</h2>\n<p>컴파일: 전체 코드를 기계어로 변환 후 실행\n인터프리터: 실행 시점에 한 줄씩 해석. 속도는 좀 느림</p>\n<h2>JIT (Just -In-Time)</h2>\n<p>실행 중에 자주 쓰이는 코드만 동적으로 컴파일해 기계어로 변경\n인터프리터 단점 개선</p>\n<h1>IPC</h1>\n<p>프로세스간 통신 방식</p>\n<ul>\n<li>파이프</li>\n<li>메시지 큐</li>\n<li>공유 메모리</li>\n<li>소켓</li>\n<li>시그널</li>\n</ul>\n<h2>Shared Mem</h2>\n<p>물리 메모리를 공유 -> 동기화 반드시 필요. 빠름</p>\n<h2>메시지 큐</h2>\n<p>양방향도 가능</p>\n<h1>Thread Safe</h1>\n<p>여러 스레드가 접근해도 데이터 불일치나 Race Condition이 발생하지 않는 상태</p>\n<ol>\n<li>뮤텍스/세마포어 등 Lock 기법</li>\n<li>Lock-Free/Wair-Free</li>\n<li>Thread-Local Storage</li>\n<li>불변 객체 설계</li>\n</ol>\n<h2>Peterson 알고리즘</h2>\n<h2>race condition</h2>\n<p>여러 스레드가 동시에 공유 자원 업데이트 할 때, 실행 순서에 따라 결과 달라짐.</p>\n<h2>Thread Safe 구현하려면 반드시 락?</h2>\n<p>반드시 락이 필요하지는 않음.\nLock-Free나 Wait Free로도</p>\n<h1>동기화 하드웨어적 해결</h1>\n<h2>원자적 명령</h2>\n<p>test_and_set, compare_and_swap, xchg\n여러 스레드가 동시에 접근해도 원자적 락 획득</p>\n<h2>volatile의미</h2>\n<p>컴파일러 최적화 방지\n동기화 보장은 x\n값이 언제 바뀔지 모름을 컴파일러에 알림</p>\n<h2>멀티코어 동기화</h2>\n<p>캐시 일관성 프로토콜, 원자적 버스 잠금 사용\n원자적 연산 시 버스 또는 캐시 라인 잠금으로 동시 업데이트 막고 순차적 동작 보장.</p>\n<h1>페이지 교체 알고리즘</h1>\n<h2>LRu 구현</h2>\n<p>Linked List + 해시</p>\n<h1>File descriptor &#x26; File System</h1>\n<p>OS가 파일 열 때 반환하는 추상 핸들 정수\n각 프로세스마다 FD 테이블 있으며, FD를 통해 파일에 읽기 쓰기 가능</p>\n<h2>INode</h2>\n<p>유닉스 계열 파일 시스템에서 파일 메타데이터를 저장한 구조체</p>\n<p>파일명은 디렉터리, 실제 데이터 위치는 I-NODE</p>\n<h1>블로킹 논블로킹</h1>\n<p>블로킹: I/O 요청 시 호출 스레드가 잠들어서 다른 작업 불가.\n논블로킹: I/O 요청 시 즉시 반환, 스레드는 계속 진행</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>그래프</h1>\n<p>정점 + 간선</p>\n<p>인접행렬: matrix ij i와 j사이에 간선 존재하면 1\n희소그래프에서 쓸데없는 공간 낭비됨\n인접리스트: graph[1] = [2, 3, 4] i에 연결된 것들 저장\n간선이 적은 희소 그래프에서 메모리 절약\n두 정점 연결 여부 조회가 조금 더 걸림</p>\n<p>정점 N, 간선 N^3 개라면?\n인접행렬은 N^2 만큼 필요하지만, 인접리스트는 N^3 개만큼 필요함</p>\n<p>사이클이 없는 그래프 = 트리 인가?\n아니다. 연결되지 않은것 있을 수 있음.</p>\n<h2>최단거리</h2>\n<p>BFS: 가중치가 없는 그래프에서 최단 경로\n다익스트라: 가중치가 음수가 아닌 그래프, 단일 출발점\n벨만포드: 음수 허용. 음수 사이클 판별 가능\n플로이드 워셜: 모든 정점 쌍 최단 경로</p>\n<p>트리에서의 최단 거리(다익스트라 x)\nDFS, BFS만으로 찾을 수 있음.\n가중치가 있으면 다익스트라</p>\n<p>다익스트라 - 힙</p>\n<ul>\n<li>힙기반 구현</li>\n<li>단순 배열</li>\n</ul>\n<h1>재귀함수</h1>\n<p>함수 진입 시, 새 스택 프레임이 call stack에 쌓임.\n콜스택 - 끝에서부터 반환됨. 돌아가면서 됨</p>\n<p>재귀 최적화: Tail Recursion을 루프 형태로 최적화 가능\nTail Recursion: 함수가 마지막에 자기 자신을 호출하는 형태. 호출 후 추가 연산 없이 결과를 바로 반환.</p>\n<p>컴파일러가 스택 프레임을 재사용해, 반복문처럼 동작시킴.</p>\n<h1>MST</h1>\n<p>Minimum Spanning Tree\n가중치가 있는 연결 그래프에서, 모든 정점을 포함하면서 간선들의 총 가중치 합이 최소가 되는 트리.</p>\n<ul>\n<li>Kruskal: 모든 간선을 가중치 오름차순으로 정렬 후, 순서대로 간선을 추가. Union-Find: 자료구조로 사이클 여부를 효율적 판단. 정렬 + Union-Find 사</li>\n<li>Prim알고리즘: 특정 시작 정점에서 출발. 인접 간선 중 최소 가중치를 선택해 트리 확장</li>\n</ul>\n<p>n개의 정점 - n-1개의 간선</p>\n<h1>Thread Safe</h1>\n<p>일부 언어/라이브러리는 스레드 안전한 자료구조를 기본 제공\nConcurrentHashMap</p>\n<p>뮤텍스로 보호 - 자료구조 접근 시 락을 걸어 동시성 제어. 잠금 충돌로 성능 저하 발생</p>\n<p>Lock-free/Wait-free: compare and swap등 원자적 연산으로 병행성 높임</p>\n<p>락을 여러 락으로 분산하거나, 읽기 락, 쓰기 락으로 분리하는것도 가능</p>\n<p>배열 길이를 안다면? 더 빠른 thread-sage 연산 가능?\n원소 단위로 원자적 CAS를 적용하면, 부분적인 동시 접근을 허용할 수 있다.\n인덱스별, 세그먼트별 락을 사용하여 병행성 높일 수 있다.</p>\n<h1>문자열 처리</h1>\n<p>Trie: 각 노드가 글자를 표현. 경로를 따라가며 문자열 존재 여부 확인\n다수 문자열이 공통 접두어를 공유할 때 메모리 절약.\n문자열이 많고, 공통 부분이 커지면 메모리 사용이 커질 수 있지만, 보통은 메모리 절약됨.</p>\n<p>kmp: 패턴 p를 전처리 하여, 본문 T를 검색할 때 재탐색 범위를 줄임.</p>\n<h1>이진 탐색</h1>\n<p>정렬된 배열/리스트에서 원하는 값 효율적으로 찾음.\n중앙 원소와 비교해, 탐색 범위 절반씩 줄여감.\nO(lon N)의 시간복잡도 가짐</p>\n<p>Lower Bound: 어떤 값 x 이상이 처음으로 나타나는 위치\nUpper Bound: 어떤 값 X 초과가 처음으로 나타나는 위치</p>\n<h1>그리디 vs 동적계획법</h1>\n<p>그리디: 매 단계에서 지역적으로 최선을 선택\n구현이 단순하고 빠름\n항상 최적해를 보장하지 않음.</p>\n<p>동적 계획법: 문제를 작은 단위로 나누고, 하위 문제 해를 재활용해 전체 문제 해를 구함.\n전역적 최적해를 보장하지만, 메모리 사용량 증가</p>\n<p>동적 계획법으로 풀 수 있는 모든 문제는 재귀로 풀수 있다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>메모리, 입력과 출력, CPU 세 가지 부분이 서로 어떻게 연관되는지 살표보자</p>\n<h2>메모리</h2>\n<p>조작할 비트들을 저장할 장소.\n메모리는 집이 빈틈 없이 늘어선 거리와 같다.\n모든 집은 크기가 똑같고, 정해진 개수만큼 비트를 저장할 수 있다.\n각 집에는 주소가 있다.\n메모리의 기본 단위는 바이트 이지만, 꼭 바이트로 읽어야 하는 것은 아니다. 32비트 컴퓨터는 4바이트 덩어리로 읽는다. 한 번에 많이 읽으면 더 많은 양의 데이터를 처리할 수 있다.\n<img src=\"images/20231212092702.png\" alt=\"\">\n컴퓨터 메모리 구조를 이런 관점으로 볼 수도 있다.\n5,6,7,8과 같이 두 집에 걸쳐 데이터에 접근하는 경우를 <strong>정렬에 맞지 않는 접근</strong> 이라고 한다. 이런 경우 한 번에 접근할 수 없고 두 번 왕복 해야한다.\n버스의 각 자리에는 누가 앉을까? 이는 사용하는 프로세서에 따라 달라진다.\n<strong>엔디안</strong> 이라는 단어가 이런 차이를 표현한다.</p>\n<ul>\n<li>리틀 엔디안: 바이트3 - 바이트2 - 바이트1 - 바이트0</li>\n<li>빅 엔디안: 바이트0 - 바이트1 - 바이트2 - 바이트3\n따라서 시스템간 데이터 전송 시에는 엔디안을 염두해 두어야 한다.</li>\n</ul>\n<h2>입력과 출력</h2>\n<ul>\n<li>I/O: 입력과 출력의 줄인 말</li>\n<li>주변장치: I/O에 연결 되는 장치들\n컴퓨터에는 I/O 처리를 위한 별도의 거리가 존재한다.\n최근에는 메모리 거리의 주소 수가 훨씬 많아지면서, 빈 주소가 많아졌다. 따라서 이제는 메모리 거리 중 일부를 I/O장치에 할당하는 것이 타당해졌다.\n아무도 사용하지 않는 주소를 몇몇 지역으로 나눠서, 각 슬롯에 할당된 장치는 자신에게 할당된 주소를 모두 사용할 수 있게 한다.</li>\n</ul>\n<h2>중앙 처리 장치</h2>\n<p>실제 계산을 처리하는 컴퓨터 부품. 도심에 해당함.</p>\n<h3>산술 논리 장치(ALU)</h3>\n<p>산술 계산, 불리언 대수 및 기타 연산 수행법을 알고 있는 장치.\n<img src=\"images/20231212094248.png\" alt=\"\"></p>\n<ul>\n<li>피연산자: 수를 표현하는 비트</li>\n<li>명령코드(연산코드): 어떤 연산자 적용할지 지정.</li>\n<li>결과: 피연산자에 연산자를 적용한 결과</li>\n<li>조건 코드: 결과에 대한 추가정보가 들어감.\n조건 코드 레지스터라는 레지스터에 조건코드 저장됨.</li>\n<li>레지스터: 메모리 거리가 아닌 다른 곳에 존재하는 메모리</li>\n<li>조건 코드 레지스터\nㅡ ㅡ ㅡ ㅡ ㅡ N Z O\nN비트는 마지막으로 수행한 연산 결과가 음수인 경우 1로 설정\nZ비트는 마지막 연산 결과가 0인 경우 1\nO비트는 마지막 연산에서 오버플로나 언더플로가 생기면 1</li>\n</ul>\n<h3>시프트</h3>\n<ul>\n<li>왼쪽 시프트: 어떤 숫자의 모든 비트를 왼쪽으로 1비트 옮긴다.</li>\n<li>오른쪽 시프트: 어떤 숫자의 모든 비트를 오른쪽으로 1비트 옮긴다.\n클록에 따라 내용을 1비트씩 시프트하는 시프트 레지스터를 플립플롭으로 만들 수 있다. -> 8:1실렉터 8개를 사용한 배럴 시프터로 해결 가능.</li>\n</ul>\n<h3>실행 장치(제어 장치)</h3>\n<p>메모리의 정해진 장소에서 명령코드와 피연산자들을 가져와서 ALU에게 해야할 일을 알려준다.\n\"위치 10에 있는 수를 위치 12에 있는 수와 더한 결과를 위치 14에 저장하라\"같은 명령어 목록을 가져온다. 어디서 가져올까?\n메모리에서 찾을 수 있다. 이런 방식을 <strong>프로그램 저장 방식 컴퓨터</strong>라고 부른다. 그럼 메모리에서 명령어를 가져오는 위치는 어떻게 알까?\n<strong>프로그램 카운터</strong>를 사용한다. 이도 레지스터의 일종이다.\n프로그램 카운터에는 메모리 주소가 들어있는데, 실행 장치는 프로그램 카운터가 가르키는 주소에서 명령어를 읽어온다. 그 후 프로그램 카운터 값은 증가한다.\nCPU마다 초기 프로그램 카운터 값이 있고, 전원을 키면 이 값으로 세팅된다.</p>\n<h2>명령어 집합</h2>\n<p>명령어를 명령코드, 두 피연산자, 그리고 결과라는 네 가지 필드로 나누자.</p>\n<h3>3주소 레지스터</h3>\n<ul>\n<li>명령코드 4비트</li>\n<li>피연산자B 4비트</li>\n<li>피연산자A 4비트</li>\n<li>결과\n이렇게 필드를 나누면, 결과와 피연산자를 16주소밖에 쓸 수 없어서 제대로 사용할 수 없다.\n또한 세 가지 메모리 위치를 한꺼번에 지정하는 접근을 사용한다. 주소 버스와 데이터 버스를 각각 3개씩 둬야 하는데, 이는 작동할 수 없는 구조이다.\n-> 한 번에 한 메모리 위치에만 접근할 수 있게 하면 좀 더 많은 비트를 주소에 사용할 수 있다.\n레지스터 거리에 다른 집을 추가하여 이를 구현할 수 있다.\n이 레지스터를 <strong>누산기</strong>라고 부른다. 누산기는 ALU가 계산한 결과를 저장한다.</li>\n</ul>\n<h3>1주소 레지스터</h3>\n<ul>\n<li>명령코드 4비트</li>\n<li>주소 12비트\n두 메모리 위치에 있는 값 사이에 연산을 수행해서, 결과를 다른 메모리에 넣는 대신, 한 메모리 위치와 누산기에 있는 값을 연산해서 누산기에 값을 저장한다.</li>\n</ul>\n<h3>주소 지정 모드</h3>\n<p>누산기를 사용하면 12비트를 주소 지정에 사용할 수 있지만, 여전히 충분하지 않다. 이런 방식으로 주소를 가르키는 경우를 <strong>직접 주소 지정</strong>이라고 한다.</p>\n<ul>\n<li>직접 주소 지정: 주소를 직접 가리키는 경우</li>\n<li>간접 주소 지정: CPU 명령어에 들어있는 값을 피연산자 주소로 해석하지 않고, 피연산자 주소를 얻을 수 있는 메모리 위치를 가리키는 주소로 사용.</li>\n<li>즉시 주소 지정 모드: 주소에 해당하는 비트를 그냥 값으로 간주.</li>\n</ul>\n<h3>조건 코드 명령어</h3>\n<p>아직 조건 코드를 다루는 명령어에 대해 설명하지 않았다.\n조건 코드를 원하는 값으로 설정하거나, 조건 코드의 값을 살펴볼 수 있는 방법이 필요하다.</p>\n<ul>\n<li>cca: 조건 코드 레지스터의 값을 누산기로 복사</li>\n<li>acc: 누산기의 값을 조건 코드 레지스터에 복사</li>\n</ul>\n<h3>분기 명령어</h3>\n<p>지금까지 배운걸로는 명령어를 처음부터 끝까지 순서대로 수행할 수밖에 없다.\n프로그램 카운터의 값을 바꿀 수 있는 명령어를 분기 명령어 라고 한다.</p>\n<h3>최종 명령어 집합 구성</h3>\n<ul>\n<li>모드 2비트</li>\n<li>명령코드 4비트</li>\n<li>주소 10비트</li>\n</ul>\n<p>주소 지정 모드가 3가지 있으므로 2비트가 필요하다.\n명령코드에는 분기 명령어가 포함 돼있다.</p>\n<h2>마지막 설계</h2>\n<p>지금까지 만든 것들을 모아 컴퓨터로 만들어 보자. 모두 함께 작동하려면 접착제에 해당하는 요소가 필요하다.</p>\n<h3>명령어 레지스터</h3>\n<p>명령어를 실행하려면 컴퓨터 내부에서는 어떤 일이 벌어져야 할까? 이를 두 단계로 나뉘어진 상태 기계로 설명할 수 있다.</p>\n<ul>\n<li>패치 &#x3C;--> 실행\n처음에 컴퓨터가 해야 할 일은 메모리에서 명령어를 가져오는 <strong>패치</strong>이다. 명령어를 가져오고 나서는 어떻게 실행해야 할지 고민해야 한다.</li>\n<li>명령어 레지스터: 현재 실행중인 명령어를 저장</li>\n<li>프로그램 카운터 -> (주소 버스) -> 메모리 -> (데이터 버스) -> 명령어 레지스터</li>\n</ul>\n<h3>데이터 경로와 제어 신호</h3>\n<p>프로그램 카운터의 값을 메모리 주소 버스에 넣을 방법과 메모리에 있는 데이터를 명령어 레지스터로 넣을 방법이 필요하다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 111.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsTAAALEwEAmpwYAAACiklEQVR42nWUeZOiQAzF+f5fzVr9w+JQFORsLkXBg/Ga+XVHcXdrN2UxoclLXl7SY2VZlsRxaGxjLAgC7YdhFEU81+t1nud1XZdlWVWVUgrItzErjmLHdsCEQeC57mKxiPRLSIS/9AOD3G63hD6fT563242TFzjP8qJQRVFw5Ps+ZamAH8cxn+qqbtt2t9sRinO5XAQsiQBrDse+h1hrjFT7/b4qy+v1um9bygIGkyZp0zTDMJD0fr8L7YhqaZrSm+u6jm1nabparRaexzkp1quV6zjL5ZLs5J3P57PZjM5IZ8GBP/AhJYSliKlcnc9niECN1DhIRS6IhEHY972ujDyHw4EXYASR63Q6kQWf87qqIC/yEEC6x+PxEYwiaZJItOd60CMo2kQob9s25O+Ph4QCQ6c/BBs/iJ6UxaECEjR1rfKcduTrP0ZVGKOyTEvlCl9vQppyAvLL2PfbABPzXpI4TpKElcjS7GVpxjB4ButAhBzbFvBnwxCMwdCwWcbNRnb0takbDmNjydvwGSF4ZLf4zGIRrXc4yz+m9CMzcxqNV+JJASN8i/QozNF0OmUNUAV5WCDo8Xy8pf6dNklRAUUM2PcZzPTXlHfGAxE95K4jN+tVGpOympBS0NayKaXBRNP2ZDLhM9srNXkyNhhyDXfbHdfL8zwAtMrCI6EGE4QnmbjGsncoLA5LJmxp8ng8juQJ0OCxE9NGiWzALsNFVsVxHMbRdR0qb8wiwx/adKd7FrBsDySZLVcHB/5915Me8hez7dy/r2HYNs1ysQAJ5G+w7APrzaRE9pGafIIOd4EbgWM9jclIZJiirTjsbaGU/tGS+VGfiUo9izZI05r/GLLeyEv/w/9tHP4PwB7GFlZ+chkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231214221740\"\n        title=\"\"\n        src=\"/static/d95c34a117486aa4f70e903cd081b86f/5a190/20231214221740.png\"\n        srcset=\"/static/d95c34a117486aa4f70e903cd081b86f/772e8/20231214221740.png 200w,\n/static/d95c34a117486aa4f70e903cd081b86f/e17e5/20231214221740.png 400w,\n/static/d95c34a117486aa4f70e903cd081b86f/5a190/20231214221740.png 800w,\n/static/d95c34a117486aa4f70e903cd081b86f/91f10/20231214221740.png 992w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n+) 간접 주소 레지스터: 간접 주소 지정을 사용할 때, 메모리에서 읽어온 주소 저장.</p>\n<h3>데이터 흐름 제어</h3>\n<h2>RISC와 CISC명령어 집합</h2>\n<p>명령어가 복잡해지면서, 컴퓨터 제어 회로도 복잡해졌다. 통계적으로 분석한 결과, 복잡한 명령어 중 상당수는 거의 쓰이지 않는다는 사실을 발견했다.</p>\n<ul>\n<li>RISC: 프로그램의 실행시간을 대부분 차지하는 명령어만을 포함하는 기계.</li>\n<li>CISC: 기존 설계 방식으로 만든 컴퓨터\nRISC는 <strong>적재-저장 구조</strong>를 사용한다. 메모리와 레지스터를 오가는 명령어들과 레지스터 간 명령어로만 이뤄진 구조이다.\nRISC에 새로운 명령어를 추가하면서 최근의 RISC는 예전 CISC보다 훨씬 복잡해졌다.</li>\n</ul>\n<h2>GPU</h2>\n<p>그래픽 처리 장치\n비디오를 매끄럽게 처리하려면 몇백만 개가 넘는 지점을 초당 60회 이상 계속 그려야 한다.\n그래픽 처리는 아주 특화된 작업이기 때문에 CPU의 모든 기능이 필요하진 않다.</p>\n<ol>\n<li>GPU에는 간단한 처리 장치가 아주 많이 들어 있다.</li>\n<li>GPU는 CPU보다 메모리 버스의 폭이 더 넓다. -> 메모리에 더 빠르게 접근 가능</li>\n</ol>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>Commandline Interface에서 어떻게 kafka를 동작시키는지 간단히 알아봅시다.\n<a href=\"https://beming-dev.github.io/subCategory/about/\">hello</a></p>\n<p>kafka가 설치돼있고, 환경변수를 등록해서 bin경로 없이 kafka명령을 실행할 수 있는 환경을 가정한다.</p>\n<h1>Kafka Broker</h1>\n<h2>Broker 시작</h2>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">kafka-server-start.sh ~/kafka_2.12-3.9.0/config/kraft/server.properties</code></pre></div>\n<p>server.properties 파일 정보를 사용해서 kafka-server-start script를 실행시킨다.</p>\n<h1>Topics</h1>\n<h2>topic 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-topics.sh --bootstrap-server localhost:9092 --topic first_topic --create</code></pre></div>\n<p>bootstrap-server를 지정해주고, topic 이름을 지정해주며 kafka-topics script를 실행한다.</p>\n<h2>partition 개수, reprication factor 지정</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-topics.sh --bootstrap-server localhost:9092 --topic first_topic --create --partitions 3 --replication-factor 1</code></pre></div>\n<p>다음과 같이 partition 개수와 replication-factor를 지정해주며 topic을 생성할 수 있다.</p>\n<ul>\n<li>broker 개수보다 큰 수의 replication-factor는 지정 불가</li>\n</ul>\n<h2>topic list 보기</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-topics.sh --bootstrap-server localhost:9092 --list</code></pre></div>\n<p>다음과 같이 list 명령을 사용하면 생성된 topic들의 이름을 확인할 수 있다.</p>\n<p>하나의 topic의 세부 사항을 보고싶다면 describe 옵션을 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-topics.sh --bootstrap-server localhost:9092 --topic first_topic --describe</code></pre></div>\n<h2>topic 삭제</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-topics.sh --bootstrap-server localhost:9092 --topic first_topic --delete</code></pre></div>\n<h1>Producer</h1>\n<p>producer와 관련해서는 kafka-console-producer.sh script를 사용한다.</p>\n<h2>producer 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic first_topic</code></pre></div>\n<p>다음 명령으로 first_topic에 대한 producer를 생성할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAP0lEQVR42iXIOQ6AMAwFUXocKY1leef+l/wBU0zx5lpBWA+B8sbODbdAZiDir6pgZmDm9+f0fVWFu4+7GyIyPvKgGeorngQMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250104143219\"\n        title=\"\"\n        src=\"/static/5cb321a11a966c8e7c8c349143c5d8d5/5a190/20250104143219.png\"\n        srcset=\"/static/5cb321a11a966c8e7c8c349143c5d8d5/772e8/20250104143219.png 200w,\n/static/5cb321a11a966c8e7c8c349143c5d8d5/e17e5/20250104143219.png 400w,\n/static/5cb321a11a966c8e7c8c349143c5d8d5/5a190/20250104143219.png 800w,\n/static/5cb321a11a966c8e7c8c349143c5d8d5/c1b63/20250104143219.png 1200w,\n/static/5cb321a11a966c8e7c8c349143c5d8d5/29007/20250104143219.png 1600w,\n/static/5cb321a11a966c8e7c8c349143c5d8d5/5ba90/20250104143219.png 1604w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n다음과 같이 입력할 수 있는 > Interface가 표시되고, 여기에 메시지를 입력해서 topic으로 전송할 수 있다.</p>\n<p>존재하지 않는 topic에 대해 producer를 생성하면, server.properties의 기본 설정에 따라 topic이 자동생성됨.\n실수 방지를 위해 error를 반환하도록 이 기능은 꺼두는게 좋음.</p>\n<h2>acks 설정</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic first_topic --producer-property acks=all</code></pre></div>\n<p>--producer-property 옵션으로 property를 지정하여 producer를 생성할 수 있다.\n위와 같이 명령하면 acks가 all이므로 모든 broker의 확인을 받게 된다.</p>\n<h2>roundrobin 방식 사용</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-producer.sh --bootstrap-server localhost:9092 --producer-property partitioner.class=org.apache.kafka.clients.producer.RoundRobinPartitioner --topic first_topic</code></pre></div>\n<h2>key 지정</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-producer.sh --bootstrap-server localhost:9092 --topic first_topic --property parse.key=true --property key.separator=:</code></pre></div>\n<p>\":\" 을 기준으로 key value를 지정하겠다는 의미이다.</p>\n<p>\">\" 표시에 key:velue(ex)name: mingwan) 과 같은 형식으로 데이터를 전송하면 key가 입력된다.</p>\n<h1>Consumer</h1>\n<h2>consumer 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic second_topic</code></pre></div>\n<p>위의 명령을 생성하면 CLI가 대기 상태로 진입한다.\nproducer를 통해 메시지가 topic에 생성되면, consumer에도 표시된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwklEQVR42qWO2W6EMAxF88YSR0A7xBCUkLBI0///wFscaRaYvvXh6C6yLSt/9yDWMEww44E16NliGAYwc9a+72Htq7t6UaFpGqh92aArjaqoUJd1piiKE2VZfnR/IXNqdAGTc5imCTwwRjcipgjv/ZMQQuaa53l+9qIxRij/M4M3i1u4ofMtvv0X0pqwLAtSSljXNQ/KsnSCZOkfXhDvjsfUft9BDaGmCtpoaDrQGkSUMcac/Hu+IntKLndtdzryH34B8eiS853g/t0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250104144640\"\n        title=\"\"\n        src=\"/static/7b08869b785eb7c3f2abcfc682664306/5a190/20250104144640.png\"\n        srcset=\"/static/7b08869b785eb7c3f2abcfc682664306/772e8/20250104144640.png 200w,\n/static/7b08869b785eb7c3f2abcfc682664306/e17e5/20250104144640.png 400w,\n/static/7b08869b785eb7c3f2abcfc682664306/5a190/20250104144640.png 800w,\n/static/7b08869b785eb7c3f2abcfc682664306/c1b63/20250104144640.png 1200w,\n/static/7b08869b785eb7c3f2abcfc682664306/29007/20250104144640.png 1600w,\n/static/7b08869b785eb7c3f2abcfc682664306/5c263/20250104144640.png 1636w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n다음과 같이 2개의 CLI창을 띄워두고 하나는 producer, 하나는 consumer로 생성을 하면 다음의 동작을 확인할 수 있다.</p>\n<h2>처음 메시지부터 보기</h2>\n<p>consumer를 켜면 켜진 시점부터 받은 데이터만 표시된다. 모든 데이터를 확인하려면</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic second_topic --from-beginning</code></pre></div>\n<p>다음과 같이 불러오면 된다.</p>\n<p>partition이 여러개라면 partition간의 순서는 고려되지 않고 데이터가 읽히므로, 순서가 뒤죽박죽일 수 있다.</p>\n<h2>key, value, timestamp 표시</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic second_topic --formatter kafka.tools.DefaultMessageFormatter --property print.timestamp=true --property print.key=true --property print.value=true --property print.partition=true --from-beginning</code></pre></div>\n<p>복잡해 보이지만, timestamp, key, vlaue, partition정보를 true로 하고 defaultMessageFormatter로 출력하도록 지정하는 간단한 코드이다.</p>\n<p>이렇게 하면 메시지 정보가 다른 정보들을 포함해서 display된다.</p>\n<h1>consumer group</h1>\n<h2>consumer group 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic second_topic --group my-first-application</code></pre></div>\n<p>second_topic에 대해 my-first-application이라는 이름의 group에 consumer를 생성한다.\n같은 group에 여러 consumer를 생성하고 메시지를 보내면 메시지가 번갈아서 표시되는걸 확인할 수 있다.</p>\n<h2>consumer group list 확인</h2>\n<p>여기서 부터는 kafka-consumer-groups.sh script를 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list</code></pre></div>\n<h2>group의 상세정보 확인</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe -group my-second-application</code></pre></div>\n<h2>+</h2>\n<p>group을 지정하지 않고 consumer를 생성하면 임시 consumer group이 생성되고 거기에 consumer가 할당된다.\n잠시 후 사라지기 때문에 이 group을 사용해서는 안된다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>Kafka Topics</h1>\n<p>데이터의 stream\n원하는 만큼 많이 가질 수 있음.\n이름으로 식별\nsequence of messages = data stream</p>\n<h2>partitions</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABNElEQVR42nWRW0vDMBiG9/9vRMcuRATR6YVM1GvddKBubDph1OHsdIg41rnRtLY5NGlfv6QiuzHwkHwk75NTBWutKAoYY6C1ocIgYBk2Ljg2m8Qlx1aLo3YlUG2muB5zmwDnAoPhCCGLnaOyLszzHJnWEFJBSYEglDi4U6h3FA6Jo67C7o1EtUXCF+GEcZzg/tHDchWWQk0Cu4sQEoaEtrY9ihxMaJz6Ec58hnPqG2OGWaJ+b1MeQqkMz/4U8XdSCu3g43OG2TxwMktKGyjBsaDwtseIEDtPDLVhiNdYOZtU2j2RzfcHHoLF6p8rZ+VCqpAkBr0uJ4TjoSfQaqeYTMVfxp5w8vaOJOWl0IbXsR9iJ4Xk+FpJ7DcigjnqJwx7xxGGo5Sihj6QniWK0b7tYx4snfAHgL3Bk0DcT/IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250104130351\"\n        title=\"\"\n        src=\"/static/53282db82377e7708e4f3392f02995f9/5a190/20250104130351.png\"\n        srcset=\"/static/53282db82377e7708e4f3392f02995f9/772e8/20250104130351.png 200w,\n/static/53282db82377e7708e4f3392f02995f9/e17e5/20250104130351.png 400w,\n/static/53282db82377e7708e4f3392f02995f9/5a190/20250104130351.png 800w,\n/static/53282db82377e7708e4f3392f02995f9/4c42d/20250104130351.png 896w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>각각의 메시지는 partition에 할당되고, 고유한 id를 가짐. 이 id를 partition offset이라 부름.\n데이터가 partition에 기록되면 삭제, 수정 등 불가(immutability).\n데이터는 정해진 limited time동안 기록됨\n키가 제공되지 않으면 random partition에 기록됨.</p>\n<h1>Producers</h1>\n<p>topic에 데이터를 적는 주체.\n어떤 partition에 데이터를 기록할지 알게됨. broker가 정하는게 아님.\npartition이 고장나면 producer가 어떻게 복구할지 알고있음.</p>\n<p>key=null이면, round robin방식. partitions에 차례대로 하나씩 기록\nkey 제공되면 해싱. 동일한 키는 동일한 partition으로 기록.</p>\n<h2>message anatomy</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 486px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 106.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACdklEQVR42oVUYXeiMBDk//+23ofe1UNRsa1aTwGlEJIAwnZnAxy1tOa9fYlks5mZnegZY6iuKqo4yonAnrGWtOa8uv60V93M2ljykHxvXK9XOXBvmNuCs4OlVWzpcV/Qr21Btm7le42CpSt4tooekpC2RUJPly39fd+TbWrZs/am4DkrJFKl6ZTmVHGhoWCHsGTaUXahTHOuyiSubfO1YNu2pPKclFIMXVPOa2jWU666gviWZTkVWnNuIYGzkwi/G2PKPw0pmOVKxEQXb8PakguVbp/dgKL45vb1/1zj5oxZfYuwbdqBUlHojqKSQqDYTnX5J8rQLdy80MxfkL9Y0Wq9ofD5hfz5kveaadtMFcTtl/RdUEEOICsK7ugllQOK16B3TlNqmuarhkhA56qR41EMh6BdyZpZeSna7bOm0AyXVGU1nEOglodE3ASKfeB3XV/pFMX073ii5HyR9fEUyQwA7aczbg0QQhk0+00ki+94Xq5D1jCgzfMr/Z75NA9WtAjWgngMoAcBB3igl6N7TAOQd28H+Y2LMIMi7IIZlwHtbv82nBGNOWD2oSBubBglDkRJIuiAGr5CMdG4Q46GnWKX00uFGdJJU3LxmuKnpqRAzAgw4zeEt2XfFOOE59yYLwUi5OSS6wLgpCkQFc8L0YzWaMiS/fe621PEqIJVKI1phY3LkbkLUPfshA/7ESdnMfNuf6CUqcLox2N07y3nw1s2xr1R0HLaloNH0ST5xxZzO7P3Z0z3liGBh2LjAYH9xVLs8vjku/U8oD9sG9gnWIa0ZqT4Dn3HrOTpgbezRikJ6KpDrIdnBzthbTqb9P82oDg+Cw0/AFErYEokzT8kAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250104131523\"\n        title=\"\"\n        src=\"/static/5b3ded9d5f57b2971a609fc28a46c487/4ee7f/20250104131523.png\"\n        srcset=\"/static/5b3ded9d5f57b2971a609fc28a46c487/772e8/20250104131523.png 200w,\n/static/5b3ded9d5f57b2971a609fc28a46c487/e17e5/20250104131523.png 400w,\n/static/5b3ded9d5f57b2971a609fc28a46c487/4ee7f/20250104131523.png 486w\"\n        sizes=\"(max-width: 486px) 100vw, 486px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\nkafka 메시지는 다음과 같은 구조를 가집니다.</p>\n<h2>Kafka Message Serializer</h2>\n<p>kafka는 입출력으로 byte만 사용.\n따라서 Serializer가 입, 출력을 Serialize, 해줌.\nkey, value에 대해 적용됨.</p>\n<h1>Consumers</h1>\n<p>Topic에서 data를 읽는 주체. - pull model</p>\n<p>Deserializer를 이용해서 Deserialize하여 프로그래밍 언어가 읽을 수 있는 형태로 변환.</p>\n<p>producer 단계에서부터 타입이 잘 정의되어 있어야 함. Topic의 타입 변경 불가.</p>\n<h2>consumer groups</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoElEQVR42m2Q30uTYRTH9ycVUX9GhZUtE1dQDlEk6cqLLkKcPyBtlE7GmqLLNHGZMJQEbxQvregqKbyxlkXvNnl/be+e99N53neTSR44POd8v+f7fc7zRDLzy1yNPqSts4eRyRRT6Xmud8QDbOJlhsnpLDeE0/1MdpGh8Rfc7OrlWrSbhaU8T4YnuBWT/k43q+83iGRzK9y+10fng0eMJ9NMZ3JE7/fTHuvjuZglU3PcFa5dROm5NySeTdEVfxxoXr9d4+lIkpj0ej6/vkmERtTrdXzfD2qlVJDN8IRTKuT0jJ5trZs6HWcMPc9DNc8Ww5CrCadxbaAE8/CVahjyv2F4o6L41+bgh8n3Xw7HZZfjksu3nxZfj0ypHYqGy+FvwYo2fypuoGmNU8PwRR69ixaXRi0uJkz6lx0GVhwuj2nMZvCdQzxnc2XM5ELCYrhg6f0b2nM21OTWF5PsjsUryc1PZTY+lpjZLpOS/PDZoLBfYXY35PcOzEBz7obh5ytqNbnVt6WzscwS5olB1TKoSZ5UDFy7EnB6plq15Q/PPvkfTT8noPP4sB0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250104132656\"\n        title=\"\"\n        src=\"/static/8f3806f779f4f8770f37cbcbbdc47770/5a190/20250104132656.png\"\n        srcset=\"/static/8f3806f779f4f8770f37cbcbbdc47770/772e8/20250104132656.png 200w,\n/static/8f3806f779f4f8770f37cbcbbdc47770/e17e5/20250104132656.png 400w,\n/static/8f3806f779f4f8770f37cbcbbdc47770/5a190/20250104132656.png 800w,\n/static/8f3806f779f4f8770f37cbcbbdc47770/e0885/20250104132656.png 918w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>같은 topic을 읽는 consumer들의 group.</p>\n<p>같은 topic을 읽는 여러개의 consumer group도 존재 가능.\n보통 service당 하나의 consumer group 갖게 됨.</p>\n<h2>Consumer offsets</h2>\n<p>kafka는 consumer group이 읽고 있던 offset을 저장.\n어디까지 읽었는지 offset을 commit</p>\n<h2>Delivery semantics for consumer</h2>\n<p>default JAVA - automatically commit offsets (at least once)\n수동</p>\n<ul>\n<li>At least once: 최소한 한 번 메시지가 처리된 직후 offset commit. 메시지를 다시 처리할 수도 있음.</li>\n<li>At most once: consumer가 메시지를 받자마다 offset commit. 처리가 잘못되면 메시지 잃음</li>\n<li>Exactly once:  메시지를 딱 한번 처리</li>\n</ul>\n<h1>Brokers</h1>\n<p>Kafka cluster는 다수의 brokers로 이루어짐.\nbroker = server\nID로 식별됨\n각 broker에는 특정한 topic partitions만 담김 -> 데이터가 모든 broker에 걸쳐서 분산됨.\n하나의 bootstrap broker에 연결되면, 전체 kafka cluster에 연결됨. -> broker개수 많이 가능.</p>\n<p>ex) 3개의 partition을 가진 Topic A와 2개의 partition을 가진 Topic B. 3개의 Broker가 존재한다고 가정.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABgElEQVR42kWQzUocQRSF+wl8CBdZuQg+grssBLMKwRdwFoEEA1mID2AgIIwhIOoiEBJiZqKCESQQjEMQxVEXA4LoIklPt5mptrurqn+qlS813aIXDlXUOfVxOU6WZhgtSWVEriQmSchNwWCy3FAkitx6mYptzt7zvPRMUdistn/iWy8mtyznj5A0j30a7b98aXvsnAUlaDCRStnq9Fg9dGkeuWx2/nElk9IrjOHXRcDntsv6iUvDMn73Fc72ecjwe4+JLZ+HnzzGNy7tFhWwGyaMfvQYW/cZW/MZ+eBzIXTpcWN43LjkwYrHo6bPUL3LxmmEc3Qmqb0NeLEoqC0I5laDO2AvTHm1Inj2rtL0UkC3X214Uxi+dq5YOBAstwXze4JTX+Kc7CmmxzX1lwGzT2PePLc9mQrY76XMTirmpiJe10Jmnmg8twKmmSG1nV/bjgc9XycSrTRO19X8+KZpfVflud+6B0qZsWvff24rdm4VRmnpDTJBLK1UKRFJYqX5DwcsqJBd2y64AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250104134258\"\n        title=\"\"\n        src=\"/static/44dac8aefbe5642395c38b5b6536ca0d/5a190/20250104134258.png\"\n        srcset=\"/static/44dac8aefbe5642395c38b5b6536ca0d/772e8/20250104134258.png 200w,\n/static/44dac8aefbe5642395c38b5b6536ca0d/e17e5/20250104134258.png 400w,\n/static/44dac8aefbe5642395c38b5b6536ca0d/5a190/20250104134258.png 800w,\n/static/44dac8aefbe5642395c38b5b6536ca0d/6bfd0/20250104134258.png 1011w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>topic의 partition들이 여러 broker에 저장되는걸 kafka scale이라함.\nhorizontal scaling - broker, partition이 추가되면 rebalancing됨.</p>\n<p>bootstrap server: cluster에 있는 각각의 kafka broker</p>\n<h1>Topic replication factor</h1>\n<p>topic은 1보다 큰 replication factor을 가져야 함.\nbroker가 down됐을 때, 다른 kafka broker가 사본을 가지고 있어서 그걸 받을 수 있게 됨.</p>\n<p>ex) topic A가 2의 replication factor를 갖고 있다고 가정.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABbklEQVR42j1RS0sCURSef1NUq4jBRYtCsjYVRtELCqJwE7TpfxQF9qBISvEVvtIpSjMoolZBUYgmGC1DM58zc2fm6x5tOnA43HvOd7/zfVdQFIZGUwFVWVHBmAYKwzAgyyqarVRaPUq6p6A5hZ8Ja/ZUlUFw+6NwHniwvX+Cs4s0dA4wQS9vWWzuuLB35MMGr6+ZPDRNx0+lCpUxRBIpbO0ew3nogTsQQ70hQxAH7ei3TaKzz4rZpTU+qCH7XkCt3kQwfI5u0Qb7nAMdvVZEpSQnycHljeCrWMbU4ip6LMMQB8ZhsU6gUq1BCMev4A9JnCGK69tHfJcrCPG7p+cMkjf3GJtZwYJjHaPTy7z/8CeXQdMNXKbv4AnG4AslEOFkrQ1JQlsgoHAPKDWt7aP3NM43GIF93oEucQhETqHress/8swMxjHktVDiG9FWZiVvdL1Nkct/IBCWuNQUly8hX/j8f4DmSuXqfxY5lj7mFx5sljLJMNl2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250104134842\"\n        title=\"\"\n        src=\"/static/5da0bef11ed159c89a6138fc4f5e7871/5a190/20250104134842.png\"\n        srcset=\"/static/5da0bef11ed159c89a6138fc4f5e7871/772e8/20250104134842.png 200w,\n/static/5da0bef11ed159c89a6138fc4f5e7871/e17e5/20250104134842.png 400w,\n/static/5da0bef11ed159c89a6138fc4f5e7871/5a190/20250104134842.png 800w,\n/static/5da0bef11ed159c89a6138fc4f5e7871/34e70/20250104134842.png 1053w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n102가 고장나면, 101과 103으로부터 복구.</p>\n<h2>Leader for a Partition</h2>\n<p>1개의 broker만 partition의 leader가 될 수 있음.\nproducer는 leader인 broker에게만 데이터 전송.\nISR: In-sync-Replica. 동기화 돼있는 경우.</p>\n<h1>Producer Acknowledgements</h1>\n<p>producer는 데이터 쓰기 확인을 받을 수 있다.</p>\n<ul>\n<li>acks = 0: producer가 확인을 기다리지 않음. 데이터 유실 가능</li>\n<li>acks = 1: Leader의 확인을 기다림. 데이터 유실 제한</li>\n<li>acks = all: Leader와 모든 replica의 확인 필요. 데이터 유실 안됨</li>\n</ul>\n<h1>Kafka Topic Durability</h1>\n<p>N의 복제 계수 가지면, N-1개의 broker를 잃어도 클러스터에 데이터 존재</p>\n<h1>Zookeeper</h1>\n<p>최신 버전에서 사라졌지만, 이전 버전에서 여전히 필요.</p>\n<p>broker들을 관리함.\nleader election 과정에 도움을 줌.\n변경이 있을 떄 broker들에게 알림.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>왜 MSA의 적용이 필요할까?</h1>\n<p>About에는 현재 20개에 가까운 다양한 Route들이 존재합니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 274px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 437%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAABXCAYAAAAERWXPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKEUlEQVR42p1ZSXNT6RVVkgWpJh1A1jyP1jxYgydZg61ZliVbtmxjG2waN00aaIaGkJAK3SmKJqmuSqqyyCabLLNKVTb5eyfnfpINLgrrqRdfyXrv6Xv3u/eec8+91nl9PrgcLsTXE8gOcvC4PEin0nC5XDCZTDCbzVMtnT8QhNvhxPxwHq1HbQT8AaxWVuH3+2E0GmGxWM4flr8nLZ3VaoXdYYd5xoygPwofXzAzo4fNboeTVtpsNvXpcjk1baqTH0SiMczOBvDk+3c4fvAMuXwerUYba6trqFWraDZbyOazMBgMEAMu3dDpdKqH5O12bm40jI4p1+RlalltsNNis0WjhaFwBH6fF9XtfeydnCLM7+udNsrFElZKZcQiIeXPSdapDe12B9weDxz0Y2BuBQuVFqJ0QWFpCYl4HOm5DMLBgPagOBwOuNxuyOewaEI5Y4eFR5Tv0VicD5npO1qnYbMLR/Z63PjP6wT++6+HSKTz6K130e50GaxZlY8Wi1Xbhh8GxWRxwsaclBsGwwz0TJ/RZhbNa5w2UQQCfjx5/Qa3v36CdDaH7nobG90eSitFGIwGTQE596GkhNVqQWA2BH9gViVyMBhUqPG4PZoDMo6yXcHMw8B0Bnso1Vpwu13IZDOYm8siFotMv2GA1ngYlN2Te+jtHjEQIZRKJTSIlsLyIkxjTE95ZCu8Pr9KFwmEkcvpdCnrJHA2G31onTYo373D3ce/VYndbnWxu3cL3U4HHa7t7W1kU8mRtZcE6ELaSGBMY4jJi84wPbrHTbSyzWwoBJ/C8hE6w0OF5YX5BSwsLnEtolIpo1QsIpVITAyQwrKHWLbbbcgUKhjsH8Lr9SHHXJzLZMjeKSwVlvk9q7A9cUOFZeadkENmfhFBWic35Loc0+31wM37RqPpnMEnHjkcEfry4euX3xEpT1VQ1jvrqNWaWO/3sT8cwu/1amNsFZRx3RD8Cv0rXEuB4pqZmRl/GkiwFq0WRhFk2jx69Qa37n9D2kpiZ7BBtumhUlrlZxvNRh3VtSqcUn8usVT58CxxY/MZhFIJQs9DyEURjycQj8VYuPz8O44Qs0HKhNk8AXo++k8cPwjvo7+wBbffh3wuowgiGJpFMpFUfhWMT6Iznd1mR5AkKg8/Wv4d/rD/BhHm22CT1MV6UmHV67TaaLWaSNDqSbVF5+SRz1ARsM3AZdKrH82wZIo1JpNRBWZGr1epMzkorB8R+slPP/2v1cK/73yBRDZPq1ooVUZ12ev1vIeflrSxKUebEeKFJI/v4DVxhfjXy/yzTQjER2kTJP/5+MP9rx6hsbVLXyVQXFlGKp2evqacWeF0OlBj3pXrbTJ4kOQwjwRVmNlk1lxPLuShkEOU6SFiSV4g4shFgnWrmmKaruoJUgLMvQev/oQjImWOdXl3Z5tVr8uETqpIa656I4K1XSBRUVmiFuRlgm+jaWoLI8rC+y9f4+bpb6gkorSujfUeGafaICcmtYulkQ9HwjKdm0csNYd4IoViYZHMHVLyWKhNs1g6i7IEocyymV9eUZZkydgRksGN69enq8tneShoEBkyOLqDTG4BB/tDpJKJCw9LEZtUSs+RIl/kU6qeUJlgWU8MS4AEOSLrTNo19vu6fPLwWyIki35vA/VaHRuUdb2NdTSJ7e5Gn2qiodLoU/KOQXlv4Uh4OllWIwjNBlWwIqEwhJH8FE6iFaPRy7UOLbQrIhUf7ty+i2ZvWzFPfj6nsJxhcDJzc2Mla5hY+UaMTfUlUe5s76G63qeFsyzwC6SvCjY3B4oozqh/YltxjmVJcNYQL7GsgqC6J4vCsVS8n6BgfXj8x7e4880LJHjEveEOdliPfXSFZax1BKJioXWSWLKc12U9rl//tUodCYgkvPjMME6hmXEaXcaR51gWsdTd/Qvu3HuLECNZXa1gba3GVOmxNWsqAVpZXUW5XEKEkJRNrZf1KYKAuWwbNw/uw0kOlHqcIo6TyRQjnUUul2MPmCMks0oUfMpKFWWPh1jm0Yu1KuL0n7xEUinMlkz6aTmFnlVPHXlGw5GVPqTzTx49x95d0heLujQ+zXYTdXaiyXj0vBNVS0vjYxlXNQmIQEssUuQqQTEaz9GkuV8OBv14+v2fmTbPqRxELPVQa7TQYQPU7bRQY4AcE4TSB12AQ33xB2dVYvsCAdWfiEQRMRpj1H1UtRrbW/Yp3ECax63DE1RZSj1eEUvzjHJKqS6lDbUqh1EnFVDqa/PmbbS2hqrXa9XrVLB1LC4sKD+ax8mvufERUvVxYwcRMiLT0YhFIiqiXpbT4ZxMDhew/Potjh8+o4V5BqKNBhHSYup0uyTYRhNNWuz3+T+Jkgt1WdjlLDVkZDA6nuScWd2TZyRAmiwMhcNqiHH69CWGx6fw8uhra6totOoo1xqoUtJl59IquS1a+NCtqN+OxWKFZbRIC72Y5+wmyxY3QiUm+JU00qLELgwxsgvLiCXTkLLgdrlV833W+pq0FvoP5zb3vn2Fw3sPEaALhiTY7cEATTZAPXajQh7aGx8Jijif/hEcG8ckKgG4ceOG8p15GgsFy+/r8jP2e1FsbW4q5V9nw7O1ucXk92n34dkQQ7AsSyZzUoOTibiaRwg0FVq0HPnDIUZ356YSTC7K41wur3As7W0inUGebG3TTg5BteHw+Et0hweUcWGsVZmDlRJpaw1lasR6nfRls07sBj4eYoyjaSDd6/WjJkgCZdBYmy+IJSHYLx6/YIGKY2d7gF5/gOHODlbY0Zu0KtgLsy81xB1FUjp5mTBJA2S1Tjn7mg2FlewVptk8OGaZDKJSrqBIKBYKS9Tffs0NkPKhZzyQrNcbFEirLPp+EusSBxfzKrqX1eGPN+SRz7B8NV3DtXBe0ZRdRJQMN3hf4Vj8p2Hp7BYTRSUncR4Hbnz1D4Tv/xXZRAy3Dnax1acMqVZgM+phNRk0LZ0+u47P021cTbXxq2Rd/f1ZsoVr+T6uxBv4TK6nO5qX7heFE9j7L2DsPMbdd//E4NXfYdp4jsqDH9F8+jdcKd/Dzwp38fOVU01L9/niLq4VDnB1cQ+e2ims5dswVI4R6t6Hr/0lruSH+OX8ruals7OSednOukimpb041gaLRI4HKQ4j4/EUrFJnrNqXzma3KYUgCX70soTf/3hK5KQ47muiUiyTuZ3TdVKSFjbruK1wBFjlnMSvYaRUp/gvxcdiSWH5B9yhpItSbG6wFm+xAxARJdOQqfplVY9lNDpO5NF0zjme0Fmmbx5nx0OMIw4xNnYPKUl8WOIgskgfFpYLinB/2hCDTY+MnUU8FZaXsbS0jGxmTllp1Dgp/mCIYVfNd5DMIxvYZPLpHpGG0+lGmNdFUJk1DyT9o4HkIY8dY0clAen3t7DZ63JMUEOdZSDgZ8E3mbVpbEWsDrYXjpGck/yUe6IbnePxqeqpx+XiUxv+H8qUmryTCdHtAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250308155446\"\n        title=\"\"\n        src=\"/static/66d1f21b4cd5a8754fa8c701d5afd661/d3fa7/20250308155446.png\"\n        srcset=\"/static/66d1f21b4cd5a8754fa8c701d5afd661/772e8/20250308155446.png 200w,\n/static/66d1f21b4cd5a8754fa8c701d5afd661/d3fa7/20250308155446.png 274w\"\n        sizes=\"(max-width: 274px) 100vw, 274px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n그러나 모든 API에 고르게 요청이 들어가지는 않습니다. 주요 기능이나, user 등 특정 api에 요청이 몰릴것임을 쉽게 짐작할 수 있습니다.</p>\n<p>Monolithic architecture를 사용하면 요청이 많이 몰릴 때, 전제 Application이 영향을 받기 때문에 이상적이지 않습니다.</p>\n<p>그래서 어떤 API에 요청이 많이 들어오는지 ELK 스택을 활용해 분석하고, MSA를 적용해보기로 했습니다.</p>\n<h1>API 요청이 들어올때 로깅을 해보자.</h1>\n<p>API 요청이 들어올 때 로깅을 하는 방법은 다양합니다.</p>\n<p>예를 들어, application에서 모든 요청에 적용되는 AOP혹은 middleware를 두고 로깅을 할 수도 있고, Nginx의 로그를 가져와 활용할 수도 있습니다.</p>\n<p>Nginx의 로그를 활용하는 방법은 ELK의 설정 수정과 추가적인 필터링이 필요하므로 저는 전자의 방법을 사용했습니다.</p>\n<p>먼저, 사용중인 Nest.js 코드에 middleware를 추가해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoggingMiddleware</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestMiddleware</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">WINSTON_MODULE_PROVIDER</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> logger<span class=\"token operator\">:</span> LoggerService<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> NextFunction<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token comment\">// 요청 로깅 (JSON 형식)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      timestamp<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      level<span class=\"token operator\">:</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token string\">'Incoming Request'</span><span class=\"token punctuation\">,</span>\n      method<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n      url<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>originalUrl<span class=\"token punctuation\">,</span>\n      ip<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>ip<span class=\"token punctuation\">,</span>\n      userAgent<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'user-agent'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      body<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>NestMiddleware를 구현하며 use에 로깅을 추가해주면 됩니다.\n그 다음 app.module에 middleware를 적용해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppModule</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestModule</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>consumer<span class=\"token operator\">:</span> MiddlewareConsumer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">consumer</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>\n        LoggingMiddleware<span class=\"token punctuation\">,</span>\n        <span class=\"token function\">helmet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">compression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// cors(corsOptions),</span>\n        TokenValidatorMiddleware<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">exclude</span><span class=\"token punctuation\">(</span>\n       <span class=\"token punctuation\">{</span> path<span class=\"token operator\">:</span> <span class=\"token string\">'payment/portone-webhook'</span><span class=\"token punctuation\">,</span> method<span class=\"token operator\">:</span> RequestMethod<span class=\"token punctuation\">.</span><span class=\"token constant\">POST</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 특정 경로 제외</span>\n      <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">forRoutes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 middleware를 적용해주면, 이제부터 모든 api 요청이 로깅될 것입니다.\n저는 Docker container 형태로 배포 중이므로, Docker log에 기록되고, ELK가 이를 수집 하고 있으니 이제 Kibana에서 해당 로그들을 확인할 수 있습니다.</p>\n<h1>ELK에서 API요청을 시각화 해보자.</h1>\n<p>api로깅을 해뒀으므로,\nkibana discover에서 아래와 같은 데이터가 들어오고 있는걸 확인할 수 있었습니다.\n이제 이 데이터를 시각화 해서 어떤 요청이 많이 들어오고 있는지 확인해봅시다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACG0lEQVR42n1Ui27CMAzk/78PiZd4igFDQN9t2ia9+dymCmVbJJOQJmf7fM6sA+CtdR2SrECSpMjyHPD71iKKYzRNM+75Ea45Zl3XwZu1TgHTVACzHM45PUSg1+sle5mcsWjaVo2O+I3rWmaen4XoTkDLyqAqK+R5oZc5qqrCbrfDarXCer3W9WazwWKxwHw+132uGcgM/wxGzVEUBZbLpQLRjqeT2vnrC1EUIRY6mAGjHVOWH+HQIi2YcoaiLEdQK6kkSYJy2Aud4YPDoChWDsVpjlguE6QLinL7/sbj+dRInjL7qDg/ZeaalL2l3A2ep96NMbhcLjifzzgej2q3221c3+93HA4HpeZfDv0gNwSg7fd7bLdbdXC9XjVaGrlspdofKVem0YiMqWVtVA6UBS+UUu1qMFPXuo/gPjN7B3TksBd2IoVJRXcekOsPegKK1D6KMnQKL7NTCNo0raZM4rmnHSMOQpDQfgfU6HK8or7daKw8UyZo6wEnYF3Yer0OHWIBIiAvciYI9TfVoDcXWM/hCEi9MZJIUyVgHCdSjFjB+J+yoNEJZ9+afwubESbZWJS8KMWJ04pS2BeRCTVHmXB+PB7aQTSKnup4AxQKparyctSN8GTH14byOUnvXkWHlA/bkrz28hJpiUNKiRG/P18CkEpUYR97YbMoLuRNztKmXTUB7JDKs+UfUh8hIyCXBGXv0qKhl/ktLNQPZzZ6aZFt5w0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250308161440\"\n        title=\"\"\n        src=\"/static/6d50616ea92416d1e3e19d84243134ec/5a190/20250308161440.png\"\n        srcset=\"/static/6d50616ea92416d1e3e19d84243134ec/772e8/20250308161440.png 200w,\n/static/6d50616ea92416d1e3e19d84243134ec/e17e5/20250308161440.png 400w,\n/static/6d50616ea92416d1e3e19d84243134ec/5a190/20250308161440.png 800w,\n/static/6d50616ea92416d1e3e19d84243134ec/6f2be/20250308161440.png 1029w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>위의 값을 보면 parsed_json.url 값을 사용하면 어떤 요청이 많이 들어오는지 확인할 수 있을것으로 보입니다.</p>\n<p>kibana에서 특정 필드를 집계하여 시각화하기 위해서는 해당 필드를 keyword 타입으로 저장해야 합니다.</p>\n<p>default로는 text 타입으로 저장되는데, text 타입은 토큰화되어 저장되므로 그 값 자체를 사용해서 집계가 불가능합니다. keyword 타입으로 저장하면 문자 전체를 저장하기 때문에 그대로 사용 가능합니다.</p>\n<p>kibana Dev tools에서 아래 명령을 통해 keyword 타입으로 저장할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">PUT _index_template/logs_template\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"index_patterns\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"nest-logs-*\"</span><span class=\"token punctuation\">]</span>, \n  <span class=\"token string\">\"priority\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token number\">10</span>,\n  <span class=\"token string\">\"template\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"mappings\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"properties\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"parsed_json.url\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token string\">\"type\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"keyword\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 parsed_json.url 값을 이용해 Kibana dashboard에서 시각화 해봅시다.\nDashboard에서 parsed_json.url 필드를 끌어 놓고, Bar horizontal Type으로 분석해보니 아래와 같은 결과를 얻었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqElEQVR42o2Ty27bMBBF/c1ZdNUfKPIP3XZRIECBrpJFUidepas0yMM27MaJ0diqTFESHyIp3cwwfih1nIbAFakB52iuOOxYLRCcRO3zqMYXNG/kKwltBQxJqHlUiHtf7mtCAaslOk3ToD3qukFNsRBqVMZhIlLs/zzCp/NDfB/9wkUyha9rcBantsVjC1g5h6pyKJWCKhRG6Qwfe9+wd/IVg8U87gkMpLx/FYE+BLw2GGxKjd9pgg/dA3y5PocLPibWr8DWQCHkxi4FjbGwtoLSmoAGg+QRny97MN7FPc0O2BqYZS0gWdHaQOYFhJSwyuB6NsVV+udNq28Ci6KMwEzm0KXCkCocZcnawX+BQmRbFWqyrY2Btw7jdI47mb4fyBWtBgf5hFkMZMvjv3NM8sX7gVzVCsIHkucbyyWtp1mKmcpbQOzUM5DbgKCsQC3EJ8xi64rahoFj+ofKVZBWQ1YmzllcL9+jNCy11VZjt+3zdVjoEj8mtzi7H+D0vo/TSR9nDwP0HoYx1qV3jh/f3WAskt3Al/Sl6NHQ1Sy5E6g7vHOrr0cx6wkq9fFCwjbM1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250308162446\"\n        title=\"\"\n        src=\"/static/f421b52b51e73105ec1d59a4e58d5b33/5a190/20250308162446.png\"\n        srcset=\"/static/f421b52b51e73105ec1d59a4e58d5b33/772e8/20250308162446.png 200w,\n/static/f421b52b51e73105ec1d59a4e58d5b33/e17e5/20250308162446.png 400w,\n/static/f421b52b51e73105ec1d59a4e58d5b33/5a190/20250308162446.png 800w,\n/static/f421b52b51e73105ec1d59a4e58d5b33/c1b63/20250308162446.png 1200w,\n/static/f421b52b51e73105ec1d59a4e58d5b33/b6c94/20250308162446.png 1429w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>About은 메인 페이지에서 GroupStudy, Gather데이터를 가져오고 있으므로, 이 요청들이 많이 들어오는 걸 확인할 수 있습니다.\nUser 정보도 조회할 일이 많으니 /user/profile에 대한 요청도 많이 들어오네요.</p>\n<p>대부분의 요청이 /user, /gather, /groupstudy, /feed를 통해 들어오므로, 만약 분리한다면 이 module들을 위주로 분리하면 좋겠네요!</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>제작중인 StockSimulation 애플리케이션은 Spring과 Mysql을 사용하고 있습니다. 애플리케이션의 핵심 데이터인 한국, 미국 상장 주식 데이터는 Stock이라는 테이블에 저장돼있고, 약 8200개 정도의 column을 가집니다.</p>\n<p>Symbol값을 primary key로 설정한다면 좋겠지만, 혹시 모를 중복에 대비해 primary key를 따로 설정해두어서 symbol 값에는 index가 설정돼있지 않습니다.</p>\n<p>그래서 Symbol 값에 index를 설정해두기 전에, 몇몇 query들에서 얼마나 유의미한 시간차이가 생기는지 간단히 확인해보겠습니다.</p>\n<h2>시간 측정 annotation 만들기</h2>\n<p>함수의 실행시간을 편하게 측정하기 위해 먼저 annotation을 하나 만들어 주겠습니다.\n기능은 Aspect를 사용하여 주입할거기 때문에 이렇게 annotation만 만들어주면 됩니다.</p>\n<ul>\n<li>annotations/LogExcecutionTime.java</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Retention</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">RetentionPolicy</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RUNTIME</span><span class=\"token punctuation\">)</span>  \n<span class=\"token annotation punctuation\">@Target</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ElementType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">METHOD</span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">public</span> <span class=\"token annotation punctuation\">@interface</span> <span class=\"token class-name\">LogExecutionTime</span> <span class=\"token punctuation\">{</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>aspects/ExecutionTimeAspect.java</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Aspect</span>  \n<span class=\"token annotation punctuation\">@Component</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ExecutionTimeAspect</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token annotation punctuation\">@Around</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"@annotation(logExecutionTime)\"</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">logExecutionTime</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProceedingJoinPoint</span> joinPoint<span class=\"token punctuation\">,</span> <span class=\"token class-name\">LogExecutionTime</span> logExecutionTime<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Throwable</span><span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">long</span> startTime <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">Object</span> result <span class=\"token operator\">=</span> joinPoint<span class=\"token punctuation\">.</span><span class=\"token function\">proceed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">long</span> endTime <span class=\"token operator\">=</span> <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">long</span> executionTime <span class=\"token operator\">=</span> endTime <span class=\"token operator\">-</span> startTime<span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>joinPoint<span class=\"token punctuation\">.</span><span class=\"token function\">getSignature</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"executed in\"</span> <span class=\"token operator\">+</span> executionTime <span class=\"token operator\">+</span> <span class=\"token string\">\"ms\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>logExecutionTime annotation이 달린 메소드의 시간을 측정하고 log를 남기도록 작성한 Aspect입니다.</p>\n<h2>단순 조회 시간 측정</h2>\n<p>이제 함수에 annotation을 달고 실행을 시켜봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Override</span>  \n<span class=\"token annotation punctuation\">@LogExecutionTime</span>  \n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getCurrentStockPrice</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> symbol<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>index가 없는 경우</h3>\n<p>getCurrentStockPrice(String)executed in199ms\ngetCurrentStockPrice(String)executed in116ms\ngetCurrentStockPrice(String)executed in127ms\ngetCurrentStockPrice(String)executed in71ms\ngetCurrentStockPrice(String)executed in76ms\ngetCurrentStockPrice(String)executed in86ms</p>\n<p>getCurrentStockPrice(String)executed in102ms\ngetCurrentStockPrice(String)executed in122ms</p>\n<p>getCurrentStockPrice(String)executed in113ms\ngetCurrentStockPrice(String)executed in99ms\ngetCurrentStockPrice(String)executed in101ms</p>\n<h3>index가 있는 경우</h3>\n<p>getCurrentStockPrice(String)executed in87ms\ngetCurrentStockPrice(String)executed in142ms\ngetCurrentStockPrice(String)executed in88ms\ngetCurrentStockPrice(String)executed in78ms\ngetCurrentStockPrice(String)executed in77ms\ngetCurrentStockPrice(String)executed in77ms\ngetCurrentStockPrice(String)executed in89ms</p>\n<p>getCurrentStockPrice(String)executed in120ms\ngetCurrentStockPrice(String)executed in78ms\ngetCurrentStockPrice(String)executed in84ms</p>\n<h2>Join 시간 측정</h2>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>최근 주식에 관심을 많이 가지면서, 주식 거래 시뮬레이터를 만들어보면 재밌겠다 생각했습니다.\n기술 스택으로 Spring boot와 MySQL을 사용할 예정이어서 간단히 데이터베이스를 설계해보려 합니다.</p>\n<h1>주식 시뮬레이터에 어떤 기능이 필요할까?</h1>\n<p>요구사항을 파악하고 프로젝트를 진행하는게 아니므로, 제가 만들고싶은 기능을 요구사항으로 생각하고 데이터베이스를 설계해야 합니다. 꼭 필요한 기능들을 정리해봅시다.</p>\n<h2>사용자는 로그인을 할 수 있어야 한다.</h2>\n<p>로그인은 간단히 처리하기 위해 구글 로그인만을 제공할 예정입니다.</p>\n<h2>사용자는 주식 정보를 확인할 수 있어야한다.</h2>\n<p>주식의 현재가, 당일 최고가, 최저가, 거래 내역 등을 확인할 수 있으면 좋겠습니다.</p>\n<h2>사용자는 주식을 사고 팔 수 있어야 한다.</h2>\n<p>구매 수량을 지정하여, 주식을 사고 팔 수 있어야 합니다.</p>\n<h2>사용자는 보유 중인 주식을 확인할 수 있어야 한다.</h2>\n<p>자신이 주식을 얼마에 구매했고, 몇 개를 보유하고 있는지 확인할 수 있어야 합니다.</p>\n<h2>미국주식과 한국주식을 모두 지원해야 한다.</h2>\n<p>최근 미국주식에 대한 관심이 높아서, 미국주식 기능도 지원하고 싶습니다.</p>\n<h2>관심 주식을 등록할 수 있어야 한다.</h2>\n<p>관심 주식은 좀 더 자주 확인하므로, 유저의 편의를 위해 제공합니다.</p>\n<h1>요구사항에서 Entity를 뽑아내자</h1>\n<h2>User</h2>\n<p>먼저 유저정보는 꼭 필요할 것입니다.\n요구사항을 분석했을 때 다음과 같은 데이터가 필요할 것으로 보입니다.</p>\n<ul>\n<li>provider: 어떤 방식으로 로그인 했는지 구분합니다.</li>\n<li>won: 보유한 돈의 정보입니다. 주식을 구매하기 위해 필요합니다.</li>\n</ul>\n<h2>Stock</h2>\n<ul>\n<li>country: 주식이 상장된 곳을 구분합니다.</li>\n<li>industry</li>\n<li>name</li>\n<li>sector</li>\n<li>symbol</li>\n<li>type</li>\n</ul>\n<p>위의 정보들은 주식 정보를 크롤링할 때, 필요한 정보들을 뽑아냈습니다.</p>\n<h2>Holding</h2>\n<p>사용자가 어떤 주식을 들고있는지에 대한 정보가 필요합니다.</p>\n<ul>\n<li>userId: 유저와의 관계를 나타냅니다.</li>\n<li>amount: 몇개 들고있는지 나타냅니다.</li>\n<li>average: 평균단가가 얼마인지 나타냅니다.</li>\n<li>symbol: 주식의 symbol입니다.</li>\n</ul>\n<h2>History</h2>\n<p>주식 거래는 돈을 다루는 민감한 일이므로, 사고파는 모든 정보를 기록해두면 좋을것 같습니다.</p>\n<ul>\n<li>amount: 구매, 판매 수량을 나타냅니다.</li>\n<li>price: 얼마에 구매했는지 나타냅니다.</li>\n<li>symbol: 어떤 주식을 구매했는지 나타냅니다.</li>\n<li>timestamp: 구매 시간을 나타냅니다.</li>\n<li>type: 구매인지 판매인지 구분합니다.</li>\n<li>userId: 누구의 데이터인지 구분합니다.</li>\n</ul>\n<h2>Like</h2>\n<ul>\n<li>symbol: 어떤 주식인지 나타냅니다.</li>\n<li>userId: 누구의 데이터인지 나타냅니다.</li>\n</ul>\n<h1>ER 다이어그램을 작성해보자.</h1>\n<p>이제 데이터베이스에 어떤 Entity와 속성이 필요한지 파악했으므로, ER 다이어그램을 만들어봅시다.</p>\n<p>저는 MySQL Workbench를 사용하였습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 113.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADKUlEQVR42pWV23LaMBCGef9n6Bvkqr3IdCYXSUuTNKXgJCQQDvEBn23ANjYnG/vvroxdQppMqplFIK1+rbSflkaWZWDb7Xav+m2aYWwF6E88DK05nsiceYw8Z5/S73hNgz/Y8jx/0RfUb9ItLto9nJxd4Xpo43LoYGD4QFGgWne8tlEpH9rfXVOEwQxTz0NG4tzS7faV36G9GSH3vMDxZlA0E7Y7xXK5xJYEee7Q78MRpkLQg66bUFUNsizDo99JkmC9XmO1Wgnj73WE7wqmKTzXJbEJFEVFHCfYbDZinH2qniP/8JG3QmAr7lPcIYkcH5MjrMZIMNunf/ei58kVOY4UDf3RMx6ehpC6j5C1CSW5qJEREdKxs12JUoMXFkUuUGBH7qvdUuJQdykpli9MNj34QST8y+hKvJZ0p3mVFJ7Q3Ahd2cLAnKFnECZRIhx5R15cHG1WneRHV8PJeQdndxrOugYeVZeSQoKdgYLP336jJXtoqzMYfrgXpOOsUyRki+UaYUKZXZfY8DrDtvAwGMOehpgtVsJHRBhFAVzHhuc4cC2TsKDnxRFR64wMfPryHacdBaeSiqE5pUhzLBYLeP5MIDUeP0MlCnhMYDMPI1iWDW1ikOkIglBkk7MXzFwxFy1icflRFAlMeC4iAd/36DUFZHMaTzgpO/izOQnRTs+qYC6OY8Ebm6XrYqzfH0CSbikivc5utz9E87qFlnSP9t0DZIJfRBiEIWzbgU4RWqZZk89tpOpotru47HRxfiNB0S0xzussepaaM8VANSAbDvx5WAr26GKvWre4/NVG82cLBh2xYo2Tw63Y32kFdFWReJzhr+ZEUoJ4BS9M4BMubhAjWZXkkwwUO8SFRBv2NNyMXBjTqC5fFT4V2PXTq1nb71g587hGV/G1SffUl/FE4uaUkdq9eClcIOq3fHiE7KhIsDgnyLEskcny9aSvyhYL1m/5vWrDDgGhYZi2oGBKNDA2vAmLMD7/Vb5YMCICLNPCZDIh+B1RCw/9jte/Wb4qbBRi8KZzj+uWhNZtVxDA7TiID1VsdphHMQyqOKZH8Ns+giiuN/3Xf8ofJmzngJ03fMwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250318151737\"\n        title=\"\"\n        src=\"/static/bbaa7f184af7a372e5a92382949fa6b0/5a190/20250318151737.png\"\n        srcset=\"/static/bbaa7f184af7a372e5a92382949fa6b0/772e8/20250318151737.png 200w,\n/static/bbaa7f184af7a372e5a92382949fa6b0/e17e5/20250318151737.png 400w,\n/static/bbaa7f184af7a372e5a92382949fa6b0/5a190/20250318151737.png 800w,\n/static/bbaa7f184af7a372e5a92382949fa6b0/91b29/20250318151737.png 983w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n위에서 추출한 Entity를 생성하고, Entity들 간의 Relationship을 표현했습니다.\n한 user는 여러개의 history, like, holding을 가질 수 있습니다. 그리고 각 주식은 여러개의 like를 가질 수 있습니다. 이를 1대 다 관계로 표현했습니다.</p>\n<p>데이터 구조가 복잡하지 않고, 3정규형까지 위반하는 내용이 없기에 정규화는 생략해도 괜찮을것 같습니다.</p>\n<h1>테이블을 물리적으로 설계하자</h1>\n<p>Spring boot와 JPA를 사용할 예정이기 때문에, Spring 코드 상에 Entity를 구현하고 연결해주면 자동으로 MySQL에 테이블이 생성될 것입니다.</p>\n<p>User Entity를 어떻게 정의할지 예시로 살펴봅시다.\ngetter, setter는 생략했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>stock<span class=\"token punctuation\">.</span>stock_simulator<span class=\"token punctuation\">.</span>entity</span><span class=\"token punctuation\">;</span>  \n  \n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">jakarta<span class=\"token punctuation\">.</span>persistence<span class=\"token punctuation\">.</span></span><span class=\"token operator\">*</span></span><span class=\"token punctuation\">;</span>  \n  \n<span class=\"token annotation punctuation\">@Entity</span>  \n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"Users\"</span><span class=\"token punctuation\">,</span> indexes <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token annotation punctuation\">@Index</span><span class=\"token punctuation\">(</span>name<span class=\"token operator\">=</span><span class=\"token string\">\"idx_gid\"</span><span class=\"token punctuation\">,</span> columnList <span class=\"token operator\">=</span> <span class=\"token string\">\"gid\"</span><span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token annotation punctuation\">@Id</span>  \n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>unique <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> gid<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> won<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> nickname<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> provider<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token comment\">//getter, setter</span>\n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">return</span> <span class=\"token string\">\"User{\"</span> <span class=\"token operator\">+</span>  \n                <span class=\"token string\">\"id='\"</span> <span class=\"token operator\">+</span> id <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>  \n                <span class=\"token string\">\", gId='\"</span> <span class=\"token operator\">+</span> gid <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>  \n                <span class=\"token string\">\", won='\"</span> <span class=\"token operator\">+</span> won <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>  \n                <span class=\"token string\">\", nickname='\"</span> <span class=\"token operator\">+</span> nickname <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>  \n                <span class=\"token string\">\", provider='\"</span> <span class=\"token operator\">+</span> provider <span class=\"token operator\">+</span> <span class=\"token char\">'\\''</span> <span class=\"token operator\">+</span>  \n                <span class=\"token char\">'}'</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>브라우저 탭 전환 시 버퍼링 문제 해결 과정을 자세히 설명해드리겠습니다.</p>\n<h2>�� 문제 진단</h2>\n<h3>원인 분석</h3>\n<ol>\n<li>\n<p>메시지 누적: WebSocket으로 받은 실시간 데이터가 무제한으로 쌓임</p>\n</li>\n<li>\n<p>불필요한 리렌더링: 탭 전환 시 쌓인 메시지를 모두 처리하면서 성능 저하</p>\n</li>\n<li>\n<p>메모리 누수: 이벤트 리스너와 상태가 제대로 정리되지 않음</p>\n</li>\n<li>\n<p>타입 불일치: 문자열과 숫자 간 변환 오류로 인한 계산 실패</p>\n</li>\n</ol>\n<h2>�� 개선 사항 및 원리</h2>\n<h3>1. 메시지 처리 최적화</h3>\n<h4>Before (문제가 있던 코드)</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>// 모든 메시지를 순서대로 처리</p>\n<p>pendingMessages.forEach((msg) => processMessage(msg));</p>\n<h4>After (최적화된 코드)</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>// 가장 최신 메시지만 처리하여 성능 향상</p>\n<p>const latestMessage = pendingMessagesRef.current[pendingMessagesRef.current.length - 1];</p>\n<p>processMessage(latestMessage);</p>\n<p>개선 원리:</p>\n<ul>\n<li>\n<p>시간 복잡도: O(n) → O(1)로 단축</p>\n</li>\n<li>\n<p>메모리 사용량: 모든 메시지 저장 → 최신 메시지만 저장</p>\n</li>\n<li>\n<p>처리 속도: 백그라운드에서 쌓인 수백 개 메시지를 모두 처리하는 대신, 최신 상태만 반영</p>\n</li>\n</ul>\n<h3>2. 중복 처리 방지 메커니즘</h3>\n<p>typescript</p>\n<p>Apply</p>\n<p>// 중복 메시지 방지</p>\n<p>if (lastProcessedTime.current === lastMessage.time) return;</p>\n<p>lastProcessedTime.current = lastMessage.time;</p>\n<p>개선 원리:</p>\n<ul>\n<li>\n<p>중복 제거: 동일한 시간의 메시지는 한 번만 처리</p>\n</li>\n<li>\n<p>불필요한 계산 방지: 같은 데이터로 차트를 여러 번 업데이트하지 않음</p>\n</li>\n<li>\n<p>CPU 사용량 감소: 중복 연산 제거로 성능 향상</p>\n</li>\n</ul>\n<h3>3. 메모리 사용량 제한</h3>\n<h4>WebSocket 컨텍스트</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>// 최대 10개만 유지하여 메모리 사용량 제한</p>\n<p>const limitedMessages = updatedMessagesForSymbol.slice(-10);</p>\n<h4>차트 데이터</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>// 최대 100개만 유지</p>\n<p>setChartData((cd) => [newData, ...cd.slice(0, 99)]);</p>\n<p>개선 원리:</p>\n<ul>\n<li>\n<p>메모리 누수 방지: 무제한 데이터 누적 방지</p>\n</li>\n<li>\n<p>가비지 컬렉션 최적화: 오래된 데이터 자동 제거</p>\n</li>\n<li>\n<p>성능 안정성: 메모리 사용량이 일정 수준으로 유지</p>\n</li>\n</ul>\n<h3>4. React 성능 최적화</h3>\n<h4>React.memo 적용</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>const StockDetail: React.FC = React.memo(() => {</p>\n<p>  // 컴포넌트 내용</p>\n<p>});</p>\n<p>const CandleChart: React.FC<CandleChartProps> = React.memo(({ data }) => {</p>\n<p>  // 차트 컴포넌트 내용</p>\n<p>});</p>\n<p>개선 원리:</p>\n<ul>\n<li>\n<p>불필요한 리렌더링 방지: props가 변경되지 않으면 리렌더링 생략</p>\n</li>\n<li>\n<p>가상 DOM 비교 최적화: 실제 DOM 조작 최소화</p>\n</li>\n<li>\n<p>CPU 사용량 감소: 렌더링 비용 절약</p>\n</li>\n</ul>\n<h4>useCallback과 useMemo 활용</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>const processMessage = useCallback((lastMessage: StructuredDataType) => {</p>\n<p>  // 메시지 처리 로직</p>\n<p>}, []);</p>\n<p>const series = useMemo(() => [</p>\n<p>  // 차트 데이터 변환</p>\n<p>], [data]);</p>\n<p>개선 원리:</p>\n<ul>\n<li>\n<p>함수 재생성 방지: 의존성이 변경되지 않으면 동일한 함수 참조 유지</p>\n</li>\n<li>\n<p>계산 결과 캐싱: 동일한 입력에 대해 재계산 생략</p>\n</li>\n<li>\n<p>자식 컴포넌트 최적화: 메모이제이션된 props로 자식 리렌더링 방지</p>\n</li>\n</ul>\n<h3>5. 가시성 기반 처리 최적화</h3>\n<p>typescript</p>\n<p>Apply</p>\n<p>const isVisible = useRef<boolean>(true);</p>\n<p>const onVisibilityChange = () => {</p>\n<p>  const isNowVisible = document.visibilityState === \"visible\";</p>\n<p>  isVisible.current = isNowVisible;</p>\n<p>  if (isNowVisible &#x26;&#x26; pendingMessagesRef.current.length > 0) {</p>\n<p>    // 탭이 다시 보일 때만 처리</p>\n<p>    const latestMessage = pendingMessagesRef.current[pendingMessagesRef.current.length - 1];</p>\n<p>    processMessage(latestMessage);</p>\n<p>  }</p>\n<p>};</p>\n<p>개선 원리:</p>\n<ul>\n<li>\n<p>리소스 절약: 숨겨진 탭에서는 불필요한 처리 중단</p>\n</li>\n<li>\n<p>사용자 경험 향상: 탭 전환 시 즉시 최신 상태 반영</p>\n</li>\n<li>\n<p>배터리 절약: 백그라운드에서 불필요한 연산 방지</p>\n</li>\n</ul>\n<h3>6. 타입 안전성 개선</h3>\n<h4>Before (타입 오류)</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>high: Math.max(lastChart.high, lastMessage.currentPrice), // string vs string</p>\n<h4>After (타입 안전)</h4>\n<p>typescript</p>\n<p>Apply</p>\n<p>const currentPrice = parseFloat(lastMessage.currentPrice);</p>\n<p>const lastHigh = parseFloat(lastChart.high);</p>\n<p>high: Math.max(lastHigh, currentPrice).toString(),</p>\n<p>개선 원리:</p>\n<ul>\n<li>\n<p>런타임 오류 방지: 타입 변환으로 계산 오류 해결</p>\n</li>\n<li>\n<p>코드 안정성: 예상치 못한 동작 방지</p>\n</li>\n<li>\n<p>디버깅 용이성: 명확한 타입으로 버그 추적 가능</p>\n</li>\n</ul>\n<h2>📊 성능 개선 효과</h2>\n<h3>메모리 사용량</h3>\n<ul>\n<li>\n<p>Before: 무제한 메시지 누적 (수백 MB 가능)</p>\n</li>\n<li>\n<p>After: 최대 10개 메시지 + 100개 차트 데이터 (수 MB)</p>\n</li>\n</ul>\n<h3>처리 속도</h3>\n<ul>\n<li>\n<p>Before: O(n) - 모든 쌓인 메시지 처리</p>\n</li>\n<li>\n<p>After: O(1) - 최신 메시지만 처리</p>\n</li>\n</ul>\n<h3>리렌더링 횟수</h3>\n<ul>\n<li>\n<p>Before: 메시지 수만큼 리렌더링</p>\n</li>\n<li>\n<p>After: 실제 변경사항만 리렌더링</p>\n</li>\n</ul>\n<h3>탭 전환 응답성</h3>\n<ul>\n<li>\n<p>Before: 2-3초 버퍼링</p>\n</li>\n<li>\n<p>After: 즉시 반응</p>\n</li>\n</ul>\n<h2>�� 핵심 원리 요약</h2>\n<ol>\n<li>\n<p>데이터 제한: 무제한 누적 → 제한된 개수만 유지</p>\n</li>\n<li>\n<p>중복 제거: 모든 메시지 처리 → 최신 메시지만 처리</p>\n</li>\n<li>\n<p>메모이제이션: 매번 재계산 → 캐싱된 결과 사용</p>\n</li>\n<li>\n<p>가시성 최적화: 백그라운드 처리 중단 → 리소스 절약</p>\n</li>\n<li>\n<p>타입 안전성: 런타임 오류 방지 → 안정적인 계산</p>\n</li>\n</ol>\n<p>이러한 최적화를 통해 실시간 주식 데이터 처리 시 브라우저 성능이 크게 향상되고, 사용자 경험이 개선됩니다</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<p>기존의 코딧은 결제 플랜으로 오직 LITE플랜만 가지고 있었습니다.\n이 LITE 플랜은 특정 기능을 제한하고, 14일의 무료체험, 그리고 매달 정기 결제되는 기능을 가지고 있습니다.\n그러나 단일 플랜만을 위한 기능이다 보니, 확장성을 고려하지 않고 만들어졌습니다.</p>\n<p>이번 버전에서 NEWS 플랜을 추가하며 부가서비스 기능이 추가되고, 연간 월간 결제 등을 추가하기로 하면서 결제 기능의 거의 전 과정을 손봐야 했습니다.</p>\n<h1>기존 방식의 문제점</h1>\n<h2>데이터베이스 설계</h2>\n<p>기존에는 플랜 정보를 저장하는 테이블이 존재하지 않았습니다.\nproduct 테이블이 존재하고, payType 필드를 사용해서 플랜을 구분했습니다. PUBLIC은 사용하지 않고 있기 때문에 사실상 LITE 플랜만 존재하는 상태입니다.\n![[Pasted image 20250723102932.png]]\n이 방식의 문제점은 아래와 같습니다.</p>\n<ul>\n<li>각 플랜에 일관적인 기준을 적용하기 어렵습니다. 예를 들어, LITE 플랜의 가격이 49900원일 때, 이를 수정하려면 모든 행의 price값을 수정해야 합니다.</li>\n<li>LITE 플랜의 아이템이 모두 사라지면, 플랜에 대한 정보가 사라집니다.</li>\n</ul>\n<p>이번 기획에서는 플랜별 정보를 제공하고, 각 플랜들끼리 일관성 있게 관리를 해야하기 때문에 플랜 정보를 저장하는 테이블을 설계하고, 각 플랜에 속하는 상품을 product에 저장하는 방식을 설계하기로 했습니다.</p>\n<h2>결제 로직의 문제</h2>\n<p>현재 코드는 백엔드 api 서버와 스케줄러가 구분되어 있습니다.</p>\n<p>기존 결제 방식은 누군가 플랜을 결제하면, DB에 카드, 결제 정보가 등록되고 isRecurring 값이 1로 변경됩니다. 이 값이 1이면 스케줄러가 3분 간격으로 해당 계정들을 결제시키게 돼있었습니다.</p>\n<p>이 방식에는 몇가지 문제가 있습니다.</p>\n<ul>\n<li>스케줄러가 멈추면 결제가 이뤄지지 않습니다.</li>\n<li>즉시 결제가 이뤄지지 않습니다. 즉시 결제가 이뤄지지 않으면 사용자 경험에 좋지 않고, 결제가 되지 않은 잠깐의 시간 사이에 생길 수 있는 사이드 이펙트에 대응 해야 합니다.</li>\n</ul>\n<p>이번 업데이트에서는 연간 결제와 월간 결제가 구분되고 플랜간 변경, 결제 취소 등 다양한 케이스가 추가되면서 즉시 결제가 가능하도록 로직을 수정하며 다양한 케이스에 대응할 수 있도록 모듈화를 잘 해둬야 합니다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>실행</h1>\n<ol>\n<li>cd assignment</li>\n<li>pnpm install</li>\n<li>pnpm dev</li>\n</ol>\n<p>테스트는 pnpm test 명령으로 실행 가능합니다.</p>\n<h3>ISSUE #1. 회의실 예약 대기 기능 추가</h3>\n<p>/server/src/modules/reservations/reservations.service.ts의\nsetNextWaitingReservation를 사용해 구현했습니다.</p>\n<p>reservation에 status 필드를 추가하고 예약 생성, 변경 시 겹치는 경우 대기 상태로 만들었습니다.\n특정 예약이 취소, 변경되는 경우 대기 상태에 있는 예약 중 처리할 수 있는 것을 처리하도록 했습니다.</p>\n<h3>ISSUE #2. 회의실 예약 알림 기능 추가</h3>\n<p>/server/src/modules/notifications에 구현해 두었습니다.</p>\n<h3>ISSUE #3. API Key 인증 방식 지원</h3>\n<p>/server/src/modules/apiKeys에 구현해 두었습니다.\n프론트 페이지의 \"api key 생성\" 버튼을 클릭하여 사용 가능합니다.</p>\n<h3>ISSUE #4. 회의실 예약 수정/취소 권한 처리</h3>\n<p>/server/src/modules/reservations/reservations.service.ts의\nupdateReservation, deleteReservation 로직에 organizer와 요청을 보낸 사람의 id를 비교하는 조건문을 추가하였습니다.</p>\n<h3>ISSUE #5. 잘못된 날짜/시간으로도 예약 가능</h3>\n<p>/server/src/modules/reservations/reservations.entity.ts의\n도메인 엔티티 생성자에서 날짜, 시간의 유효성을 검증하는 로직을 추가했습니다.</p>\n<h3>ISSUE #6. 검색 시스템 개선</h3>\n<p>/frontend/src/hooks/useReservationForm.ts에\n300ms 간격으로 api 요청이 가도록 디바운싱 로직을 추가했습니다.</p>\n<p>Person테이블의 name에 index를 설정하였습니다.</p>\n<h2>리팩토링</h2>\n<p>각 모듈을 분리하고, 모듈별로 아래와 같이 구분했습니다.</p>\n<ul>\n<li>service (~.service.ts)</li>\n<li>controller (~.controller.ts)</li>\n<li>module (~.module.ts)</li>\n<li>repository interface (~Repository.interface.ts)</li>\n<li>repository (~Repository.ts)</li>\n<li>domain entity (~.entity.ts)</li>\n</ul>\n<h2>테스트</h2>\n<p>/server/src/modules의 각 폴더 하위의 test 폴더에 포함되어 있습니다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h2>리팩토링</h2>\n<p>리팩토링 과정에서 가장 신경 쓴 것은</p>\n<ul>\n<li>적절한 모듈 간 분리</li>\n<li>Controller, Service, Repository의 구분</li>\n<li>Domain Entity 정의</li>\n</ul>\n<p>이렇게 세 가지 입니다.</p>\n<p>먼저, 적절한 도메인으로 모듈을 분리했습니다. 이렇게 분리한 이유는 도메인을 각각 분리하여 관리할 수 있도록 하기 위함이고, 의존성을 덜어내기 위함입니다.</p>\n<p>그리고 Controller, Service, Repository를 구분한 이유는 각 모듈 내에서 책임을 분리하기 위함입니다. Controller는 외부와의 입출력을 담당하고, Service는 비즈니스 로직을 관리, Repository는 DB와의 접근을 위함입니다.\n이 중에서 Repository는 특별히 Interface를 정의하고 의존성 주입 개념을 사용했는데, DB에 대한 의존성을 완전히 덜어내기 위함입니다.</p>\n<p>주어진 예제에서 데이터베이스로는 SQLite, 그리고 Mikro-ORM을 사용하고 있습니다. SQLite는 서비스 규모가 커지면 다른 DB로 교체될 가능성이 높고, Mikro-ORM도 언제든 변경될 수 있고, ORM으로 해결할 수 없는 경우가 있을 수 있습니다.</p>\n<p>그래서 언제든 DB를 교체할 수 있도록 Repository Interface를 정의하고, Service에서는 Interface에 정의된 기능만 사용합니다.</p>\n<p>이 때, Domain Entity의 개념이 나오는데, DB Entity와 별개로 Domain Entity를 사용하면 DB와의 의존성을 조금 더 확실히 제거할 수 있습니다. 또한 핵심 비즈니스 로직을 Domain Entity로 위임하여 좀 더 엄밀히 관리할 수 있고, 데이터 무결성을 강화할 수도 있습니다.</p>\n<p>또한 이렇게 분리했을 때의 장점은 테스트가 쉬워집니다.\nRepository, Entity 등등을 Mocking 하기 쉬워지고, 테스트하고 싶은 부분만 확실하게 테스트 가능합니다.</p>\n<h2>요구사항</h2>\n<h3>ISSUE #1. 회의실 예약 대기 기능 추가</h3>\n<p>reservation에 status 필드를 추가하고 예약 생성, 변경 시 겹치는 경우 대기 상태로 만들었습니다.\n특정 예약이 취소, 변경되는 경우 대기 상태에 있는 예약 중 처리할 수 있는 것을 처리하도록 했습니다.</p>\n<p>roomId와 date를 사용해서 모든 데이터를 불러오고 status filter로직을 사용했는데, 애초에 DB 쿼리로 필터된걸 읽어오면 더 좋을것 같습니다.</p>\n<p>DB 읽기가 좀 많이 발생하는 문제 있음. 이거 수정하면 성능상 훨 괜찮을듯</p>\n<h3>ISSUE #2. 회의실 예약 알림 기능 추가</h3>\n<p>알림이 필요한 곳에서 가져다 쓸 수 있도록 Notification을 위한 Module을 추가했습니다.</p>\n<p>알림은 다양한 옵션이 존재하고, 미래에 확장될 수 있기 때문에, 전략 패턴과 팩토리 패턴을 사용했습니다.</p>\n<p>만약 새로운 방식의 알림을 추가해야 한다면, 방식을 추가하고 Factory에 추가해주면 됩니다.</p>\n<p>이렇게 구현한 이유는 모든 알림 방식이 같은 인터페이스를 구현하도록 하고, 언제든 확장할 수 있도록 하기 위함입니다.</p>\n<h3>ISSUE #3. API Key 인증 방식 지원</h3>\n<p>먼저, Bearer로 시작하는 API Key를 받기 위해, API KEY를 확인하는 로직을 추가했습니다.</p>\n<ul>\n<li>keyHash는 해시된 key값</li>\n<li>keyPrefix는 api key 앞부분의 일부 -> DB에서 빠르게 찾음, 원본 키 없이도 식별 가능</li>\n</ul>\n<h3>ISSUE #4. 회의실 예약 수정/취소 권한 처리</h3>\n<p>/server/src/modules/reservations/reservations.service.ts의\nupdateReservation, deleteReservation 로직에 organizer와 요청을 보낸 사람의 id를 비교하는 조건문을 추가하였습니다.</p>\n<h3>ISSUE #5. 잘못된 날짜/시간으로도 예약 가능</h3>\n<p>/server/src/modules/reservations/reservations.entity.ts의\n도메인 엔티티 생성자에서 날짜, 시간의 유효성을 검증하는 로직을 추가했습니다.</p>\n<h3>ISSUE #6. 검색 시스템 개선</h3>\n<p>/frontend/src/hooks/useReservationForm.ts에\n300ms 간격으로 api 요청이 가도록 디바운싱 로직을 추가했습니다.</p>\n<p>Person테이블의 name에 index를 설정하였습니다.</p>\n<h2>개선할 점</h2>\n<h3>Value Object 적용</h3>\n<ul>\n<li>도메인 개념을 명확하게 표현</li>\n<li>값 불변성 유지</li>\n<li>유효성 검증 강화</li>\n</ul>\n<h2>Getter, Setter 왜 안함?</h2>\n<p>getter, setter를 작성하면 코드가 간결해짐.\nreadonly 옵션으로 불변성 보장</p>\n<p>값 설정할 때 검증 안되긴함</p>\n<h2>Domain Entity를 왜 불변성 가지게 함?</h2>\n<p>암 소 쏘리</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<ul>\n<li><strong>S (Situation):</strong> 어떤 상황이었나요? (프로젝트 배경, 팀 구성 등)</li>\n<li><strong>T (Task):</strong> 당신에게 주어진 과제나 목표는 무엇이었나요?</li>\n<li><strong>A (Action):</strong> 그래서 당신은 <strong>구체적으로 어떤 행동</strong>을 했나요? (가장 중요!)</li>\n<li><strong>R (Result):</strong> 그 행동의 결과는 어땠나요?</li>\n</ul>\n<h2>동료 개발자와 기술적인 의견 충돌이 있었던 경험을 말해주세요. 어떻게 해결했나요?</h2>\n<p>처음에 서비스를 Express.js로 시작했음.\ncontroller와 service정도는 구분한 구조로 서비스를 운영해왔는데, 규모가 크지 않아 문제 없이 운영할 수 있었음.</p>\n<p>규모가 점점 커지며, 유지보수를 위해 module을 분리하고, 도메인을 정의하여 관리하고 싶어 Spring, Nest.js로의 포팅을 제안함.</p>\n<p>반대파: 포팅 비용이 꽤 크고, 현재도 무리없이 운영 가능한데 굳이 옮겨야 하나.</p>\n<p>Spring으로 옮기는것은 확실히 모든 로직을 다시 작성해야하여 너무 큰 비용이 소모됨. Nest.js대안을 찾아, 포팅에 소요되는 비용과 장점등을 어필하여 설득하였음.</p>\n<h2>기획자, 디자이너 등 비개발 직군과 소통할 때 의견 차이가 생긴다면 어떻게 조율하시겠어요?</h2>\n<p>기획자와 일을 할 때, 업무 기간 산정에 대한 의견 차이가 있었습니다. 전에 일하던 곳에서는 어떤 기능 개발이든 개발 일주일과 QA, 테스팅 일주일. 항상 동일한 기간으로 기능 개발을 들어갔습니다.\n그러나 일부 큰 기능의 경우 개발에 소요가 오래걸리고, QA 과정에서도 테스트 해야 할 케이스가 많다보니 항상 업무가 밀리는 문제가 발생.\n기능 개발을 시작하기 전, 다같이 업무 개발에 소요되는 시간을 계산해보는 시간을 가지자고 제안.</p>\n<h2>팀의 방향이나 결정이 본인의 생각과 다를 때 어떻게 행동하나요?</h2>\n<p>이 경우는 다양한 케이스가 있을 것 같습니다.\n먼저 상대의 의견이 틀리고, 저의 의견이 맞다고 생각되는 경우라면 정확한 근거를 준비해서 상대방을 설득할 것 같습니다. 반대로 상대의 의견이 맞다는 게 입증되면 상대의 의견을 존중할것입니다.</p>\n<p>만약 정답이 없는 문제인 경우, 여러 사람의 말이 모두 맞을 수 있는 문제라면 가장 높은 사람, 혹은 가장 일에 책임을 질 수 있는 사람의 결정을 따르겠습니다.</p>\n<p>혹은 각자의 결정에 따른 결과(수익성, 팀에 도움이 되는지) 등을 판단하여 가장 이득이 될 수 있는 결정에 따르는 것이 좋을 것 같습니다.</p>\n<h2>본인의 코드 리뷰 스타일은 어떤가요? 다른 사람의 코드를 리뷰할 때 어떤 부분을 중점적으로 보나요?</h2>\n<p>저는 코드 리뷰 경험이 많은 편은 아닙니다.\n그래도 그동안 해왔던 경험, 혹은 중요하게 생각하는 부분은 아래와 같습니다.</p>\n<ul>\n<li>기존의 코드 스타일을 잘 따랐는지</li>\n<li>코드를 더 유의미하게 분리할 수 있을지</li>\n<li>불필요한 로그, 주석이 남아있지 않은지</li>\n</ul>\n<h2>자신이 작성한 코드에 대해 비판적인 리뷰나 피드백을 받았을 때 어떻게 대처했나요?</h2>\n<p>피드백을 먼저 전부 확인한 후, 간단한 피드백은 즉각적으로 수정합니다.\n만약 성능과 같은 이슈로 수정해야 한다면 리뷰 받은 내용이 어느정도의 공수로 수정 가능한지, 수정했을 때 어느정도의 장점이 있는지 파악한 후 내용을 공유한 후 수정을 시작합니다.</p>\n<h2>팀의 전체적인 코드 품질을 높이기 위해 기여한 경험이 있나요?</h2>\n<p>코드 퀄리티를 위해서는 항상 고민하는 것 같습니다.\n먼저 Express.js에서 Nest.js로 옮기는 것도 클린 아키텍처 개념을 도입하기 위해서였습니다. 그 과정에서 도메인 주도 개발 개념도 알게되어 적용하고 있습니다.\n가능한 상수를 피하려고 하고 있습니다. 파일에 모아둠\n함수형 프로그래밍도 적극 사용하고 있습니다.</p>\n<h2>프로젝트 진행 중 팀의 생산성을 높이는 데 기여한 경험이 있다면 말씀해주세요.</h2>\n<p>자동화</p>\n<h2>동료의 업무가 지연되어 프로젝트 전체 일정에 차질이 생길 것 같을 때 어떻게 행동하시겠어요?</h2>\n<h2>함께 일하기 가장 편했던/어려웠던 동료는 어떤 유형이었고, 어떻게 대처했나요?</h2>\n<h2>팀 동료의 성장에 도움을 준 경험이 있나요?</h2>\n<h2>새로운 기술을 학습해서 팀에 도입하거나 공유한 경험에 대해 말해주세요.</h2>\n<h2>자신보다 경력이 많은/적은 동료와 일할 때 어떤 자세로 임하나요?</h2>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>자기소개서 기반 질문</h1>\n<h2>자기소개서에 '무난했던 일상에 안주하지 않고 도전해왔다'고 작성하셨는데, 본인을 그렇게 변화시킨 특별한 계기가 있었나요?</h2>\n<p>저는 사회복무요원으로 특수학교에서 근무했었습니다.\n특수학교에 처음 배정받았을 때, 너무도 낯선 환경에 두려움이 앞섰습니다. 그러나 막상 일을 하다보니, 너무도 잘 적응이 됐습니다. 제가 아끼는 아이도 생기고, 말이 통하지 않는 친구와 소통하는 법도 배웠습니다. 이 경험이 저의 생각을 많이 바꿔주었습니다. 다양한 세상을 경험해보고 싶어졌고, 어느곳에서도 적응할 수 있다는 자신감을 불어넣어 주었습니다. 그래서 바로 교환학생을 신청했고, 사회복무요원을 마친 후 학교로 복학하지 않고 교환학생을 떠났습니다.</p>\n<h2>여러 국가 중 특별히 <strong>네덜란드를 교환학생 국가로 선택한 이유</strong>가 있나요?</h2>\n<p>제가 간 네덜란드의 헤이그는 우리나라에서도 헤이그 특사로 유명한 세계적인 외교의 도시입니다. 그만큼 다양한 문화권의 사람이 살고, 다양한 국가에서 온 사람들을 만날 수 있었습니다. 또한 유럽 국가에 대한 환상이 있었는데, 네덜란드는 유럽 국가들 중에서 영어를 정말 잘하는 편이라 선택했습니다. 실제로 네덜란드에 갔을 때, 영어만을 사용해도 생활할 수 있었고, 다양한 국가의 사람들을 만나는 좋은 경험을 했습니다.</p>\n<h2>낯선 환경에 적응하고 소통하는 법'을 배웠다고 하셨는데, 가장 힘들었던 <strong>문화적 차이나 소통의 어려움</strong>은 무엇이었고, 본인만의 방식으로 어떻게 극복했나요?</h2>\n<p>네덜란드에 도착하여 첫 수업에 갔을 때, 너무도 낯선 환경에 모두가 영어를 사용해서 엄청 당황하고 긴장했습니다. 그러다 보니 더욱 말이 안들리고 소통이 어려웠습니다. 제가 들었던 수업은 창업 수업이라, 조별 활동이 필수이고 그만큼 의사소통 역량이 중요했습니다.\n그래서 저는 저를 최대한 그 환경에 자주 노출시키기로 했습니다. 수업 친구와 따로 약속을 잡아서 밖에서 보기도 하고, 교환학생을 대상으로 하는 모임에도 참여했습니다. 집에서도 내내 드라마나 영어 스피치를 틀어놓고 익숙해지려 노력했습니다. 그렇게 극복했고, 팀원들과 원활히 프로젝트를 마칠 수 있었습니다.</p>\n<h2>창업 수업에서 개발한 **'헬스케어 서비스'**는 구체적으로 어떤 서비스였나요? 거기서 지원자님이 맡았던 <strong>기술적인 역할</strong>은 무엇이었습니까?</h2>\n<p>헬스 트레이너와 사용자의 일정, 운동 루틴을 관리하는 어려움에 착안하여 이들을 연결해주는 플랫폼 서비스였습니다. 거기서 저는 개발자 역할을 맡았습니다. 물론 개발만 한 것은 아니고, 헬스장에 가서 인터뷰를 해서 사용자들의 요구사항을 수집한다던지, 경쟁사 분석, 사업성 분석 등 다양한 것들을 팀원들과 함께 했습니다.\n개발자로서는 웹사이트의 프로토타입을 디자이너와 함께 만들었고, LLM기반의 운동 루틴 추천 프로토타입을 만드는걸 팀원들에게 제안하고 빠르게 만들어 팀원들에게 공유했습니다.</p>\n<h2>팀 프로젝트에서 <strong>의견 충돌</strong>은 없었나요? 문화가 다른 팀원들을 설득하고 프로젝트를 성공적으로 이끌기 위해 어떤 노력을 했는지 구체적으로 말해주세요.</h2>\n<p>사실 큰 의견 충돌은 없었지만,</p>\n<h2>수익이 나고 있어요?</h2>\n<h2>합격한다면 해당 프로젝트는 어떻게 할 것인지?</h2>\n<h2>'대학생을 위한 모임 플랫폼'을 직접 개발해야겠다고 결심한 <strong>가장 결정적인 계기</strong>는 무엇이었나요? 기존 서비스들에서 어떤 불편함을 느끼셨나요?</h2>\n<p>처음에는 카톡 단체채팅방에서 투표를 하여 스터디 장소를 결정하는 동아리였습니다. 그런데 매번 투표 장소를 투표받고 스터디를 오픈하는 것이 너무 귀찮은 작업이라고 생각했습니다. 그래서 동아리를 만든분과 웹사이트를 만들어서 투표를 받는건 어떤지 얘기했습니다. 의견이 받아들여져서 스터디 투표 웹사이트가 만들어졌고, 사용자들에게 요구사항을 받고 서비스를 확장하며 \"대학생을 위한 모임 플랫폼\"에 초점이 맞춰졌고, 현재는 번개나 소모임, 스터디 이렇게 세 가지 기능을 주력으로 서비스를 운영하고 있습니다.</p>\n<h2><strong>DAU 400명</strong>이라는 성과는 어떻게 측정했으며, 이 사용자를 유치하고 유지하기 위해 어떤 <strong>기능적/마케팅적 노력</strong>을 하셨나요?</h2>\n<p>DAU는 Google Analytics를 기준으로 측정했습니다. MAU를 측정하고 싶었는데, Month기준으로 측정이 안돼서 DAU로 기재했습니다.\n사용자를 모으기 위해 처음에는 캠퍼스픽, 에브리타임이라는 플랫폼을 통해 홍보했습니다. 현재는 인스타그램, 지인 추천등 조금씩 다른 경로로도 사용자를 모으고 있습니다.</p>\n<h2>'사용자 요구사항의 중요성'을 배웠다고 하셨는데, 기억에 남는 <strong>사용자 피드백</strong>이 있다면? 그리고 그 피드백을 어떻게 서비스에 반영했나요?</h2>\n<p>가장 기억에 남고 도움이 됐던 것은 스터디 투표 참여과정이 복잡하다는 것이었습니다. 서비스를 개발하며 기능 확장에만 집중하다보니, 스터디 투표를 하기 위해서는 참여 시간, 장소, 저녁 여부 등 많은 것을 선택해야 했습니다. 그리고 직접 장소를 선택하다보니, 약간의 눈치싸움 같은 것도 생겼습니다.\n이를 해결하기 위해 스터디 투표 기능을 최대한 단순화 했습니다.\n선호하는 장소는 미리 선택해두고, 시간만 선택하면 바로 투표가 되도록 했습니다. 그리고 스터디 장소를 직접 선택하는 방식이 아니고 선호 장소의 위, 경도 정보를 기반으로 DBSCAN알고리즘을 사용해 클러스터링 하여 자동으로 장소를 선택해 스터디가 오픈되도록 했습니다. 이 기능을 출시하여 매일 개설되는 스터디 수가 1~2개 더 늘어나는 성과가 있었습니다.</p>\n<h2>해당 플랫폼 서비스는 현재 <strong>수익 모델</strong>이 있나요? 없다면, 만약 수익 모델을 만든다면 어떤 방식을 고민해 보셨나요?</h2>\n<h2>여러 도전을 통해 얻은 경험 중, 어떤 경험이 한국투자저축은행의 <strong>IT 직무를 수행하는 데 가장 큰 도움</strong>이 될 것이라고 생각하나요?</h2>\n<p>기술적으로는 About에서 유저가 이용하는 서비스를 운영해본 경험이 도움이 될 것 같습니다. 이 서비스를 운영하며 CI/CD파이프라인 구축, ELK스택, Redis, 클린 아키텍처등 개발자로서 많은 성장을 이룰 수 있었고, 이는 분명히 저축은행에서 서비스를 운영하는 데에도 도움이 될 것이기 때문입니다.</p>\n<p>교환학생에서의 경험은 사람들과 의사소통 하는데에 도움이 될 것 같습니다. 낯선 환경에서 의사소통 했던 경험은 제가 어디에서든 사람들과 어울리과 협업할 수 있다는 자신감을 불어넣어 주었기 때문입니다.</p>\n<h2>교환학생 시절의 창업 경험과 국내에서의 플랫폼 개발 경험은 성격이 조금 다른데, 두 경험을 통해 공통적으로 배운 **'성공적인 프로젝트의 핵심 요인'**은 무엇이라고 생각하나요?</h2>\n<p>사용자의 요구사항을 반영하는것과 안정적인 서비스 운영의 중요성입니다. 교환학생에서는 직접 타겟 유저들을 찾아다니며 요구사항을 수집했고, About을 운영하면서도 사용자들의 요구사항을 직접 들으며 서비스를 발전시켰습니다. 이러한 요구사항들은 항상 서비스 발전의 이정표가 되어 주었습니다.\n한국투자저축은행에서도 사용자들의 불편사항을 하나씩 해결하며 어느곳보다 편리한, 누구나 사용할 수 있는 금융서비스를 만들겠습니다.</p>\n<h2>About 기술 스택</h2>\n<p>Node.js기반의 백엔드와 React기반의 프론트로 개발했습니다. 저는 거의 백엔드 개발을 맡았는데, 처음에는 Express.js를 사용하다가 Nest.js로 옮겼습니다.\nCI/CD파이프라인 구성을 위해, AWS EC2 인스턴스와 Code Pipeline을 조합하여 git의 main 브랜치에 코드를 올리면 Docker image형태로 빌드되고, 그 이미지로 컨테이너를 띄우고 있습니다.\n그 외에 인프라 적으로는 ElasticSearch, Logstash, Kibana를 활용해 로그를 분석하고 있고, 일부 API에는 Redis를 이용한 캐싱 기능도 적용되어 있습니다.</p>\n<h2>'코드의 퀄리티를 신경 쓰지 못했다'고 하셨는데, 구체적으로 어떤 문제점들이 있었나요? 예를 들어, 코드 중복이 심했다거나, 특정 클래스가 너무 많은 역할을 했다거나 하는 예시를 들어주실 수 있나요?</h2>\n<p>처음에는 UserService와 같은 하나의 클래스가 대부분의 역할을 했습니다.\n예를 들면, DB에 접근하는 코드도 Service에서 담당하고, 유효성 검증도 Service에 존재하는 등, 담당하는게 너무 많아 하나의 코드를 수정해도 다른 부분에 문제가 없는지 여러번 확인해야 했습니다.\n이를 해결하기 위해 핵심 검증 로직과 비즈니스 로직은 Domain Entity에 위임하고, DB에 접근하는 코드는 Repository로 분리하였습니다. 여기에 그치지 않고, Repository는 Interface를 정의하고 의존성 역전 원칙을 적용하여 데이터베이스에 의존하지 않고 언제든 DB를 바꿀 수 있는 구조를 설계했습니다.</p>\n<h2>'월 10만 원 이상의 배포 비용'은 구체적으로 어떤 부분(예: 클라우드 서버 비용, 빌드 시간)에서 발생했고, 어떤 개선을 통해 절감할 수 있었나요?</h2>\n<p>먼저 Heroku로 배포할 때에는, 프론트엔드와 백엔드를 각각 따로 배포해야 했습니다. 이 둘이 합쳐서 한달에 120달러 정도를 사용하고 있었는데, 프론트엔드쪽이 메모리 사용량이 높아져 비용을 업그레이드 해야했습니다.\n이에 AWS인스턴스에 직접 CI/CD 파이프라인 구성을 고민했습니다.\n먼저, 적절한 메모리 사용량을 고려해 4GB인스턴스를 선택했습니다. 인스턴스 사용 비용과 Public IP , 저장공간 사용 비용을 계산하니 한달에 46달러가 청구될 것으로 측정되었습니다.\n여기에 자동 배포를 위해, Code Pipeline과 Code deploy, Code build 등을 사용했는데, 이들은 모두 합쳐도 비용이 10달러를 넘지 않을것으로 계산되었습니다.\n그 결과 현재 한달에 50달러 정도의 비용으로 배포를 하고 있고, 70달러 가량을 절약할 수 있었습니다.</p>\n<h2>이 리팩토링 과정은 혼자 진행하셨나요, 아니면 팀원들과 함께 진행하셨나요? 만약 팀 프로젝트였다면, 본인의 역할은 무엇이었고 팀원들을 어떻게 설득했나요</h2>\n<p>리팩토링 자체는 저 혼자 진행했으나, 팀원들을 설득할 필요는 있었습니다. 당시 프론트 개발 한분과 백엔드 개발이 저와 한분 더 있었습니다. Express.js를 Nest.js로 바꾸는 문제는 시간이 꽤 소요되기 때문에 그동안 신규 기능 개발을 하지 못하고, 오류 발생 위험도 있었기 때문에 왜 해야하는지 팀원들을 설득해야 했습니다.\n이에 저는 현재 코드 구조의 문제점과 리팩토링을 하지 않고 계속 개발을 하면 미래에 개발 비용이 더 증가할 수 있는 점, 클린 아키텍처의 유용성 등을 설명하며 팀원들을 설득했습니다. 또한 예상 소요기간을 잡고 이 기간 안에는 끝내겠다고 약속하였고, 성공적으로 마쳤습니다.</p>\n<h2>'코드를 리팩토링했다'고 하셨는데, <strong>어떤 설계 원칙(예: SOLID)이나 디자인 패턴</strong>을 적용해서 코드의 의존성을 낮추셨나요?</h2>\n<h2>CI/CD와 로깅 인프라는 <strong>어떤 도구(예: GitHub Actions, Jenkins, ELK Stack 등)를 사용</strong>해서 구축하셨나요? 수많은 도구 중에서 그것을 선택한 특별한 이유가 있나요?</h2>\n<p>Jenkins도 사용해보고, AWS의 Codepipeline, git과 ArgoCD를 이용한 방법 등등 CI/CD 파이프라인을 다양하게 구성해본 경험이 있습니다.</p>\n<p>About 서비스를 배포할 때 AWS Codepipeline을 사용했는데, 서비스를 AWS EC2로 배포할 때 가장 쉽게 CI/CD 파이프라인을 구성할 수 있기 때문에 선택했습니다. 이미 운영중인 서비스였기 때문에 가장 안정적이면서 빠르게 사용할 수 있는 CodePipeline을 택했습니다.</p>\n<p>이 방법은 쉘 스크립트만 잘 정의해두면, git의 특정 브랜치에 코드가 올라갔을 때, build관련 쉘 파일이 작동하면서 Docker image를 빌드하고, 과정이 완료되면 deploy과정이 진행되면서 Docker container 형태로 EC2에 올라가게 됩니다.</p>\n<h2>대규모 리팩토링 과정에서 기존 기능이 정상적으로 작동하는지 어떻게 검증하셨나요? 예를 들어, <strong>단위 테스트나 통합 테스트 코드</strong>를 작성하는 등의 노력이 있었나요?</h2>\n<p>About에는 테스트 코드가 많이 작성되어 있지는 않습니다.\n하지만 테스트 코드를 작성하며 개발 해본 적이 있는데, 확실히 안정성이 높다고 생각해서 테스트 코드의 중요성은 인지하고 있습니다.\n요즘에는 모듈, 메소드 단위로 책임을 잘 분리해두면, 생성형 AI가 테스트 코드를 상당히 잘 작성해주는걸 경험했었습니다. 그래서 제가 진행하고 있는 프로젝트도 이 방법으로 테스트를 작성해보는걸 고려하고 있습니다.</p>\n<h2>이 경험을 통해, <strong>빠른 기능 개발</strong>과 <strong>높은 코드 퀄리티</strong> 사이의 균형을 어떻게 맞춰야 한다고 생각하게 되셨나요? 본인만의 기준이 생겼다면 무엇인가요?</h2>\n<p>저는 두가지 모두 중요한 가치라고 생각합니다. 단기적으로는 빠른 기능 개발이 중요하며, 장기적으로는 코드 퀄리티를 챙기는게 중요합니다. 이를 위해서 저는 빠른 기능 개발 후, 리팩토링을 하는 방식을 선호합니다. 프로젝트 구조가 잘 잡혀있다면, 리팩토링에 소요되는 시간은 크지 않을 것입니다. 그래서 먼저 구조에 맞추되, 단일 책임 원칙과 같은 원칙은 무시하며 빠르게 기능을 구현합니다. 기능 구현이 완료되면 메소드를 적절히 분리하고 위치시키며 코드를 리팩토링 합니다. 이렇게 하면 기능 개발을 빠르게 마치면서 코드 퀄리티도 챙길 수 있습니다.</p>\n<h2>이 실패 경험을 통해 얻은 <strong>가장 큰 교훈</strong>은 무엇이며, 그 교훈을 앞으로 한국투자저축은행에서 업무를 할 때 어떻게 적용할 수 있을까요?</h2>\n<p>이 실패로 얻은 교훈은, 좋은 시스템은 개발 속도만이 아닌, 장기적인 안정성과 확장성이 결정한다는 것입니다.\n초기에는 새로운 기능을 추가하는 것만이 좋은 서비스라고 생각했습니다. 하지만 기술 부채를 간과한 결과, 오히려 업데이트 속도는 점점 느려지고 예상치 못한 곳에서 오류가 터져 나오는 악순환을 겪었습니다. 결국 처음에 조금 더 시간을 들여 견고한 구조를 설계하고 코드 품질을 높이는 것이, 장기적으로 훨씬 더 빠르고 안정적인 길이라는 것을 배웠습니다.</p>\n<p>이 경험은 IT업무에 두가지 방식으로 기여할 수 있다고 생각합니다.\n먼저, 'KEY뱅크'의 기능 개발, 금융 상품을 개발할 때, 해당 기능이 기존 시스템에 미칠 영향, 미래의 변화에 유연하게 대응할 수 있는 확장성을 지녔는지 고민하겠습니다.\n그리고, 사후 대응이 아닌 사전 예방 중심의 시스템을 설계하겠습니다. 리스크를 미리 식별하고 테스트 코드를 꼼꼼히 작성하여, 장애가 발생하기 전에 예방하는 견고한 시스템을 만드는 데 제 역량을 집중하겠습니다.</p>\n<h2>결과적으로는 성공적인 경험이지만, 어찌 보면 프로젝트 초기에 <strong>위험 관리를 제대로 하지 못한 것</strong>이라고 볼 수도 있습니다. 왜 초반에 이런 문제를 예측하지 못했다고 생각하시나요?</h2>\n<p>저의 지식 문제였다고 생각합니다. 처음 개발을 시작할 당시에는 기능을 구현할 줄만 알았지, 의존성 역전과 같은 개념으로 코드 간 의존성을 줄인다거나 에러 처리를 현업에서 어떻게 하는지 등에 대한 개념은 모르고 있었습니다. 개발을 공부하고 서비스를 운영하면서 어떠한 것이 중요하고, 어떤 기술이 최신 트렌드인지 하나 둘 알게 되었고 점차 서비스에 적용하며 발전시키고 성공적으로 개발할 수 있었다고 생각합니다.</p>\n<h2>'다양한 계층에게 꼭 필요한 금융 서비스'라고 말씀하셨는데, 본인이 생각하는 <strong>가장 대표적인 예시</strong>는 무엇인가요? IT 기술로 그것을 어떻게 개선할 수 있을까요?</h2>\n<p>한가지를 예시로 들면, 고령 사용자를 위한 소액 비상금 대출 서비스입니다.\n사회가 점점 고령화되며, 많은 고령 사용자가 갑작스러운 병원비나, 경조사비처럼 긴급 자금이 필요할 때 어려움을 겪고 있습니다.\n이런 분들은 신용도가 낮아 시중은행의 문턱을 넘기 어려울 수도 있고, 복잡한 모바일 앱 사용이 어려워 비대면 서비스 자체를 두려워 할 수 있습니다.\n이는 서민의 동반자를 지향하는 저축은행이 IT 기술을 통해 해결할 수 있는 중요한 문제라고 생각합니다.\nIT 기술을 여기에 활용한다면, 복잡한 앱 화면 대신, 음성이나 챗봇을 이용해 간편하게 대출 신청이 되도록 한다면, 스마트폰 사용이 익숙치 않은 분들도 두려움 없이 서비스를 이용할 수 있을 것입니다.\n또한 대출 전, 자녀 등 지정된 보호자에게 알림 문자를 전송하는 서비스 등을 운영하여 피싱과 같은 금융 사고를 예방하고, 심사과정을 편의하게 하여 대출 승인율을 높일 수도 있을 것입니다.</p>\n<h2>'서민과 중소기업의 동반자'라는 가치에 공감하셨다고 했는데, <strong>왜 시중은행이나 핀테크 기업이 아닌 저축은행</strong>이었나요? 시중은행도 서민금융 상품이 있고, 핀테크는 기술로 금융을 더 쉽게 만들고 있는데요.</h2>\n<p>시중은행과 비교했을 때, 기여의 임팩트가 다르다 생각했습니다. 시중은행의 개발자는 금융 시스템 전체의 안정성을 유지하는 중요한 역할을 할 것입니다. 하지만 저는 제가 만든 기능 하나가 어떤 고객에게, 어떻게 직접적으로 도움이 되는지 더 가까이에서 보고 싶었습니다. 서민과 중소기업이라는 명확한 고객층에 집중하는 저축은행에서는, 저의 기술적 기여를 조금 더 가까이에서 확인할 수 있을것이라 생각했습니다.</p>\n<p>또한 기술의 방향성이 다으다고 생각합니다. 핀테크 기업은 대체로 편리함에 집중합니다. 하지만 저축은행은 포용성을 더욱 생각하는 곳입니다. 꼭 필요한 사람들에게 포용적인 서비스를 제공하는 것, 이러한 따뜻한 혁신에 더 큰 보람을 느낄것이라 생각했습니다.</p>\n<p>결론적으로, 제가 한국투자저축은행을 선택한 이유는 '안정적인 기반 위에서 가장 임팩트 있는 혁신'을 할 수 있는 곳이기 때문입니다.</p>\n<h2>경쟁사 앱과 비교</h2>\n<p>앱의 편의성 측면에서 봤을 때, Key 뱅크는 앱의 첫 화면에서 대표적인 금융 상품을 확인할 수 있고, UI가 전체적으로 깔끔하다는 느낌을 받았습니다.\n그러나 OK 저축은행과 비교했을 때, 앱에 머물게 하는 경험적 매력은 부족하다고 생각했습니다. 캐릭터를 활용한 홍보로 매력을 더하고, 미니게임, 운세 등 애플리케이션에 사용자가 더 머물게 하는 매력적인 기능들이 같이 있었습니다.</p>\n<p>하지만 이는 반대로 말하면 Key 뱅크 앱이 더 성장 가능성이 열려있다고 볼 수 있습니다. 지금과 같은 깔끔한 UI를 바탕으로, 사용자가 앱에 더 머물 수 있는 혜택과 이벤트와 같은 기능을 포함시킨다면 더 좋을 것 같습니다.</p>\n<h2>저희 'KEY뱅크'가 인상 깊었다고 하셨는데, <strong>직접 사용해보셨나요?</strong> 사용해보셨다면 <strong>가장 만족스러웠던 점과, IT 전문가로서 개선하고 싶은 점</strong>이 각각 무엇이었나요?</h2>\n<p>Key뱅크 앱은 전반적으로, 불필요한 기능 없이 깔끔하고 사용하기 편리하다는 느낌을 받았습니다. 금융상품도 대출, 예적금으로 구분하여 한눈에 확인할 수 있어 좋았습니다. 약간 아쉬웠던 점이라면, 조회/이체와 같은 기능을 클릭했을 때, 전자금융서비스 가입이 필요하다는 메시지가 나오는데, 어떻게 가입할 수 있는지에 대한 안내가 없다는 점이었습니다. 이때 바로 전자금융서비스 가입 페이지로 이동이 되던가, 방법을 안내해준다면 훨씬 많은 유저를 잡아둘 수 있지 않을까 생각됐습니다.\n그리고 메인페이지에서 KEY뱅크가 추천하는 상품을 볼 수 있었는데, 조금 더 다양한 기준에서 어떤 점이 특화된 상품인지 추천해서 보여준다면 더 좋을것 같았습니다.</p>\n<h2>저희 회사의 강점으로 '안정'과 '혁신'을 꼽아주셨습니다. IT 직무에서 이 <strong>두 가지 가치가 서로 충돌하는 상황</strong>이 생긴다면 어떻게 대처하시겠습니까? (예: 새로운 기술 도입 시 보안 문제)</h2>\n<p>이는 회사가 추구하는 방향에 따라 다를 수 있다고 생각합니다. 급변하는 IT 회사라면, 혁신의 가치에 조금 더 중점을 둘 것입니다. 하지만, 은행에서는 절대적으로 안정이 중요한 가치라 생각합니다. 예를 들어 새로운 기술을 도입 시 보안 문제가 생길 가능성이 있다면, 기 기술을 아예 도입하지 않거나 시간이 오래 걸리더라고 보안 취약점을 완전히 해결하고 도입해야 할 것입니다. 그래서 두 가치가 충돌하는 상황이 생긴다면, 저는 안정을 우선시 하며, 다양한 케이스로 문제가 생기지 않을지 검토하며, 시간이 오래 걸리더라도 확실한 혁신을 제공하고 싶습니다.</p>\n<h2>저희 회사의 '안정성'은 보수적인 문화로 비칠 수도 있습니다. 본인이 가진 <strong>혁신적인 아이디어가 조직의 속도나 문화와 맞지 않을 때</strong> 어떻게 하시겠습니까?</h2>\n<p>안정성은 금융 IT의 핵심이자, 한국투자저축은행이 오랜 기간 고객들과 쌓아온 신뢰입니다. 따라서 혁신은 안정성이란 토대 위에서 이루어져야 합니다.</p>\n<p>아이디어가 조직과 맞지 않는다면, 섣불리 주장하기 전에, 왜 그럴까? 에 대해 먼저 자문하겠습니다. 선배님들의 의견을 경청하며 제 아이디어가 놓치고 있는 부분이 있는지 객관적으로 검토해보겠습니다.</p>\n<p>그리고 아이디어를 한번에 완벽히 제안하기보다. 전체 시스템에 영향을 주지 않는 작은 범위에서 프로토타입을 만들어보고 검증해보며, 어떤 비즈니스 문제를 해결할 수 있는지, 리스크는 무엇이며 어떤 긍정적인 효과를 기대할 수 있는지 구체적으로 정리하여 소통하겠습니다.</p>\n<p>이러한 노력에도 받아들여지기 힘들다면 그것은 실패가 아니라 학습의 과정이라고 생각합니다. 받은 피드백을 바탕으로 아이디어를 발전시켜, 더 적절한 시점에, 더 완성도 높게 제안할 기회를 모색하겠습니다.</p>\n<h2>좋습니다. 그렇다면 본인의 기술력으로 고객 가치를 더하고 싶다고 하셨는데, <strong>입사 후 가장 먼저 도전해보고 싶은 프로젝트나 개선하고 싶은 서비스</strong>는 무엇인가요?</h2>\n<p>기존 시스템에 익숙해지는게 가장 중요하다고 생각합니다. 팀에서 사용하는 기술 스택을 익히겠습니다.</p>\n<p>그 후에는 개발자 경험 및 운영 효율성을 개선하는 작업을 진행해보고 싶습니다. About 서비스를 운영하며, 기술 부채가 개발 속도와 안정성을 저해한다는 것을 체감했습니다. 이런 문제를 피하기 위해, 반복 업무를 자동화하고, 시스템 모니터링을 고도화하며 코드 구조를 개선하는 프로젝트에 참여하고 싶습니다.\n또한 데이터를 기반으로 사용자 한명에게 다가가는 프로젝트를 진행하고 싶습니다. Key뱅크 앱 내에서 고객들의 소비 패턴에 기반한 저축 습관을 제안하거나, 금융 목표를 설정하고 그 목표의 달성을 돕는 금융 챌린지 와 같은 기능을 개발해보고 싶습니다.</p>\n<h2>'About' 프로젝트의 백엔드 시스템을 안정적으로 운영했다고 하셨는데, 경험했던 <strong>가장 심각했던 장애나 기술적인 문제</strong>는 무엇이었고, 그것을 어떻게 해결하셨나요?</h2>\n<p>예기치 못한 오류로 서비스가 하루에 한번꼴로 다운되는 일이 있었습니다. Express.js에서 Nest.js로 옮긴 직후 이런 문제들이 일어났는데, 에러처리를 완벽히 했다 생각했는데, 예기치 못한 오류들 때문에 이런 문제가 생겼습니다. 서비스를 Docker container로 배포하고 있었는데, 에러 로그를 확인하는게 쉽지 않다는 문제도 있었습니다.\n이를 해결하기 위해, 먼저 에러 처리 파이프라인을 정비했습니다. 전역 에러 핸들러를 설정하고, 에러들을 일관된 JSON 포맷으로 변경했습니다. 그리고 에러 발생 케이스에 따라 정리하고, 예기치 못한 오류는 따로 잡아낼 수 있도록 했습니다. 그런다음 ELK 스택을 도입했습니다. Docker에서 나오는 오류를 필요한 것만 필터링하여 Kibana 대시보드에서 확인할 수 있는 파이프라인을 구성했습니다.\n그 결과, 에러로 서비스가 다운되는 케이스가 없어졌고, 에러가 발생하면 대시보드에서 즉시 확인할 수 있는 모니터링 환경도 갖추었습니다.</p>\n<h2>해커톤에서 단기간에 서비스를 구현하는 것과, 'About'처럼 장기간 서비스를 운영하는 것은 매우 다른 경험이었을 것 같습니다. 두 경험을 통해 <strong>각각 무엇을 배웠다고 생각하시나요?</strong></h2>\n<h2><strong>도메인 주도 설계(DDD)와 클린 아키텍처</strong>를 학습하고 적용했다고 하셨는데, 'About' 프로젝트에 실제로 이 개념들을 어떻게 적용했는지 <strong>구체적인 코드나 구조를 예시</strong>로 들어 설명해주실 수 있나요?</h2>\n<p>먼저 클린아키텍처를 적용하며, 모듈별로 controller, service, repository를 분리했습니다. Controller를 통해 외부의 요청을 service로 전달하면, service에서 비즈니스 로직을 처리하고, repository에서 DB와 통신합니다.\n이 과정에서 Repository는 인터페이스를 정의하여 의존성 역전 원칙을 적용했습니다. service 코드는 repository의 interface에만 의존하여, interface 내부 구현을 수정하여도 service 코드는 수정할 필요가 없도록 했습니다. 이렇게 DB의 의존성을 완벽히 분리하여 언제든 다른 DB로 교체할 수 있는 구조를 만들었습니다.\n또한 도메인 주도 설계를 적용했습니다. 서비스의 핵심 데이터들을 도메인으로 설계하고, 핵심 검증 로직이나 비즈니스 로직을 도메인 객체에 위임했습니다. 이러한 설계를 통해 프로젝트가 제공하는 도메인, 핵심 기능을 한곳에서 확인하고, 중복을 줄일 수 있으며, 전체 구조를 깔끔하게 유지할 수 있었습니다.</p>\n<h2>본인이 생각하는 **'유지 보수가 용이한 시스템'**이란 무엇인가요? 좋은 코드와 나쁜 코드의 차이를 가르는 본인만의 기준이 있다면 설명해주세요.</h2>\n<p>수치화된 기준은 없지만, 코드를 수정할 때 여러 곳을 같이 수정해야 한다면 유지 보수가 나쁜 시스템이라 여깁니다. 예를 들어, 신규 기능을 추가하거나 기능을 수정해야 할때, 이건 건드릴 곳이 너무 많아서 힘들겠는데? 라는 생각이 들면 구조에 대해 다시 생각해 보아야 한다고 생각합니다.</p>\n<h2>금융 IT 시스템은 특히 안정성과 보안이 중요합니다. 본인이 가진 개발 철학이나 경험이 <strong>금융 시스템의 안정성을 높이는 데</strong> 어떻게 직접적으로 기여할 수 있다고 생각하시나요?</h2>\n<h2>본인은 '안정적인 시스템 구현'과 '새로운 서비스 개발' 역량을 모두 갖추었다고 하셨습니다. 하지만 현실에서는 <strong>안정성을 추구하다 보면 개발 속도가 느려지고, 속도를 추구하다 보면 안정성을 놓치기 쉽습니다.</strong> 이 두 가치가 충돌할 때, 본인은 어떤 기준으로 우선순위를 판단하시겠습니까?</h2>\n<h2>해커톤, 교환학생 프로젝트 등 다양한 경험을 하셨습니다. 여러 경험을 통해 <strong>본인이 개발자로서 가장 크게 성장했다고 느낀 순간</strong>은 언제였나요?</h2>\n<p>개발자로서 가장 성장했다고 느낄 때는, 새로운 기술을 배워서 프로젝트에 적용하고 그게 제대로 동작할 때입니다.\n일례로, ELK 스택을 이용하여 API의 응답속도를 분석하고, 응답이 오래걸리는 API를 찾아서 Redis 캐싱을 적용해 응답시간을 50%이상 줄인 적이 있습니다.\n그 결과로 웹페이지의 초기 렌더링 속도가 빨라졌고, 사용자들로 부터 체감될 정도로 빨라졌다는 후기를 들었습니다. 이런 경험으로 개발자로서도 성장하고, 보람도 느낄 수 있었습니다.</p>\n<h2>여러 프로젝트를 경험한 것은 장점이지만, 한편으로는 <strong>하나의 분야에 대한 깊이가 부족한 제너럴리스트(Generalist)는 아닌가 하는 우려</strong>가 있을 수도 있습니다. 이에 대해 어떻게 생각하시나요?</h2>\n<h2>'사용자의 요구사항을 최우선으로 하는 금융 IT 전문가'가 꿈이라고 하셨습니다. 본인이 생각하기에, <strong>저축은행 고객들이 IT 서비스에 대해 가장 중요하게 생각하는 요구사항</strong>은 무엇이라고 생각하시나요?</h2>\n<p>제가 Key 뱅크의 플레이스토어 리뷰를 좀 확인해봤습니다. 대게 대부분의 사용자들이 말하는 불편사항은 대출을 하려고 모든 정보를 입력했는데, 대출이 불가능한 경우에 대한 불만이 많았습니다.\n저축은행인만큼 대출이 급한 사용자가 많고, 빠르고 쉽게 대출을 하고싶은 요구사항이 크다 생각했습니다.\n제가 직접 대출을 받아볼 수는 없어서, 정확한 대출 프로세스는 모릅니다. 하지만 대출 과정을 조금 더 단순화 할 수는 있지 않을까 생각합니다. 예를 들면, 사용자에게 선택적으로 직장, 연봉과 관련된 데이터를 사전에 입력해 둘 수 있게 하고, 이를 바탕으로 대출 불가능 상품을 표시해주는 것입니다. 혹은 외부 금융 데이터와 연계해서 이런 기능을 추가할 수도 있을 것 같습니다. 그리고 가져온 정보들을 대출 정보를 입력할 때 자동으로 입력되도록 한다면 사용자가 입력해야 하는 정보도 많이 줄일 수 있을 것입니다. 그렇게 불필요하게 불가능한 상품에 정보를 입력하는 케이스를 줄이면 요구사항을 해소할 수 있지 않을까 생각해보았습니다.</p>\n<h2>'기술을 통해 고객의 삶에 실질적인 편의를 제공하고 신뢰를 얻을 때 보람을 느낀다'고 하셨습니다. 본인이 가진 기술 역량으로, **한국투자저축은행 고객들에게 제공하고 싶은 '실질적인 편의'**가 있다면 어떤 것이 있을까요?</h2>\n<h2>저희 회사가 꿈을 이루기 위한 '최고의 환경'이라고 말씀해주셨습니다. 저희 회사 외에 <strong>다른 금융사(시중은행, 핀테크 등)도 고려해보셨을 텐데, 그럼에도 불구하고 저희 회사를 선택한 결정적인 이유</strong>는 무엇인가요?</h2>\n<p>기능이 많지 않은만큼 다양한 것을 시도해볼 수 있지 않을까용?</p>\n<h2>'핵심 금융 시스템 운영'과 '디지털 혁신 프로젝트 참여' 모두를 경험하고 싶다고 하셨습니다. 만약 입사 후, <strong>본인의 희망과는 달리 한 가지 업무(예: 기존 시스템 유지보수)만 장기간 맡게 된다면</strong> 어떻게 하시겠습니까?</h2>\n<h2>'회사의 발전에 기여하는 선순환'을 만들고 싶다고 하셨습니다. 그렇다면 입사 후, <strong>이 선순환을 만들기 위해 가장 먼저 학습하거나 습득해야 할 역량</strong>은 무엇이라고 생각하시나요? 그리고 그것을 위해 어떤 노력을 하실 건가요?</h2>\n<p>\"가장 먼저 저축은행의 핵심业务인 여신과 수신에 대한 도메인 지식을 빠르게 습득해야 합니다. 이를 위해 선배님들께 적극적으로 질문하고, 관련 업무 규정이나 프로세스를 꾸준히 학습하겠습니다. 기술적인 부분과 비즈니스적인 부분을 함께 이해해야 진정한 전문가로 성장할 수 있다고 생각합니다.\" 와 같이 구체적인 학습 계획을 제시하는 것이 좋습니다.</p>\n<p>동료들과의 적극적인 코드 리뷰와 기술 공유를 통해 팀의 기술력 상향 평준화에 기여</p>\n<hr>\n<h1>나에 대한 질문</h1>\n<h2>1분 자기소개</h2>\n<p>안녕하세요. 한국투자저축은행 IT 직무에 지원하게 된 채민관이라고 합니다. 컴퓨터과학을 전공하며 백엔드와 프론트엔드 관련한 다양한 기술 스택을 공부했습니다. 특히 <strong>유지보수가 용이하고 확장이 유연한 시스템을 설계하는 것을 저의 핵심 개발 철학으로 삼아왔습니다.</strong>  또한 수백명이 이용하는 웹서비스를 운영하며 안정적인 서비스 제공의 중요성과 사용자 요구사항의 중요성을 배웠습니다.</p>\n<p>이러한 저의 경험은 한국투자저축은행의 견고한 뱅킹 시스템과 'KEY 뱅크'와 같은 디지털 플랫폼을 안정적으로 운영하며 발전시키는데 기여할 것입니다. 또한 유지보수가 용이하고 확장이 유연한 설계를 통해, 신규 금융 상품 개발과 같은 핵심 업무를 더욱 안정적이고 효율적으로 만들어나가겠습니다.</p>\n<p><strong>안주하지 않고 끊임없이 성장하는 개발자</strong>가 되어, 한국투자저축은행과 함께 새로운 금융의 미래를 열어가고 싶습니다. 감사합니다.</p>\n<h2>스트레스 해결법</h2>\n<p>통제할 수 있는 스트레스\n통제할 수 없는 스트레스\n바로 앞에 발표를 앞두고 있다거나 즉각적인 스트레스</p>\n<p>스트레스는 원인을 통제할 수 있는 경우와 통제할 수 없는 경우로 나누어 생각할 수 있을것 같습니다.\n먼저 원인이 통제 가능하다면, 시간을 좀 투자하더라도 원인을 잘게 나누어 해결하고 적극적으로 방법을 찾아 해결합니다.\n반면 스트레스의 원인이 외부에 있다면, 저는 수면을 통해 해소하곤 합니다. 저는 스트레스나 번아웃 같은 것들을 빠르게 극복하는 편입니다. 푹 자고 일어나면 개운함과 동시에 스트레스를 받았던 것들을 좀 잊게 돼서 숙면하는걸 선호합니다. 이를 위해 시간과 날씨가 괜찮다면 런닝을 하기도 합니다. 런닝을 하면 다른 생각들을 잊게되고 숙면에도 도움이 되기 때문입니다.\n마지막으로 발표를 앞두고 있다거나 하는 상황에 스트레스를 받는다면, 호흡을 통해 스트레스를 해소합니다. 폐에 숨이 꽉차게 들이마쉰 후 한번 도 들이마쉼.</p>\n<h2>본인의 장단점</h2>\n<p>저의 장점은 강한 책임감과 실행력입니다. 대학에서 진행하는 해커톤에 참여했을 때, 핵심기능 중 도서관 프로그램 추천 기능을 완성하지 못할 위기에 놓였습니다. 저는 팀의 목표 달성과 프로젝트의 완성도를 위해, 기존에 학습해 두었던 LLM 기술을 빠르게 적용하여 추천 기능의 프로토타입을 구현하고 시스템에 연동하는 역할을 자원했습니다. 밤샘 작업 끝에 핵심 기능을 완성하여 프로젝트의 완성도를 크게 높일 수 있었고, 최종 발표에서도 좋은 평가를 받았습니다.</p>\n<p>저의 단점은 거절을 잘 못하는 것입니다. 인턴 시절 제가 맡고 있는 기능 외에도 다양한 업무 요청을 받았는데, 거절을 잘 하지 못해 최대한 바로 해결해주려 했습니다. 처음에는 이것이 효율적인 협업이라 생각했지만, 오히려 책임져야 할 핵심 업무가 늦어져 전체 팀의 생산성을 저해하는 결과를 낳았습니다.\n이 문제를 해결하기 위해, 체계적인 업무 관리의 필요성을 실감하고, 중요도와 긴급도를 기준으로 저만의 우선순위를 설정했습니다. 이 기준을 사용해 제 업무 상황을 투명하게 공유하고, 일정을 조율하며 저의 단점을 극복해 나아갔습니다ㄴ.</p>\n<h2>살면서 가장 힘들었던 순간</h2>\n<p>사회복무요원으로써 특수학교에 근무하게 되었습니다. 특수학교 근무에 대해 찾아보니, 폭력성이 있는 아이를 통제해야 하고 모르는 아이의 신변처리를 도와야 하는 등 이전에 경험해보지 못한, 완전히 다른 방식의 소통과 책임감이 필요한 곳이었습니다. 이런 환경에 놓이니 과연 내가 잘할 수 있을까 하는 걱정이 앞섰습니다.</p>\n<p>하지만 피할 수 없다면, 제가 먼저 다가가야 한다고 생각했습니다. 제가 가진 선입견을 버리고 아이들의 눈높이에서 소통하려 노력했습니다. 말이 통하지 않는 아이와도 행동으로 소통하려 하고, 아이의 폭력성 있는 행동도 이해하기 위해 노력했습니다. 이러한 노력으로 환경에 완벽히 적응하며 무사히 복무를 마칠 수 있었고, 나중에는 봉사활동으로 아이들을 다시 만나러 가기도 했습니다.</p>\n<p>이 경험은 저에게 값진 경험이 됐습니다. 진정한 소통은 정해진 방식이 아닌, 상대의 입장을 이해하려는 노력에서 시작한다는 것을 알았고, 어느 환경에 놓여도 적응할 수 있다는 자신감을 불어넣어 주었습니다.</p>\n<h2>여기와서 어떻게 기여할것이냐?</h2>\n<p>제가 개발자로서 가장 중요하게 생각하는 가치는 안정성과 사용자 요구사항을 해결하며 가치를 제공하는 것입니다.\n한국투자저축은행은 고객의 자산을 다루는 곳인 만큼, 먼저 'KEY뱅크'와 같은 서비스의 안정성에 기여하겠습니다.</p>\n<p>제가 구글 플레이스토어에서 사람들이 주로 어떤 불만을 갖고 잇는지 좀 찾아보았습니다. 주로 대출을 위한 정보를 모두 입력했는데 거절당한 경우에 대한 불만이 많았습니다. 사전 정보를 입력받아 적합한 금융 상품을 추천해주거나, 정보를 입력하는 중간중간 자격요건을 체크해 주는등 전반적인 프로세스를 개선해볼 수 있을것 같습니다.</p>\n<h2>어떻게 일할 것이냐?</h2>\n<h2>지원동기</h2>\n<p>저는 안정성과 혁신이라는 두 가지 가치를 모두 실현하는 금융 IT 전문가가 되고 싶습니다. 기술로 고객의 자산을 안전하게 지키고, 기술로 고객의 삶을 편리하게 만드는 경험을 하고 싶습니다.\n이러한 저의 목표를 이루기에 한국투자 저축은행은 매력적인 회사였습니다. 특히 서민과 중소기업이라는 명확한 고객층에게 필요한 금융서비스를 제공하며, 저의 기술이 가치를 만들어내는 과정을 가까이에서 체감할 수 있겠다 생각했습니다.</p>\n<p>또한 한국투자저축은행은 한국투자금융지주라는 든든한 기반이 주는 안정성을 기반으로 저축은행 업계에서 꾸준한 성장을 하고 있습니다. 또한 'Key 뱅크'와 같은 서비스를 통해 금융을 편리하게 하려는 혁신성 또한 갖추고 있어, 저의 개발 철학과 잘 맞는다고 생각하여 지원하게 되었습니다.</p>\n<p>제가 가진 안정적인 시스템 운영 경험과 새로운 도전을 두려워하지 않는 실행력을 바탕으로, 한국투자저축은행의 '안정적인 혁신'에 기여하는 핵심 인재가 되겠습니다.\"</p>\n<h2>인생의 목표가 무엇인지?</h2>\n<p>제 인생의 목표는 꾸준히 성장하여 제가 속한 공동체에 기술적으로나 인간적으로나 긍정적인 영향을 주는 사람이 되는 것입니다.</p>\n<p>개발자로서는 최신 기술을 빠르게 학습하고, 제가 만드는 서비스를 통해 사용자들에게 안정적으로 제공되고 불편한 점을 해결해주며 가치를 창출하고 싶습니다. 한국투자저축은행에서 고객들이 자산을 믿고 맡길 수 있는 금융 서비스를 만들어 이를 달성할 수 있다고 생각합니다.</p>\n<p>개인적으로는 제가 가진것을 나누며 동료들과 함께 성장하고 싶습니다. 원활한 의사소통으로 제가 속한 공동체에 긍정적인 분위기를 만들어주는 사람이 되고 싶습니다.</p>\n<h2>성공한 인생이란 무엇이라고 생각하시나요?</h2>\n<p>제가 추구하는 성공한 인생이란, 주변 사람들, 혹은 만나는 사람들에게 신뢰 받는 사람이 되는 것이라고 생각합니다.</p>\n<p>먼저 전문가로서는, 제가 가진 기술을 인정받고 제가 만드는 가치를 사람들이 신뢰롭다고 생각할 때  가장 보람과 성취감을 느낄 것 같습니다.</p>\n<p>개인으로서는 제가 속한 공동체의 사람들이 저를 신뢰하고 믿을 수 있는 사람이라고 생각하면 좋겠습니다.</p>\n<p>전문적인 성장과 인간적인 성숙이 조화를 이루면 이러한 신뢰를 얻을 수 있고, 비로소 성공한 인생이라고 생각할 수 있을것 같습니다.</p>\n<h2>자신의 단점 3가지를 말해보세요.</h2>\n<ul>\n<li>돕고자 하는 마음이 앞서 우선순위를 놓쳤던 경험 (거절을 잘 못하는 것)</li>\n<li>기술적 구현에 몰두하여 '왜?'를 놓치려 했던 경향</li>\n<li>의욕이 앞서 다소 낙관적으로 일정을 산정했던 습관</li>\n</ul>\n<h2>그 중 한국투자저축은행에 지원한 이유</h2>\n<p>한국투자저축은행에 입사하고 싶은 이유는 '견고한 안정성'과 '미래의 성장성'이라는 두가지를 갖췄다는 점이 제가 개발자로서 추구하는 목표와 일치하기 때문입니다.</p>\n<p>먼저 한국투자저축은행은 한국투자금융지주의 일원으로서 안정성을 갖추고 있습니다. 안정적인 재무 상태를 바탕으로 업계에서 최고 수준인 A0 기업 신용 등급을 유지하고 있습니다. 이는 장기적인 관점에서 IT 인프라에 꾸준히 투자하고 견고한 시스템을 만들 튼튼한 기반이 된다고 생각합니다.</p>\n<p>또한 네이버페이와 같은 빅테크 기업과 협업하여 전용 상품을 출시하는 모습이 인상깊었습니다. 이는 기존의 금융을 넘어 디지털에 익숙한 새로운 고객들에게 다가가려는 적극적인 자세를 보여준다고 생각합니다. 이러한 혁신적인 모습은, 제가 가진 호기심과 실행력으로 회사에 기여할 기회가 많다는 확신을 주었습니다.</p>\n<h2>당신의 강점/장점?</h2>\n<p>저는 문제를 회피하지 않고, 기술을 통해 근본적인 해결책을 찾아내는 '기술적 문제 해결 능력'을 갖추었습니다.</p>\n<p>'About' 서비스를 운영하며, 초기에는 빠른 기능 개발에만 집중하다 보니 기술 부채가 쌓여 개발 속도와 안정성이 떨어지는 문제에 직면했습니다. 저는 단순히 눈앞의 버그를 해결하는 땜질식 처방이 아니라, 장기적인 안정성을 위해 클린 아키텍처를 도입하여 시스템을 전면 리팩토링하고, CI/CD와 로깅 환경을 구축하는 근본적인 해결책을 주도했습니다.\n저는 기술을 사용하는 '사람'을 먼저 생각하는 '사용자 중심의 책임감'을 가지고 있습니다.</p>\n<p>이 경험은 제가 'About' 서비스를 개발할 때, 단순히 기능을 만드는 것을 넘어 '이 기능이 사용자에게 정말 편리할까?', '어떤 부분에서 어려움을 느낄까?'를 끊임없이 고민하는 개발 철학의 바탕이 되었습니다. 이러한 저의 강점은 <strong>한국투자저축은행에서 다양한 고객, 특히 고령층과 같은 디지털 소외 계층까지도 배려하는, 모두를 위한 금융 서비스를 만드는 데 반드시 필요하다</strong>고 생각합니다.</p>\n<h2>내가 생각하는 좋은 회사</h2>\n<p>개발자로서 '안정성'과 '사용자 중심의 혁신'이라는 두 가지 가치를 가장 중요하게 생각합니다. 견고한 안정성 위에서 사용자를 향한 혁신을 추구할 때, 서비스가 성장할 수 있다고 믿기 때문입니다. 회사를 선택할 때도 이 기준을 최우선으로 고려합니다.</p>\n<h2>글을 잘쓰냐 말을 잘하냐</h2>\n<p>글쓰기와 말하기 모두 개발자에게 필요한 상호 보완적인 역량이라고 생각합니다. 둘 중에 고르자면 저는 말하기에 조금 더 자신이 있습니다.</p>\n<p>먼저 글쓰기는 생각을 구조화하기 위해 사용합니다. 복잡한 문제를 해결하거나 시스템을 설계할 때, 생각을 먼저 글로 정리해봅니다. 이런 과정을 통해 논리가 더욱 명확해지고 생각을 구체화 할 수 있었습니다.</p>\n<p>말하기는 공감대를 형성하고 협업을 이끌어내는 과정입니다.\n좋은 개발자는 뛰어난 의사소통 능력이 필요합니다. 개발이라는 분야 자체가 다른 사람의 요구를 기술적으로 해결해야 하는 분야이기 때문입니다. 서비스를 운영하면서 사용자들의 피드백을 들으며 서비스를 개선하렸고, 교환학생, 해커톤 등 다양한 서비스를 팀원들과 만들어보면서 말하기 역량을 길렀고 저의 강점 중 하나가 되었습니다.</p>\n<h2>취미가 어떻게 되는지</h2>\n<p>저의 취미는 헬스입니다. 저는 지금도 마른 편이지만, 예전에 엄청 말랐던 적이 있습니다. 이러한 왜소한 체격을 극복하기 위해 헬스를 시작했습니다.</p>\n<p>헬스를 시작해서 좋은점은 꾸준히 하는 일이 생겼다는 점입니다. 매일 꾸준히 하는 일이 생기고 성과가 눈에 점점 보이니 성취감과 꾸준함을 얻을 수 있었습니다.</p>\n<p>또한 헬스를 하며 땀을 흘리는 것이 재충전의 시간이 됩니다. 업무나 개발 과정에서 어려운 문제에 부딪혔을 때, 잠시 땀을 흘리며 운동에 집중하고 나면 오히려 문제에 대한 새로운 시각이나 해결책이 떠오를 때가 많았습니다.</p>\n<hr>\n<h1>회사에 관한 질문</h1>\n<h2>당행 상품에 대해 아는대로 말해보라</h2>\n<p>예금</p>\n<ul>\n<li>더드림 파킹통장: 변동이율이 적용되고 입출금 자유</li>\n<li>ACE 회전정기예금: 1년 단위로 이율이 변경</li>\n</ul>\n<p>대출</p>\n<ul>\n<li>온라인 햇살론: 저신용, 저소득자의 정부지원보증부대출</li>\n<li>ACE 신용대출</li>\n</ul>\n<h2>key뱅크 앱의 아쉬운 점과 좋은 점</h2>\n<p>Key 뱅크 앱의 좋았던 점은, 불필요한 기능이 없다는 점과 깔끔한 UI였습니다. 앱의 첫 화면에서 당행의 상품을 확인할 수 있고, 대출과 예적금을 구분하여 한눈에 확인할 수 있었던 점이 좋았습니다.</p>\n<p>아쉬웠던 점은 먼저 기능적으로는 계좌 조회 버튼을 클릭했을 때, 전자금융서비스에 가입하라는 안내 문구만 나오고 실제 방법에 대한 설명은 없어서 당혹스러웠던 경험이 있습니다. 만약 안내 문구대신 실제 가입 페이지, 혹은 가입 방법을 설명해준다면 유저의 이탈을 더 막을 수 있지 않을까 생각했습니다.</p>\n<p>또한 사용자들을 앱에 머물게 할 핵심 기능이 부족하다고 생각했습니다. 타사의 앱들을 확인해봤을 때, 캐릭터를 이용한 홍보, 혹은 앱 내 이벤트 등을 통해 고객들을 앱에 머물게 하는 기능이 있었습니다. 저는 이러한 기능들이 애플리케이션에 대한 이미지를 더 좋게 하고, 사용자들이 한국투자 저축은행의 서비스에 더욱 의지하게 할 수 있다고 생각합니다. 그래서 이러한 기능들이 추가되면  더 좋지 않을까 생각해보았습니다.</p>\n<h2>한국투자저축은행에 대해 아는 것, 이 분야에 지원하게 된 동기</h2>\n<p>한국투자금융지주라는 든든한 기반을 바탕으로, 저축은행 업계에서 선두주자 역할을 하고 있습니다. 대표적인 상품으로는 온라인 햇살론, ACE 신용대출 등이 있으며 부동산 PF 대출 등도 진행하고 있는것으로 알고 있습니다. 그리고 저축은행중에 기업신용등금이 항상 A를 유지하며 가장 높은것으로 알고 있습니다.</p>\n<p>이러한 안정성을 갖춘 저축은행에서, 서민과 중소기업을 위한 금융이라는 확실한 고객층에게 필요한 금융 서비스를 개발하고, 저의 기술이 만들어내는 가치를 가까에에서 체감하고 싶어 지원하게 되었습니다.</p>\n<p>시중은행에 비해 저축은행에서 저의 성과를 더욱 가까이에서 확인할 수 있고, 전반적인 금융 시스템을 개발하며 다양한 도전을 해볼 수 있을 것이라 생각했습니다.</p>\n<h2>금융의 10년 뒤는?</h2>\n<p>금융은 점점 초개인화된 금융을 추구하는 방향으로 가게 될 것이라고 생각합니다. 개인의 금융 비서와 같은 역할을 할 수 있어야 합니다.\n최근 빅테크 기업들도 금융 업계에 진출하고 있는 만큼, 이러한 경향은 더욱 빨라질 것이라 생각합니다.</p>\n<p>현재처럼 단순히 잔액을 보여주고, 입출금을 하고 예적금, 대출을 하는 것을 넘어, 소비 패턴 투자 성향 등을 분석하고 이에 알맞은 금융 상품을 고객에게 추천하며, AI 챗봇 기능을 활용해 고객이 궁금한 점을 바로 해결해주는 그런 서비스로 진화할 것입니다.</p>\n<p>예를 들면, '다음 달 카드 지출이 평소보다 30퍼 많을 것으로 예상되니, 단기 파킹통장의 일부 금액을 이체해두어 연체를 막는것이 신용 점수 향상에 도움이 될 것이다.'와 같이 고객이 개인 비서처럼 사용할 수 있는 금융 비서로 진화할 것입니다.</p>\n<h2>디지털 뱅크로의 전환에 어떻게 기여할 것인가?</h2>\n<p>디지털 전환의 가장 중요한 전제는 안정성이라 생각합니다. 디지털에 의존적인 상황에서 발생하는 오류는 그만큼 치명적일 것이기 때문입니다. 따라서 장애를 사전에 예측할 수 있도록 인프라를 구성하고, 에러 발생 시에도 즉각적으로 대응할 수 있는 인프라를 만들겠습니다.</p>\n<p>그리고 이를 바탕으로, 고객들의 금융 경험을 편리하게 하는 기능 개발에 기여하겠습니다. 복잡한 대출 신청 프로세스를 간소화하고, 고객의 정보에 맞게 필요한 금융 상품을 먼저 추천하는 등, 한국투자저축은행이 고객의 일상에 꼭 필요한 금융 파트너가 되도록 기여하겠습니다.</p>\n<h2>어떤일을 하는지 아나?</h2>\n<p>웹/앱 애플리케이션을 운영</p>\n<p>(계정계 시스템 개발/운영)\n대출 심사, 사후관리 등 전반적인 대출 프로세스를 개발하고 운영</p>\n<p>(정보계 데이터 관리)\n관리 업무를 전산화하고 데이터 분석 보고서를 통해 인사이트를 제공</p>\n<h2>당사의 이미지</h2>\n<p>가장 신뢰가 가는 저축은행 입니다. 한국투자금융지주라는 든든한 기반이 있고, 한국투자증권등과 같은 증권업도 운영하여 회사 이름도 엄청 친숙했습니다. 그리고 실제로도 저축은행 업계에서 가장 높은 기업신용등급인 A 단계를 유지하며 신뢰성 있는 모습을 보여주고 있습니다. 그래서 저는 신뢰도가 높은 최고의 저축은행이라는 이미지를 가지고 있습니다.</p>\n<h2>1금융권과 2금융권의 차이</h2>\n<p>2금융권은 은행을 제외한 저축은행, 증권사, 보험사 등의 금융기관을 뜻합니다.</p>\n<p>저축은행은 1금융권에 비해 상대적으로 높은 리스크를 감수하는 만큼 더 높은 예금 이자를 제공합니다.\n1금융권에서 중, 저신용으로 인해 대출이 어려운 사람들을 위한 대출 상품을 더 높은 대출 금리로 제공합니다.</p>\n<h2>\"시중은행이 아닌 저축은행에 지원한 이유\"</h2>\n<p>\"제가 시중은행이 아닌 저축은행을 선택한 이유는, 제가 만든 기술이 가져오는 **'가시적인 임팩트'**에 더 큰 가치를 두기 때문입니다.</p>\n<p>물론 시중은행은 규모가 크고 시스템이 잘 갖춰져 있을 수 있지만, IT 전문가로서 제가 맡는 역할은 매우 세분화될 수 있습니다. 반면 한국투자저축은행과 같은 선도적인 저축은행에서는, 제가 참여한 프로젝트가 회사의 핵심 비즈니스에 직접적으로 기여하고 고객의 반응을 빠르게 확인할 수 있다고 생각했습니다.\n<strong>저의 코드가 서민과 중소기업 고객에게 실질적인 금융 편의를 제공하는 과정을 처음부터 끝까지 경험하며 성장하고 싶습니다.</strong> 이러한 저의 성장 비전을 한국투자저축은행에서 이룰 수 있다고 생각하여 지원했습니다.</p>\n<h2>금융기관의 역할이 뭐라고 생각하는가?</h2>\n<p>사회의 신뢰를 기반으로 개인과 기업의 성장을 돕는 곳.\n사회의 여유 자금을 자금이 필요한 곳으로 흘러가도록 신뢰를 기반으로 작동하는 기관이라고 생각합니다.</p>\n<p>경제 주체의 성장을 지원합니다. 개인에게는 주택 마련이나 교육같은 인생의 목표를 달성할 수 있도록 돕고, 기업에게는 투자 자금을 공급하여 새로운 가치를 창출하도록 지원합니다.</p>\n<h2>저축은행이 뭐하는 곳인가?</h2>\n<p>저축은행은 서민의 금융 편의를 위해 설립된 제2금융권입니다. 시중은행에 비해 높은 예금 금리와 완화된 대출 조건을 제공합니다.\n신용도가 낮거나 소득 증빙이 어려운 사람들에게 꼭 필요한 자금을 공급하는 역할을 합니다.</p>\n<h2>입사 후 무슨 일을 하고 싶은지?</h2>\n<p>먼저 입사 초기에는 한국투자 저축은행 IT 팀에서 사용하는 기술 스택, 필요한 도메인 지식을 배우며 빠르게 적응하겠습니다.\n그 후 이 경험을 바탕으로 기존 시스템의 운영 안정성을 높이고, 'KEY 뱅크'와 같은 디지털 서비스를 고도화 하고 싶습니다.</p>\n<h2>상사가 부당한 지시를 내린다면 어떻게 할 것인가?</h2>\n<p>가장 먼저, 제가 그 지시를 오해했을 가능성을 고려하겠습니다. 상사는 이 분야에서 저보다 더 많은 정보, 다른 시각을 가지고 있을 수 있기 때문입니다. '제가 이해한 바가 맞는지 다시 여쭤봐도 되겠습니까?'와 같이 정중하게 의도와 목적을 다시 한번 확인하겠습니다.</p>\n<p>그 후에도 방법이 부당하다고 생각하면, 다음과 같이 경우를 나눠보겠습니다.\n먼저, 법적으로 문제가 있는 부당한 지시라면 반대 의사를 표하겠습니다. 심각한 문제가 있는 사안이라면 회사의 공식적인 감사 채널을 통한 문제 제기까지 생각해보겠습니다.</p>\n<p>하지만 법적인 문제가 없는 부당한 지시라면, 그 목표를 달성할 수 있는 더 효율적이거나 리스크가 적은 대안이 있는지 고민하겠습니다. 문제 제기가 아닌 해결책을 통해 소통해 보겠습니다.</p>\n<p>이런식으로도 결론이 나지 않는다면, 공식적인 절차를 통해 조언을 구하겠습니다. 팀 리더나 차상급자에게 현재 상황과 예상되는 리스크, 그리고 제가 제시했던 대안 등을 객관적인 사실에 기반하여 보고 드리고 조언을 구하겠습니다.</p>\n<h2>회사 재무제표에 대해 아는대로 얘기</h2>\n<ul>\n<li>8조 5천억 정도의 총자산을 보유하고 있습니다.</li>\n<li>자기자본비율이 거의 16%로 계속 증가하고 있어, 재무건정성이 안정적입니다.</li>\n<li>수익성 지표도 좋아 총자산순이익률이 0.59%로 전년보다 개선됐습니다.</li>\n<li>하지만 부동산 관련 대출의 연체율이 증가하고 있어 이 부분은 리스크 관리가 필요할 것으로 보입니다.</li>\n<li>연체대출비율이 9.42%로 전년동기대비 2%넘게 증가</li>\n</ul>\n<h2>LTV, DTI, DSR의 차이</h2>\n<p>LTV: 담보인정비율. 10억에 LTV 50%면 5억까지 대출\nDTI: 총부채상환비율. 소득 대비 빚을 갚을 능력. 연 소득에서 이번에 받을 주담대의 원리금 상환액과 기존에 보유한 다른 대출의 연간 이자 상환액이 차지하는 비율\nDSR: 총부채원리금상환비율. 모든 대출의 원리금 상환액을 더해 연 소득과 비교.</p>\n<h2>한국투자저축은행의 주요 사업 영역에 대해 설명해보세요.</h2>\n<p>먼저 은행에 자금을 조달하는 수신 업무입니다. 시중은행보다 경쟁력있는 금리를 제공하는 더드림 파킹통장이나 회전정기예름과 같은 상품을 통해, 고객에게 자산 증식의 기회를 제공하고 회사에 안정적인 운영자금을 조달합니다.</p>\n<p>다음으로는 회사의 수익원인 여신 업무입니다.\n가계 금융에는, 살만한 직장인 대출이나 정부지원 상품인 햇살론 등을 통해, 다양한 서민들이 필요한 자금을 이용할 수 있게 돕고 있습니다.\n기업 금융에는 부동산 PF나 부동산 담보대출을 통해 사업을 확장할 기회를 제공합니다.</p>\n<h2>여신심사의 핵심은 무엇이라고 생각하십니까?</h2>\n<p>정확한 리스크 예측이 가장 중요하다고 생각합니다. 단순히 신용 점수를 보는 것을 넘어, 갚을 능력과 갚을 의지를 데이터를 기반으로 예측할 수 있어야 합니다. 소득, 자산, 부채와 같은 전통적 금융 정보 뿐 아니라, 최근에는 소비 패턴이나 통신비 납부 이력과 같은 데이터도 활용하여 잠재적인 리스크를 다각도로 분석해야 합니다. 이러한 정확한 예측이 은행의 자산 건정성을 지키는 역할을 할 것입니다.</p>\n<p>또한 비즈니스 관점에서 효율적인 실행입니다. 아무리 정확한 심사 모델이 있어도, 과정이 너무 느리거나 복잡하다면 고객은 기다려주지 않습니다. 신속하고 일관된 금융 경험을 제공하는 것이 시장 경쟁력에 큰 힘이 될 것입니다.</p>\n<h2>PF(Project Financing)에 대해 아는 대로 설명해보세요.</h2>\n<p>PF는 개발 프로젝트의 미래 사업성, 앞으로 벌어들일 현금흐름을 보고 자금을 조달하는 방식입니다. 보통 프로젝트만을 위한 특수 목적회사를 설립하여 리스크를 분리하는 구조를 가집니다.</p>\n<p>또한 리스크 관리가 중요한 영역입니다.\n최근 고금리와 원자재 가격 상승, 부동산 경기 둔화 등의 이유로 부동산 PF의 사업성이 약화되면서 저축은행의 가장 큰 건전성 관리 과제가 되었습니다. 특히 사업초기에 투입되는 브릿지론이 본 PF로 넘어가지 못할 경우 부실 위험이 크기 때문에(이렇게 되면 사업 착공이 지연되거나 무산되고, 결국 만기가 도래한 브릿지론 중 상당수가 연체 상태에 빠지게 됩니다.), 더욱 정교한 관리가 필요하다고 생각합ㄴ디ㅏ.</p>\n<h2>저축은행과 시중은행의 차이는 무엇이라고 생각합니까?</h2>\n<p><strong>시중은행</strong>은 전 국민과 대기업을 대상으로 보편적이고 안정적인 금융 서비스를 제공하며 경제의 큰 흐름을 책임지는 '대동맥'의 역할을 합니다.</p>\n<p>반면, <strong>저축은행</strong>은 법적 설립 목적부터 '서민과 중소기업의 금융 편의'를 위해 존재합니다. 즉, 시중은행이라는 대동맥의 혈액이 닿기 어려운 <strong>금융 소외계층이나 중·저신용자, 소상공인들에게 자금을 공급</strong>하여 경제의 실핏줄을 튼튼하게 만드는 '모세혈관'의 역할을 수행합니다. 이것이 제가 저축은행에 더 큰 매력을 느끼는 이유입니다.</p>\n<h4><strong>둘째, 상품의 특징과 리스크 관리 방식이 다릅니다.</strong></h4>\n<p>이러한 역할의 차이는 상품에도 그대로 나타납니다. 저축은행은 자금 조달을 위해 시중은행보다 더 높은 예금 금리를 제공하고, 상대적으로 높은 리스크를 감수하는 대신 합리적인 수준의 대출 금리를 책정합니다.</p>\n<p>이는 자연스럽게 <strong>더 정교하고 세분화된 리스크 관리</strong>의 중요성으로 이어집니다. 시중은행이 거시적인 안정성에 집중한다면, 저축은행은 개별 고객의 잠재력을 더 깊이 있게 평가하고 관리해야 하는 과제를 안고 있습니다.</p>\n<h2>최근 금리 변동이 저축은행 업계에 미치는 영향은 무엇인가요?</h2>\n<p>최근의 고금리 기조는 위협과 기회가 있는 양날의 검으로 작용한다고 생각합니다.\n고객의 이자 상환 부담을 가중시켜 연체율 상승으로 이어질 수 있습니다. 특히 시중은행보다 중, 저신용 고객 및 부동산 PF 대출이 많은 저축은행의 경우, 이러한 외부의 충격에 더 민감할 것입니다. 또한 예금 유치를 위해 높은 금리를 제공해야 하는 저축은행의 특성상, 기준금리 인상은 자금조달비용의 상승을 불러올 것입니다.</p>\n<p>이러한 상황에 리스크 관리 역량이 뛰어난 저축은행이 돋보일 수 있는 기회라고도 생각합니다. 정교한 심사 모델을 통해 우량 차주를 선별하고, 부실 자산을 효율적으로 관리하는 능력은 회사의 경쟁력이 되기 때문입니다. 또한, 시중은행들이 리스크 관리를 위해 대출 문턱을 높일 때, 저축은행은 <strong>틈새시장에서 잠재력 있는 고객을 발굴</strong>할 수 있는 기회를 가질 수도 있습니다.</p>\n<h2>한국투자저축은행의 강점은 무엇이라고 생각하십니까?</h2>\n<p>첫째, 한국투자금융지주의 일원으로서 갖춘 '견고한 안정성'입니다.</p>\n<p>이는 단순히 재무적으로 튼튼하다는 의미를 넘어, <strong>고객의 신뢰를 최우선으로 여기는 확고한 경영 철학</strong>을 의미한다고 생각합니다. 실제로 업계 최고 수준인 'A0' 신용등급을 유지하고 있다는 사실은 이러한 안정성을 객관적으로 증명하는 지표입니다.</p>\n<p>둘째, 안정에만 머무르지 않고 '미래를 향한 성장성'을 증명하고 있다는 점입니다.</p>\n<p>특히 <strong>네이버페이와 같은 빅테크 기업과 적극적으로 협업하여 전용 상품을 출시</strong>하는 모습이 매우 인상 깊었습니다. 이는 단순히 상품 하나를 더 판매하는 것을 넘어, 기존의 금융 문법을 넘어 디지털에 익숙한 새로운 고객들에게 먼저 다가가려는 <strong>개방적이고 진취적인 자세</strong>를 보여준다고 생각합니다.</p>\n<h2>금융권에서 고객응대 시 가장 중요한 자세는 무엇인가요?</h2>\n<h2>한국투자저축은행에 대해 아는 것</h2>\n<h2>한투에 입사하면 어떻게 일할 것이냐?</h2>\n<p>항상 배우는 자세로 일하겠습니다. 저의 최우선 목표는 한국투자저축은행의 핵심 금융 시스템과 비즈니스 로직, 팀의 개발 문화에 완벽히 적응하는 것입니다. 제가 아무리 개발 기술과 경험을 가지고 있어도, 회사의 시스템과 문화에 대한 깊은 이해 없이는 기여하기 어렵다고 생각합니다. 선배님들의 노하우를 빠르게 흡수하고, 질문하는 것을 두려워하지 않으며 가장 먼저 신뢰할 수 있는 팀원으로 성장하겠습니다.</p>\n<p>또한 항상 안정성과 장기적인 관점에서의 코드 퀄리티를 고려하며 개발하겠습니다. 저의 업무상황을 동료들과 항상 투명하게 공유하고, 코드 리뷰나 기술 토론에 적극적으로 참여하여 팀 전체의 기술적 향상을 추구하겠습니다.</p>\n<h2>지점 방문 해봤냐?</h2>\n<p>지점 방문을 고민했는데 지점방문을 해보진 않았습니다. 먼저 제가 지원한 IT 분야에 관해서는 영업점에서 많은 정보를 얻기는 힘들다고 생각했습니다.</p>\n<p>또한 제가 면접 준비 경험이 많지는 않아서 후회가 업도록 최대한 면접 준비를 열심히 해보자는 마음에서 방문하지 않았습니다.</p>\n<hr>\n<h1>개발에 관한 질문</h1>\n<h2>front-end를 선호하는지 back-end를 선호하는지</h2>\n<p>저는 프론트엔드 개발과 백엔드 개발 두가지를 모두 공부했지만, 백엔드 개발을 조금 더 선호합니다.</p>\n<p>그 이유는 프론트엔드보다 백엔드 개발을 할 때 조금 더 학술적으로 공부해볼 것이 많기 때문입니다. 프론트엔드에서는 브라우저라는 실행 환경의 한계와, 사용자에게 노출된다는 보안상의 이유 때문에 해볼 수 있는 것들이 많이 적어집니다.</p>\n<h2>개인과 팀 단위로 개발할 때 차이점</h2>\n<p>개인 개발은 속도와 자율성을 추구하고, 팀 개발은 안정성과 지속가능성을 더 추구하게 되는것 같습니다.</p>\n<p>개인개발의 가장 큰 장점은 의사결정의 속도입니다. 아이디어가 떠오르면 즉시 코드로 구현하며 빠르게 결과물을 만들 수 있습니다.</p>\n<p>반면, 팀 개발은 속도보다는 함께 멀리가는 것을 목표로 합니다. 코드리뷰를 통해 더 나은 해결책을 찾고, 지식을 공유할 수 있습니다.\n팀에서 따르는 컨벤션을 따라야 합니다. 내 코드를 다른 사람이 수정할 수도 있고, 다른사람의 코드를 내가 수정할 수도 있기에 본인의 개발 철학보다는 팀의 개발 철학과 컨벤션을 우선적으로 따라야 합니다.\n활발한 소통이 필요합니다. 비즈니스 목표를 함께 이해하고 같은 목표를 향해 나아가야 프로젝트를 성공적으로 완수할 수 있습니다.</p>\n<h2>IT분야에 지원하게 된 동기</h2>\n<h2>개발하면서 부족함을 느낄 때 어떻게 하는 지</h2>\n<p>개발하다가 저의 코드에 부족함이 느껴진다면, 그 부분을 파고들어 구글링 AI, 지인 등을 활용하여 적극적으로 질문하고 답을 찾는 편입니다. 제가 고민하는 부분은 이미 다른 사람이 고민해봤을 가능성이 높기 때문입니다. 일례로, 제 서비스를 전체적으로 리팩토링 하던 도중, 부족한 부분이 발견되어 이 부분을 좀 더 깊게 공부해보았고, 그 결과 도메인 주도 개발이라는 새로운 개념을 학습하며 코드의 구조를 한단계 더 안정적으로 만들 수 있었습니다.</p>\n<h2>협업을 어떻게 진행했나요?</h2>\n<p>보통 일주일마다 회의를 하고, 그때그때 나온 요구사항을 정리하여 할 일을 분배했습니다.</p>\n<p>주간에 나온 이슈는 슬랙을 통해 공유했습니다.</p>\n<p>현재 일하는 팀에서는 애자일 방식을 적용해 일하고 있습니다. 스프린트 단위로 릴리즈를 나누고 역할을 분배하여 나눠가집니다. 일일 스크럼 회의로 그날그날 할 일을 공유하고, 슬랙과 지라를 이용해 협업하고 있습니다.</p>\n<h2>잘 안따르는 팀원이 있을 때는 어떻게 하나요?</h2>\n<p>팀원이 잘 따르지 못하는 이유를 파악하려고 노력합니다.\n기술적인 문제로 해결이 안돼서 참여하지 못하는거라면, 제가 가서 돕거나 같이 해결해주려 노렵합니다.\n만약 동기부여가 되지 않아 참여하지 못하는거라면 탈퇴하는 경우가 많았습니다. 프로젝트가 강제성이 있거나 참여에 보상이 있는게 아니다보니 어쩔 수 없었던것 같습니다.\n그러나 만약 회사에서라면, 업무를 바꿔주거나 하는식으로 이해를 맞춰주면 좋을것 같습니다.</p>\n<p>그리고 개인적인 경험으로는 주기적인 회의를 진행할 때 참여도가 높아지는 경험이 있었습니다. 팀원들 서로 진행상황등을 공유한다면 더 높은 참여율을 보일 수 있을것이라 생각합니다.</p>\n<h2>협업에서 가장 중요한 요소는 무엇인가요?</h2>\n<p>저는 협업에서 적절한 역할 분배와 이들 간의 커뮤니케이션이 중요하다고 생각합니다. 협업을 한다면 협업을 하는 만큼의 효율이 나와야 하기 때문입니다.</p>\n<p>팀원들 간에 서로 어떤 일을 하고 있는지 명확히 나뉘어 있고, 이를 서로 안다면 전체적으로 팀에 동기부여가 될 것입니다. 또한 하고 있는 일에 대한 전체적인 그림이 보인다면 팀의 생산성 또한 늘어날 것입니다.</p>\n<p>그리고 커뮤니케이션이 제대로 되지 않으면, 서로의 요구사항이 맞지 않아 수정이 필요한 경우가 종종 생깁니다. 이런 경우 협업을 통한 생산성이 급격히 저하돼서, 원활한 커뮤니케이션 역시 중요하다고 생각합니다.</p>\n<h2>팀 내 갈등이나 의견 차이가 발생했을 때 어떻게 해결하시나요?</h2>\n<p>큰 갈등은 없었지만, 의견 차이가 발생한 적은 있었습니다. Express.js에서 Nest.js를 포팅하는 과정에서 포팅 과정이 비용 소모가 많이 되다보니 굳이 옮겨야 하나? 와 같은 의견도 나왔습니다.\n상대의 의견도 경청하면서, 제가 제시한 방법을 채택했을때의 이점과, 얼마의 시간 비용이 소요될지 등을 제시하여 의견 차이를 좁혔습니다.\nNest.js의 모듈 기반 방식을 사용하면 각 route 관리가 더 쉬워질거라는 점, 의존성 역전 개념을 이용하면 미래의 확장성에 이점이 있을거라는 점 등을 제시했습니다.</p>\n<p>만약 상대가 반대의견과 더 좋은 의견을 제시하면 저도 따를것입니다. 팀 전체에 이익이 되는 방향으로 좋은 의견을 선택하는게 중요하다고 생각합니다.</p>\n<h2>협업 도구나 워크플로우에 대해 경험이 있으신가요? 어떤 도구를 주로 사용하시나요?</h2>\n<p>현재 일하는 팀에서는 JIRA를 사용하여 이슈와 서로의 작업을 트래킹합니다. 작업 사항에 대해 JIRA 이슈를 생성하고, 이슈 기반으로 코드를 개발합니다.</p>\n<p>코드 버전 관리는 항상 git을 사용합니다.\n현재는 bitbucket도 사용하고 있습니다. jira와 연동이 돼서 이슈 기반으로 개발을 하고 있고, PR과 같은 작업도 bitbucket 상에서 하고 있습니다.</p>\n<p>Slack도 많이 사용하고 있습니다. 회사에서는 여러 프로그램을 Slack과 연동해서 사용중이고,\n협업 프로젝트에서는 그냥 작업 사항을 태널별로 공유하는 용도로 사용하고 있습니다.</p>\n<p>코드 관련해서는 Git을 항상 사용합니다.\n체계적으로 브랜치와 flow를 관리하기 위해, trunc based 전략을 주로 사용합니다. main 브랜치가 배포되는 브랜치이고, 추가 기능이 필요할 때는 브랜치를 하나 빼서 feat/ 또는 hotfix/ 와같은 이름으로 사용합니다.\nmain에 merge할 때는 항상 pull request를 사용하고, 로컬 브랜치에 push 하기 전에 꼭 원격 브랜치의 main에 rebase하여 그래프도 관리하고 있습니다.</p>\n<p>그리고 인원이 많을 때는 Slack도 사용했습니다. 백엔드, 프론트엔드 채널을 나누어 소통하며 업무 상황과 피드백도 주고 받았습니다.</p>\n<p>현재는 인원이 2명밖에 되지 않아 주로 카카오톡을 이용하여 소통하고 있습니다.</p>\n<h2>애자일(Agile)이나 스크럼(Scrum)과 같은 협업 방법론에 대해 어떻게 생각하시나요?</h2>\n<p>저는 백엔드 개발의 가치가 요구사항을 비즈니스 로직으로 풀어내며 나온다고 생각합니다.\n애자일 방식이 빠른 피드백과 유연한 대응을 가능하게 한다는 점과, 고객 가치를 우선한다는 점에서 좋은 방식이라 생각합니다.\n애자일을 타이트하게 적용해본 경험은 없지만, 주기적인 팀 미팅을 진행할 때 개발 속도가 훨씬 빨라지는 것을 경험했습니다. 그래서 체계적으로 애자일을 적용하는곳에서 저도 한번 경험해보고 싶습니다.</p>\n<h2>About은 어떤식으로 유저의 불편을 알아채나요?</h2>\n<p>불편사항을 유저들이 보낼 수 있는 Collection을 하나 만들어뒀습니다. 거기로 들어오는걸 보고 알아차리기도 하고, 이 스터디 만드신 분이 프론트를 담당하고 계십니다. 근데 스터디 사이트 운영에도 엄청 활발하게 참여하셔서, 유저들과 직접 얘기하면서 불편사항을 받거나 직접 카톡으로 받고 알아차리시는 경우도 있습니다.</p>\n<h2>기술 블로그?</h2>\n<p>기술 블로그는 백엔드 관련해서는 제가 굵직한 것들을 제 블로그에 좀 기록하고 있습니다.</p>\n<h2>업무의 우선순위는 어떻게 설정하나요?</h2>\n<hr>\n<h2>마지막 할말</h2>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>협업을 어떻게 진행했나요?<a href=\"file:///c%3A/Users/bpms2/Desktop/assignment-nodejs-backup-20250814/assignment/README.md\">C:\\Users\\bpms2\\Desktop\\assignment-nodejs-backup-20250814\\assignment\\README.md</a></h1>\n<p>보통 일주일마다 회의를 하고, 그때그때 나온 요구사항을 정리하여 할 일을 분배했습니다.</p>\n<p>주간에 나온 이슈는 슬랙을 통해 공유했습니다.</p>\n<p>현재 일하는 팀에서는 애자일 방식을 적용해 일하고 있습니다. 스프린트 단위로 릴리즈를 나누고 역할을 분배하여 나눠가집니다. 일일 스크럼 회의로 그날그날 할 일을 공유하고, 슬랙과 지라를 이용해 협업하고 있습니다.</p>\n<h1>잘 안따르는 팀원이 있을 때는 어떻게 하나요?</h1>\n<p>팀원이 잘 따르지 못하는 이유를 파악하려고 노력합니다.\n기술적인 문제로 해결이 안돼서 참여하지 못하는거라면, 제가 가서 돕거나 같이 해결해주려 노렵합니다.\n만약 동기부여가 되지 않아 참여하지 못하는거라면 탈퇴하는 경우가 많았습니다. 프로젝트가 강제성이 있거나 참여에 보상이 있는게 아니다보니 어쩔 수 없었던것 같습니다.\n그러나 만약 회사에서라면, 업무를 바꿔주거나 하는식으로 이해를 맞춰주면 좋을것 같습니다.</p>\n<p>그리고 개인적인 경험으로는 주기적인 회의를 진행할 때 참여도가 높아지는 경험이 있었습니다. 팀원들 서로 진행상황등을 공유한다면 더 높은 참여율을 보일 수 있을것이라 생각합니다.</p>\n<h1>협업에서 가장 중요한 요소는 무엇인가요?</h1>\n<p>저는 협업에서 적절한 역할 분배와 커뮤니케이션이 가장 중요하다고 생각합니다.\n협업을 한다면 협업을 하는 만큼의 생산성이 나와야 하기 때문입니다.\n팀원들이 서로 어떤 작업을 하고 있는지 안다면 더 동기부여도 되고, 작업 진행상황이 명확하게 보이기 때문에 생산성이 늘어나게 됩니다.\n그리고 업무가 적절하게 분배돼야 생산성 높게 일할 수 있다고 생각합니다.</p>\n<p>그리고 커뮤니케이션이 제대로 되지 않으면 서로의 요구사항이 맞지 않아 다시 개발해야 하는 경우가 종종 생깁니다. 이런 경우 협업을 통한 생산성이 급격히 저하돼서, 커뮤니케이션이 정말 중요하다고 생각합니다.</p>\n<h1>코드 리뷰 프로세스는 어떻게 진행하시나요?</h1>\n<p>이전에 인원이 많을 때는 코드 리뷰도 진행했었습니다. feature 브랜치를 만들어 작업한 후, main에 merge하기 전에 Pull Request를 보내 변경 사항을 확인하고, main에 merge하는 식으로 작업했습니다. 코드 스타일이 기존 스타일을 잘 따르고 있는지 등을 중점으로 봤던것 같습니다.</p>\n<p>저는 주로 trunk-based와 같은 기법을 많이 사용합니다. main브랜치를 두고 바로 feature브랜치를 빼서 기능을 개발합니다. 코드를 원격에 올리기 전에는 꼭 main브랜치와 rebase해서 충돌을 local에서 미리 해결하고, 원격에 푸시 합니다. 그런 다음 main에 pr을 올리고, 리뷰가 필요한 상황이면 코드를 리뷰하고 main에 머지합니다.</p>\n<h1>팀 내 갈등이나 의견 차이가 발생했을 때 어떻게 해결하시나요?</h1>\n<p>큰 갈등은 없었지만, 의견 차이가 발생한 적은 있었습니다. Express.js에서 Nest.js를 포팅하는 과정에서 포팅 과정이 비용 소모가 많이 되다보니 굳이 옮겨야 하나? 와 같은 의견도 나왔습니다.\n상대의 의견도 경청하면서, 제가 제시한 방법을 채택했을때의 이점과, 얼마의 시간 비용이 소요될지 등을 제시하여 의견 차이를 좁혔습니다.\nNest.js의 모듈 기반 방식을 사용하면 각 route 관리가 더 쉬워질거라는 점, 의존성 역전 개념을 이용하면 미래의 확장성에 이점이 있을거라는 점 등을 제시했습니다.</p>\n<p>만약 상대가 반대의견과 더 좋은 의견을 제시하면 저도 따를것입니다. 팀 전체에 이익이 되는 방향으로 좋은 의견을 선택하는게 중요하다고 생각합니다.</p>\n<h1>협업 도구나 워크플로우에 대해 경험이 있으신가요? 어떤 도구를 주로 사용하시나요?</h1>\n<p>현재 일하는 팀에서는 JIRA를 사용하여 이슈와 서로의 작업을 트래킹합니다. 작업 사항에 대해 JIRA 이슈를 생성하고, 이슈 기반으로 코드를 개발합니다.</p>\n<p>코드 버전 관리는 항상 git을 사용합니다.\n현재는 bitbucket도 사용하고 있습니다. jira와 연동이 돼서 이슈 기반으로 개발을 하고 있고, PR과 같은 작업도 bitbucket 상에서 하고 있습니다.</p>\n<p>Slack도 많이 사용하고 있습니다. 회사에서는 여러 프로그램을 Slack과 연동해서 사용중이고,\n협업 프로젝트에서는 그냥 작업 사항을 태널별로 공유하는 용도로 사용하고 있습니다.</p>\n<p>코드 관련해서는 Git을 항상 사용합니다.\n체계적으로 브랜치와 flow를 관리하기 위해, trunc based 전략을 주로 사용합니다. main 브랜치가 배포되는 브랜치이고, 추가 기능이 필요할 때는 브랜치를 하나 빼서 feat/ 또는 hotfix/ 와같은 이름으로 사용합니다.\nmain에 merge할 때는 항상 pull request를 사용하고, 로컬 브랜치에 push 하기 전에 꼭 원격 브랜치의 main에 rebase하여 그래프도 관리하고 있습니다.</p>\n<p>그리고 인원이 많을 때는 Slack도 사용했습니다. 백엔드, 프론트엔드 채널을 나누어 소통하며 업무 상황과 피드백도 주고 받았습니다.</p>\n<p>현재는 인원이 2명밖에 되지 않아 주로 카카오톡을 이용하여 소통하고 있습니다.</p>\n<h1>애자일(Agile)이나 스크럼(Scrum)과 같은 협업 방법론에 대해 어떻게 생각하시나요?</h1>\n<p>저는 백엔드 개발의 가치가 요구사항을 비즈니스 로직으로 풀어내며 나온다고 생각합니다.\n애자일 방식이 빠른 피드백과 유연한 대응을 가능하게 한다는 점과, 고객 가치를 우선한다는 점에서 좋은 방식이라 생각합니다.\n애자일을 타이트하게 적용해본 경험은 없지만, 주기적인 팀 미팅을 진행할 때 개발 속도가 훨씬 빨라지는 것을 경험했습니다. 그래서 체계적으로 애자일을 적용하는곳에서 저도 한번 경험해보고 싶습니다.</p>\n<h1>About은 어떤식으로 유저의 불편을 알아채나요?</h1>\n<p>불편사항을 유저들이 보낼 수 있는 Collection을 하나 만들어뒀습니다. 거기로 들어오는걸 보고 알아차리기도 하고, 이 스터디 만드신 분이 프론트를 담당하고 계십니다. 근데 스터디 사이트 운영에도 엄청 활발하게 참여하셔서, 유저들과 직접 얘기하면서 불편사항을 받거나 직접 카톡으로 받고 알아차리시는 경우도 있습니다.</p>\n<h1>기술 블로그?</h1>\n<p>기술 블로그는 백엔드 관련해서는 제가 굵직한 것들을 제 블로그에 좀 기록하고 있습니다.</p>\n<h1>업무의 우선순위는 어떻게 설정하나요?</h1>\n<p>비즈니스 임팩트와 마감 기한 이렇게 두가지를 중요하게 봐야한다고 생각합니다.\n개인적으로는 비즈니스 임팩트가 큰 기능을 먼저 처리합니다. 그리고 그런 일이 없을때 자잘한 이슈를 해결하고 그것도 많이 해결했을때는 리팩토링을 진행하는 편입니다. 제가 일하는곳이 다 요구사항이 급변하고 많이 들어오는 곳이다보니 이런식으로 많이 일을 진행하고 있는것 같습니다.</p>\n<p>이것보다 더 우선시 되는것이 장애 대응입니다. 상황이 변할 때마다 우선순위를 재평가 하기도 합니다.</p>","frontmatter":{"thumbnail":null,"categories":null,"date":null,"slug":null,"title":""}}},{"node":{"html":"<h1>Argo CD</h1>\n<p>ArgoCD는 애플리케이션의 선언적 메니페스트를 Git 저장소에 두고, 클러스터 상태를 Git에 저장된 상태와 실시간으로 비교하고 동기화 해 주는 도구입니다. Git commit만으로 배포, 롤백, 드리프트 감지 등의 기능을 제공합니다.</p>\n<p>Kubernetes 애플리케이션의 자동 배포를 위한 CD 툴로, Helm또는 Kustomize방식을 사용합니다.</p>\n<p>Git저장소를 단일 출처로 삼아, 매니페스트 파일을 Git에 두면, ArgoCD가 주기적으로 Git에서 desired state를 가져와 클러스터의 live state와 비교하고, 차이가 있다면 kubectl apply, kubectl delete와 같은 명령으로 자동 동기화를 합니다.</p>\n<hr>\n<h1>과정 기록</h1>\n<p>아래는 제가 git, ArgoCD를 이용해 CI/CD 파이프라인을 구성한 방법입니다.\nSpring backend 배포를 기준으로 작성하였습니다.</p>\n<h2>Git Repository 준비</h2>\n<p>먼저, 두가지의 Git Repository가 준비돼야 합니다.</p>\n<ul>\n<li>백엔드 Repository</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">backend<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\n├── <span class=\"token punctuation\">.</span>github<span class=\"token operator\">/</span>\n│\t└── workflows<span class=\"token operator\">/</span>\n│\t\t└── ci<span class=\"token operator\">-</span>cd<span class=\"token punctuation\">.</span>yml\n├── src<span class=\"token operator\">/</span>…           # Spring Boot 소스\n├── pom<span class=\"token punctuation\">.</span>xml\n└── Dockerfile</code></pre></div>\n<p>Docker image가 빌드 되는 Dockerfile과, github action을 실행할 수 있는 yaml파일이 필요합니다.</p>\n<ul>\n<li>ci/cd용 repo</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">infra<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\n├── argocd<span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>app<span class=\"token punctuation\">.</span>yaml\n├── <span class=\"token keyword\">base</span><span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>deployment<span class=\"token punctuation\">.</span>yaml\n│   ├── backend<span class=\"token operator\">-</span>service<span class=\"token punctuation\">.</span>yaml\n│   └── kustomization<span class=\"token punctuation\">.</span>yaml\n│   └── <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">.</span>yaml\n└── overlays<span class=\"token operator\">/</span>\n    └── production<span class=\"token operator\">/</span>\n\t    └── patches<span class=\"token operator\">/</span>\n\t\t│   └── backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml\n\t\t│   └── backend<span class=\"token operator\">-</span>replicas<span class=\"token punctuation\">.</span>yaml\n        └── kustomization<span class=\"token punctuation\">.</span>yaml\n        └── sealedsecret<span class=\"token operator\">-</span>backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml</code></pre></div>\n<h2>먼저, CI 파이프라인을 설정해봅시다.</h2>\n<p>backend repository의 ci-cd.yaml파일에 아래와 같이 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> CI/CD Pipeline\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout code\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Docker Buildx\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/setup<span class=\"token punctuation\">-</span>buildx<span class=\"token punctuation\">-</span>action@v2\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Docker Registry\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v2\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKER_USER <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKER_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build &amp; Push image\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v4\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> .\n          <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> beming/$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.event.repository.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout infra repo\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">repository</span><span class=\"token punctuation\">:</span> beming<span class=\"token punctuation\">-</span>dev/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>cicd\n          <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.INFRA_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> infra\n          <span class=\"token key atrule\">persist-credentials</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Kustomize image tag\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cd infra/base\n          yq e '.images[] \n            |= select(.name==\"beming/'${{ github.repository }}'\") \n            .newTag = \"'${{ github.sha }}'\"' -i kustomization.yaml</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Commit &amp; Push infra changes\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cd infra\n          git config user.name \"github-actions[bot]\"\n          git config user.email \"actions@github.com\"\n          git add .\n          git commit -m \"chore: bump ${{ github.repository }} to ${{ github.sha }}\"\n          git push</span></code></pre></div>\n<p>위 yaml파일을 간단히 설명하면, main 브랜치에 코드가 push 되면, \bDockerfile을 build하여 Docker hub에 push합니다.</p>\n<p>그런 다음, ci-cd repository로 이동한 후, 방금 push한 이미지의 태그값을 kustomization.yaml파일에 알려주며 해당 repository에 커밋을 넣습니다.</p>\n<p>이 커밋은 나중에 argoCD를 트리거하는 역할을 할 것입니다.</p>\n<p>이 과정에서 세가지 환경변수를 git backend repository에 등록해야 합니다.</p>\n<ul>\n<li>DOCKER_USER: Docker hub username</li>\n<li>DOCKER_TOKEN: Docker hub에서 발급해주는 토큰</li>\n<li>INFRA_TOKEN: git에서 발급받은 ci-cd repository에 접근 가능한 토큰</li>\n</ul>\n<p>INFRA_TOKEN은 git profile 클릭 -> settings -> developer settings -> personal access tokens -> Tokens(classic)에서 발급받을 수 있습니다.</p>\n<p>환경변수는 backend repository에 접속 후, setting -> Secrets and Variables -> actions 에서 등록 가능합니다.</p>\n<h2>ArgoCD를 설정해봅시다.</h2>\n<p>이제 kubernetes가 설치돼있는, kubectl 명령을 사용할 수 있는 인스턴스에 접속합니다.</p>\n<p>kubernetes에 argoCD를 설치해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 1) Argo CD 네임스페이스 생성</span>\nkubectl create namespace argocd\n\n<span class=\"token comment\"># 2) Argo CD 컨트롤러 설치</span>\nkubectl apply <span class=\"token parameter variable\">-n</span> argocd <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-f</span> https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n\n<span class=\"token comment\"># 3) 서버 접근을 위해 포트포워딩 (로컬 테스트용)</span>\nkubectl <span class=\"token parameter variable\">-n</span> argocd port-forward svc/argocd-server <span class=\"token number\">8080</span>:443</code></pre></div>\n<p>이제 public_ip:8080 번 포트로 접속하면 argoCD의 로그인 창을 볼 수 있습니다.\n물론 인스턴스의 방화벽에서 8080번 포트가 허용돼있어야 합니다.</p>\n<p>초기 ID값은 admin이고,\n비밀번호는 아래의 명령으로 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># admin 비밀번호 = Argo CD server Pod 이름</span>\nkubectl <span class=\"token parameter variable\">-n</span> argocd get pods <span class=\"token parameter variable\">-l</span> app.kubernetes.io/name<span class=\"token operator\">=</span>argocd-server <span class=\"token parameter variable\">-o</span> name <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d<span class=\"token string\">'/'</span> <span class=\"token parameter variable\">-f2</span>\n\n<span class=\"token comment\"># 안되면 아래의 방법을 사용</span>\nargocd admin initial-password <span class=\"token parameter variable\">-n</span> argocd</code></pre></div>\n<p>로그인에 성공했다면, 아래와 같은 화면을 볼 수 있습니다.\n![[Pasted image 20250714114029.png]]</p>\n<h2>이제 cicd repository의 스크립트 설정을 해봅시다.</h2>\n<p>아까전에 아래와 같이 꽤 복잡한 구조를 구성해뒀습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">infra<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\n├── argocd<span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>app<span class=\"token punctuation\">.</span>yaml\n├── <span class=\"token keyword\">base</span><span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>deployment<span class=\"token punctuation\">.</span>yaml\n│   ├── backend<span class=\"token operator\">-</span>service<span class=\"token punctuation\">.</span>yaml\n│   └── kustomization<span class=\"token punctuation\">.</span>yaml\n│   └── <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">.</span>yaml\n└── overlays<span class=\"token operator\">/</span>\n    └── production<span class=\"token operator\">/</span>\n\t    └── patches<span class=\"token operator\">/</span>\n\t\t│   └── backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml\n\t\t│   └── backend<span class=\"token operator\">-</span>replicas<span class=\"token punctuation\">.</span>yaml\n        └── kustomization<span class=\"token punctuation\">.</span>yaml\n        └── sealedsecret<span class=\"token operator\">-</span>backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml</code></pre></div>\n<p>먼저, argoCD의 진입점은 /overlays/production/kustomization.yaml 파일입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n\n<span class=\"token comment\"># 1) 공통 리소스(base)를 import</span>\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ../../base\n  <span class=\"token punctuation\">-</span> sealedsecret<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>env.yaml\n\n<span class=\"token comment\"># 2) 프로덕션 전용 패치 파일들</span>\n<span class=\"token key atrule\">patches</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> patches/backend<span class=\"token punctuation\">-</span>replicas.yaml\n    <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> patches/backend<span class=\"token punctuation\">-</span>env.yaml\n    <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend</code></pre></div>\n<p>이 파일을 로드하면서</p>\n<ul>\n<li><code class=\"language-text\">resources</code> 로 지정된 <code class=\"language-text\">../../base</code> 디렉토리와</li>\n<li><code class=\"language-text\">sealedsecret-backend-env.yaml</code> 을 순서대로 가져옵니다.</li>\n</ul>\n<p>그런 다음, /base/kustomization.yaml에 있는 파일을 읽습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> backend<span class=\"token punctuation\">-</span>deploy.yaml\n  <span class=\"token punctuation\">-</span> backend<span class=\"token punctuation\">-</span>svc.yaml\n  <span class=\"token punctuation\">-</span> namespace.yaml\n\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> beming/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>back\n    <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> placeholder<span class=\"token punctuation\">-</span>backend\n\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization</code></pre></div>\n<ul>\n<li><code class=\"language-text\">backend-deploy.yaml</code>, <code class=\"language-text\">backend-svc.yaml</code>, <code class=\"language-text\">namespace.yaml</code> 을 차례로 읽습니다.</li>\n<li><code class=\"language-text\">images</code> 블록에 따라 Deployment의 <code class=\"language-text\">image:</code> 필드를 치환하는데, 이 때 tag값은 아까전의 github action에서 치환하여 commit을 넣어줍니다.</li>\n</ul>\n<p>/base/backend-deploy.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token comment\"># base에서는 1로 두고, overlays에서 프로덕션/스테이징 복제 수 조정</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># CI에서 placeholder-backend를 실제 SHA/tag로 교체합니다</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> beming/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>back<span class=\"token punctuation\">:</span>placeholder<span class=\"token punctuation\">-</span>backend\n          <span class=\"token key atrule\">envFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">secretRef</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n          <span class=\"token comment\"># 선택: 헬스체크</span>\n          <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">httpGet</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /actuator/health\n              <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> http\n            <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n            <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span>\n          <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">httpGet</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /actuator/health\n              <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> http\n            <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span>\n            <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span>\n          <span class=\"token comment\"># 선택: 리소스 요청·제한</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"100m\"</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"128Mi\"</span>\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"500m\"</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"512Mi\"</span></code></pre></div>\n<p>/base/spring-svc.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span>\n      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30080</span></code></pre></div>\n<p>/base/namespace.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"apiversion:v1\"><pre class=\"language-apiversion:v1\"><code class=\"language-apiversion:v1\">kind: Namespace\nmetadata:\n  name: backend-namespace</code></pre></div>\n<p>/patches/backend-env.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spring-backend # base/backend-deploy.yaml 의 metadata.name 과 반드시 일치\nspec:\n  template:\n    metadata:\n      # (선택) 프로덕션 환경을 나타내는 라벨 추가\n      labels:\n        environment: production\n    spec:\n      containers:\n        - name: spring-backend # base 의 container name 과 일치\n          # 1) 프로덕션 프로파일 활성화를 위한 환경변수\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: production\n            - name: JAVA_OPTS\n              value: \"-Xms512m -Xmx1g\"\n          # 2) 리소스 요청(requests) / 제한(limits)\n          resources:\n            requests:\n              cpu: \"500m\"\n              memory: \"512Mi\"\n            limits:\n              cpu: \"1\"\n              memory: \"1Gi\"</code></pre></div>\n<p>/patches/backend-replicas.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spring-backend # base/backend-deploy.yaml 에 정의된 Deployment 이름과 동일해야 합니다\nspec:\n  replicas: 3 # 프로덕션에서 원하는 복제본 수\n</code></pre></div>\n<p>아래는 GPT가 그려준 대략적인 과정입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌────────────────────────────────────┐\n│ 1. Git 클론 및 overlays/production 로 진입\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 2. Kustomize load overlays/...    │\n│    ├── import base/ (resources)    │\n│    └── import sealedsecret...      │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 3. base/kustomization.yaml 적용   │\n│    ├─ backend-deploy.yaml      │\n│    ├─ backend-svc.yaml         │\n│    └─ namespace.yaml               │\n│    + images.newTag 치환            │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 4. overlays/sealedsecret 추가     │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 5. patches 병합                   │\n│    - replicas 변경                │\n│    - envFrom secretRef 추가       │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 6. 최종 매니페스트 출력            │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 7. Argo CD가 kubectl apply (sync) │\n└────────────────────────────────────┘\n</code></pre></div>\n<h2>환경변수 지정</h2>\n<p>제가 가장 애먹었던 부분은 바로 환경변수를 지정하는 방법입니다.\n환경변수가 public repository에 노출되지 않으면서, ArgoCD에 알려줄 수 있는 그런 방법이 필요했습니다.</p>\n<p>위의 고민을 해결하기 위해, Sealed Secret Controller를 사용했습니다.\n먼저 아래와 같이 Sealed Secret Controller를 설치해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-f</span> https://github.com/bitnami-labs/sealed-secrets/releases/latest/download/controller.yaml</code></pre></div>\n<p>아래와 같은 명령으로 secret파일을 생성해줍니다.</p>\n<p>secret-plain.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>namespace\n<span class=\"token key atrule\">stringData</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">FRONT_BASE_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://beming-stock.kro.kr\"</span>\n  <span class=\"token key atrule\">JWT_SECRET</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"randomstrlongerthan32fortestdonotusethisvalue\"</span></code></pre></div>\n<p>아래 명령으로 Sealed Secret을 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubeseal <span class=\"token parameter variable\">--format</span> yaml <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">&lt;</span> secret-plain.yaml <span class=\"token operator\">></span> sealedsecret.yaml</code></pre></div>\n<p>이제 결과로 암호화된 sealedsecret파일을 얻을 수 있습니다.\n해당파일을 프로젝트의 /overlays/production 밑에 위치시켜줍니다.</p>\n<p>그 후, /overlays/production/kustomization.yaml의 resources에,\nsealedsecret.yaml 과 같이 등록해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ../../base\n  <span class=\"token punctuation\">-</span> sealedsecret<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>env.yaml</code></pre></div>\n<p>마지막으로, backend-env.yaml파일에 secret 이름을 추가해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># CI에서 placeholder-backend를 실제 SHA/tag로 교체합니다</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> beming/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>back<span class=\"token punctuation\">:</span>placeholder<span class=\"token punctuation\">-</span>backend\n          <span class=\"token key atrule\">envFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">secretRef</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env</code></pre></div>\n<p>이제 컨테이너 내부에서 환경변수에 접근할 수 있게 됩니다.</p>\n<p>모든 과정이 성공적으로 완료되면, 아래와 같은 화면을 볼 수 있습니다.\n![[Pasted image 20250714134954.png]]</p>\n<h2>배포 확인</h2>\n<p>성공적으로 배포됐다면 api로 요청을 보낼 수 있어야겠죠?</p>\n<p>저희는 service를 생성하는 backend.svc.yaml 파일에서, 30080번 포트를 외부에 노출시켰습니다.</p>\n<p>아래 명령으로 EXTERNAL_IP값을 확인해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get services <span class=\"token parameter variable\">-n</span> backend-namespace\n\n<span class=\"token comment\"># 아래와 같은 결과가 나옵니다.</span>\nNAME TYPE CLUSTER-IP EXTERNAL-IP PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span> AGE\nspring-backend NodePort <span class=\"token number\">10.107</span>.223.38 <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span> <span class=\"token number\">80</span>:30080/TCP 3h31m</code></pre></div>\n<p>저의 경우는 EXTERNAL_IP가 비어있는데, 이런 경우는 인스턴스의 publicIP로 요청을 보내면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl http://${EXTERNAL_IP}:30080/actuator/health</code></pre></div>\n<p>위의 결과로 제대로 된 응답이 온다면 성공입니다. 이제 백엔드를 kubernetes에 자동으로 배포하는 CI/C파이프라인이 구성됐습니다.</p>\n<h1>트러블 슈팅</h1>\n<h2>ArgoCD가 접속이 되지 않음</h2>\n<p>처음에 ArgoCD로 포트포워딩이 제대로 되지 않아 접속이 불가했습니다.</p>\n<p>해결방법은 다음과 같습니다.</p>\n<ul>\n<li>인스턴스의 방화벽 설정을 열어준다</li>\n<li>아래와 같이 모든 인터페이스에 대해 포트 포워딩을 걸어준다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl port-forward \\\n  --address 0.0.0.0 \\\n  svc/argocd-server -n argocd 8080:443</code></pre></div>\n<p>이제 http://&#x3C;EC2 퍼블릭IP>:8080\n으로 접속이 가능합니다.</p>\n<p>아래와 같이 백그라운드에서 실행하면 좀 더 편리합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nohup kubectl -n argocd port-forward svc/argocd-server 8080:443 --address 0.0.0.0 \\\n  > ./argocd-port-forward.log 2>&amp;1 &amp;</code></pre></div>\n<h2>이미지 pull이 실패하는 경우</h2>\n<p>argoCD UI에서 sync버튼을 눌러 backend deploy를 하면, Docker image pull 이 실패합니다.</p>\n<p>그 이유는 저희가 Docker image의 tag값을 git에서 커밋으로 올려주도록 해뒀기 때문입니다.</p>\n<p>이 상황을 피하고 싶다면, tag값을 latest로 해서 항상 이미지를 가져올 수 있게 하던가,\ngithub action을 트리거 시켜서 argoCD를 작동시키면 됩니다.</p>\n<p>태그값이 잘 들어갔는지는 argoCD의 UI log에서 확인 가능합니다.</p>\n<h2>배포에 성공했는데 ArgoCD에서 오류가 뜨는 경우</h2>\n<p>저희는 앱이 살아있다는 신호를 /actuator/health 라우트에서 신호를 받도록 yaml파일에 설정해뒀습니다.</p>\n<p>이 신호를 받기 위해서는, actuator 의존성을 Spring에 추가해둬야 합니다.</p>\n<p>gradle 기준 아래 명령을 build.gradle에 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">implementation 'org.springframework.boot:spring-boot-starter-actuator'</code></pre></div>\n<p>application.properties에서 endpoint를 노출시킵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server.port=3000\nmanagement.server.port=${server.port}\nmanagement.endpoints.web.exposure.include=health,info\nmanagement.endpoint.health.show-details=always</code></pre></div>\n<p>이렇게 하고 Docker image를 다시 빌드하면 해당 라우트가 잘 작동합니다.</p>\n<p>참고로 server.port값은 Dockerfile의 Expose값과도 일치해야 하고, yaml파일에서도 포트 번호를 잘 신경써줘야 제대로 동작합니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"stock-simulator"}],"date":"2025-07-30","slug":"/blog/stock-simulator/cicd","title":"MSA - Kubernetes, ArgoCD 배포자동화"}}},{"node":{"html":"<h1>Argo CD</h1>\n<p>ArgoCD는 애플리케이션의 선언적 메니페스트를 Git 저장소에 두고, 클러스터 상태를 Git에 저장된 상태와 실시간으로 비교하고 동기화 해 주는 도구입니다. Git commit만으로 배포, 롤백, 드리프트 감지 등의 기능을 제공합니다.</p>\n<p>Kubernetes 애플리케이션의 자동 배포를 위한 CD 툴로, Helm또는 Kustomize방식을 사용합니다.</p>\n<p>Git저장소를 단일 출처로 삼아, 매니페스트 파일을 Git에 두면, ArgoCD가 주기적으로 Git에서 desired state를 가져와 클러스터의 live state와 비교하고, 차이가 있다면 kubectl apply, kubectl delete와 같은 명령으로 자동 동기화를 합니다.</p>\n<hr>\n<h1>과정 기록</h1>\n<p>아래는 제가 git, ArgoCD를 이용해 CI/CD 파이프라인을 구성한 방법입니다.\nSpring backend 배포를 기준으로 작성하였습니다.</p>\n<h2>Git Repository 준비</h2>\n<p>먼저, 두가지의 Git Repository가 준비돼야 합니다.</p>\n<ul>\n<li>백엔드 Repository</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">backend<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\n├── <span class=\"token punctuation\">.</span>github<span class=\"token operator\">/</span>\n│\t└── workflows<span class=\"token operator\">/</span>\n│\t\t└── ci<span class=\"token operator\">-</span>cd<span class=\"token punctuation\">.</span>yml\n├── src<span class=\"token operator\">/</span>…           # Spring Boot 소스\n├── pom<span class=\"token punctuation\">.</span>xml\n└── Dockerfile</code></pre></div>\n<p>Docker image가 빌드 되는 Dockerfile과, github action을 실행할 수 있는 yaml파일이 필요합니다.</p>\n<ul>\n<li>ci/cd용 repo</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">infra<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\n├── argocd<span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>app<span class=\"token punctuation\">.</span>yaml\n├── <span class=\"token keyword\">base</span><span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>deployment<span class=\"token punctuation\">.</span>yaml\n│   ├── backend<span class=\"token operator\">-</span>service<span class=\"token punctuation\">.</span>yaml\n│   └── kustomization<span class=\"token punctuation\">.</span>yaml\n│   └── <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">.</span>yaml\n└── overlays<span class=\"token operator\">/</span>\n    └── production<span class=\"token operator\">/</span>\n\t    └── patches<span class=\"token operator\">/</span>\n\t\t│   └── backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml\n\t\t│   └── backend<span class=\"token operator\">-</span>replicas<span class=\"token punctuation\">.</span>yaml\n        └── kustomization<span class=\"token punctuation\">.</span>yaml\n        └── sealedsecret<span class=\"token operator\">-</span>backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml</code></pre></div>\n<h2>먼저, CI 파이프라인을 설정해봅시다.</h2>\n<p>backend repository의 ci-cd.yaml파일에 아래와 같이 작성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># .github/workflows/backend-deploy.yml</span>\n\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Backend CI/CD Pipeline\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"backend/**\"</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># 1. 소스 코드 체크아웃</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout code\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n\n      <span class=\"token comment\"># 2. Docker Buildx 설정 (최신 버전 사용)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Docker Buildx\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/setup<span class=\"token punctuation\">-</span>buildx<span class=\"token punctuation\">-</span>action@v3\n\n      <span class=\"token comment\"># 3. Docker Hub 로그인 (시크릿 이름은 실제 설정에 맞게 확인)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Docker Hub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># 또는 secrets.DOCKER_USER</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># 또는 secrets.DOCKER_TOKEN</span>\n\n      <span class=\"token comment\"># 4. Docker 이미지 빌드 및 푸시 (context 경로 수정)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build &amp; Push image\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v5\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> ./backend/chatirumae <span class=\"token comment\"># &lt;-- backend 디렉토리를 빌드 컨텍스트로 명시</span>\n          <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> beming/chat<span class=\"token punctuation\">-</span>irumae<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\"># 5. GitOps(Infra) 리포지토리 체크아웃</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout infra repo\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">repository</span><span class=\"token punctuation\">:</span> ChatIrumae/gitops\n          <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.INFRA_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># GitOps 리포지토리에 push 권한이 있는 토큰</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> infra\n\n      <span class=\"token comment\"># 6. yq 설치 (매우 중요!)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install yq\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> mikefarah/yq@v4.34.1 <span class=\"token comment\"># yq 설치 액션 사용</span>\n\n      <span class=\"token comment\"># 7. Kustomize 이미지 태그 업데이트 (yq 실행)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Kustomize image tag\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cd infra/base/backend</span>\n\n          REPO_NAME=$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.event.repository.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          IMAGE_NAME=\"beming/chat<span class=\"token punctuation\">-</span>irumae<span class=\"token punctuation\">-</span>backend\"\n          NEW_TAG=$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n          echo \"🔧 Updating image $IMAGE_NAME to tag $NEW_TAG\"\n\n          <span class=\"token comment\"># yq를 사용하여 이미지 태그 업데이트</span>\n          yq e '(.images<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">|</span> select(.name == \"'\"$IMAGE_NAME\"'\") ).newTag = \"'\"$NEW_TAG\"'\"' <span class=\"token punctuation\">-</span>i kustomization.yaml\n\n          echo \"✅ Diff after update<span class=\"token punctuation\">:</span>\"\n          git <span class=\"token punctuation\">-</span>C ../../.. diff <span class=\"token comment\"># infra 루트에서 diff 실행</span>\n\n      <span class=\"token comment\"># 8. 변경사항 커밋 및 푸시 (git add 경로 수정)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Commit &amp; Push infra changes\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cd infra\n          git config user.name \"github-actions[bot]\"\n          git config user.email \"github-actions[bot]@users.noreply.github.com\"\n          git add base/backend/kustomization.yaml # &lt;-- 수정한 파일만 명시적으로 add</span>\n\n          <span class=\"token comment\"># 변경사항이 있을 때만 커밋</span>\n          if <span class=\"token tag\">!</span> git diff <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>staged <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>quiet; then\n            <span class=\"token key atrule\">git commit -m \"chore(backend)</span><span class=\"token punctuation\">:</span> Bump $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.repository <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> image to $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\"\n            git push\n          else\n            echo \"No changes to commit.\"\n          fi\n</code></pre></div>\n<p>위 yaml파일을 간단히 설명하면, main 브랜치에 코드가 push 되면, \bDockerfile을 build하여 Docker hub에 push합니다.</p>\n<p>그런 다음, ci-cd repository로 이동한 후, 방금 push한 이미지의 태그값을 kustomization.yaml파일에 알려주며 해당 repository에 커밋을 넣습니다.</p>\n<p>이 커밋은 나중에 argoCD를 트리거하는 역할을 할 것입니다.</p>\n<p>이 과정에서 세가지 환경변수를 git backend repository에 등록해야 합니다.</p>\n<ul>\n<li>DOCKER_USER: Docker hub username</li>\n<li>DOCKER_TOKEN: Docker hub에서 발급해주는 토큰</li>\n<li>INFRA_TOKEN: git에서 발급받은 ci-cd repository에 접근 가능한 토큰</li>\n</ul>\n<p>INFRA_TOKEN은 git profile 클릭 -> settings -> developer settings -> personal access tokens -> Tokens(classic)에서 발급받을 수 있습니다.</p>\n<p>환경변수는 backend repository에 접속 후, setting -> Secrets and Variables -> actions 에서 등록 가능합니다.</p>\n<h2>ArgoCD를 설정해봅시다.</h2>\n<p>이제 kubernetes가 설치돼있는, kubectl 명령을 사용할 수 있는 인스턴스에 접속합니다.</p>\n<p>kubernetes에 argoCD를 설치해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 1) Argo CD 네임스페이스 생성</span>\nkubectl create namespace argocd\n\n<span class=\"token comment\"># 2) Argo CD 컨트롤러 설치</span>\nkubectl apply <span class=\"token parameter variable\">-n</span> argocd <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-f</span> https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n\n<span class=\"token comment\"># 3) 서버 접근을 위해 포트포워딩 (로컬 테스트용)</span>\nkubectl <span class=\"token parameter variable\">-n</span> argocd port-forward svc/argocd-server <span class=\"token number\">8080</span>:443</code></pre></div>\n<p>이제 public_ip:8080 번 포트로 접속하면 argoCD의 로그인 창을 볼 수 있습니다.\n물론 인스턴스의 방화벽에서 8080번 포트가 허용돼있어야 합니다.</p>\n<p>초기 ID값은 admin이고,\n비밀번호는 아래의 명령으로 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># admin 비밀번호 = Argo CD server Pod 이름</span>\nkubectl <span class=\"token parameter variable\">-n</span> argocd get pods <span class=\"token parameter variable\">-l</span> app.kubernetes.io/name<span class=\"token operator\">=</span>argocd-server <span class=\"token parameter variable\">-o</span> name <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d<span class=\"token string\">'/'</span> <span class=\"token parameter variable\">-f2</span>\n\n<span class=\"token comment\"># 안되면 아래의 방법을 사용</span>\nargocd admin initial-password <span class=\"token parameter variable\">-n</span> argocd</code></pre></div>\n<p>로그인에 성공했다면, 아래와 같은 화면을 볼 수 있습니다.\n![[Pasted image 20250714114029.png]]</p>\n<h2>이제 cicd repository의 스크립트 설정을 해봅시다.</h2>\n<p>아까전에 아래와 같이 꽤 복잡한 구조를 구성해뒀습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">infra<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\n├── argocd<span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>app<span class=\"token punctuation\">.</span>yaml\n├── <span class=\"token keyword\">base</span><span class=\"token operator\">/</span>\n│   ├── backend<span class=\"token operator\">-</span>deployment<span class=\"token punctuation\">.</span>yaml\n│   ├── backend<span class=\"token operator\">-</span>service<span class=\"token punctuation\">.</span>yaml\n│   └── kustomization<span class=\"token punctuation\">.</span>yaml\n│   └── <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">.</span>yaml\n└── overlays<span class=\"token operator\">/</span>\n    └── production<span class=\"token operator\">/</span>\n\t    └── patches<span class=\"token operator\">/</span>\n\t\t│   └── backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml\n\t\t│   └── backend<span class=\"token operator\">-</span>replicas<span class=\"token punctuation\">.</span>yaml\n        └── kustomization<span class=\"token punctuation\">.</span>yaml\n        └── sealedsecret<span class=\"token operator\">-</span>backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml</code></pre></div>\n<p>먼저, argoCD의 진입점은 /overlays/production/kustomization.yaml 파일입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ../../../base/backend\n  <span class=\"token punctuation\">-</span> sealedsecret<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>env.yaml\n<span class=\"token key atrule\">patches</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>replicas.yaml\n    <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env.yaml\n    <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n</code></pre></div>\n<p>이 파일을 로드하면서</p>\n<ul>\n<li><code class=\"language-text\">resources</code> 로 지정된 <code class=\"language-text\">../../../base</code> 디렉토리와</li>\n<li><code class=\"language-text\">sealedsecret-backend-env.yaml</code> 을 순서대로 가져옵니다.</li>\n</ul>\n<p>그런 다음, /base/kustomization.yaml에 있는 파일을 읽습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> backend<span class=\"token punctuation\">-</span>deploy.yaml\n  <span class=\"token punctuation\">-</span> backend<span class=\"token punctuation\">-</span>svc.yaml\n  <span class=\"token punctuation\">-</span> namespace.yaml\n\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> beming/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>back\n    <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> placeholder<span class=\"token punctuation\">-</span>backend\n\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization</code></pre></div>\n<ul>\n<li><code class=\"language-text\">backend-deploy.yaml</code>, <code class=\"language-text\">backend-svc.yaml</code>, <code class=\"language-text\">namespace.yaml</code> 을 차례로 읽습니다.</li>\n<li><code class=\"language-text\">images</code> 블록에 따라 Deployment의 <code class=\"language-text\">image:</code> 필드를 치환하는데, 이 때 tag값은 아까전의 github action에서 치환하여 commit을 넣어줍니다.</li>\n</ul>\n<p>/base/backend-deploy.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token comment\"># base에서는 1로 두고, overlays에서 프로덕션/스테이징 복제 수 조정</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># CI에서 placeholder-backend를 실제 SHA/tag로 교체합니다</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> beming/chat<span class=\"token punctuation\">-</span>irumae<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">:</span>placeholder<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># envFrom:</span>\n          <span class=\"token comment\">#   - secretRef:</span>\n          <span class=\"token comment\">#       name: backend-env</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3001</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n          <span class=\"token comment\"># 선택: 헬스체크</span>\n          <span class=\"token comment\"># readinessProbe:</span>\n          <span class=\"token comment\">#   httpGet:</span>\n          <span class=\"token comment\">#     path: /actuator/health</span>\n          <span class=\"token comment\">#     port: http</span>\n          <span class=\"token comment\">#   initialDelaySeconds: 20</span>\n          <span class=\"token comment\">#   periodSeconds: 10</span>\n          <span class=\"token comment\"># livenessProbe:</span>\n          <span class=\"token comment\">#   httpGet:</span>\n          <span class=\"token comment\">#     path: /actuator/health</span>\n          <span class=\"token comment\">#     port: http</span>\n          <span class=\"token comment\">#   initialDelaySeconds: 60</span>\n          <span class=\"token comment\">#   periodSeconds: 20</span>\n          <span class=\"token comment\"># 선택: 리소스 요청·제한</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"100m\"</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"128Mi\"</span>\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"500m\"</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"512Mi\"</span>\n</code></pre></div>\n<p>/base/spring-svc.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>service\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3001</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3001</span>\n      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30081</span></code></pre></div>\n<p>/base/namespace.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"apiversion:v1\"><pre class=\"language-apiversion:v1\"><code class=\"language-apiversion:v1\">kind: Namespace\nmetadata:\n  name: backend-namespace</code></pre></div>\n<p>/patches/backend-env.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spring-backend # base/backend-deploy.yaml 의 metadata.name 과 반드시 일치\nspec:\n  template:\n    metadata:\n      # (선택) 프로덕션 환경을 나타내는 라벨 추가\n      labels:\n        environment: production\n    spec:\n      containers:\n        - name: spring-backend # base 의 container name 과 일치\n          # 1) 프로덕션 프로파일 활성화를 위한 환경변수\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: production\n            - name: JAVA_OPTS\n              value: \"-Xms512m -Xmx1g\"\n          # 2) 리소스 요청(requests) / 제한(limits)\n          resources:\n            requests:\n              cpu: \"500m\"\n              memory: \"512Mi\"\n            limits:\n              cpu: \"1\"\n              memory: \"1Gi\"</code></pre></div>\n<p>/patches/backend-replicas.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spring-backend # base/backend-deploy.yaml 에 정의된 Deployment 이름과 동일해야 합니다\nspec:\n  replicas: 3 # 프로덕션에서 원하는 복제본 수\n</code></pre></div>\n<p>아래는 GPT가 그려준 대략적인 과정입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">┌────────────────────────────────────┐\n│ 1. Git 클론 및 overlays/production 로 진입\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 2. Kustomize load overlays/...    │\n│    ├── import base/ (resources)    │\n│    └── import sealedsecret...      │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 3. base/kustomization.yaml 적용   │\n│    ├─ backend-deploy.yaml      │\n│    ├─ backend-svc.yaml         │\n│    └─ namespace.yaml               │\n│    + images.newTag 치환            │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 4. overlays/sealedsecret 추가     │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 5. patches 병합                   │\n│    - replicas 변경                │\n│    - envFrom secretRef 추가       │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 6. 최종 매니페스트 출력            │\n└────────────────────────────────────┘\n             ↓\n┌────────────────────────────────────┐\n│ 7. Argo CD가 kubectl apply (sync) │\n└────────────────────────────────────┘\n</code></pre></div>\n<h2>환경변수 지정</h2>\n<p>제가 가장 애먹었던 부분은 바로 환경변수를 지정하는 방법입니다.\n환경변수가 public repository에 노출되지 않으면서, ArgoCD에 알려줄 수 있는 그런 방법이 필요했습니다.</p>\n<p>위의 고민을 해결하기 위해, Sealed Secret Controller를 사용했습니다.\n먼저 아래와 같이 Sealed Secret Controller를 설치해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-f</span> https://github.com/bitnami-labs/sealed-secrets/releases/latest/download/controller.yaml</code></pre></div>\n<p>아래와 같은 명령으로 secret파일을 생성해줍니다.</p>\n<p>secret-plain.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>namespace\n<span class=\"token key atrule\">stringData</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">FRONT_BASE_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://beming-stock.kro.kr\"</span>\n  <span class=\"token key atrule\">JWT_SECRET</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"randomstrlongerthan32fortestdonotusethisvalue\"</span></code></pre></div>\n<p>아래 명령으로 Sealed Secret을 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubeseal <span class=\"token parameter variable\">--format</span> yaml <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">&lt;</span> secret-plain.yaml <span class=\"token operator\">></span> sealedsecret.yaml</code></pre></div>\n<p>이제 결과로 암호화된 sealedsecret파일을 얻을 수 있습니다.\n해당파일을 프로젝트의 /overlays/production 밑에 위치시켜줍니다.</p>\n<p>그 후, /overlays/production/kustomization.yaml의 resources에,\nsealedsecret.yaml 과 같이 등록해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ../../base\n  <span class=\"token punctuation\">-</span> sealedsecret<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>env.yaml</code></pre></div>\n<p>마지막으로, backend-env.yaml파일에 secret 이름을 추가해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># CI에서 placeholder-backend를 실제 SHA/tag로 교체합니다</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> beming/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>back<span class=\"token punctuation\">:</span>placeholder<span class=\"token punctuation\">-</span>backend\n          <span class=\"token key atrule\">envFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">secretRef</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env</code></pre></div>\n<p>이제 컨테이너 내부에서 환경변수에 접근할 수 있게 됩니다.</p>\n<p>모든 과정이 성공적으로 완료되면, 아래와 같은 화면을 볼 수 있습니다.\n![[Pasted image 20250714134954.png]]</p>\n<h2>배포 확인</h2>\n<p>성공적으로 배포됐다면 api로 요청을 보낼 수 있어야겠죠?</p>\n<p>저희는 service를 생성하는 backend.svc.yaml 파일에서, 30080번 포트를 외부에 노출시켰습니다.</p>\n<p>아래 명령으로 EXTERNAL_IP값을 확인해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get services <span class=\"token parameter variable\">-n</span> backend-namespace\n\n<span class=\"token comment\"># 아래와 같은 결과가 나옵니다.</span>\nNAME TYPE CLUSTER-IP EXTERNAL-IP PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span> AGE\nspring-backend NodePort <span class=\"token number\">10.107</span>.223.38 <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span> <span class=\"token number\">80</span>:30080/TCP 3h31m</code></pre></div>\n<p>저의 경우는 EXTERNAL_IP가 비어있는데, 이런 경우는 인스턴스의 publicIP로 요청을 보내면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl http://${EXTERNAL_IP}:30080/actuator/health</code></pre></div>\n<p>위의 결과로 제대로 된 응답이 온다면 성공입니다. 이제 백엔드를 kubernetes에 자동으로 배포하는 CI/C파이프라인이 구성됐습니다.</p>\n<h1>트러블 슈팅</h1>\n<h2>ArgoCD가 접속이 되지 않음</h2>\n<p>처음에 ArgoCD로 포트포워딩이 제대로 되지 않아 접속이 불가했습니다.</p>\n<p>해결방법은 다음과 같습니다.</p>\n<ul>\n<li>인스턴스의 방화벽 설정을 열어준다</li>\n<li>아래와 같이 모든 인터페이스에 대해 포트 포워딩을 걸어준다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl port-forward \\\n  --address 0.0.0.0 \\\n  svc/argocd-server -n argocd 8080:443</code></pre></div>\n<p>이제 http://&#x3C;EC2 퍼블릭IP>:8080\n으로 접속이 가능합니다.</p>\n<p>아래와 같이 백그라운드에서 실행하면 좀 더 편리합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nohup kubectl -n argocd port-forward svc/argocd-server 8080:443 --address 0.0.0.0 \\\n  > ./argocd-port-forward.log 2>&amp;1 &amp;</code></pre></div>\n<h2>이미지 pull이 실패하는 경우</h2>\n<p>argoCD UI에서 sync버튼을 눌러 backend deploy를 하면, Docker image pull 이 실패합니다.</p>\n<p>그 이유는 저희가 Docker image의 tag값을 git에서 커밋으로 올려주도록 해뒀기 때문입니다.</p>\n<p>이 상황을 피하고 싶다면, tag값을 latest로 해서 항상 이미지를 가져올 수 있게 하던가,\ngithub action을 트리거 시켜서 argoCD를 작동시키면 됩니다.</p>\n<p>태그값이 잘 들어갔는지는 argoCD의 UI log에서 확인 가능합니다.</p>\n<h2>배포에 성공했는데 ArgoCD에서 오류가 뜨는 경우</h2>\n<p>저희는 앱이 살아있다는 신호를 /actuator/health 라우트에서 신호를 받도록 yaml파일에 설정해뒀습니다.</p>\n<p>이 신호를 받기 위해서는, actuator 의존성을 Spring에 추가해둬야 합니다.</p>\n<p>gradle 기준 아래 명령을 build.gradle에 추가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">implementation 'org.springframework.boot:spring-boot-starter-actuator'</code></pre></div>\n<p>application.properties에서 endpoint를 노출시킵니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server.port=3000\nmanagement.server.port=${server.port}\nmanagement.endpoints.web.exposure.include=health,info\nmanagement.endpoint.health.show-details=always</code></pre></div>\n<p>이렇게 하고 Docker image를 다시 빌드하면 해당 라우트가 잘 작동합니다.</p>\n<p>참고로 server.port값은 Dockerfile의 Expose값과도 일치해야 하고, yaml파일에서도 포트 번호를 잘 신경써줘야 제대로 동작합니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Project","subCategory":"capstone"}],"date":"2025-07-30","slug":"/blog/capstone/cicd","title":"MSA - Kubernetes, ArgoCD 배포자동화"}}},{"node":{"html":"<p>최근 About 프로젝트에 클린 아키텍처를 도입하고 있습니다.</p>\n<p>서비스를 Controller, Service, Entity, Repository 정도의 경계로 나누고, 고수준 모듈이 저수준 모듈을 참조하는 (Service에서 Repository를 호출하는) 경우는 interface를 정의하여 의존성을 방향을 제어하도록 구현하고 있습니다.\n![[Pasted image 20250627113727.png]]</p>\n<p>위 도식에서 추가로 외부에 의존해야 하는게 필요하다면 (ex. 결제 api), interface를 정의해서 interface에만 의존하는 방식으로 구현중에 있습니다.</p>\n<p>여기서 DB의존성 제거를 위해 Repository를 분리하기 위해서는, 도메인 엔티티를 정의해야 합니다. 그렇지 않고 DB 스키마를 사용하게 된다면, 완전한 DB의 분리가 이루어졌다고 보기 어렵습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"></code></pre></div>\n<h1>도메인 주도 개발</h1>\n<p>먼저, 도메인이란 \"<b>소프트웨어가 해결하고자 하는 문제 영역</b>\" 입니다.\n예를 들어, 은행 앱의 도메인을 설계 한다면, 아래와 같은 것들이 도메인이 될 수 있습니다.</p>\n<ul>\n<li>계좌 정보</li>\n<li>고객 정보</li>\n<li>은행 상품\n도메인은 서비스를 운영한다면 필수적으로 존재하게 되는데, 개발자로서 우리는 이를 소프트웨어적으로 구현해야 하므로 <b>도메인 모델</b>을 설계해야 합니다.\n설계 방식에 제약은 없지만 주로 객체를 이용해 설계하는 것이 일반적입니다.</li>\n</ul>\n<h1>설계</h1>\n<p>먼저 일반적으로 생각했을 때, 해결하려는 하나의 문제가 존재할 것이고, 그 문제를 위해 필요한 엔티티가 여러개 있을 것입니다. 이 하나의 문제를 도메인이라 부릅시다.</p>\n<p>도메인을 해결하기 위해서는 여러 엔티티들이 상호작용 해야합니다. 이 수많은 엔티티들 중에는 서로 연관된 것들이 존재합니다. 이런 엔티티를 묶은것을 <b>애그리거트 (Aggregate)</b>라고 부릅시다. 하나의 애그리더트는 <b>애그리거트 루트</b>를 가지고 여러 하위 엔티티를 포함합니다.</p>\n<p>예를 들어, 은행 상품 이라는 애그리거트를 설계한다고 생각해봅시다. 하위에</p>\n<hr>\n<h3>Aggregate 1: Catalog</h3>\n<ul>\n<li>Entity1: Product: 상품코드, 이름, 설명</li>\n<li>Entity2: Category: 카테고리 이름, 카테고리 코드</li>\n<li>Entity3: Attribute: 최고한도, 최저예치금</li>\n</ul>\n<hr>\n<h3>Aggregate2: Definition</h3>\n<ul>\n<li>Entity1: RatePlan: 연이율, 적용기간, 변동금리/고정금리</li>\n<li>Entity2: Fee: 수수료 유형, 금액, 비율</li>\n</ul>\n<hr>\n<p>다음과 같은 Aggregate, Entity가 생성될 것입니다.</p>\n<h1>Entity와 Value Object</h1>\n<p>Entity는 고유한 식별자를 가지고, LifeCycle동안 동일성을 유지해야 합니다.\n반면, Value Object는 식별자가 없고, 값 자체로 동일성을 판단합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>        <span class=\"token comment\">// 식별자</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Email</span> email<span class=\"token punctuation\">;</span>    <span class=\"token comment\">// VO 참조</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@ValueObject</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Email</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> address<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Email</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> address<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>address<span class=\"token punctuation\">.</span><span class=\"token function\">matches</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".+@.+\\\\..+\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"유효하지 않은 이메일\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>address <span class=\"token operator\">=</span> address<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>엔티티와 Value Object를 구분함으로서, 도메인 모델의 의도를 분명하게 드러낼 수 있습니다.</p>\n<p>Entity의 안에는 비즈니스 규칙에 따라 상태가 바뀌는 로직이 들어가고, Value Object는 불변으로 설계하여, 변경이 필요하면 새로운 인스턴스를 생성하여 Side-Effect를 차단할 수 있습니다.</p>\n<h2>불변성</h2>\n<p>DDD에서 왜 불변성을 챙겨야 할까요?</p>\n<p>불변성을 적용하면 다음과 같은 이점을 얻을 수 있습니다.</p>\n<ul>\n<li>멀티스레드 환경에서 동시성 이슈 감소</li>\n<li>사이드 이펙트를 방지하여 예측 가능한 동작 보장</li>\n<li>단위 테스트에서 상태 설정이 간단해짐</li>\n</ul>\n<p>아래에서 Money를 불변성을 가진 Value Object로 설계해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Money</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">BigDecimal</span> amount<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> currency<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Money</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BigDecimal</span> amount<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>amount <span class=\"token operator\">=</span> amount<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currency <span class=\"token operator\">=</span> currency<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Money</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BigDecimal</span> amount<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">.</span><span class=\"token function\">signum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"금액은 음수일 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Money</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">,</span> currency<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 불변 연산: 새 객체를 반환</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Money</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Money</span> other<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currency<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>currency<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"통화 단위가 다릅니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Money</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>amount<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> currency<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Getter만 제공</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">BigDecimal</span> <span class=\"token function\">getAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> amount<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getCurrency</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> currency<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 코드를 보면, Money 객체에는 내부 필드를 외부에서 조작할 수 있는 set 메서드를 제공하지 않습니다.</p>\n<p>유일하게 Money를 변경할 수 있는건 외부에 노출된 add 뿐입니다. 그러나 add 메서드 역시 내부 상태 변경을 허용하지 않고 새로운 Money 객체를 반환합니다.</p>\n<h1>Entity, VO, 불변성</h1>\n<p>Entity와 VO, 불변성은 함께 사용하면 시너지 효과를 얻을 수 있습니다.</p>\n<ol>\n<li>도메인의 의도 명확화\nVO를 통해 핵심 값의 비즈니스 규칙을 캡슐화 하고, Entity는 식별과 참조 역할에만 집중합니다.</li>\n<li>안정적 모델 유지\nVO에 불변성을 적용하면, Entity 내부의 VO가 의도치 않게 변형되는걸 방지합니다. 따라서 복잡한 트랜잭션, 이벤트에서 안정성이 확보됩니다.</li>\n<li>테스트 용이성\nVO 단위 테스트로 값 검사 로직을 검증하면, Entity의 단위 테스트에서 VO의 생성이 보장됩니다.</li>\n</ol>\n<p>아래에서 간단한 예시를 확인해봅시다.</p>\n<p>먼저, Money 객체에 값 검사 로직을 추가해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Money</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">BigDecimal</span> amount<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> currency<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Money</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BigDecimal</span> amount<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>amount <span class=\"token operator\">=</span> amount<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currency <span class=\"token operator\">=</span> currency<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Money</span> <span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BigDecimal</span> amount<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> currency<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">.</span><span class=\"token function\">signum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"금액은 음수일 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Money</span><span class=\"token punctuation\">(</span>amount<span class=\"token punctuation\">,</span> currency<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Money</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Money</span> other<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">verifySameCurrency</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Money</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>amount<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>amount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> currency<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Money</span> <span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> quantity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>quantity <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"수량은 음수일 수 없습니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Money</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>amount<span class=\"token punctuation\">.</span><span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BigDecimal</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> currency<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">verifySameCurrency</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Money</span> other<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currency<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>other<span class=\"token punctuation\">.</span>currency<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"통화가 다릅니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">BigDecimal</span> <span class=\"token function\">getAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> amount<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getCurrency</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> currency<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> o<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* address equality */</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token annotation punctuation\">@Override</span> <span class=\"token keyword\">public</span> <span class=\"token keyword\">int</span> <span class=\"token function\">hashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">/* based on amount &amp; currency */</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 이 VO를 Order 객체에서 사용해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Entity: Order</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Order</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> customerId<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderLine</span><span class=\"token punctuation\">></span></span> lines <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> customerId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>customerId <span class=\"token operator\">=</span> customerId<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addLine</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span> product<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> quantity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Money</span> lineTotal <span class=\"token operator\">=</span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">multiply</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        lines<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">OrderLine</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> quantity<span class=\"token punctuation\">,</span> lineTotal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 전체 주문 금액 계산</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Money</span> <span class=\"token function\">totalAmount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> lines<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderLine</span><span class=\"token operator\">::</span><span class=\"token function\">getLineTotal</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Money</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BigDecimal</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ZERO</span><span class=\"token punctuation\">,</span> lines<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLineTotal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCurrency</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token class-name\">Money</span><span class=\"token operator\">::</span><span class=\"token function\">add</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// OrderLine 내부 클래스</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderLine</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> quantity<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Money</span> lineTotal<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// VO</span>\n\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderLine</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> productId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> quantity<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Money</span> lineTotal<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>productId <span class=\"token operator\">=</span> productId<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>quantity <span class=\"token operator\">=</span> quantity<span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>lineTotal <span class=\"token operator\">=</span> lineTotal<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">public</span> <span class=\"token class-name\">Money</span> <span class=\"token function\">getLineTotal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> lineTotal<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>위 예에서 Money는 불변 VO이고, Order Entity는 내부의 OrderLine(주문 상품들) 에서 Money를 가집니다.</p>\n<ul>\n<li>Money(VO) 가 금액 계산, 검증 역할을 전담합니다. 따라서 Order는 주문 로직에만 집중할 수 있습니다.</li>\n<li>Money가 불변 객체이므로, 한번 생성된 금액 정보는 절대 변경되지 않습니다.</li>\n<li>Money의 단위 테스트에서 덧셈, 곱셈, 통화 검증이 완료되면, Order의 단위 테스트에서는 addLine과 totalAmount의 검증만 완료되면 됩니다.</li>\n</ul>\n<p>이런 이유로 도메인 주도 개발을 할 때에는 Entity, VO, 불변성 개념을 잘 알고 있는것이 도움이 됩니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-07-28","slug":"/blog/about/ddd","title":"도메인 주도 개발(DDD)을 적용해보자"}}},{"node":{"html":"<p>코딧은 크롤링을 통해 다양한 뉴스, 법안, 회의록 데이터를 수집하고 있습니다.</p>\n<p>또한 DB에 저장된 수천만 ~ 수억개의 데이터를 사용자들에게 효율적이고 빠르게, 그리고 다양한 방식으로 검색을 제공해야 합니다.</p>\n<p>데이터베이스를 MySQL을 사용한다고 가정하면, MySQL만으로 충분한 성능의 기능을 제공할 수 있을까요?</p>\n<h1>MySQL에서의 서비스 제공</h1>\n<p>MySQL에서 다양한 조건으로 빠른 검색을 제공하기 위해서는 아래와 같은 방법들을 생각해볼 수 있습니다</p>\n<h2>인덱스 설계</h2>\n<ul>\n<li>자주 조회되는 키를 기준으로 인덱스를 설계합니다.</li>\n<li>Full Text 인덱스를 추가하여 전문에서 검색이 용이하도록 합니다.</li>\n<li>두개 이상의 인덱스를 묶어 복잡한 조건에서도 인덱스를 탈 수 있도록 합니다.</li>\n</ul>\n<p>MySQL에서 인덱스를 해두는것과 해두지 않는것은 데이터의 크기가 클 수록 조회속도에서의 차이가 큽니다.</p>\n<p>인덱스를 잘 설계하면 빠른 검색을 기대할 수 있지만, 검색 조건이 다양해질수록 제대로된 인덱스를 설계하기가 어려워집니다.</p>\n<p>또한 인덱스는 읽기 속도를 높혀주지만, 나머지 연산(INSERT, UPDATE, DELETE)의 연산속도는 늦춥니다. 따라서 지속적으로 데이터를 쓰고 수정해야하는 크롤링 데이터에 너무 많은 인덱스를 걸어놓는건 성능에 좋지 않을겁니다.</p>\n<h2>데이터 분할, 샤딩</h2>\n<ul>\n<li>데이터를 년도별, 혹은 다른 기준으로 파티셔닝 해둘 수 있습니다.</li>\n<li>애플리케이션에서 특정 shardId를 계산해 어떤 DB 인스턴스에 접근할지 결정할 수 있습니다.</li>\n<li>프록시, 미들웨어에서 샤딩을 관리할 수 있습니다.</li>\n<li>MySQL 전용 샤딩 솔루션(Vitess 등)을 사용합니다.</li>\n</ul>\n<p>위와같이 데이터를 분할, 샤딩하여 관리할 수도 있습니다.\n하지만 여러 MySQL 인스턴스가 필요할 수 있고, 저희 서비스의 성격과 잘 맞지 않는 방식입니다.</p>\n<h1>Elasticsearch 도입</h1>\n<p>MySQL만으로 풀텍스트 검색과 대용량 분산 처리를 모두 커버하기엔 한계가 있습니다. 특히 <strong>다양한 언어 분석</strong>, <strong>실시간 색인</strong>, <strong>수평 확장</strong>이 필요한 경우에는 Elasticsearch 도입을 고려해볼 수 있습니다.</p>\n<h2>어떤점이 좋을까?</h2>\n<p>먼저, ElasticSearch는 오픈소스입니다. 충분한 자원과 약간의 learning curve만 넘으면 누구나 사용할 수 있습니다.</p>\n<p>문서 단위로 인덱스를 생성하고, 역색인 방식으로 빠른 검색을 제공합니다.\nMySQL의 Full-Text는 문서 단위 검색에 제한이 있지만, ES는 토큰화, 형태소 분석 등 다양한 분석기를 제공합니다.</p>\n<p>또한 자동으로 데이터를 샤딩하여 저장하고, 내부적으로 노드를 재배치 하는 작업도 진행합니다.\nMaster-Data 노드를 구분해 고가용성 및 장애 복구를 지원합니다.</p>\n<h2>고려해야 할 점은?</h2>\n<p>elasticsearch의 도입은 확실히 관리 리소스를 증가시킵니다.\nDB에 있는 데이터를 elasticsearch에 인덱싱 해야하므로 데이터의 불일치, 누락이 발생할 수 있고 elasticsearch용 쿼리를 설계해야 하는 불편함이 있습니다.</p>\n<p>Codit 서비스는 주로 크롤링한 데이터, api에서 받아온 데이터를 서빙합니다.\n그러기 위해선 받아온 데이터를 DB에 저장하고, 서비스에서 사용하기 좋은 형태로 가공하는 과정이 필요합니다.</p>\n<p>특히 크롤링 된 데이터는 완벽할 수 없습니다. 크롤링 된 데이터를 바로 사용한다면, 비즈니스 로직쪽에 DB에서 데이터를 가져와 전, 후처리 해주는 로직이 들어가게 됩니다.</p>\n<p>그러나 이 부분을 elasticsearch에 indexing하는 과정에서 처리한다면 코드를 조금 더 깔끔하게 분리할 수 있습니다.</p>\n<p>그렇다면 데이터 불일치, 누락 문제는 어떻게 해결할 수 있을까요?\nDB에서 크롤링된 데이터가 업데이트 되거나, 일부 데이터가 인덱싱 되지 않을 수 있습니다.\n이런 데이터는 지속적으로 모니터링하여 변경, 누락 사항을 반영해줘야 합니다.</p>\n<p>Codit에서는 airflow를 이용한 자동화 스크립트를 이용하여 데이터를 지속적으로 업데이트하고 인덱싱 해주고 있습니다. 문서의 updatedAt값을 기준으로 변경사항이 있으면 다시 인덱싱하고, 인덱싱이 누락된 데이터가 있는지 모니터링합니다.</p>\n<h1>MySQL에서의 검색 vs elasticsearch에서의 검색</h1>\n<p>정확한 성능 비교는 어렵지만, 한번 단순하게 성능 비교를 해봅시다.</p>\n<p>DB에서 약 3000만개의 데이터가 기록된 news 테이블과, ElasticSearch에서 뉴스 데이터를 인덱싱한 인덱스 news-2023,news-2024,news-2025(약 3000만개 데이터) 세 가지를 비교하여 보겠습니다.</p>\n<hr>\n<p>먼저, DB에 다음과 같은 쿼리를 날립니다.\nnews 테이블의 press 열에는 인덱스를 걸어두었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">EXPLAIN</span> <span class=\"token keyword\">ANALYZE</span>\n<span class=\"token keyword\">SELECT</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">FROM</span> news\n<span class=\"token keyword\">WHERE</span> press<span class=\"token operator\">=</span><span class=\"token string\">\"기독교한국신문\"</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">-> Index lookup on news_2023 using index_press (press='기독교한국신문')  (cost=3558 rows=3238) (actual time=0.0704..40939 rows=3238 loops=1)↵</code></pre></div>\n<p>결과를 해석해보면 첫 데이터를 찾는데에 0.07ms, 마지막 데이터를 찾는데에 40.9초 정도가 소요됐습니다.</p>\n<hr>\n<p>이번엔 elasticsearch에 아래와 같은 쿼리를 날려봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET news-2023,news-2024,news-2025/_search\n{\n  \"size\": 10000,\n  \"query\": {\n    \"term\": {\n      \"press\": {\n        \"value\": \"기독교한국신문\"\n      }\n    }\n  }\n}</code></pre></div>\n<p>![[Pasted image 20250625160011.png]]\n우측 상단의 결과를 보면 약 3.2초가 소요됐습니다.</p>\n<p>데이터가 다른것과 단순한 시간 비교임을 감안해도 약 10배 이상 검색에 차이가 나는것을 확인할 수 있습니다.</p>\n<h2>왜 이런 성능차이가 날까?</h2>\n<p>MySQL은 기본적으로 B-Tree 인덱스를 사용합니다.\nB-Tree를 탐색해 문서의 주소를 얻은 후, 해당 주소에서 데이터를 읽어옵니다. 읽어오는 행 수가 많으면 I/O비용이 점점 커집니다.</p>\n<p>반면, ElasticSearch는 역색인 방식을 사용합니다.\n키워드별로 문서의 Id 리스트를 저장해두고, OS의 페이지 캐시(mmap)를 활용해 디스크 I/O를 최소화합니다.</p>\n<p>이 외에도 ElasticSearch는 데이터를 여러 샤드에 나누어 저장하고 병렬로 읽어오므로 훨씬 빠른 검색 성능을 보입니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"codit"}],"date":"2025-07-14","slug":"/blog/codit/elasticsearch","title":"왜 ElasticSearch를 사용할까?"}}},{"node":{"html":"<h1>문제 상황</h1>\n<p>뉴스 알림을 보내는 기능은, 코딧 서비스에서 중요한 역할을 합니다.</p>\n<p>그 중에는 다음과 같은 로직이 있었습니다.\n(실제 사용되는 코드이므로, 코드는 매우 단순화 하였습니다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token function\">discoverNotification</span><span class=\"token punctuation\">(</span>userId<span class=\"token punctuation\">,</span> shopId<span class=\"token punctuation\">,</span> <span class=\"token comment\">/*...*/</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> datum <span class=\"token keyword\">of</span> retdata<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Models<span class=\"token punctuation\">.</span><span class=\"token function\">writeNotification</span><span class=\"token punctuation\">(</span>\n\t\tuserId<span class=\"token punctuation\">,</span>\n\t\tshopId<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token comment\">//...</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> retdata<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token function\">writeNotification</span><span class=\"token punctuation\">(</span>\n\t<span class=\"token parameter\">userId<span class=\"token punctuation\">,</span>\n\tshopId<span class=\"token punctuation\">,</span>\n\t<span class=\"token operator\">/</span><span class=\"token operator\">...</span></span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n\t\tINSERT INTO </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>table<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (\n\t\tuserId,\n\t\tshopId,\n\t\t...\n\t\t\\`order\\`\n\t\t) VALUES (\n\t\t'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>userId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">',\n\t\t'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>shopId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">',\n\t\t//...\n\t\t)\n\t</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>query <span class=\"token operator\">&amp;&amp;</span> query<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>orm<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span>query<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">[</span>results<span class=\"token punctuation\">,</span> metadata<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위의 코드에서는 데이터 하나당 반복문을 돌며 DB에 값을 넣어주고 있습니다.\n실제로 코드를 짜다보면, 여러 데이터를 반복문으로 돌며 DB에 넣어주는 로직을 짜는 경우가 자주 생깁니다.</p>\n<h1>어떤 문제가 있을까요?</h1>\n<p>위 상황에서는 다음과 같은 문제가 발생할 수 있습니다.</p>\n<ol>\n<li>for 루프 안에서 await를 사용합니다. 알림 개수가 많아지면 전체 실행 시간이 정비례하여 증가합니다.</li>\n<li>개별 INSERT마다 DB와의 연결이 필요하고, 네트워크 전송이 필요하므로 네트워크가 병목되고 DB 트랜잭션 관리 부담도 커집니다.</li>\n<li>동시에 DB로 여러 요청이 갈 경우 connection pool이 금방 소진됩니다.</li>\n</ol>\n<p>2번 문제는 설정에 따라 매번 새 connection이 생기지는 않을 수 있지만, DB가 새 쿼리를 받을 때마다 쿼리 파싱, 계획 수립 비용이 생기고 네트워크 병목이 일어나게 됩니다.</p>\n<h1>Bulk Insert를 사용한 해결</h1>\n<p>MySQL은 여러 레코드를 한번의 쿼리로 DB에 넣을 수 있는 Bulk Insert를 제공합니다.</p>\n<p>대충 아래와 같은 형태입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> notifications<span class=\"token punctuation\">(</span>\bfield1<span class=\"token punctuation\">,</span> field2<span class=\"token punctuation\">,</span> field3<span class=\"token punctuation\">,</span> field4<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">VALUES</span>\n  <span class=\"token punctuation\">(</span><span class=\"token string\">'u1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'s1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Hello'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token string\">'u2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'s2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'World'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token string\">'u3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'s3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Foo'</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이런 쿼리를 만들어주기 위해서는, 데이터를 위의 형태로 파싱해줘야 합니다.</p>\n<p>javascript에서는 아래와 같이 할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> insertValues <span class=\"token operator\">=</span> insertList\n  <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">(\n\t'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token punctuation\">.</span>userId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">',\n\t'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token punctuation\">.</span>shopId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">',\n\t'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token punctuation\">.</span>country<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">',\n\t'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token punctuation\">.</span>type<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">',\n\t'</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token punctuation\">.</span>uniqId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">'\n\t)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이렇게 해주면 Values에 들어갈 형태의 데이터가 만들어집니다.\n이제, 이걸 사용해서 하나의 쿼리를 만들어주면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n\nINSERT INTO </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>table<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (\nuserId,\nshopId,\ncountry,\ntype,\nnumber,\n) VALUES\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>insertValues<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<h1>Bulk insert의 이점, 시간 단축</h1>\n<p>여러번 날리던 쿼리를 이렇게 하나의 쿼리로 처리하면 다음과 같은 이점이 있습니다.</p>\n<ol>\n<li>네트워크 왕복 지연 감소</li>\n<li>DB엔진의 쿼리 처리 비용 감소</li>\n<li>트랜잭션 오버헤드 감소</li>\n</ol>\n<p>이 외에도 락, 디스크 효율등 다양한 이점을 가지고 있습니다.</p>\n<p>그럼 실제로 얼마만큼 효율이 좋아졌을까요?\n시간을 확인해보기 위해, 모든 데이터를 기록할 때까지의 시간을 console.time으로 찍어보았습니다.</p>\n<p>제가 사용한 코드에서 기존에는 50개의 데이터를 반복문으로 돌며 insert 해줬습니다.\n아래는 시간을 찍어보며 테스트 한 결과입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">default: 1.528s\ndefault: 1.521s\ndefault: 1.594s\ndefault: 1.660s\ndefault: 1.393s\ndefault: 1.468s\ndefault: 1.561s\ndefault: 1.445s\ndefault: 1.387s\ndefault: 1.370s\ndefault: 1.238s\ndefault: 1.473s</code></pre></div>\n<p>데이터를 확인해보면 평균 1.5s가 소요되는 것을 확인할 수 있습니다.</p>\n<p>이제 bulk insert를 적용한 시간을 봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">default: 488.031ms\ndefault: 469.722ms\ndefault: 353.171ms\ndefault: 369.206ms\ndefault: 625.083ms\ndefault: 414.684ms\ndefault: 729.071ms\ndefault: 363.519ms\ndefault: 435.876ms\ndefault: 368.932ms\ndefault: 535.38ms\ndefault: 348.015ms\ndefault: 368.04ms\ndefault: 455.504ms</code></pre></div>\n<p>평균적으로 500ms가 소요되는 것을 확인해볼 수 있습니다.</p>\n<p>약 1/3의 시간이 줄었습니다. 한번에 처리하는 데이터의 양이 많아지면 더 큰 효과를 느릴 수 있을것이란걸 기대해볼 수 있습니다.</p>\n<h1>Bulk insert의 단점</h1>\n<p>물론 장점만 있는것은 아닙니다.</p>\n<ol>\n<li>단일 쿼리가 너무 커지면 패킷 크기 제한, 메모리 부족 등 문제 발생</li>\n<li>하나의 레코드에 에러가 나면 전체 쿼리 롤백</li>\n<li>롤백 비용이 커짐</li>\n</ol>\n<p>이러한 문제들이 있는데, 이 문제들은 간단히 해결이 가능합니다.</p>\n<h1>Bulk insert 개선</h1>\n<p>먼저, 단일 쿼리가 너무 커지면 패킷 크기 제한에 걸리거나 메모리가 부족하거나 롤백 비용이 커지는 문제는 어떻게 해결할까요?</p>\n<p>당연히 단일 쿼리의 크기를 줄이면 됩니다!</p>\n<p>적절한 크기로 Batch 사이즈를 나누고 시스템 자원을 고려해 수백~수천개씩 bulk insert를 날리면 됩니다.</p>\n<hr>\n<p>다음으로, 하나의 레코드에 에러가 나면 전체 쿼리가 롤백되는 문제는 어떻게 해결할까요?\n물론 요구사항에 따라, 전체를 롤백해야 할 수 있습니다.</p>\n<p>하지만 저의 경우는 문제가 있는 데이터는 삽입하지 않고, 나머지는 정상적으로 삽입되길 바랐습니다.</p>\n<p>이 경우, INSERT에 IGNORE 값을 주면 됩니다</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n\nINSERT IGNORE INTO </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>table<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (\nuserId,\nshopId,\ncountry,\ntype,\nnumber,\n) VALUES\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>insertValues<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>INSERT IGNORE 구문은, 삽입 중 발생하는 경고 수준의 에러는 무시합니다.\n중복 키 충돌과 같은 문제는 무시하고 삽입을 진행합니다.</p>\n<p>혹은 ON DUPLICATE KEY 옵션을 줄 수도 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> query <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n\nINSERT IGNORE INTO </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>table<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> (\nuserId,\nshopId,\ncountry,\ntype,\nnumber,\n) VALUES\n</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>insertValues<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\nON DUPLICATE KEY UPDATE\n  userId = VALUES(name);\n  ...\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>요구사항에 맞게 적절히 사용하면 됩니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"codit"}],"date":"2025-06-13","slug":"/blog/codit/sql","title":"Bulk insert를 이용한 MySQL 쿼리 최적화"}}},{"node":{"html":"<h1>개요</h1>\n<p>코딧의 서비스는 여전히 Javascript를 사용하고 있는 곳이 많습니다.\napi서버는 typescript로의 마이그레이션을 마쳤지만, 크롤러, 인덱서, admin등 나머지 코드는 전부 javascript를 사용하고 있습니다.</p>\n<p>서비스 자체가 데이터 요구사항, 기획 변경등에 따라 수정이 잦고, 여러명이 관리하기 때문에 javascript로 작성된 코드를 유지보수 하는것이 디버깅, 개발 속도 면에서 불리했습니다.</p>\n<p>그래서 이번 기회에 javascript코드를 typescript로 점진적으로 마이그레이션 하며 개발을 진행하기로 했습니다.</p>\n<p>Javascript를 Typescript로 마이그레이션 할 때는 모든 파일을 이동할 필요 없이 점진적으로 적용할 수 있기 때문에, 실제 운영 중인 서비스에서도 무리 없이 진행할 수 있었습니다.</p>\n<hr>\n<h2>왜 TypeScript인가?</h2>\n<ul>\n<li><strong>정적 타입 검증</strong>: 컴파일 타임에 타입 오류를 잡아내 런타임 에러를 줄입니다.</li>\n<li><strong>IDE 지원 강화</strong>: 자동완성·리팩토링·정적 분석 기능 활용이 수월해집니다.</li>\n<li><strong>명시적 문서화</strong>: 인터페이스와 타입 별칭으로 코드 의도를 명확히 표현합니다.</li>\n<li><strong>대규모 협업</strong>: 명확한 계약(contract)이 있어 팀원 간 변경 충돌을 방지합니다.</li>\n</ul>\n<hr>\n<h2>사전 준비</h2>\n<ol>\n<li><strong>Node.js &#x26; npm/yarn</strong>\n<ul>\n<li>최소 Node.js 12 이상 권장</li>\n</ul>\n</li>\n<li><strong>빌드 툴 확인</strong>\n<ul>\n<li>Webpack, Rollup, Babel 등</li>\n</ul>\n</li>\n<li><strong>버전 관리</strong>\n<ul>\n<li>Git 브랜치를 분리하여 실험적 마이그레이션 진행</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h2><code class=\"language-text\">tsconfig.json</code> 설정하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"jsonc\"><pre class=\"language-jsonc\"><code class=\"language-jsonc\">{\n  &quot;compilerOptions&quot;: {\n    &quot;target&quot;: &quot;ES2020&quot;,                 // 컴파일 후 타겟 JS 버전\n    &quot;module&quot;: &quot;CommonJS&quot;,               // 모듈 시스템 설정\n    &quot;strict&quot;: true,                     // 모든 엄격 모드 옵션 활성화\n    &quot;noImplicitAny&quot;: true,              // 암묵적 any 금지\n    &quot;strictNullChecks&quot;: true,           // null, undefined 검사 강화\n    &quot;esModuleInterop&quot;: true,            // CommonJS 호환\n    &quot;skipLibCheck&quot;: true,               // @types 로딩 속도 최적화\n    &quot;forceConsistentCasingInFileNames&quot;: true,\n    &quot;moduleResolution&quot;: &quot;node&quot;,\n    &quot;outDir&quot;: &quot;dist&quot;,\n    &quot;rootDir&quot;: &quot;src&quot;,\n    &quot;declaration&quot;: true,                // .d.ts 파일 생성\n    &quot;allowJs&quot;: true,                    // .js 파일도 컴파일 대상\n    &quot;checkJs&quot;: false                    // JSDoc 검사 여부 (점진적 전환 시 true 추천)\n  },\n  &quot;include&quot;: [&quot;src/**/*&quot;],\n  &quot;exclude&quot;: [&quot;node_modules&quot;, &quot;dist&quot;]\n}</code></pre></div>\n<ul>\n<li>allowJs: true 로 초기 단계에서 .js 파일도 함께 컴파일하도록 설정하고</li>\n<li>점차 .js → .ts 로 파일명을 변경해 나갑니다.</li>\n</ul>\n<p>typescript는 결국 javascript로 컴파일 되기 때문에, allowJS 옵션을 허용하여 컴파일 대상에 포함시킵니다.</p>\n<h2>점진적 파일 확장자 변경</h2>\n<ol>\n<li><strong>핵심 유틸리티부터</strong>\n자주 변경되지 않는 안정적인 유틸리티부터 <code class=\"language-text\">.js → .ts</code> 변경</li>\n<li><strong>비즈니스 로직</strong>\n데이터 모델, 서비스 레이어 등 점진적 변경</li>\n<li><strong>엔트리 포인트</strong>\n최종적으로 <code class=\"language-text\">index.js</code> 등 엔트리 포인트를 <code class=\"language-text\">.ts</code>로 변환</li>\n</ol>\n<hr>\n<h2>마이그레이션 단계별 가이드</h2>\n<h3>1) 컴파일러 테스트</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx tsc <span class=\"token parameter variable\">--noEmit</span></code></pre></div>\n<p>위 명령으로 파일을 컴파일하며 오류를 해결합니다.\n--noEmit옵션으로 타입검사 만을 수행합니다.</p>\n<h3>2) 빌드 스크립트 수정</h3>\n<ul>\n<li><code class=\"language-text\">package.json</code> 예시</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>   \n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>     \n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsc\"</span><span class=\"token punctuation\">,</span>     \n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node dist/index.js\"</span><span class=\"token punctuation\">,</span>     \n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ts-node-dev --respawn src/index.ts\"</span>   \n  <span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>3) 코드 수정 및 타입 추가</h3>\n<ul>\n<li><strong><code class=\"language-text\">any</code> 남용 지양</strong></li>\n<li><strong>타입 가드</strong> 활용</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">function</span> <span class=\"token function\">isString</span><span class=\"token punctuation\">(</span>x<span class=\"token operator\">:</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> x <span class=\"token keyword\">is</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>   \n\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">typeof</span> x <span class=\"token operator\">===</span> <span class=\"token string\">'string'</span><span class=\"token punctuation\">;</span> \n<span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2>주요 고려사항 및 팁</h2>\n<ul>\n<li><strong><code class=\"language-text\">strictNullChecks</code></strong>: 널 안전성을 확보하려면 반드시 활성화</li>\n<li><strong><code class=\"language-text\">esModuleInterop</code></strong>: CommonJS 모듈과의 호환성</li>\n<li><strong>파일간 순환 참조</strong>: 타입만 분리된 <code class=\"language-text\">*.d.ts</code>로 순환 방지</li>\n<li><strong><code class=\"language-text\">skipLibCheck</code></strong>: 빌드 속도 vs. 타입 안전성 균형</li>\n<li><strong>점진적 마이그레이션</strong>: 작은 단위로 PR 생성, 코드 리뷰 강화</li>\n</ul>\n<hr>\n<h2>결론</h2>\n<p>위 단계들을 적용하며 파일을 하나씩 typescript로 변환하면, 큰 오류 없이 모든 파일을 typescript로</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"codit"}],"date":"2025-06-01T00:00:00.000Z","slug":"/blog/codit/typescript","title":"Javascript에서 Typescript로의 마이그레이션"}}},{"node":{"html":"<p>규모 있는 소프트웨어 개발을 하다보면 필연적으로 다음과 같은 문제들에 마주합니다.</p>\n<p>\"영향을 받는 곳이 너무 많아 수정이 힘들다\"\n\"인원이 늘어나도 생산성이 그닥 높아지지 않는다.\"</p>\n<p>Clean Architecture는 코드 간 의존성을 줄여 코드의 유지 보수성을 높이고, 변경을 유연하게 합니다.</p>\n<p>최종적으로는 아주 적은 인력으로도 시스템을 유지, 보수, 확장 할 수 있게 됩니다.</p>\n<p>이 포스팅은 Clean Architecture 책을 기반으로, 제가 경험해본 Clean Architecture에 관한 글입니다. 모든 예시는 Typescript와 Nest.js 기반입니다.</p>\n<h1>의존</h1>\n<p>왜 코드 규모가 커지면 점점 수정, 확장이 어려워질까요?\n이를 이해하기 위해 먼저 의존이라는 개념을 이해해야 합니다.</p>\n<h2>Module</h2>\n<p>우리는 코드를 작성할 때, 하나의 파일에 모든 코드를 작성하지 않습니다.\nJava의 import, Javascript의 import, require, c, c++의 include 같은 코드를 통해 외부 라이브러리, 혹은 다른 모듈의 코드를 불러오게 됩니다.</p>\n<p>바로 이 부분에서 코드들 간의 의존성이 생기게 됩니다.</p>\n<p>일례로, 어떤 프로젝트에 A모듈, B모듈만 존재한다고 가정해봅시다. 이 때, A모듈에서는 B모듈을 import 해서 사용하고 있습니다.</p>\n<h2>불안정한 Module</h2>\n<p>아무도 A모듈을 import하지 않지만, A모듈은 B모듈의 코드를 사용하고 있습니다. 이 때, A 모듈의 코드를 변경하면 어떨까요?</p>\n<p>A모듈에서 코드를 아무리 수정해도, 어떤 코드도 영향을 받지 않습니다. 즉, A 모듈은 수정에 자유롭습니다. 우리는 이런 상태를 \"불안정하다\" 라고 합니다.</p>\n<h2>안정적인 Module</h2>\n<p>반면, B 모듈은 A 모듈에서 호출되지만, 아무 모듈도 import하지 않습니다. B모듈의 코드를 수정하면 어떻게 될까요? B모듈의 수정에 따라, A 모듈까지 수정해야 할 경우가 생길 것입니다.</p>\n<p>즉, B모듈은 수정이 자유롭지 않습니다. 우리는 이런 상태를 \"안정적이다\" 라고 합니다.</p>\n<hr>\n<p>그렇다면 모든 모듈이 안정적이면 좋을까요? 그럼 코드를 수정할 수 없으므로 좋지 않습니다. 그럼 모든 모듈이 불안정하면 좋을까요? 좋겠지만 이는 불가능합니다.</p>\n<p>어떤 모듈이 불안정해지면 어떤 모듈은 안정적이게 됩니다.\n따라서 우리는 코드를 불안정한 모듈과 안정한 모듈로 분리해야 합니다.</p>\n<h1>추상화와 구체화</h1>\n<p>잠시 이야기를 넘어와 봅시다.</p>\n<p>다음과 같은 코드를 본 적 있을겁니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Logger</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ConsoleLogger</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Logger</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[Console] </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>interface를 만들고, 그 interface에 맞는 class를 구현 했습니다.</p>\n<p>이 코드에서 userProcessor은 추상화 부분, AdminUserProcessor은 구체화 부분이라 부릅니다.</p>\n<p>왜 굳이 코드를 이렇게 나눌까요?\n그건 바로 인터페이스(추상화 부분)은 안정적이고, 구현체 부분은 불안정하기 때문입니다.</p>\n<h1>추상화를 통한 의존성 제어</h1>\n<p>이제 두 가지 개념을 응용해봅시다.</p>\n<p>아까와 같이 A모듈에서 B모듈을 호출하려 합니다.\n그런데 만약, B모듈이 추상화된 코드를 가지고 있다고 생각해봅시다.</p>\n<p>A모듈에서 B모듈의 추상화를 import하여 사용하면 어떨까요?\n추상화는 안정적이기 때문에 이는 매우 자연스럽습니다.\n추상화된 코드는 변경이 거의 없기 때문에 A모듈이 수정에 영향을 받을 일이 잘 없을 것입니다.</p>\n<p>이런 식으로 코드의 모든 의존을 추상화에 하면 어떨까요? 우리는 구현체를 자유롭게 수정하면서 코딩할 수 있을 것입니다.</p>\n<p>이 개념이 바로 <b>\"의존성 제어\"</b>입니다. 위의 이미지와 같이 의존성의 방향을 바꾸어 설계할 수 있습니다.</p>\n<p>이제 안정적인 부분을 추상화로, 불안정한 부분을 구현체로 코드를 나누는 것에 성공했습니다.</p>\n<p>이는 매우 이상적이지만 한가지 함정이 존재합니다.\n추상화에 의존한다면, 구현체 코드는 모르는것 아닌가요? 실제 코드의 동작은 구현체가 할텐데, 추상화를 import해서 사용하면 코드가 동작하질 않습니다.</p>\n<h1>의존성 주입</h1>\n<p>그래서 필요한 개념이 바로 Dependency Injection(DI), 의존성 주입입니다.\n추상화에 의존하는 모듈들에게, 구현체의 내용을 알려주는 것이죠.</p>\n<p>그럼 어떤 방법으로 의존성을 주입할 수 있을까요?</p>\n<p>위의 예시를 다시 가져와서 알아봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">Logger</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ConsoleLogger</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Logger</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">log</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[Console] </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>message<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>생성자 주입</h2>\n<p>클래스가 생성될 때 필요한 의존성을 전달 받습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> logger<span class=\"token operator\">:</span> Logger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">registerUser</span><span class=\"token punctuation\">(</span>username<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">유저 등록 완료: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>username<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 사용 예시</span>\n<span class=\"token keyword\">const</span> logger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConsoleLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> userService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserService</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nuserService<span class=\"token punctuation\">.</span><span class=\"token function\">registerUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">'홍길동'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>코드를 보면, 클래스에서는 Logger 인터페이스만 사용하지만 외부에서 생성할 때 Logger의 내용을 주입해줍니다.</p>\n<h2>메서드 주입</h2>\n<p>메서드를 호출할 때마다 의존성을 전달해줍니다.\n매번 다른 의존성을 유연하게 전달할 수 있지만, 코드가 복잡해집니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">registerUser</span><span class=\"token punctuation\">(</span>username<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> logger<span class=\"token operator\">:</span> Logger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 유저 등록 로직</span>\n    logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">유저 등록 완료: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>username<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 사용 예시</span>\n<span class=\"token keyword\">const</span> userService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> logger <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConsoleLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nuserService<span class=\"token punctuation\">.</span><span class=\"token function\">registerUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">'홍길동'</span><span class=\"token punctuation\">,</span> logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Setter 주입</h2>\n<p>의존성이 필요한 곳에 Setter를 만들어 나중에 선택적으로 주입합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">UserService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> logger<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Logger<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">setLogger</span><span class=\"token punctuation\">(</span>logger<span class=\"token operator\">:</span> Logger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger <span class=\"token operator\">=</span> logger<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">registerUser</span><span class=\"token punctuation\">(</span>username<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">유저 등록 완료: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>username<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Logger가 없습니다.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 사용 예시</span>\n<span class=\"token keyword\">const</span> userService <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">UserService</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nuserService<span class=\"token punctuation\">.</span><span class=\"token function\">setLogger</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">FileLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nuserService<span class=\"token punctuation\">.</span><span class=\"token function\">registerUser</span><span class=\"token punctuation\">(</span><span class=\"token string\">'홍길동'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>어디서 의존성을 주입할까?</h2>\n<p>의존성을 주입하는 다양한 방법을 알았습니다.\n그러나 한가지 또 고민이 생깁니다.\n어디서 의존성을 주입해줘야 할까요?\n의존성을 주입해주기 위해선 구현체 코드를 호출해야 하는데, 어떻게 보면 구현체에 의존하게 된다고 볼 수 있습니다.</p>\n<p>그래서 보통 의존성 주입은 \"main\" 컴포넌트에서 전부 처리합니다. 이름이 main이 아니어도, 프로그램의 entry point가 그 역할을 하게 됩니다.</p>\n<p>이렇게 하면 얻는 이점은 다음과 같습니다.</p>\n<ul>\n<li>한 곳에서 객체를 생성하여 중앙 집중화 한다.</li>\n<li>의존성의 흐름이 명확해진다.</li>\n<li>구현체에 의존하는 것을 main이 혼자 맡을 수 있다.</li>\n</ul>\n<p>Main은 전체 애플리케이션의 시작점이기 때문에, 여기서 구현체에 의존하고 구현체를 결정하는건 자연스럽습니다.</p>\n<p>비즈니스 로직이 있는 곳에서 구현체에 의존하면 다시 설계의 유연성이 무너지게 될 것입니다.</p>\n<h2>프레임워크</h2>\n<p>추가적으로, Nest.js와 Spring과 같은 프레임워크는 의존성 제어를 간편하게 할 수 있게 도와줍니다.</p>\n<h2>의존성 제어</h2>\n<p>이제 우리는 추상화를 이용해, 코드의 의존성을 제어할 수 있는 능력을 갖췄습니다.</p>\n<p>그렇다면 이제 어떻게 코드의 의존성을 설계할 것인지에 대해 알아봐야 합니다.</p>\n<h1>의존성 방향</h1>\n<p>Clean Architecture에서는 코드의 의존성 방향을 어떻게 설계해야 하는지 제시합니다.</p>\n<p>아래는 아키텍처에 관심이 있다면 한번쯤 봤을법한 이미지입니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 772px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGklEQVR42jVSC08iVxjl//YXNGna3SZtNDAODA/RFdeyul2ooisBBB1lQZgX82IY5gkzAyMyzFOrMX2k7WW3e3Lz5ebmnJx895zYbDYzDMOyLMO0rNnctm1DHRmqoEtDTRHB1MesLgsTZWSZa9oXmCZgWzFFURzHcT0v9L3F3VwzbYIgGKqv8r07ZWBrvDmmLJmeyfRqee+6nvsZnufJshzTNA1cA2+FjyYlbPmmu/yFfdjD/SM8aAu2464eHp/88MEPo6/C/8XAFYh1d7Ws9sT09TzHcbB4vimVE2IlK/RhVH9TJcFCQeC7Ky8IgjAMv8woitZiY6I2MeG74idkXC38U01Lhbf9fJbZ2f3zLDs72bzgKoTp3C8c1zbNqfEVYGFJkmI0y+ZbE3iA7v9bPyOKUiouvvpR3txA67v7f9Xz1mUGnWHseD5mif4tQZLUZ5AkORgMYrU2mevNdqLGoVF6QNKrd9kJWZiUkZdEsnyVT4Ul6BNz2pEZiWz3OhiGdbodhmFARoIgxEpNEkL5ZFA+reV8aEuk95ZhZTp/7+0h1EFq5++PW3iv2BwLls6JIs9xHM/zw+FisdB1PVa6wOGbUeaxcoruRoktvpvzX841vejnU+SH7PYfpymKPEKVcOVEQRQG678Cww+CdVS16z7SNuDJcVos3GeRcBvRzpC7QvIFyWQq8ddCLttXDq6wt+LRnvArodBc6bd2IiE1GipwZphBriZ+Xzn+gUkm6jCbgxwI1tLwbin+apiBmY/xinBL06w9xFV6OjOn1AA7qRgsq2pazDQmF+1+oqZA+EXc2N9+Ok0b73LBceaxDLHHyRurjNLBavnsPT8vn8JFpJ032hCktVprZ12feKv7epdJNU2ow28S5z8z7zeok0QXg1vWUYuZW4bre1MbuFhLy5nzAlGtGoKwdgZFAWXzXadHMYfo6KcD9JvXO98iJ/tNsXU7sOfWY/T72FLy0mFuWMRUWvhQ7mxsyLW6rKrAWQe5DQVhLI44mry5vmo0m5dXlxTRH4/A8wjEw3IsRuLgAOYA1APHKRzXNO0/c/fFNRx0/ScAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250329105503\"\n        title=\"\"\n        src=\"/static/e0f1f90e1b97a08e2a6ab29308781c77/940c5/20250329105503.png\"\n        srcset=\"/static/e0f1f90e1b97a08e2a6ab29308781c77/772e8/20250329105503.png 200w,\n/static/e0f1f90e1b97a08e2a6ab29308781c77/e17e5/20250329105503.png 400w,\n/static/e0f1f90e1b97a08e2a6ab29308781c77/940c5/20250329105503.png 772w\"\n        sizes=\"(max-width: 772px) 100vw, 772px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n위 그림에서 요소를 크게 분리해보자면, 엔티티, 유즈케이스, 어댑터, 세부사항 정도로 나눌 수 있습니다.</p>\n<p>세부사항 -> 어댑터 -> 유즈케이스 -> 엔티티</p>\n<p>와 같은 방향을 따르고, 내부 원에 속한 요소는 외부 원에 대해 어떤 것도 알지 못해야 합니다.</p>\n<p>요소 각각에 대해 한번 알아봅시다.</p>\n<h2>엔티티</h2>\n<p>애플리케이션의 핵심 중의 핵심이 되는 업무 객체입니다.\n예들 들어, 배달 서비스라면 음식점과 주문자 의 존재 정책이 엔티티가 될 수 있습니다.</p>\n<h2>유즈케이스</h2>\n<p>유즈케이스는 애플리케이션의 핵심 업무 객체입니다.\n앤티티는 애플리케이션이 없어도 존재해야 하지만, 유즈케이스는 애플리케이션에서 제공하는 기능입니다.\n\"예를 들면, 장바구니에 음식을 담는다\"와 같은 행위입니다.</p>\n<h2>어댑터</h2>\n<p>유즈케이스가 작동하기 위해서는, 사용자 인터페이스, 데이터베이스와 소통해야 합니다. 유즈케이스가 GUI와 데이터베이스 사이에서 브릿지 역할을 해 주는 것이 어댑터 레이어입니다.\nController와 같은 코드들이 어댑터가 될 수 있습니다.</p>\n<h2>세부사항</h2>\n<p>웹, 데이터베이스, 프레임워크 등입니다.\n그리고 언제든지 바뀔 수 있는 것들입니다.\n예를 들면, 데이터베이스를 MongoDB에서 MySQL로 바꿔야 할 수 있습니다.</p>\n<p>클린 아키텍처를 적용하면 이런 세부사항의 결정을 끝까지 미룰 수 있고, 언제든 바꿀 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 772px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADGklEQVR42jVSC08iVxjl//YXNGna3SZtNDAODA/RFdeyul2ooisBBB1lQZgX82IY5gkzAyMyzFOrMX2k7WW3e3Lz5ebmnJx895zYbDYzDMOyLMO0rNnctm1DHRmqoEtDTRHB1MesLgsTZWSZa9oXmCZgWzFFURzHcT0v9L3F3VwzbYIgGKqv8r07ZWBrvDmmLJmeyfRqee+6nvsZnufJshzTNA1cA2+FjyYlbPmmu/yFfdjD/SM8aAu2464eHp/88MEPo6/C/8XAFYh1d7Ws9sT09TzHcbB4vimVE2IlK/RhVH9TJcFCQeC7Ky8IgjAMv8woitZiY6I2MeG74idkXC38U01Lhbf9fJbZ2f3zLDs72bzgKoTp3C8c1zbNqfEVYGFJkmI0y+ZbE3iA7v9bPyOKUiouvvpR3txA67v7f9Xz1mUGnWHseD5mif4tQZLUZ5AkORgMYrU2mevNdqLGoVF6QNKrd9kJWZiUkZdEsnyVT4Ul6BNz2pEZiWz3OhiGdbodhmFARoIgxEpNEkL5ZFA+reV8aEuk95ZhZTp/7+0h1EFq5++PW3iv2BwLls6JIs9xHM/zw+FisdB1PVa6wOGbUeaxcoruRoktvpvzX841vejnU+SH7PYfpymKPEKVcOVEQRQG678Cww+CdVS16z7SNuDJcVos3GeRcBvRzpC7QvIFyWQq8ddCLttXDq6wt+LRnvArodBc6bd2IiE1GipwZphBriZ+Xzn+gUkm6jCbgxwI1tLwbin+apiBmY/xinBL06w9xFV6OjOn1AA7qRgsq2pazDQmF+1+oqZA+EXc2N9+Ok0b73LBceaxDLHHyRurjNLBavnsPT8vn8JFpJ032hCktVprZ12feKv7epdJNU2ow28S5z8z7zeok0QXg1vWUYuZW4bre1MbuFhLy5nzAlGtGoKwdgZFAWXzXadHMYfo6KcD9JvXO98iJ/tNsXU7sOfWY/T72FLy0mFuWMRUWvhQ7mxsyLW6rKrAWQe5DQVhLI44mry5vmo0m5dXlxTRH4/A8wjEw3IsRuLgAOYA1APHKRzXNO0/c/fFNRx0/ScAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250329105503\"\n        title=\"\"\n        src=\"/static/e0f1f90e1b97a08e2a6ab29308781c77/940c5/20250329105503.png\"\n        srcset=\"/static/e0f1f90e1b97a08e2a6ab29308781c77/772e8/20250329105503.png 200w,\n/static/e0f1f90e1b97a08e2a6ab29308781c77/e17e5/20250329105503.png 400w,\n/static/e0f1f90e1b97a08e2a6ab29308781c77/940c5/20250329105503.png 772w\"\n        sizes=\"(max-width: 772px) 100vw, 772px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n이미지의 오른쪽 아래 그림을 살펴봅시다.\nController에서 입력이 들어오면, 그걸 use case로 전달하여 처리하고, presenter로 전송하는게 자연스럽습니다.</p>\n<p>그러나 이를 위해서는 UseCase가 Presenter를 알아야 합니다.\n내부 원이 바깥쪽 요소를 알지 않아야 한다는 철학을 지키기 위해, 우리는 의존성 역전 개념을 사용하여, UseCase가 Presenter에 의존하지 않게 만들 수 있습니다.</p>\n<p>이런식으로 의존성 흐름을 제어하여 위 이미지와 같은 의존 흐름을 만드는 것이 Clean Architecture의 기본 개념입니다.</p>\n<h1>코드를 통해 Clean Architecture를 설계해보자</h1>\n<p>제가 운영중인 서비스에는 단순한 채팅 기능이 있습니다.\n이 모듈이 단순한 Entity를 유지하고 있으므로, 예시로 사용해보겠습니다.</p>\n<p>아래 코드에서 확인할 부분은 데이터베이스 의존성을 제거한 부분입니다.\n엔티티의 정의와 세부사항을 정하는 코드를 확인해보면 좋습니다.</p>\n<h2>엔티티를 정의하자</h2>\n<p>서비스를 만들 때, 가장 먼저 Entity를 설계해야 합니다.\nEntity는 애플리케이션이 존재하지 않아도 존재해야 합니다.</p>\n<p>채팅 기능이라면, 아래와 같은 Entity를 가질 수 있습니다.</p>\n<p>/entities/Chat.ts</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">ChatStatus</span> <span class=\"token operator\">=</span> <span class=\"token string\">'normal'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'inactive'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'deleted'</span><span class=\"token punctuation\">;</span>\n  \n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ChatProps</span> <span class=\"token punctuation\">{</span>\n  user1<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> IUser<span class=\"token punctuation\">;</span>\n  user2<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> IUser<span class=\"token punctuation\">;</span>\n  status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> ChatStatus<span class=\"token punctuation\">;</span>\n  contents<span class=\"token operator\">:</span> ContentProps<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n  \n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Chat</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> props<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    user1<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> IUser<span class=\"token punctuation\">;</span>\n    user2<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> IUser<span class=\"token punctuation\">;</span>\n    status<span class=\"token operator\">:</span> ChatStatus<span class=\"token punctuation\">;</span>\n    contents<span class=\"token operator\">:</span> Content<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> ChatProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      user1<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>user1<span class=\"token punctuation\">,</span>\n      user2<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>user2<span class=\"token punctuation\">,</span>\n      status<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>status <span class=\"token operator\">??</span> <span class=\"token string\">'normal'</span><span class=\"token punctuation\">,</span>\n      contets<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>contents <span class=\"token operator\">??</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Content</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token comment\">//getter</span>\n\n  <span class=\"token function\">addContent</span><span class=\"token punctuation\">(</span>contentProps<span class=\"token operator\">:</span> ContentProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Content</span><span class=\"token punctuation\">(</span>contentProps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>contents<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token comment\">// 도메인 엔티티 -> DTO or primitive 변환</span>\n  <span class=\"token function\">toPrimitives</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ChatProps <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      user1<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>user1<span class=\"token punctuation\">,</span>\n      user2<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>user2<span class=\"token punctuation\">,</span>\n      status<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">,</span>\n      contents<span class=\"token operator\">:</span> tis<span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>contents<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> c<span class=\"token punctuation\">.</span><span class=\"token function\">toPrimitives</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>/entities/Content.ts</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ContentProps</span> <span class=\"token punctuation\">{</span>\n  userId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  content<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n  \n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Content</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> props<span class=\"token operator\">:</span> Required<span class=\"token operator\">&lt;</span>ContentProps<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>props<span class=\"token operator\">:</span> ContentProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      userId<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>userId<span class=\"token punctuation\">,</span>\n      content<span class=\"token operator\">:</span> props<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">get</span> <span class=\"token function\">userId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>userId<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">get</span> <span class=\"token function\">content</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token function\">toPrimitives</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ContentProps <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>먼저, Chat은 하나의 채팅방 역할을 합니다.\n다음으로 Content는 채팅방에서 하나하나의 채팅을 의미합니다.</p>\n<p>엔티티를 설계할 때는 Entity가 가지는 필수 요소를 정의하고, 생성자를 정의합니다. 이 때 생성자에서 데이터 무결성을 위한 검사를 할 수 있습니다.</p>\n<p>그리고, addContent와 같은 데이터 무결성을 위한 약간의 비즈니스 로직이 포함될 수 있습니다. 이 부분도 완전히 제거하는 편이 좋을 수 있는데, 저는 포함하여 사용중입니다.</p>\n<h2>유즈케이스를 정의하자</h2>\n<p>유즈케이스는 service 코드를 정의하여 사용하고 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChatService</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">//repository DI</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">ICHAT_REPOSITORY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> chatRepository<span class=\"token operator\">:</span> IChatRepository<span class=\"token punctuation\">,</span>\n\t<span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">async</span> <span class=\"token function\">getChat</span><span class=\"token punctuation\">(</span>userId<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> RequestContext<span class=\"token punctuation\">.</span><span class=\"token function\">getDecodedToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">const</span> user1 <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>id <span class=\"token operator\">></span> userId <span class=\"token operator\">?</span> userId <span class=\"token operator\">:</span> token<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> user2 <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>id <span class=\"token operator\">&lt;</span> userId <span class=\"token operator\">?</span> userId <span class=\"token operator\">:</span> token<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">const</span> chat <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>chatRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByUser1AndUser2WithUser</span><span class=\"token punctuation\">(</span>\n      user1<span class=\"token punctuation\">,</span>\n      user2<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>chat<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">can't find chat </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user1<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> and </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>user2<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">const</span> opponent <span class=\"token operator\">=</span>\n      <span class=\"token punctuation\">(</span>chat<span class=\"token punctuation\">.</span>user1 <span class=\"token keyword\">as</span> IUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>_id <span class=\"token operator\">==</span> token<span class=\"token punctuation\">.</span>id\n        <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>chat<span class=\"token punctuation\">.</span>user2 <span class=\"token keyword\">as</span> IUser<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>chat<span class=\"token punctuation\">.</span>user1 <span class=\"token keyword\">as</span> IUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">const</span> conversationForm <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> opponent<span class=\"token punctuation\">,</span> contents<span class=\"token operator\">:</span> chat<span class=\"token punctuation\">.</span>contents <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> conversationForm<span class=\"token punctuation\">;</span>\n\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>데이터베이스에 접근하는 코드를 의존성 주입하여 사용하고 있습니다.\ngetChat에서 비즈니스 로직을 수행하고, 결과를 반환합니다.</p>\n<h2>어댑터를 정의하자.</h2>\n<p>어댑터로는 Controller를 사용하고 있습니다.\n클라이언트의 입력을 Service로 전달해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Controller</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'chat'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChatContoller</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> chatService<span class=\"token operator\">:</span> ChatService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Get</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">getChat</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Query</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> getChatDTO<span class=\"token operator\">:</span> GetChatDTO<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> toUid <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> getChatDTO<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>chatService<span class=\"token punctuation\">.</span><span class=\"token function\">getChat</span><span class=\"token punctuation\">(</span>toUid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>크게 확인할 부분은 없습니다.</p>\n<h2>세부사항을 정의하자</h2>\n<p>여기에서 말하는 세부사항은 어떤 DB를 쓸 것인가? 와 같은 문제입니다.\n저는 MongoDB를 사용할 것인데, 나중에 MySQL과 같은 DB로 옮길것을 대비해서 DB의 의존성을 제거하고 싶습니다.\n다음과 같이 해 볼 수 있습니다.</p>\n<p>먼저 Service 코드에서 MongoDB에 접근하는 코드를 직접 호출하면, service 코드가 세부사항을 알아야 하므로, Clean Architecture가 지켜지지 않습니다.</p>\n<p>따라서 의존성을 역전시키기 위한 interface를 정의해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IChatRepository</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">findByUser1AndUser2WithUser</span><span class=\"token punctuation\">(</span>\n    user1Id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    user2Id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Chat <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 나머지 코드</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>구현체도 만들어줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChatRepository</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">IChatRepository</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">InjectModel</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'Chat'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> ChatModel<span class=\"token operator\">:</span> Model<span class=\"token operator\">&lt;</span>IChat<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">async</span> <span class=\"token function\">findByUser1AndUser2WithUser</span><span class=\"token punctuation\">(</span>\n    user1Id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n    user2Id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Chat <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> doc <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ChatModel<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      user1<span class=\"token operator\">:</span> user1Id<span class=\"token punctuation\">,</span>\n      user2<span class=\"token operator\">:</span> user2Id<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">populate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'user1 user2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>doc<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">mapToDomain</span><span class=\"token punctuation\">(</span>doc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n <span class=\"token keyword\">private</span> <span class=\"token function\">mapToDomain</span><span class=\"token punctuation\">(</span>doc<span class=\"token operator\">:</span> IChat<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Chat <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> chat <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Chat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      user1<span class=\"token operator\">:</span> doc<span class=\"token punctuation\">.</span>user1<span class=\"token punctuation\">,</span>\n      user2<span class=\"token operator\">:</span> doc<span class=\"token punctuation\">.</span>user2<span class=\"token punctuation\">,</span>\n      status<span class=\"token operator\">:</span> doc<span class=\"token punctuation\">.</span>status<span class=\"token punctuation\">,</span>\n      contents<span class=\"token operator\">:</span> doc<span class=\"token punctuation\">.</span>contents<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        userId<span class=\"token operator\">:</span> c<span class=\"token punctuation\">.</span>userId<span class=\"token punctuation\">,</span>\n        content<span class=\"token operator\">:</span> c<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">,</span>\n        createdAt<span class=\"token operator\">:</span> c<span class=\"token punctuation\">.</span>createdAt<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">return</span> chat<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>구현체에서 주의해야 할 부분은, Repository는 Entity를 반환해야 한다는 점입니다. Entity가 아닌 DB에서 읽은 데이터를 그대로 반환한다면, 그 코드를 사용하는 Service는 결국 DB에 의존하게 되어버립니다.</p>\n<p>이제 DB를 MySQL로 바꾸고 싶다면 어떻게 할까요?\nChatRepository대신 MySQLChatRepository를 작성하고, 의존성 주입을 해주면 끝입니다. 다른 모듈은 ChatRepository에 직접 의존하지 않으므로 변경에 영향을 받지 않습니다.</p>\n<h1>Clean Architecture를 어떻게 더 적용해볼까?</h1>\n<p>지금까지 간단한 코드로 어떤 느낌으로 DB의존성을 제거하는지 살펴보았습니다.</p>\n<p>의존성을 제어하는 방법을 잘 사용한다면, 더 다양한 세부사항에 대한 결정을 미룰 수 있습니다.</p>\n<p>예를 들면, 결제 기능을 구현할 때 Interface를 정의해둔다면 어떤 결제 서비스를 이용할지 와 같은 결정은 멀리 미뤄둘 수 있습니다.</p>\n<p>코드들이 추상화에만 의존하게 되니 변경도 훨씬 자유로울것이고, 유지보수 역시 훨씬 편해질 것입니다.</p>\n<p>즉, 처음에 우리가 달성하고자 했던 목표를 많이 달성했습니다.</p>\n<p>이 포스팅에서 설명한 내용이 전부는 아닙니다.\nFP, OOP등도 적용하고, SOLID 원칙 같은것도 적용하면 더 좋은 코드를 만들 수 있습니다.</p>\n<p>저도 처음부터 클린아키텍처를 적용하며 서비스를 만들었으면 좋았겠지만, 당시에는 이런 개념을 몰랐었기에 이제서야 하나씩 리팩토링 해 가고 있습니다.</p>\n<p>앞으로도 다양한 개념들을 적용하며, 더 나은 구조에 대해 탐구해보겠습니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-03-28T00:00:00.000Z","slug":"/blog/about/clean","title":"Clean Architecture with Nest.js"}}},{"node":{"html":"<h1>시간이 오래걸리는 API를 찾아내보자</h1>\n<p>현재 About 서비스는 Docker에서 생성되는 모든 로그를 ELK 스택으로 수집하고 분석하고 있습니다.\n원래는 단순하게 에러 로그만 수집하여 사용했는데, 이를 잘 활용하면 각 API의 처리 속도도 분석해볼 수 있겠다 생각했습니다.</p>\n<p>이를 위해서는 먼저 Nest.js로 들어오는 모든 요청의 URL과 실행 시간을 로깅해야 합니다.\n그래서 다음과 같은 middleware를 두었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">LoggingMiddleware</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestMiddleware</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">WINSTON_MODULE_PROVIDER</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> logger<span class=\"token operator\">:</span> LoggerService<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  <span class=\"token function\">use</span><span class=\"token punctuation\">(</span>req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span> res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span> next<span class=\"token operator\">:</span> NextFunction<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> startTime <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token comment\">// 요청 로깅 (JSON 형식)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      timestamp<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      level<span class=\"token operator\">:</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token string\">'Incoming Request'</span><span class=\"token punctuation\">,</span>\n      method<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n      url<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>originalUrl<span class=\"token punctuation\">,</span>\n      ip<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>ip<span class=\"token punctuation\">,</span>\n      userAgent<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>headers<span class=\"token punctuation\">[</span><span class=\"token string\">'user-agent'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      body<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    res<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'finish'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> duration <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> startTime<span class=\"token punctuation\">;</span>\n  \n      <span class=\"token comment\">// 응답 로깅 (JSON 형식)</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        timestamp<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        level<span class=\"token operator\">:</span> <span class=\"token string\">'info'</span><span class=\"token punctuation\">,</span>\n        message<span class=\"token operator\">:</span> <span class=\"token string\">'Outgoing Response'</span><span class=\"token punctuation\">,</span>\n        method<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">,</span>\n        url<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>originalUrl<span class=\"token punctuation\">,</span>\n        statusCode<span class=\"token operator\">:</span> res<span class=\"token punctuation\">.</span>statusCode<span class=\"token punctuation\">,</span>\n        duration<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>duration<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>요청이 들어올 때, ip timestamp url등의 정보를 기록합니다.</li>\n<li>요청이 종료될 때, url과 duration등의 정보를 기록합니다.</li>\n</ul>\n<p>이 middleware를 Global로 적용한다면, 들어오고 나가는 모든 요청을 로깅하게 됩니다.</p>\n<h1>이 로그를 Kibana에서 어떻게 시각화할 수 있을까요?</h1>\n<p>ELK 스택은 잘 구성돼있다 가정하겠습니다.</p>\n<p>먼저, ElasticSearch는 인덱스 생성 시 특별한 설정이 없다면 데이터를 text타입으로 저장합니다. 이 text 타입은 문자가 분해되어 저장되기 때문에, 시각화에 사용하기 어렵습니다. 그래서 시각화할 필드의 타입을 다르게 바꿔줘야 합니다.</p>\n<p>타입은 수정이 불가능하기 때문에, reindexing 하는 과정이 필요합니다.\n아래 명령은 새로운 template를 적용하는 명령입니다. 이 template이 적용된 후 생성되는 index에는 변경된 타입이 반영됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PUT _template/nest-logs-template\n{\n  \"index_patterns\": [\"nest-logs-*\"], \n  \"mappings\": {\n    \"properties\": {\n      \"parsed_json.duration\": {\n        \"type\": \"integer\"\n      }\n    }\n  }\n}\n\nPUT _template/nest-logs-template\n{\n  \"index_patterns\": [\"nest-logs-*\"], \n  \"mappings\": {\n    \"properties\": {\n      \"parsed_json.url\": {\n        \"type\": \"keyword\"\n      }\n    }\n  }\n}</code></pre></div>\n<ul>\n<li>먼저,  Duration 필드를 integer type으로 지정합니다. 숫자 타입으로 인식되기 때문에, 최대값, 평균값등 분석에 사용할 수 있습니다.</li>\n<li>url 필드를 keyword type으로 지정합니다. 문자열은 기본적으로 text 타입으로 저장되어 tokenize되지만, keyword type을 지정하면 문자 자체를 저장합니다. 따라서 url을 분석 대상으로 사용할 수 있습니다.</li>\n</ul>\n<p>다음으로, 기존 index들을 reindexing 해줘야 합니다. template이 적용돼있으므로 바뀐 type이 적용된 index가 생성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST _reindex\n{\n  \"source\": {\n    \"index\": \"nest-logs-2025.03.09\"\n  },\n  \"dest\": {\n    \"index\": \"nest-logs-2025.03.09-reindexed\"\n  }\n}</code></pre></div>\n<p>이 과정이 모두 성공했으면 이제 url과 duration을 시각화에 사용할 수 있습니다.</p>\n<p>이제 아래의 과정을 거치면 각 url 별로, 평균 처리 시간을 확인할 수 있습니다.</p>\n<ol>\n<li>햄버거 메뉴에서 visualization library를 선택하여 create 버튼을 누른 후, Lens를 선택합니다.</li>\n<li>parsed_json.url(이름 다를 수 있음) 필드를 드래그 하여 놓으면, Horizontal axis가 \"Top values of parsed_json.url\"로 설정됩니다.</li>\n<li>오른쪽의 Vertical axios 를 선택한 후, Average와 parsed_json.duration을 선택합니다.</li>\n</ol>\n<p>그럼 아래와 같은 그래프가 완성됩니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/0lEQVR42p1SS2vVQBjNv1TQiii4KAouXBaEIq6LuFCwFBTswi4q4gUflZaqVPG+tLSXUrC3tbmvPCfJTGYyk+M3ydVWfCwcOJnXN+c7J9/nHEQRel6MQz+HOw6Qpim0MSi0/i84k0ggTARtLEkJVZgKdm0hla72UpnprP8JJ2YZYiK0wbkswHOFKM0QRgkY3Rk651xBSg0hFESuK/K/wUnocS5VpVCqAqmQ9EiioDUTGfqRT0lkbanQ0BRnTPlH2DsnICVeEIOTOqsgizPosoQdndEhzjUW4bK4ym6qcwsznek7jf2xdvyQ4eh4gCBOkDGO1GN1OClsDvo4//wBxiwh65gS4heC3wgznsPzA4wmHhSRKJJtq6zJZmvYx6XGEr6MjrHvjdHb7aHb/Yx2u41Wq4WMftdplRUhSzK4gyGCIETGBXIqilVSUKKm+xWza8tY3H6HhQ8vMHdrHleuzuLshRmcuTiDZx/fVkTGmBPCJOXwSWFEljkR2tLracCnwQEuv3yI+50NLDTXcO3VY8xvPsX118u4ubmKG+tPaqLTllnCEYQxUi6hbNsw8ZNw13Nxe6uB1b0OVvZauNN+g0c7W7jbWcfS9nvc626gMz7CtySolVrC0SSAO/QgqN8YFSTcH9YZy9pKSe1gYYcUOVIqkCBXtj9tjDTkqDyx/B05Vj0YtgqCjgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250317172315\"\n        title=\"\"\n        src=\"/static/8c84ef6528d211c07e190034f54bef68/5a190/20250317172315.png\"\n        srcset=\"/static/8c84ef6528d211c07e190034f54bef68/772e8/20250317172315.png 200w,\n/static/8c84ef6528d211c07e190034f54bef68/e17e5/20250317172315.png 400w,\n/static/8c84ef6528d211c07e190034f54bef68/5a190/20250317172315.png 800w,\n/static/8c84ef6528d211c07e190034f54bef68/c1b63/20250317172315.png 1200w,\n/static/8c84ef6528d211c07e190034f54bef68/29007/20250317172315.png 1600w,\n/static/8c84ef6528d211c07e190034f54bef68/9efb3/20250317172315.png 1894w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>먼저 시간이 가장 오래걸린 /admin/user/~는 모든 유저 정보를 가져오는 관리자가 사용하는 api입니다. 속도가 느려도 유저들이 체감할 수 없습니다.</p>\n<p>그 다음으로 속도가 느린 api는 /groupstudy/snapshot 요청입니다. Groupstudy의 데이터를 populate해서 전부 가져오는 요청인데, 자주 호출되고 매우 큰 양의 데이터를 가져옵니다. 이 api의 속도를 한번 개선해봅시다.</p>\n<h1>Redis 캐싱을 적용해보자.</h1>\n<p>/groupstudy/snapshot은 groupstudy의 모든 데이터를 가져온 후, 메인페이지에서 사용하기 좋게 가공하는 과정을 포함합니다. groupstudy의 모든 데이터가 양이 크고 가공하는 로직이 포함돼있어서 시간이 오래걸린다고 생각해볼 수 있습니다.</p>\n<p>그렇다면 가공된 데이터 전체를 Redis에 캐싱하면 어떨까요?</p>\n<p>아래 이미지는 /groupstudy/snapshot api를 로컬에서 여러번 실행했을 때 걸리는 시간입니다. 보통 800ms 전후로 실행되는걸 확인할 수 있었습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 132%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEHElEQVR42mVV6ZKzNhDkHbZqvcbG5hCHAQFCHDbGleT9H2rSLbC/TeXHFELSNN1z4embkhqmi0TSJBQVhtLebpIWhaRZJtcgED/OpLi/xBgjrelFYf/w8yOH74PEcSwZ3uMoEqWUeFmaSttb6Rsttiyk0bV0sCxVksa4lMRyxUdoeYa7TYPzyhmBU/gT8Bycpaoq8aIoFlXUkueZVHkqZaakgtVY13j2XescgstFcjAwYG+0FlMDtK6lx3qExdcrMHLxSDlWoVyuFzmfA9hZTjA+/dNJyrL8AKZJIg1CoeCcgnEGS66hFDhXOOM9LwJg2xoZplmatgOjTixiNdheuraVvu9dbAhIJ7IbsUfj2uL+fVmk1vWbYSKq7KWyq1T9Ik/bwVr5e+pFlzdc1C5OAZKj8LTDIPP9Lg+A8NlbK/M8Swfgj2SVJwh6hMBenCPlBk6y7y45hthPwNAO1mV7APA4jmIBSGNCnOQkUcickXG6O+m23+SOuGTwVV5MfgEaSO0AqNtGWpxzTXYFYkvzlEolcZJfsKeTvOySm6qUEMyvSMIFMWSJNcgss12C+Q3GNVUwLE4yv67yGI4hJAdyQmadZNQV12RGQFoOpxF1WIOphl+FZwmrwIzVsAFSsqbkGRI2ydZ02EONYc24kB0BmeUHQtGhFglUArTAU+1dsklOMye5pORhlXUwTvZfI9qshuRok8xOKeA0wcmCicGHWqzZORnemUTHMMdmskumvHdRf7L9SzIL2yBJLcygpNq9UzTsBtaO4R/Je5Yhd+i3LPfmj2QyTckQjGgWYA8U/sBGQClF7HUypGRVDZD7gmxkeehkheR/kOW22iQTkPXKjN7htIANbUAiHijuW1m5BDpApjuKwABM6RyH1z0JFzyDT0IinBFwAsjMAQHnARNqnSaXpAihcYDbLEPjl9rJu6XJJ2bv+vvEEIANnDOCs8NgF7Ykngbyd8ko7CxydccEBL8AfgOSfQZAC4a0DsZOqTDGNGcpYu4AL3s2ORfDKHTr4/H4P/vBhOYZQ8QWZMx838cHEQ500/Ho72XD9mEdgQk3ff8PCB3842bvD3H0v8+OWJ+CqyzLC00wwgbxpnlyzd0iBoZdYrdp0rD5sad14+qs0ds7x9dmVmqUToL4kfH7V+A9Hg9pUFecbwQqEPQE/xHGk/F7F/b5fPoU+6fw+QMD0+/vb/n6+nLN4T3doJxlwGzjoLQoas66eX7I87m69bquMuGM58tzgcRFJpQLp3mEH9nhcHCgLC2PzCiFF8Zxu8R3thKNMlKMuKLY3jXUUBHDxB4meybsA/haXw5kWZ6OTbWPIf6TCcDYlOhdvnM/y3LXsyw3ThiG5T+A2+gmQLoBZKlz4Hwr8U4Qrt8DlPd5b9tTW7aRdQKyPf8FL433aB9NzboAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250315155814\"\n        title=\"\"\n        src=\"/static/1898d6c830ee483661ac32ba0a4a4bc7/5a190/20250315155814.png\"\n        srcset=\"/static/1898d6c830ee483661ac32ba0a4a4bc7/772e8/20250315155814.png 200w,\n/static/1898d6c830ee483661ac32ba0a4a4bc7/e17e5/20250315155814.png 400w,\n/static/1898d6c830ee483661ac32ba0a4a4bc7/5a190/20250315155814.png 800w,\n/static/1898d6c830ee483661ac32ba0a4a4bc7/ae77d/20250315155814.png 1111w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>한번 코드에 Redis 캐싱을 적용해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token function\">getGroupStudySnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">let</span> groupStudyData<span class=\"token punctuation\">;</span>\n\tgroupStudyData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redisClient<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token constant\">GROUPSTUDY_FULL_DATA_KEY</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>groupStudyData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>groupStudyData<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n\t<span class=\"token comment\">//그 외 로직</span>\n\t\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redisClient<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>\n      <span class=\"token constant\">GROUPSTUDY_FULL_DATA_KEY</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">//returnVal은 최종 가공된 데이터가 들어갑니다.</span>\n      <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>returnVal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'EX'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n\t<span class=\"token keyword\">return</span> returnVal<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Redis가 적용되는 로직만 작성했습니다.\nGROUPSTUDY_FULL_DATA_KEY값의 데이터가 있는지 확인하고, 있다면 그 값을 return 합니다.\n그리고 데이터가 없다면, 모든 과정을 마친 후 최종 데이터를 GROUPSTUDY_FULL_DATA_KEY를 key로하여 저장합니다.</p>\n<h1>이제 API 요청이 빨라졌을까?</h1>\n<p>결론부터 말하면, 이 방식을 적용한 후 오히려 API 응답 속도가 1000ms대로 느려졌습니다(로컬 기준).</p>\n<p>그 원인에 대해 생각해본 결과, 최종 결과 데이터가 너무 크기 때문에 네트워크 전송 속도, Redis에서 읽고 쓰는 속도 등이 영향을 준 것이 아닐까 생각했습니다.</p>\n<p>그렇다면 이를 어떻게 해결할 수 있을까요?\n압축을 사용하면 됩니다.</p>\n<h1>데이터를 압축하여 다시 캐싱해보자</h1>\n<p>아래는 수정된 코드입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> gzip <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>zlib<span class=\"token punctuation\">.</span>gzip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> gunzip <span class=\"token operator\">=</span> <span class=\"token function\">promisify</span><span class=\"token punctuation\">(</span>zlib<span class=\"token punctuation\">.</span>gunzip<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token function\">getGroupStudySnapshot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">let</span> groupStudyData<span class=\"token punctuation\">;</span>\n    groupStudyData <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redisClient<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token constant\">GROUPSTUDY_FULL_DATA</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>groupStudyData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>\n        <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">gunzip</span><span class=\"token punctuation\">(</span>Buffer<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span>groupStudyData<span class=\"token punctuation\">,</span> <span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n   <span class=\"token comment\">//그 외 로직</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redisClient<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>\n      <span class=\"token constant\">GROUPSTUDY_FULL_DATA</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">await</span> <span class=\"token function\">gzip</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>returnVal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token string\">'base64'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'EX'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">return</span> retuenVal<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>압축을 위해 zlib 라이브러리를 사용했습니다.</p>\n<p>압축한 데이터를 캐싱하는 코드를 적용했습니다. 추가적인 처리를 하고 실행시간을 확인해봅시다.</p>\n<h1>캐싱된 데이터에 추가적인 처리가 필요합니다.</h1>\n<p>캐싱기능이 완료됐을까요? 아직 아닙니다.\n캐싱은 말 그대로 데이터를 그대로 캐시에 저장하고 있는 것입니다.\n데이터에 변경이 일어나도 캐싱된 데이터는 변경되지 않기때문에, 이 부분의 처리가 필요합니다.\n지금은 누군가 groupstudy를 만들거나 참여해도, 유저한테 보이지 않을 것입니다.</p>\n<p>저는 이 문제를 /groupstudy로 GET이 아닌 요청이 들어올 경우, 캐싱된 데이터를 삭제하여 해결했습니다.</p>\n<p>Nest.js에서는 middleware로 이 문제를 해결해도 되고, Interceptor로 해결할 수도 있습니다. 저는 Interceptor 방식을 선택했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GroupStudyInterceptor</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">NestInterceptor</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">REDIS_CLIENT</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> redisClient<span class=\"token operator\">:</span> Redis<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token function\">intercept</span><span class=\"token punctuation\">(</span>\n    context<span class=\"token operator\">:</span> ExecutionContext<span class=\"token punctuation\">,</span>\n    next<span class=\"token operator\">:</span> CallHandler<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Observable<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>Observable<span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">>></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">switchToHttp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">startsWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/groupStudy'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> request<span class=\"token punctuation\">.</span>method <span class=\"token operator\">!==</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redisClient<span class=\"token punctuation\">.</span><span class=\"token function\">del</span><span class=\"token punctuation\">(</span><span class=\"token constant\">GROUPSTUDY_FULL_DATA</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> next<span class=\"token punctuation\">.</span><span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">UseInterceptors</span></span><span class=\"token punctuation\">(</span>GroupStudyInterceptor<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">GroupStudyController</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 Interceptor를 적용해두면, groupstudy 데이터가 변경되면 캐싱된 데이터가 사라집니다.</p>\n<h1>결과를 확인해보자</h1>\n<p>아래는 캐싱 적용전 /groupStudy/snapshot으로 들어오는 요청의 처리시간입니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABT0lEQVR42pWT206DQBRF+/9vJmo1KjYxvvbJxGv6BX5JWxgY5sJc4LhnoBUK2kAyIenMXqx9Cos851QUnOq6oXA1ze8KvxljqaoMOecn9hryfphbhMNZlpMQinRVkbUOG+2ucy4+rCwFwqYL1vFuraDtdo3sGg/87oA1gDiodUVCSgRltAnAsLz3EdqCmm7VMex8SXmRUJpeI/fanfEtUClNEkAhZDTpA621PVgP6ADMH2F4i9xnDwgjKVWE8bIcGQYgTQI5YHe0318ODcPQtYahUrMMPSoXxTNlbAWhzdBQBVicoRgBTQDSdGXGHroZvg0NVWc3b4aozO4BvBoDY2V5qGxnVH6KllJ+9YFnKpu/DRlbwvACIi8nlY+GgqpZrw3+lGyF3ObUUP87Q6KpyuGTTQBcQuZ9+GIf5ldOAKcqhytUTtOEdrsb4vzjCPwBkLXxW7ZJqgsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250318124533\"\n        title=\"\"\n        src=\"/static/b65a2fee19dbb09a06b88cef15de72b4/5a190/20250318124533.png\"\n        srcset=\"/static/b65a2fee19dbb09a06b88cef15de72b4/772e8/20250318124533.png 200w,\n/static/b65a2fee19dbb09a06b88cef15de72b4/e17e5/20250318124533.png 400w,\n/static/b65a2fee19dbb09a06b88cef15de72b4/5a190/20250318124533.png 800w,\n/static/b65a2fee19dbb09a06b88cef15de72b4/c1b63/20250318124533.png 1200w,\n/static/b65a2fee19dbb09a06b88cef15de72b4/ccd6a/20250318124533.png 1549w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n평균을 구해보면 225.2초입니다.</p>\n<p>아래는 캐싱 적용 후 요청의 처리시간입니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABbUlEQVR42pWTy07DMBBF+/Ns2NBNEQKJCoQAIcGCBRJiCf/AP/TpJLZjx3aGO06axiGiJZJVNbFPzp2ZTITIaLsV5L2nuq6TFUIgYwzpsqSqcr+elaUlG+9Td39ijCUhBCldkrGWnNsf5JfkeUFSKrJ4xlddh/jrnKH1+gtnP/HS7xYaAMRGhhVSUlEUVMKIOmCI0Aa0swvxsPcKyWa0Wp1Slj22ezxNrK1iJKU1aSw2qXtA54al2AE1QE8wvEGCj84+ApXSMRYbcgkOAZvIbHiB2Gcoy/PAEGZSqbhSQ5/UdGgoxB2gVxB5Sw37wNTwb2CWjQAZEOOiKdxRjQYdAvLFTdlsLmm5nAL8MtKUto7DpgznLzV8gOEc5977kS3prikyDvJxkRVqOEdTzpHstW9oo10BYA7gMU3Zd/maVuvZEFjhE2rmkMH8/39zeJvOIUeU3BDMYJbnsZ59Q64hto4YSsSd0mJxAuh9Z/gDuErxKpOEV+0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250318124603\"\n        title=\"\"\n        src=\"/static/c41b2d894e697dd8e50140bf9804e1e5/5a190/20250318124603.png\"\n        srcset=\"/static/c41b2d894e697dd8e50140bf9804e1e5/772e8/20250318124603.png 200w,\n/static/c41b2d894e697dd8e50140bf9804e1e5/e17e5/20250318124603.png 400w,\n/static/c41b2d894e697dd8e50140bf9804e1e5/5a190/20250318124603.png 800w,\n/static/c41b2d894e697dd8e50140bf9804e1e5/c1b63/20250318124603.png 1200w,\n/static/c41b2d894e697dd8e50140bf9804e1e5/280a1/20250318124603.png 1545w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n평균을 구해보면 104.9입니다.</p>\n<p>처리시간을 2배이상 줄일 수 있었습니다.\n단순히 봐도 처리시간이 확연히 준 것을 알 수 있습니다.</p>\n<h1>앞으로는?</h1>\n<p>제가 사용중인 Redis 서버는 Ram 1GB 인스턴스에서 작동하고 있습니다.\n그래서 많은 데이터를 캐싱하기에는 좋지 않습니다.\n앞으로 같은 방법으로 duration 분석을 통해, 시간이 오래 걸리는 요청을 찾아내고, 그 부분을 캐싱하는 방식으로 활용해보려 합니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-03-16T00:00:00.000Z","slug":"/blog/about/caching","title":"시간이 오래걸리는 API를 캐싱하자"}}},{"node":{"html":"<h1>왜 메시지 큐를 사용해야 할까?</h1>\n<p>About 서비스는 알림을 보내야 하는 다양한 경우가 존재합니다.\n메시지 큐를 사용하지 않고 알림 서비스를 운영하면 다음과 같은 문제가 있을 수 있습니다.</p>\n<ol>\n<li>알림 전송이 끝날 때까지 기다렸다 응답을 보내면, API 응답 속도가 느려진다.</li>\n<li>동시에 많은 요청이 들어오면, 서버의 부하가 증가한다.</li>\n<li>장애 발생 시, 재시도가 어렵다.</li>\n</ol>\n<p>Nest.js API 서버 - Redis 메시지 큐를 분리하면 이러한 문제들을 한번에 해결할 수 있습니다.</p>\n<h1>Redis 서버를 만들어보자</h1>\n<p>Redis 메시지 큐를 분리하기 위해선 먼저 Redis 서버를 따로 가지고 있어야 합니다.\n저는 이전에 생성해두었던 Oracle cloud의 Ubuntu 인스턴스를 사용했습니다.</p>\n<ol>\n<li>Redis 설치</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> update <span class=\"token parameter variable\">-y</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> redis-server</code></pre></div>\n<ol start=\"2\">\n<li>Redis 설정\nRedis의 설정 파일은 Ubuntu 기준 /etc/redis/redis.conf 에 위치합니다.\n아래 명령으로 설정 파일을 수정합니다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo vim /etc/redis/redis.conf</code></pre></div>\n<p>외부 접속을 위한 몇가지 설정을 해줍시다.\n아래의 항목들을 찾거나 추가하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">bind 0.0.0.0\n\nprotected-mode no\n\nrequirepass &lt;your_redis_password></code></pre></div>\n<p>설정이 모두 완료되면, Redis를 재시작하여 설정을 적용해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Ubuntu\nsudo systemctl restart redis-server</code></pre></div>\n<ol start=\"3\">\n<li>추가적으로 Linux의 방화벽 설정, cloud 서비스의 VCN을 업데이트 해줍니다.</li>\n</ol>\n<p>이렇게 완료되었다면 외부에서 Redis에 접속할 수 있게 됩니다.</p>\n<h1>Nest.js에서 Redis를 사용해보자.</h1>\n<p>Nest.js에는 Bull이라는 Redis 기반의 Queue 시스템을 Nest.js에서 간편하게 사용하도록 만든 BullModule이 존재합니다. 이 BullModule을 사용해서 간편하게 메시지 큐 기능을 구현해봅시다.</p>\n<p>먼저, 필요한 라이브러리를 설치해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install @nestjs/bull bull ioredis</code></pre></div>\n<p>Redis를 사용할 Module에 Redis 연결 정보를 입력해줍시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">@<span class=\"token function\">Module</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">imports</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token comment\">// BullModule 등록</span>\n    BullModule<span class=\"token punctuation\">.</span><span class=\"token function\">forRoot</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">redis</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">REDIS_HOST</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">REDIS_PORT</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">REDIS_PASSWORD</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    BullModule<span class=\"token punctuation\">.</span><span class=\"token function\">registerQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'webpush'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n</code></pre></div>\n<p>이제 메시지 큐에 데이터를 넣을 Producer와 소비할 Consumer를 추가해봅시다.</p>\n<h2>Producer</h2>\n<p>구독 정보와 payload를 메시지 큐에 넘기는 enqueueWebPush 메소드를 작성해줬습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> InjectQueue <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Queue <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"bull\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Injectable</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NotificationProducer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">InjectQueue</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"webpush\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> webpushQueue<span class=\"token operator\">:</span> Queue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">enqueueWebPush</span><span class=\"token punctuation\">(</span>subscriptions<span class=\"token operator\">:</span> INotificationSub<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> payload<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webpushQueue<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendWebPush\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      subscriptions<span class=\"token punctuation\">,</span>\n      payload<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Consumer</h2>\n<p>이제 Consumer를 작성해줍시다.</p>\n<ul>\n<li>먼저, Consumer에는 Processor annotation이 필요합니다. 여기에 'webpush'를 넣어주면, \"webpush\" 라는 이름의 큐를 구독하겠다는 의미입니다.</li>\n<li>다음으로 처리 메소드에, Process annotation과 'sendWebPush'값을 넘겨줍니다. sendWebPush라는 이름의 job을 처리하는 메소드라는 의미입니다.</li>\n<li>이 Process는 job이라는 매개변수를 받는데, 여기에 Producer가 넘겨주는 값의 정보가 포함돼 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Processor<span class=\"token punctuation\">,</span> Process <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@nestjs/bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Job <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"bull\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> PushNotifications <span class=\"token keyword\">from</span> <span class=\"token string\">\"node-pushnotifications\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Processor</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"webpush\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebPushConsumer</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> push<span class=\"token operator\">:</span> PushNotifications<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>push <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PushNotifications</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      web<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">/* ...vapid 설정... */</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      android<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> priority<span class=\"token operator\">:</span> <span class=\"token string\">\"high\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      isAlwaysUseFCM<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Process</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sendWebPush\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">handleSendWebPush</span><span class=\"token punctuation\">(</span>job<span class=\"token operator\">:</span> Job<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> subscriptions<span class=\"token punctuation\">,</span> payload <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> job<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token builtin\">Promise</span><span class=\"token punctuation\">.</span><span class=\"token function\">allSettled</span><span class=\"token punctuation\">(</span>\n        subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>sub<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>push<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>sub<span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> results<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> error<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>메시지 큐가 잘 동작하고 있는지 확인해보자</h1>\n<p>먼저 Redis가 실행중인 인스턴스에서 다음 명령으로 Redis에 접속해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">redis-cli <span class=\"token parameter variable\">-h</span> <span class=\"token operator\">&lt;</span>REDIS_HOST<span class=\"token operator\">></span> <span class=\"token parameter variable\">-p</span> <span class=\"token operator\">&lt;</span>REDIS_PORT<span class=\"token operator\">></span> <span class=\"token parameter variable\">-a</span> <span class=\"token operator\">&lt;</span>PASSWORD<span class=\"token operator\">></span></code></pre></div>\n<p>접속에 성공했다면, 생성된 Key 목록을 확인해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">KEYS bull:webpushQueue:*</code></pre></div>\n<p>저는 다음과 같은 결과를 확인할 수 있었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">xxx.xx.xx.xx:6379> KEYS bull:webpushQueue:*\n(empty list or set)\n144.24.95.17:6379> KEYS *\n 1) \"bull:webpushQ:1030\"\n 2) \"bull:webpushQ:1062\"\n 3) \"bull:webpushQ:1047\"\n 4) \"bull:webpushQ:1031\"\n 5) \"bull:webpushQ:3\"\n 6) \"bull:webpushQ:failed\"\n ...</code></pre></div>\n<p>메시지 큐에 Key가 잘 생성되고 있고, 알림이 정상적으로 전송되고 있는걸 확인했습니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-03-05T00:00:00.000Z","slug":"/blog/about/pubsub","title":"Redis 와 Bull을 이용한 메시지 큐 기능 사용.md"}}},{"node":{"html":"<h1>Error 로깅과 모니터링의 중요성</h1>\n<p>서비스를 운영하며 가장 중요하게 생각된 부분은 서비스를 장애 없이 운영하는 것이었습니다.\nExpress.js에서 Nest.js로 코드를 porting하며 처음에 가장 문제가 됐던 부분은 에러 발생시 백엔드가 종료돼버리는 것이었습니다.\n처음에는 종료되는 에러가 발생하면 처리하는 식으로 해결해보려 했는데, 계속 서버가 종료되는걸 그냥 둘 수 없었습니다.</p>\n<p>서비스가 예기치 않게 종료되는건 Error가 제대로 Handling 되지 않아서 인데, Nest.js에서 처리되지 않은 Error를 Handling할 수 있는 Listener를 제공합니다.\nmain.ts에 다음과 같은 코드를 추가하여 해결할 수 있었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">//전역 에러 핸들링\nprocess.on('unhandledRejection', (reason, promise) => {\n  logger.error('🔥 Unhandled Rejection', { promise, reason });\n});\n  \nprocess.on('uncaughtException', (error) => {\n  logger.error('🔥 Uncaught Exception', { error });\n});</code></pre></div>\n<p>일단 급한불은 껐지만 얼른 에러에 대한 처리를 해주고, 에러가 발생할 때마다 바로 바로 대응이 가능하도록 하고 싶었습니다.</p>\n<h1>왜 ELK 스택은 선택했을까?</h1>\n<ol>\n<li>ELK는 Open source입니다. Splunk와 같은 다른 유료 서비스와 비교했을 때, 무료로 사용할 수 있는 ELK 스택이 서비스에 맞았습니다.</li>\n<li>Docker container의 로그를 수집할 수 있고, ElasticSearch 기반으로 빠른 검색 성능을 보유하고 있습니다.</li>\n<li>Kubernetes를 사용하고 있지 않습니다. Kubernetes를 사용중이라면, Prometheus, Grafana같은 다른 서비스도 고려해봤을 수 있지만, ELK가 가장 간편하게 사용할 수 있었습니다.</li>\n</ol>\n<h1>ELK란 무엇일까?</h1>\n<p>ELK란 ElasticSearch, Logstash, Kibana 라는 세가지 인기있는 데이터 처리 솔루션을 일컫는 말입니다.</p>\n<p>ElasticSearch는 검색 및 분석\nLogstash는 데이터 수집\nLibana는 데이터 시각화</p>\n<p>이렇게 각각 담당합니다.</p>\n<h1>Docker-compose로 ELK 구성하기</h1>\n<p>About은 Frontend와 Backend를 Docker Container로 배포하고 있습니다.\nELK를 Docker conatiner로 띄우고, Docker의 로그를 수집하는 과정을 구성해봅시다.</p>\n<p>여기선 Container의 로그를 Logstash로 전송해주기 위해 추가로 Filebeat을 사용합니다.</p>\n<p>ELK는 현재 8.xx 버전까지 나와있지만, 8버전 이상부터는 보안 문제를 해결하려면 무료 사용에 제한이 있어 7버전을 사용했습니다.</p>\n<p>현재 저희는 AWS의 RAM 4GB, 100GB 디스크의 인스턴스를 사용중입니다.\n제한된 환경에서 ELK 스택을 사용하기 위해 다음과 같은 사항을 주로 고려했습니다.</p>\n<ul>\n<li>수집하는 log의 양 제한.</li>\n<li>ELK의 각 stack의 메모리 사용량 제한.</li>\n<li>특정 기간이 지난 로그는 삭제</li>\n</ul>\n<h2>Elasticsearch</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.27\n    container_name: elasticsearch\n    environment:\n      - discovery.type=single-node\n      - \"ES_JAVA_OPTS=-Xms512m -Xmx512m\"\n      - xpack.security.enabled=false  # 데모용. 프로덕션에서는 보안 설정 권장\n      - xpack.license.self_generated.type=basic\n      - http.cors.enabled=true  # CORS 활성화\n      - http.cors.allow-origin=\"*\"\n      - http.cors.allow-methods=OPTIONS,HEAD,GET,POST,PUT,DELETE\n      - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization\n      - http.cors.allow-credentials=true\n      - xpack.security.authc.api_key.enabled=false  # API Key 인증 비활성화\n      - xpack.security.authc.anonymous.roles=superuser  # 익명 사용자에게 슈퍼유저 권한 부여\n    volumes:\n      - es-data:/usr/share/elasticsearch/data\n    ports:\n      - \"9200:9200\"</code></pre></div>\n<ul>\n<li>보안 관련 설정을 비활성화했으므로, 누구나 접근할 수 있습니다. 실제 배포 환경에서는 보안 설정을 해야합니다.</li>\n<li>Cors 설정을 활성화했습니다.</li>\n<li>익명 사용자가 superuser 권한을 가집니다. 이 또한 실제로는 수정해야 합니다.</li>\n<li>메모리 사용량을 512mb로 제한합니다.</li>\n</ul>\n<p>5일이 지난 데이터를 삭제하고, 일별로 로그를 관리하기 위해, docker-compose가 시작할 때 ilm 정책을 적용해 줬습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 1) ILM 정책 생성\necho \"=== Create ILM policy ===\"\ncurl -X PUT \"http://elasticsearch:9200/_ilm/policy/delete-after-5d\" \\\n     -H 'Content-Type: application/json' \\\n     -d '{\n       \"policy\": {\n         \"phases\": {\n           \"hot\": {\n             \"actions\": {\n               \"rollover\": {\n                 \"max_age\": \"1d\",\n                 \"max_size\": \"1gb\"\n               }\n             }\n           },\n           \"delete\": {\n             \"min_age\": \"5d\",\n             \"actions\": {\n               \"delete\": {}\n             }\n           }\n         }\n       }\n     }'\n\n# 2) 인덱스 템플릿에 ILM 적용 예시\necho \"=== Create index template with ILM ===\"\ncurl -X PUT \"http://elasticsearch:9200/_index_template/logs_template\" \\\n     -H 'Content-Type: application/json' \\\n     -d '{\n       \"index_patterns\": [\"nest-logs-*\"],\n       \"template\": {\n         \"settings\": {\n           \"index.lifecycle.name\": \"delete-after-5d\",\n           \"index.lifecycle.rollover_alias\": \"logs-alias\"\n         }\n       }\n     }'</code></pre></div>\n<ul>\n<li>rollover: 1일이 지나거나, 1GB가 넘으면 다음 index로 넘어감.</li>\n<li>delete: 5일이 지난 index는 삭제됨</li>\n</ul>\n<h2>kibana</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kibana:\n    image: docker.elastic.co/kibana/kibana:7.17.27\n    container_name: kibana\n    environment:\n      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200\n      - XPACK_SECURITY_ENABLED=false\n      - SERVER_HOST=0.0.0.0\n    ports:\n      - \"5601:5601\"\n    depends_on:\n      - elasticsearch</code></pre></div>\n<ul>\n<li>elasticsearch가 실행돼야 kibana가 작동되도록 합니다.</li>\n<li>마찬가지로 보안설정은 해두지 않았습니다.</li>\n<li>5601 포트로 접속하면 kibana UI를 사용할 수 있습니다.</li>\n</ul>\n<h2>Logstash</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">logstash:\n    image: docker.elastic.co/logstash/logstash:7.17.27\n    container_name: logstash\n    depends_on:\n      - elasticsearch\n    volumes:\n      - ./logstash/pipeline:/usr/share/logstash/pipeline\n    ports:\n      - \"5044:5044\"\n      - \"5000:5000\"\n      - \"9600:9600\"\n    environment:\n      - LS_JAVA_OPTS=-Xms256m -Xmx256m</code></pre></div>\n<ul>\n<li>/logstash/pipeline폴더에 logstash.yml 설정파일을 두어 적용합니다.</li>\n<li>5044 포트를 통해 filebeat에서 logstash로 로그를 전송합니다.</li>\n<li>5000번 포트는 추가적인 데이터 입력을 받을때 필요합니다.</li>\n<li>9600 포트는 logstash를 모니터링 하기위한 api입니다.</li>\n</ul>\n<p>logstash.conf</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">input {\n  beats {\n    port => 5044\n  }\n}\n\nfilter {\n  # message가 JSON 형식인지 체크\n  if [message] =~ \"^\\{[\\s\\S]*\\}$\" {\n    json {\n      source => \"message\"\n      target => \"parsed_json\"\n    }\n  } else {\n    mutate {\n      rename => { \"message\" => \"raw_message\" }\n    }\n  }\n\n  # JSON 파싱 실패한 경우\n  if \"_jsonparsefailure\" in [tags] {\n    mutate {\n      rename => { \"message\" => \"raw_message\" }\n      remove_field => [ \"parsed_json\" ]  # 실패한 parsed_json 필드 제거\n    }\n  }\n\n  # 필요 없는 필드 제거 (메모리 절약)\n  mutate {\n    remove_field => [\"@version\", \"host\"]\n  }\n}\n\noutput {\n  elasticsearch {\n    hosts => [\"http://elasticsearch:9200\"]\n    index => \"nest-logs-%{+YYYY.MM.dd}\"\n    retry_on_conflict => 3  # 충돌 시 최대 3번 재시도\n  }\n\n  # stdout 최소화 (운영 환경에서 메모리 절약)\n  stdout {\n    codec => plain {\n      format => \"%{message}\"\n    }\n  }\n}</code></pre></div>\n<ul>\n<li>5044포트에서 beats 프로토콜 데이터를 받습니다.</li>\n<li>'{' 를 새 로그의 시작으로 봅니다. Nest.js의 로깅에서 모든 로그를 json 형식으로 변환했으므로 이렇게 작성할 수 있습니다.</li>\n<li>로그 데이터를 JSON 형식으로 변환합니다. 변환이 실패하면 raw_message로 저장합니다.</li>\n<li>output을 elasticsearch:9200으로 전송합니다.</li>\n</ul>\n<h2>Filebeat</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">filebeat:\n    image: docker.elastic.co/beats/filebeat:7.17.27\n    container_name: filebeat\n    depends_on:\n      - logstash\n    user: root\n    volumes:\n      - ./filebeat/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro\n      - /var/lib/docker/containers:/var/lib/docker/containers:ro\n      - /var/run/docker.sock:/var/run/docker.sock:ro</code></pre></div>\n<ul>\n<li>로그를 수집하고 logstash로 전송합니다.</li>\n<li>./filebeat 폴더에 filebeat.yml 설정파일을 둡니다.</li>\n<li>/var/lib/docker/containers를 마운트하여 Docker 컨테이너 내부 로그 파일을 수집합니다.</li>\n<li>/var/run/docker.sock을 마운트하여 Docker 컨테이너 이벤트를 추적합니다.</li>\n</ul>\n<p>filebeat.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">filebeat.inputs:\n  - type: container\n    paths:\n      - /var/lib/docker/containers/*/*.log\n    ignore_older: 48h  # 2일 이상 된 로그 무시 (디스크 절약)\n    scan_frequency: 30s  # 30초마다 로그 확인\n    close_inactive: 10m  # 10분 동안 업데이트 없는 파일 닫기\n\n    multiline:\n      pattern: '^{'  # JSON 로그가 '{'로 시작하면 새 이벤트로 간주\n      negate: true   # 이 패턴이 아닐 때 이전 로그와 합치기\n      match: after\n\n    containers:\n      ids:\n        - \"nest-app\"\n        - \"next-app\"\n    processors:\n      - add_docker_metadata: ~\n\nprocessors:\n  - drop_event:\n      when:\n        or:\n          - equals:\n              message: \"\"\n          - not:\n              has_fields: [\"message\", \"@timestamp\"]\n          - contains:\n              message: \"Health check\"  # 필요 없는 헬스 체크 로그 삭제\n          - contains:\n              message: \"DEBUG\"  # DEBUG 로그 필터링\n\noutput.logstash:\n  hosts: [\"logstash:5044\"]\n  bulk_max_size: 25  # 기존 50 → 25로 줄여 메모리 부담 완화\n  worker: 2  # 기본 1 → 2로 병렬 처리 향상</code></pre></div>\n<ul>\n<li>오래된(2일 이상된) 로그는 filebeat가 읽지 않습니다.</li>\n<li>docker container의 로그파일을 읽어서 수집합니다.</li>\n<li>add_docker_metadata로 docker 관련 메타데이터를 추가합니다.</li>\n<li>수집한 로그를 logstash:5044로 전송합니다.</li>\n</ul>\n<h1>실제 저장되는 데이터 확인해보기</h1>\n<p>이제 5601 포트에서 실행중인 kibana에 접속하여 어떻게 logging이 되는지 확인해봅시다.</p>\n<p>먼저, index를 확인해보면 다음과 같습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACA0lEQVR42n1T7W6jMBDk/V/u/jU5pVJPSq9NICSAjb/N3M6S5Kgq1dLKxtizszPr5nB4BePl5QW7/R77/W/sdnu8vf0Bx7Is2A5+r3sLYq4YXMZ1jhIJJmQ0565H213w8fGJ4/s7jsejrk+nM0opyDkjhIgYo8zhS4Iqy1RW4FQqsmw0Z5NxkyzjOKDve3jvZT2ibTuZJ0zThNO5RXe5oOs61Frx02gG62GdVxZBWHhhoWtllTRsLCCvKgy8D3DOabACPesdwuwQ5W5jfIJPRX4KZYnyCLlchA1BHvueSVLSIHBKWUttpaq/84w2eDT8aQWdpdRlUSACJNGOgFEucX8yFtfbgHGycALWX2+yNvBy7jAN+NW1OIhsTRbaxgrdLOWkqkKXXFRHglozKztjjDIyApzl/0QwKXEYRjhh54VUkEQNWbQ24jQGtCaqa1h4cdSyaBLZ093HzLB2Vg05k5S2FE1h9osAfQ5BQakJFh6cVDPn73JsYlEJjLbUas7/RA1Fv0lTspd0U1MVKcPeXY7Pw9tYgauWue1NBRxc0pik04s+giqZfwZ87Dvnv/Rmww+CXUTHbqPhLAzZlzGGbyUzHn1IQM7PkmlKL2+xnVbAXNeSrZiyNnj4xo5jnlf37bya82RIQD5sMiTwynDVkIBsjXrXbGuK8yuzWdqF5tBjMvwH0m9FCXURf54AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250308171200\"\n        title=\"\"\n        src=\"/static/2ba3e0142cf3dbd7c63c8d883e249a9a/5a190/20250308171200.png\"\n        srcset=\"/static/2ba3e0142cf3dbd7c63c8d883e249a9a/772e8/20250308171200.png 200w,\n/static/2ba3e0142cf3dbd7c63c8d883e249a9a/e17e5/20250308171200.png 400w,\n/static/2ba3e0142cf3dbd7c63c8d883e249a9a/5a190/20250308171200.png 800w,\n/static/2ba3e0142cf3dbd7c63c8d883e249a9a/c1b63/20250308171200.png 1200w,\n/static/2ba3e0142cf3dbd7c63c8d883e249a9a/869d7/20250308171200.png 1477w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\nilm정책은 잘 적용되었지만, 로그는 7일치가 기록되고 있네요.\n이 부분은 추가적인 확인이 필요할 것 같습니다.</p>\n<p>이제 에러들이 어떻게 로깅되고 있는지 확인해봅시다. Discover 탭에 접속하여 보고싶은 field들을 선택하고, 적절한 fileter를 설정해주면 보고싶은 데이터만 확인할 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJklEQVR42nWTa44TMRCEc3Auwx34wxmQ+LcgpOwmYZNsknnaHr/tKbp7JoEFMVLJmYn9ubrL3mz7Ad9ajXNroJRGnWeUUh+qdVEpZVEu0C49pEjGJ3x9Nfj45YpN21tYY+FcQPARk5kwTRaGv1kHTaPS9M0GDFOCCxk5VyQCp1QQSXPO+PTU4sPnIzZNN+Jlf8Tu5wmXS4NxNOj7UYD9FKEIFGMSQMgzcqUK/lIl3Z/NQIBb06MfNKyLCLJrhveB3MTVSSJoXEb6xi2YqTXzzCOoFQPNOxKcgKMyaNpBQLwbQxlorUUIgcrLMjrv4Wn0NP4LbGjeMzCvDtldiBmReqOMkxIXYFyA5I5h7JKdM0xWYym1lI7m7QW+6Ql4ubbkLNAfM4WwAikYBjCQ4doYCSs+4EsbYqSA0o3W7pYeHs4tTq3C4LKo015KNuviREClNQU1YBhGce2cE6cheBL3+ELA5wW4uyrsW4ezzjgOEZ0t4ord+LWHDHDOy++ld/O7HuZ8I21XhzeN74cbDs2Ek0poJzpn4nASF1IyAVkcxvvn3sM1FAFeNX4cO7z2XoAdA+moWDrU95QZzPofsNaGoKvDl8uI7ZvGmy5SsjhcXT1SDvHhlq8jb8gqhd+55PaPlLWj2xBhKS1DDXaSGvdwEod8mLU2GJUS16x7Tzl9azntq5S8HhsNPtwx3u9olTvKgXDCuRbZgMVHJciN+f0u64oh9eAb+Au/ND+C0KnYPQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250308171514\"\n        title=\"\"\n        src=\"/static/257bb162b15ee2dbc5f703595fc9e926/5a190/20250308171514.png\"\n        srcset=\"/static/257bb162b15ee2dbc5f703595fc9e926/772e8/20250308171514.png 200w,\n/static/257bb162b15ee2dbc5f703595fc9e926/e17e5/20250308171514.png 400w,\n/static/257bb162b15ee2dbc5f703595fc9e926/5a190/20250308171514.png 800w,\n/static/257bb162b15ee2dbc5f703595fc9e926/c1b63/20250308171514.png 1200w,\n/static/257bb162b15ee2dbc5f703595fc9e926/29007/20250308171514.png 1600w,\n/static/257bb162b15ee2dbc5f703595fc9e926/913b9/20250308171514.png 1822w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n저는 다음과 같이 구성해줬는데, 에러 메시지들을 잘 확인할 수 있었습니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-03-01T00:00:00.000Z","slug":"/blog/about/elk","title":"Nest.js 서비스를 장애없이 운영할 수 있을까?"}}},{"node":{"html":"<p>Stream 데이터 타입은, 지금까지 본 데이터 타입과는 많이 다릅니다.\nlist와 sorted set이 섞인 형태라고 볼 수 있습니다.\n주로 서로 다른 서버 간 통신이 필요할 때 많이 사용합니다.</p>\n<h2>동작 원리</h2>\n<p>Message Producer -> Redis(stream) -> Message consumer\n와 같은 흐름을 가집니다.</p>\n<ol>\n<li>Producer가 message(Hash) 생성</li>\n<li>Redis의 Stream에 저장되고, ID(UNIX Timestamp)가 부여됨</li>\n<li>Consumer가 message 요청하면 전송. message를 전송해도 stream에 그대로 남아있음.</li>\n</ol>\n<h2>사용 예시</h2>\n<p>만약 <a href=\"mailto:A@gmail.com\">A@gmail.com</a>으로 메일을 보내달라는 요청이 들어왔다고 생각해봅시다.\n우리의 서버는 그 요청을 Third Party Email API로 전송하고 응답을 기다릴 것입니다.\nThird Party Email API에서 메일을 보내는 데에는 약간의 시간이 필요하므로, 그 기간동안 처음 들어온 요청은 대기하고 있을 것입니다.\n요청이 대기 상태로 있는건 그렇게 좋은 상황은 아닙니다.\nStream을 사용해 요청을 대기 상태에 두지 않고 처리할 수 있습니다.\n요청을 stream에 달아두고 응답을 반환하는 것이죠. 그럼 Email API가 비어있을 때 요청을 가져다 처리하면 됩니다.</p>\n<h2>명령어</h2>\n<h3>XADD</h3>\n<p>XADD [key] * [key] [value] [key] [value]</p>\n<ul>\n<li>\n<ul>\n<li>표시는 Redis에게 key를 생성해 달라는 의미입니다.</li>\n</ul>\n</li>\n<li>첫 key는 stream의 key를 의미합니다.</li>\n<li>뒤의 key value는 Hash에서와 같이 key value를 저장하는 것입니다.</li>\n</ul>\n<h3>XREAD</h3>\n<p>XREAD STREAMS [key] [range]</p>\n<ul>\n<li>range는 0-0와 같은 형태를 띕니다. 0-0는 stream의 모든 message를 읽겠다는 의미입니다. timestamp를 넣어 범위를 지정할 수 있습니다.</li>\n</ul>\n<p>XREAD COUNT 2 STREAMS [key] [range]</p>\n<ul>\n<li>XREAD와 STREAMS사이에 COUNT N을 넣으면 N개만 읽어올 수도 있습니다.</li>\n</ul>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Resource","subCategory":"redis"}],"date":"2025-02-22","slug":"/blog/redis/streams","title":"Redis Streams"}}},{"node":{"html":"<p>Redis Module이란, redis에 로딩할 별도의 프로그램을 말합니다.</p>\n<p>우리는 그 중 유명한 RedisJSON과 RedisSearch를 알아봅시다.</p>\n<p>Redis Module을 사용하기 위해서는 각 Module을 다운받아 Redis에 통합하는 과정이 필요합니다.\n그러나 이는 매우 번거로워 다른 방법을 사용하는걸 추천합니다.</p>\n<ol>\n<li>Redis Stack사용하기: Redis Stack은 주요 Module들을 포함하여 Redis를설치할 수 있게 해줍니다.</li>\n<li>Redis cloud 사용하기: cloud에서 제공하는 관리형 redis를 사용하면 제약없이 Module에 접근할 수 있습니다.</li>\n</ol>\n<h1>Redisearch</h1>\n<p>redis에서 다향한 hash로 이뤄진 데이터에서 검색을 하는 작업은 꽤 번거롭습니다.\nRedisearch를 사용하면, 다양한 데이터 타입을 유지할 필요없이 다양한 해시 데이터를 검색 할 수 있습니다. 또한 다양한 기준으로 검색할 수도 있습니다.</p>\n<ol>\n<li>Index 생성 (FT.CREATE)</li>\n<li>query 실행 (FT.SEARCH)</li>\n</ol>\n<h2>index</h2>\n<p>index를 생성할 때는 먼저 검색할 레코드를 지정해야 합니다.\n특정 문자열을 제공하면, 그 문자열로 시작하는 모든 hash를 검색합니다.\n예를들어, items#을 제공하면 items#로 시작하는 모든 hash를 찾습니다.</p>\n<p>Redisearch의 예시를 위해 예시 데이터를 아래와 같이 만들어봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"redis\"><pre class=\"language-redis\"><code class=\"language-redis\">HSET cars#a1 name &#39;fast car&#39; color red year 1950\nHSET cars#b1 name &#39;car&#39; color red year 1960\nHSET cars#c1 name &#39;old car&#39; color blue year 1970\nHSET cars#d1 name &#39;new car&#39; color blue year 1980</code></pre></div>\n<h2>FT.CREATE</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FT.CREATE idx:cars ON HASH PREFIX 1 cars#\n\t SCHEMA name TEXT year NUMERIC color TAG</code></pre></div>\n<ul>\n<li>idx:cars는 key를 의미합니다.</li>\n<li>ON HASH는 우리가 찾으려는 데이터 타입입니다. HASH혹은 JSON만 가능합니다.</li>\n<li>PREFIX 1 cars#: cars#로 시작하는 모든 record를 찾으라는 명령입니다. 여러 개의 key로 검색하고 싶다면, 1을 n으로 변경 후 뒤에 적어주면 됩니다.</li>\n<li>SCHEMA는 Hash안에서 찾길 원하는 속성을 설명합니다. 필드의 이름, 타입 을 반복해서 적습니다.</li>\n</ul>\n<h2>타입</h2>\n<ul>\n<li>NUMERIC: 숫자를 의미합니다.</li>\n<li>GEO: 지리적 좌표를 의미합니다.</li>\n<li>VECTOR: 레코드들 간의 유사성을 찾을 수 있게 합니다.</li>\n<li>TAG: 문자열의 query에 사용됩니다.</li>\n<li>TEXT: 문자열의 search에 사용됩니다.</li>\n</ul>\n<h3>Querying과 Searching의 차이</h3>\n<ul>\n<li>Querying은 주어진 조건과 완전히 일치하는 것을 찾는 것입니다.</li>\n<li>Searching은 정확하지 않아도 근접한 것들을 찾는다는 개념입니다.</li>\n</ul>\n<p>TEXT를 사용하면 Redis가 단순 검색을 넘어 내부적으로 추가적인 연산을 합니다.</p>\n<h2>FT.SEARCH</h2>\n<p>FT.SEARCH [key] [query] [query]</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FT.SEARCH idx:cars '@name:(fast car)'</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FT.SEARCH idx:cars '@color:{blue}'</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FT.SEARCH idx:cars '@year:[1955, 1980]'\n%% +inf, -inf, ( 사용 가능 %%\nquery 앞에 -를 사용하면 제외하고 검색</code></pre></div>\n<ul>\n<li>query를 작성할 때는 항상 @다음에 필드이름을 작성해줍니다.</li>\n<li>query를 여러개 이어 작성할 수 있습니다.</li>\n<li>(): TEXT</li>\n<li>{}:TAG</li>\n<li>[]:NUMBER</li>\n</ul>\n<p>을 위해 사용합니다.</p>\n<h3>Number query</h3>\n<ul>\n<li>@year: [1955 1980] : 기본</li>\n<li>@year: [(1955 (1980]: 경계값 미포함</li>\n<li>@year: [-inf  +inf]: 양의 무한대, 음의 무한대</li>\n<li>-@year: [1955 1980]: 범위 제외하고 검색</li>\n</ul>\n<h3>Tag query</h3>\n<ul>\n<li>@color{blue}: 기본</li>\n<li>-@color{blue}: blue제외하고 검색</li>\n<li>@color{red | blue}: or</li>\n<li>@color{light\\ blue}: 공백 포함하려면 백슬래시 필요</li>\n</ul>\n<p>추가로 알아둬야 할 것은 Tag query에 사용할 수 없는 단어가 있습니다.\na, is, the, an, and등의 언어들이 Tag query에 포함되면 자동으로 제거됩니다.</p>\n<p>예를 들어, @cities:{to|a|or}은 @cities:{}와 같습니다.</p>\n<h3>Text query</h3>\n<ul>\n<li>fast: 'fast'로 모두 검색</li>\n<li>@name:(%fast%): 문자 1개의 불일치 허용. 최대 3개까지 %로 감쌀 수 있다.</li>\n<li>@name:(fa*): fa로 시작하는 모든 것 검색. * 앞에 최소한 2개의 문자가 와야 한다.</li>\n<li>@name:(fast car): 'fast' and 'car' 포함하는 것 검색</li>\n<li>@name:(fast | car): 'fast'or 'or' 포함하는 것 검색</li>\n<li>-@name:(fast): 'fast'로 검색되는 것 제외하고 검색</li>\n</ul>\n<p>Text query를 작성할 때, query의 내용에 전처리가 들어갑니다.\n예를 들어,  'a fast, fast car!'이라는 query로 검색한다면 전처리가 되어 [fast, fast, car]이 query로 들어갑니다.</p>\n<p>추가로, stemming 기법이 사용됩니다.\nfasting, fastly, fasts 와 같은 단어는 모두 fast와 같은 단어로 취급됩니다.</p>\n<h3>실제 사용</h3>\n<p>실제 환경에서 사용할 때, 유저가 검색한 값을 query에 집어넣어야 할겁니다.\nquery에 유저가 입력한 문자열을 사용하기 위해서는 전처리가 필요합니다.</p>\n<p>사용자가 fast ca라는 문자열을 입력했다고 가정합시다.</p>\n<ol>\n<li>공백 기준 분리: ['fast', 'car']</li>\n<li>마지막 문자에 * 붙히기, 혹은 %사용: ['fast*', 'car*']</li>\n<li>| 로 묶기 혹은 and로 묶기: fast* | ca*</li>\n</ol>\n<p>정해진 것은 없지만, 위와 같은 방법으로 전처리를 할 수 있습니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Resource","subCategory":"redis"}],"date":"2025-02-20","slug":"/blog/redis/module","title":"Redis Module"}}},{"node":{"html":"<h1>관계형 데이터</h1>\n<p>redis에서 관계형 데이터를 어떻게 다룰까요?</p>\n<ol>\n<li>id의 list를 가져온 후 list를 이용해 id에 맞는 데이터 가져오기</li>\n<li>SORT사용하기</li>\n</ol>\n<p>1번 방법을 사용하면 Redis에 두번 요청을 보내게 됩니다.SORT를 사용하는 방법에 대해 알아봅시다.</p>\n<h2>SORT</h2>\n<p>SORT 명령어는 이름과 다르게 꼭 정렬할때만 사용하지는 않습니다.</p>\n<p>다음과 같은 데이터를 예시로 만들어봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">HSET books:good title 'Good book' year 1950\nHSET books:bad title 'Bad book' year 1930\nHSET books:ok title 'OK book' year 1940\n\nZADD books:likes 999 good\nZADD books:likes 0 bad\nZADD books:likes 40 ok</code></pre></div>\n<p>여기서 한가지 알아둬야할 것은, 정렬집합에 SORT를 사용할 때, 정렬집합의 member를 SORT에서는 score라 부릅니다. 매우 헷갈리죠.</p>\n<h3>정렬하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SORT books:likes ALPHA // [\"bad\", \"good\", \"ok\"]</code></pre></div>\n<ul>\n<li>ALPHA는 alphabet순으로 정렬하라는 의미입니다.</li>\n</ul>\n<h3>BY 사용</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SORT books:likes BY books:*->year // [\"bad\", \"ok\", \"good\"]</code></pre></div>\n<ol>\n<li>정렬 집합에서 member를 전부 추출한다.</li>\n<li>books:*->year * 위치에 모든 값을 순회하며 집어넣는다. 즉, 이 과정에서 books:good, books:ok, books:bad 키를 가진 HASH를 전부 순회하게 된다.</li>\n<li>순회한 결과에서 year값을 가져온 후, 그 값을 기준으로 정렬한다.</li>\n</ol>\n<p>이 과정이 관계형 데이터를 처리하는 것과 같은 효과를 냅니다.\nBY에 nosort라는 특수한 값을 사용할 수도 있습니다.</p>\n<h2>예시</h2>\n<p>item을 조회수를 기준으로 정렬하여 가지고 오고싶은 상황이라 생각해봅시다.</p>\n<p>여기서는 node-redis를 이용하여 예를 들겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> results <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>\n\t<span class=\"token function\">itemsByViewsKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// return 'items#views'</span>\n\t<span class=\"token punctuation\">{</span>\n\t\t<span class=\"token constant\">GET</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n\t\t\t<span class=\"token string\">'#'</span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">itemsKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> name</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">itemsKey</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> -> views</span><span class=\"token template-punctuation string\">`</span></span>\n\t\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token constant\">BY</span><span class=\"token operator\">:</span> <span class=\"token string\">'score'</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>#는 원래의 member를 포함하겠다는 뜻입니다.</li>\n<li>itemsByViewsKey와 itemsKey함수는 각각 정의해둔 key를 반환하는 함수입니다.</li>\n</ul>\n<p>간단히 설명해보자면, items#views를 key로 가지는 정렬집합에서 score값(views) 기준으로 정렬한다음 원래의 member(id), name, views 값을 itemsKey를 key로 가지는 hash에서 가져오는 것입니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Resource","subCategory":"redis"}],"date":"2025-02-19","slug":"/blog/redis/relation","title":"Redis 관계형 데이터"}}},{"node":{"html":"<h1>동시성 문제</h1>\n<p>만약에 Redis에서 GET관련 함수로 값을 가져오고 그 값을 애플리케이션에서 업데이트 한다음에, 다시 Redis에 save한다고 생각해봅시다.</p>\n<p>만약 A가 값을 읽고 가서 Redis에 저장하는 사이에 B가 값을 읽어 간다면 어떻게 될까요?</p>\n<p>A가 값을 Redis에 쓰는 사이 B는 본인이 읽어온 값으로 처리를 하고, 그 값을 Redis에 또 저장할 것입니다. 결과적으로 A의 작업이 무시 됩니다.</p>\n<p>이러한 동시성 문제는 어떠한 값을 읽어와서 처리하고 다시 저장하는 구조에서는 언제 어디서든 일어날 수 있는 문제입니다. Redis에서는 어떻게 이 문제를 해결할까요?</p>\n<ol>\n<li>atomic한 update 명령을 사용한다.</li>\n<li>WATCH명령을 통한 transaction을 실행한다.</li>\n<li>lock을 사용한다.</li>\n<li>lua script를 사용한다.</li>\n</ol>\n<h2>atomic한 명령 사용하기</h2>\n<p>Redis에는 값을 읽어와서 수정하고 저장하는게 아니라, 특정 값을 한번에 수정시키는 명령이 있습니다.</p>\n<p>예를 들면, HINCRBY와 같은 명령이 있습니다.\n만약 Hash의 특정 값을 1 증가시켜 달라는 명령이 2개가 동시에 들어온다면, 2가 되길 기대하지만 동시성 문제로 최종 결과가 1이 될 수 있습니다.\n그럴때, HINCRBY를 사용하면 결과가 무조건 2가 됩니다.</p>\n<h2>Transaction</h2>\n<p>트랜잭션이란, 내부적으로 여러 명령을 묶어서 처리하고 그 중간에 다른 명령이 끼어들 수 없도록 처리하는 것입니다.\n다른 데이터베이스와 같이 Redis에서도 Transaction 처리를 할 수 있습니다.</p>\n<p>하지만 다른 데이터베이스에서는 트랜잭션을 롤백, 취소 할 수 있는것과 다르게 Redis에서는 롤백, 취소가 불가능합니다. 그래서 다른 데이터베이스와는 다르게 약간 활용도가 떨어집니다.</p>\n<h3>MULTI</h3>\n<p>MULTI 명령은 여러 명령을 Redis로 전송하지만 실행하지는 않습니다.</p>\n<h3>EXEC</h3>\n<p>EXEC 명령어는 대기중인 모든 명령을 실행합니다.</p>\n<p>예를 들어보면</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">MULTI\nSET color red\nSET count 5\nEXEC</code></pre></div>\n<p>다음과 같이 사용할 수 있습니다.</p>\n<h3>WATCH 명령 사용하기</h3>\n<p>WATCH [key]</p>\n<p>watch명령은 특정 key에 저장된 값을 지켜봅니다.\n다음 트랜잭션이 실행되기 전에 해당 key의 값이 변경되면, 트랜잭션이 자동으로 실패합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">WATCH color\nMULTI\nSET color red\nSET count 5\nEXEC</code></pre></div>\n<p>이렇게 사용할 수 있습니다. 그럼 EXEC 명령이 실행되기 전, color에 저장된 값이 바뀐다면, 해당 transaction이 취소됩니다.</p>\n<p>Redis에서는 이렇게 WATCH MULTI ~ EXEC 명령을 사용해 동시성 문제를 해결할 수 있습니다.</p>\n<p>추가로 알아둬야 할 것은, Transaction은 Redis와의 connection을 완전히 점유하기 때문에, Transaction을 생성할 때 새 연결을 추가해야 한다는 것입니다.</p>\n<h2>LUAscript 사용하기</h2>\n<p>만약 redis의 sorted set에서 score가 2의 배수인 모든 member를 찾으려 한다고 생각해봅시다.\nRedis의 명령 중 이걸 한번에 할 수 있는 명령은 없습니다.\n모든 값을 읽고, filter를 적용해야하죠.</p>\n<h3>LUAscript</h3>\n<p>luascript는 redis의 모든 명령에 접근 가능한 서버에 작성하는 코드입니다.\n이를 redis에 전송하면, LUAscript를 실행하고 결과를 server로 전송 받을 수 있습니다.\n하나의 luascript로 여러개의 redis명령을 동시에 실행할 수 있습니다.</p>\n<p>LUAscript의 명령을 간단히만 알아봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"lua\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token number\">123</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello world'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">local</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">--지역 변수 선언</span>\nsum2 <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token comment\">--전역 변수 선언. redis에서 사용할 수 없음.</span>\n\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>sum<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> sum <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token keyword\">then</span> <span class=\"token comment\">--조건문</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"big\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">if</span> sum <span class=\"token operator\">~=</span> <span class=\"token number\">0</span> <span class=\"token keyword\">then</span> <span class=\"token comment\">--조건문</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"wrong\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n<span class=\"token keyword\">if</span> sum <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token keyword\">then</span> <span class=\"token comment\">--조건문</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"right\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\">--of 추가로 0, 빈 문자열 등은 false의 의미로 쓰이지 않음</span>\n<span class=\"token keyword\">if</span> <span class=\"token number\">0</span> <span class=\"token keyword\">and</span> <span class=\"token string\">''</span> <span class=\"token keyword\">then</span> <span class=\"token comment\">--조건문</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"it will be printed\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token keyword\">false</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">not</span> <span class=\"token keyword\">true</span> <span class=\"token keyword\">then</span> <span class=\"token comment\">--조건문</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"it will not be printed\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\">--null의 역할을 하는건 nil입니다.</span>\n<span class=\"token keyword\">if</span> <span class=\"token keyword\">nil</span> <span class=\"token keyword\">then</span> <span class=\"token comment\">--조건문</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"it will not be printed\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"lua\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token keyword\">local</span> colors <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'red, '</span>green<span class=\"token string\">', '</span>blue'<span class=\"token punctuation\">}</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>colors<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">--배열의 idx는 1부터 시작합니다.</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token operator\">#</span>colors<span class=\"token punctuation\">)</span> <span class=\"token comment\">--배열의 길이 출력</span>\n\ntable<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>colors<span class=\"token punctuation\">,</span> <span class=\"token string\">'orange'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">--배열 마지막에 값 추가</span>\n\n<span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token function\">ipairs</span><span class=\"token punctuation\">(</span>colors<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">)</span> <span class=\"token comment\">--i:인덱스, v:값</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">for</span> i<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span> <span class=\"token keyword\">do</span> <span class=\"token comment\">--시작값, 종료값</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token comment\">-- LUA table == JS object</span>\n<span class=\"token keyword\">local</span> user <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>id <span class=\"token operator\">=</span> <span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> <span class=\"token string\">'samantha'</span><span class=\"token punctuation\">}</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n\t<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>LUAscript의 사용은 다음과 같은 과정을 거칩니다.</p>\n<ol>\n<li>script 작성</li>\n<li>script load -> script의 ID 반환받음</li>\n<li>script ID 이용하여 호출: EVALSHA명령 사용</li>\n</ol>\n<h3>script 작성</h3>\n<p>SCRIPT LOAD 'return 1 + 1'\n다음 명령을 실행하면 redis에서 script의 ID를 긴 문자열로 반환해줍니다.</p>\n<h3>script 사용</h3>\n<p>EVALSHA [scriptID] 0 [arg1] ...\nex) EVALSHA [ID] 0 '10' '20' '30'\n0의 의미는 잠시 후 설명하겠습니다.\narg로는 문자를 전달해줘야 합니다. LUA에서 tonumber함수로 숫자로 변환할 수 있습니다.\nidx가 1부터 시작한다는 걸 주의해야 합니다.</p>\n<h3>script에서 redis 사용</h3>\n<div class=\"gatsby-highlight\" data-language=\"lua\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token keyword\">return</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'color'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>다음과 같은 명령은 잘 작동하지만 이렇게 사용해서는 안됩니다.\n이 script를 호출하면 EVALSHA에서 어떤 키를 썼는지 모른 채 호출하게 됩니다.\nEVALSHA를 호출할 때 key를 전달해주는 방식을 사용해줘야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"lua\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token keyword\">return</span> redis<span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> KEYS<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>KEYS는 자동으로 정의되는 전역변수입니다.</p>\n<p>EVALSHA [scriptID] 1 [key1] [arg1] ...</p>\n<p>ex) EVALSHA [ID] 1 color '10' '20' '30'\n아까의 명령에 있던 0은 key의 개수를 나타내는 것이었습니다.\n사용할 key의 개수만큼 적고, 그 뒤에 key들을 적고 그 뒤에 arg를 적어주면 됩니다.</p>\n<p>위에서 본 것처럼, EVALSHA에서 명시하지 않은 key를 사용하는 script를 작성해도 오류가 발생하지는 않습니다. 하지만 나중에 문제를 일으킬 가능성이 매우 높으므로, 사용하지 않는게 좋습니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Resource","subCategory":"redis"}],"date":"2025-02-19","slug":"/blog/redis/lua","title":"Redis 동시성 문제와 lua 스크립트"}}},{"node":{"html":"<h1>Redis design</h1>\n<p>Redis를 사용할 때, 기존의 데이터베이스를 사용할 때와는 다르게 접근해야 합니다.</p>\n<h2>SQL database</h2>\n<ol>\n<li>데이터를 테이블에 집어넣는다.</li>\n<li>어떻게 query해 사용할지 생각한다.</li>\n</ol>\n<h2>Redis</h2>\n<ol>\n<li>답을 얻기 위해 어떤 query가 필요한지 생각한다.</li>\n<li>query에 맞게 데이터를 넣는다.</li>\n</ol>\n<h1>명령어</h1>\n<h2>해시</h2>\n<p>Key-Value 쌍으로 저장할 수 있는 데이터입니다.\n중첩하거나 배열 값을 가질 수는 없습니다.</p>\n<p>다양한 속성이 묶인 item이 있을 때 해시 구조로 저장합니다.</p>\n<h3>HSET</h3>\n<p>HSET [key] [key1] [value] [key2] [value]\nex) HSET company name 'Hello Co' age 1915\ncompany -> name: 'Hello Co', age: 1915</p>\n<ul>\n<li>추가로 알아두어야 할 것은, node-redis와 같은 라이브러리를 사용할 때, null값이 있다면 에러가 발생할 수 있습니다. node-redis 내부적으로 .toString()을 호출하기 때문인데, null || '' 와 같이 사용해주어야 합니다.</li>\n</ul>\n<h3>HGET</h3>\n<p>HGET [key] [key1]\nex) HGET company name // 'Hello Co'</p>\n<p>HGETALL company // {name 'Hello Co', age 1915}</p>\n<ul>\n<li>HGETALL을 할 때, 존재하지 않는 키에 대해 실행하면 {} 빈 Object를 응답으로 받습니다. 이 부분을 유의해서 처리해야 합니다.</li>\n</ul>\n<h3>HEXISTS</h3>\n<p>HEXISTS [key] [key1]\nkey 값 안에 key1의 값이 존재하는지 확인합니다.\nex) HEXISTS company name // 1</p>\n<h3>DEL, HDEL</h3>\n<p>DEL [key]\nkey에 저장된 값을 삭제합니다.\nex) DEL company</p>\n<p>HDEL [key] [key1]\n필드 하나만 삭제합니다.\nex) HDEL company name</p>\n<h3>HINCRBY, HINCRBYFLOAT</h3>\n<p>HINCRBY [key] [key1] [value]\nvalue만큼의 값을 key1 값에 추가합니다.\n해시에 키가 존재하지 않으면 생성합니다.</p>\n<p>HINCRBYFLOAT [key] [key1] [value]\nvalue(실수)만큼의 값을 key1 값에 추가합니다.\n해시에 키가 존재하지 않으면 생성합니다.</p>\n<h3>HSTRLEN</h3>\n<p>HSTRLEN [key] [key1]\nkey1의 길이를 반환합니다. string이 아니면 0을 반환합니다.</p>\n<h3>HKEYS, HVALS</h3>\n<p>HKEYS [key]\nkey에 저장된 값의 key들을 가져옵니다.</p>\n<p>HVALS [key]\nkey에 저장된 값의 value들을 가져옵니다.</p>\n<h2>Set</h2>\n<p>문자열의 집합을 저장합니다. 중복값은 저장되지 않습니다.</p>\n<h3>SADD</h3>\n<p>SADD  [key][value]\nkey 이름으로 set을 생성하고, value를 저장합니다.\n중복 값은 저장되지 않으므로, 저장이 성공하면 1, 실패하면 0을 반환합니다.</p>\n<h3>SMEMBERS</h3>\n<p>SMEMBERS [key]\nkey에 저장된 모든 값을 반환합니다.</p>\n<h3>SUNION</h3>\n<p>SUNION [key1] [key2] [key3] ...</p>\n<p>합집합을 반환하는 명령입니다.</p>\n<p>SUNIONSTORE [key] [key1] [key2] [key3] ...\n명령으로 새로운 key에 바로 저장할 수 있습니다.</p>\n<h3>SDIFF</h3>\n<p>SDIFF [key1] [key2] [key3] ...</p>\n<p>key1의 집합에서 key2이후의 key들의  집합을 뺍니다.\n차집합을 반환하는 명령입니다.</p>\n<p>SDIFFSTORE [key] [key1] [key2] [key3] ...\n명령으로 새로운 key에 바로 저장할 수 있습니다.</p>\n<h3>SINTER</h3>\n<p>SINTER [key1] [key2] [key3] ...</p>\n<p>교집합을 반환하는 명령입니다.</p>\n<p>SINTERSTORE [key] [key1] [key2] [key3] ...\n명령으로 새로운 key에 바로 저장할 수 있습니다.</p>\n<h3>SISMEMBER</h3>\n<p>SISMEMBER [key] [value]</p>\n<p>key에 value가 존재하면 1 존재하지 않으면 0을 반환합니다.</p>\n<h3>SMISMEMBER</h3>\n<p>SMISMEMBER [key] [value1] [value2] [value3] ...</p>\n<p>key에 각 value가 존재하는지를 배열로 반환합니다.</p>\n<h3>SCARD</h3>\n<p>SCARD [key]</p>\n<p>key의 크기(요소의 개수)를 알려줍니다.</p>\n<h3>SREM</h3>\n<p>SCARD [key] [value]</p>\n<p>key 집합에서 value를 제거합니다.</p>\n<h3>SSCAN</h3>\n<p>SSCAN [key] [cursorID] [#of elements]\nex) SSCAN items 0 COUNT 2\n[\n\"3\",\n[\n\"orange\",\n\"red\"\n]\n]</p>\n<p>cursor 값으로 부터 n개 값을 읽어옵니다.\n반환값에 다음 cursor가 포합됩니다.\nSMEMBERS로 데이터를 읽어오기에는 너무 많은 데이터가 있을 때 사용하면 좋습니다.</p>\n<h2>정렬집합</h2>\n<p>정렬집합은 hash와 같이 key value 같이 생긴 값을 내부에 갖습니다.\n하지만 key value 라고 부르지는 않고, member score라 부릅니다.\nmember값은 고유해야 합니다.\nscore는 항상 숫자여야 하고, 내부적으로 score를 기준으로 오름차순으로 정렬됩니다.</p>\n<h3>ZADD</h3>\n<p>ZADD [key] [score] [member]\nkey값의 정렬 집합에 값을 저장합니다.</p>\n<h3>ZSCORE</h3>\n<p>ZSCORE [key] [member]\nkey값의 정렬 집합에서 member의 score를 가져옵니다.</p>\n<h3>ZREM</h3>\n<p>ZREM [key] [member]\nkey값의 정렬 집합에서 member를 삭제합니다.</p>\n<h3>ZCARD</h3>\n<p>ZCARD [key]\nkey의 member 개수를 반환합니다.</p>\n<h3>ZCOUNT</h3>\n<p>ZCOUNT [key] [val1] [val2]\nkey값의 정렬 집합에서 val1과 val2 사이의 값을 가진 member의 개수를 반환합니다. 경계값은 포함합니다.</p>\n<ul>\n<li>val앞에 ( 를 붙히면 경계값을 포함하지 않습니다.</li>\n<li>-inf, +inf 값을 사용할 수 있습니다.</li>\n</ul>\n<h3>ZPOPMIN, ZPOPMAX</h3>\n<p>ZPOPMIN [key] [cnt]\nZPOPMAX [key] [cnt]</p>\n<p>상위, 하위에서 cnt개수 만큼의 값을 가져와 삭제하고 반환합니다.</p>\n<h3>ZINCRBY</h3>\n<p>ZINCRBY [key] [value] [member]\nkey값의 정렬집합에서 member의 값을 value만큼 증가시킵니다.\n음수를 줄 수도 있습니다.</p>\n<h3>ZRANGE</h3>\n<p>ZRANGE [key] [idx1] [idx2] [KEYWORD]\nkey값의 정렬집합에서 idx1~idx2사이의 인덱스를 가진 member를 반환합니다.</p>\n<ul>\n<li>WITHSCORES키워드를 사용하면 score 값도 같이 반환합니다.</li>\n<li>BYSCORE 키워드를 사용하면 idx를 인덱스로 보지 않고 score로 봅니다.</li>\n<li>REV옵션은 정렬집합을 반대로 정렬한 후 결과를 반환합니다.</li>\n<li>LIMIT a b옵션은 a만큼을 건너뛰고 b개만큼을 반환합니다. BYSCORE와 함께 사용해야 합니다.</li>\n</ul>\n<h2>HyperLogLog</h2>\n<p>HyperLogLog는 요소를 실제로 저장하지 않는 데이터 타입입니다.\n내부적으로 복잡한 알고리즘에 의해 문자열을 기억하지만 값이 실제로 저장되지 않습니다.</p>\n<p>관련된 명령어가 두 개밖에 없으므로 간편하게 사용할 수 있습니다.</p>\n<p>어떨때 사용할 수 있을까요?\n만약 상품의 조회수를 증가시킬 때, 사용자 당 한번씩만 증가시키고 싶다고 생각해봅시다.</p>\n<ol>\n<li>SET을 추가하여 itemID마다 view를 증가시킨 userID를 증가시킨다.</li>\n<li>HYPERLOGLOG를 사용한다.</li>\n</ol>\n<p>1번 방법을 사용하는 것도 가능하지만, item마다 조회한 userID를 저장하면, 엄청난 메모리가 필요할 것입니다. 이건 Redis와는 잘 맞지 않습니다.</p>\n<p>HYPERLOG는 안에 값이 얼마나 들어있는지와 상관 없이 12kb만 사용합니다. 하지만 값을 실제로 저장하지 않기 때문에 안에 몇개의 값이 존재하는지 계산하는 명령이 정확하지 않습니다. 대략 0.81%의 에러가 발생한다고 알려져 있습니다.\n하지만 조회수를 계산하는데 저정도의 오차는 그렇게 큰 영향이 아닐겁니다. 그래서 조회수와 같은 로직을 위해 HYPERLOGLOG를 사용한다면, 공간을 많이 아낄 수 있습니다.</p>\n<h3>PFADD</h3>\n<p>PFADD [key]  [value]\n값을 추가합니다.</p>\n<h3>PFCOUNT</h3>\n<p>PFCOUNT [key]\n요소의 추정적인 개수를 반환합니다.</p>\n<h2>LIST</h2>\n<p>Redis에서 List는 이중 연결 리스트 형태로 저장됩니다.</p>\n<p>Redis에서 List는 잘 사용하지 않는게 좋습니다. 비효율적이고, 대부분 다른 데이터 타입으로 더 효율적으로 사용할 수 있습니다.\n데이터의 수정 삭제 없이 끝에 계속 추가하는 경우, 수집된 데이터의 마지막 몇 개만 조회하는 경우 정도가 List와 어울립니다.</p>\n<h3>LPUSH, RPUSH</h3>\n<p>LPUSH [key] [value]\nRPUSH [key] [value]\n각각 List의 왼쪽, 오른쪽에 값을 추가합니다. List의 항목 개수를 반환합니다.</p>\n<h3>LLEN</h3>\n<p>LLEN [key]\nkey에 해당하는 List의 길이를 반환합니다.</p>\n<h3>LINDEX</h3>\n<p>LLEN [key] [idx]\nidx에 해당하는 값을 가져옵니다.\nidx는 음수도 사용할 수 있습니다. -1이 제일 마지막 항목을 의미합니다.</p>\n<h3>LRANGE</h3>\n<p>LRANGE [key] [startIdx] [endIdx]\n특정 범위의 값을 가져옵니다.\nstartIdx와 endIdx에 있는 값을 포함해서 가져옵니다.</p>\n<h3>LPOS</h3>\n<p>LRANGE [key] [value]\nRANK\nCOUNT\nMAXLEN\nkey의 list에서 value 값을 찾습니다. RANK의 값으로 N번째, COUNT값으로 N개, MAXLEN 값으로 최대 N개를 찾도록 할 수 있습니다.</p>\n<h3>LPOP, RPOP</h3>\n<p>LPOP [key]\nRPOP [key]\n각각 왼쪽 끝, 오른쪽 끝에서 값을 하나씩 제거합니다.\n맨 뒤에 숫자 n을 명시하면 n개를 제거합니다.</p>\n<h3>LSET</h3>\n<p>LSET [key] [idx] [value]\nidx위치의 값을 value로 바꿉니다.</p>\n<h3>LTRIM</h3>\n<p>LSET [key] [startIdx] [endIdx]\nstartIdx에서 endIdx 까지를 남겨두고 나머지는 전부 제거합니다.</p>\n<h3>LINSERT</h3>\n<p>LINSERT [key] [BEFORE/AFTER] [value1] [value2]\nvalue1값을 찾은 후, 앞이나 뒤에 value2값을 삽입합니다.</p>\n<h3>LREM</h3>\n<p>LREM [key] [num] [value]\nvalue의 값을 num개 제거하는 명령입니다.\nnum이 양수라면 왼쪽에서 오른쪽으로 찾으며 제거하고,\nnum이 음수라면 오른쪽에서 왼쪽으로 찾으며 제거합니다.\nnum에 0을 입력하면 value 전부를 지웁니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Resource","subCategory":"redis"}],"date":"2025-02-18","slug":"/blog/redis/use","title":"Redis 사용하기"}}},{"node":{"html":"<h1>Redis</h1>\n<p>redis는 데이터베이스입니다.\n저장한 데이터를 쿼리로 갖고 온다는 점은 다른 데이터베이스와 다른게 없습니다.\n그렇다면 Redis는 어떤점이 다를까요? 왜 Redis를 사용할까요?\n답은 간단합니다. 매우 빠르기 때문입니다.</p>\n<p>그렇다면 왜 빠를까요?</p>\n<ol>\n<li>모든 데이터가 memory에 저장됩니다.</li>\n<li>모든 데이터를 아주 단순한 구조(linked list, hash map 등)으로 관리합니다.</li>\n<li>다양한 기능이 추가돼있지 않아 단순합니다.</li>\n</ol>\n<p>물론 단점도 있습니다.\n메모리보다 큰 데이터를 가지고 작업하기 어렵습니다.\nRedis의 장점을 누리기 위해, 제한된 공간에서 제한된 기능으로 데이터를 사용하는 법을 배워야합니다.</p>\n<h1>Redis 설치</h1>\n<p>Redis를 사용하는 방법은 두가지가 있습니다.</p>\n<ol>\n<li>redis.com에서 Redis인스턴스 생성하기</li>\n<li>로컬에 설치하기</li>\n</ol>\n<p>간편하게 사용하려면 redis.com에서 설치하는게 편하지만, 무료로 사용할때는 메모리 제한이 있습니다.</p>\n<p>설치가 완료되면 redis cli 혹은 실행 환경에서 redis가 실행중인 인스턴스 정보를 입력하고 명령어를 입력하면 됩니다.</p>\n<h1>명령어</h1>\n<p>먼저 기본적인 GET, SET 명령을 봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"redis\"><pre class=\"language-redis\"><code class=\"language-redis\">SET message &#39;Hello world&#39; //&quot;OK&quot;\n\nGET message //&#39;Hello world&#39;</code></pre></div>\n<p>GET/SET [key] [value] 다음과 같은 형태로 사용하면 key값을 기준으로 value를 저장하고 가져옵니다.</p>\n<p>GET/SET 명령은 string, number 타입에만 사용이 가능합니다. List, Hash등 다른 타입데 데이터를 삽입하고 싶다면, 다른 명령을 사용해야 합니다.</p>\n<p>명령어에 대한 공식 문서를 확인하고싶다면,\n<a href=\"https://redis.io/commands\">공식문서</a>에서 확인할 수 있습니다.</p>\n<h2>SET</h2>\n<p>SET 명령을 조금 더 자세히 사용해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">SET key value [NX | XX] [GET] [EX seconds | PX milliseconds |\n  EXAT unix-time-seconds | PXAT unix-time-milliseconds | KEEPTTL]</code></pre></div>\n<p>공식문서에는 다음과 같이 나와있습니다. SET [key] [value] 외에도 다양한 옵션이 있는걸 확인할 수 있습니다.</p>\n<ul>\n<li>GET 옵션은, set을 하면서 이전에 저장된 값이 있다면 반환해줍니다.</li>\n<li>XX: redis에 이미 key가 존재할 때만 SET이 실행됩니다.</li>\n<li>NX: redis에 이미 key가 존재하지 않을 때만 SET이 실행됩니다.</li>\n<li>EX/PX: seconds/milliseconds초 후에 데이터를 redis에서 삭제합니다.</li>\n<li>EXAT/PXAT: unix time을 기준으로 그 시간이 지나면 데이터를 redis에서 삭제합니다.</li>\n</ul>\n<p>자동으로 데이터를 삭제하는 기능은 왜 필요할까요?\n이전에 말했듯이 Redis는 매우 빠릅니다. Redis를 통해 데이터를 접근하면 데이터베이스에 접근하는 것보다 빠르게 접근할 수 있습니다.</p>\n<p>따라서 자주 사용되는 데이터를 Redis에 저장해두고, 특정 시간동안 이를 유지하면 그 시간동안은 Redis를 통해 빠르게 데이터를 조회하는 캐싱 기능을 위해 자동으로 데이터를 삭제하는 기능이 존재합니다.</p>\n<h2>SET 추가</h2>\n<ul>\n<li>SETEX: SET에 EX 명령을 사용한것과 동일.</li>\n<li>SETNX: SET에 NX 명령을 사용한것과 동일.</li>\n<li>MSET: 여러 key value 동시에 등록. (MSET [key] [value] [key] [value])</li>\n<li>DEL [key]: key를 삭제합니다.</li>\n<li>SETRANGE: start인덱스부터의 값을 value로 변경합니다.\nSETRANGE [key] [start] [value]</li>\n</ul>\n<h2>GET</h2>\n<ul>\n<li>MGET: 여러 key의 값을 배열 형태로 반환해줍니다.\nMGET [key] [key] // [\"value\", \"value\"]</li>\n<li>GETRANGE: 저장된 문자열의 start에서 end까지의 index 값만을 가져옵니다.\nGETRANGE [key] [start] [end]</li>\n</ul>\n<h2>숫자 다루기</h2>\n<p>숫자도 기본적으로 문자열과 같이 GET, SET명령을 사용합니다.\n그러나 추가로 숫자에만 사용가능한 명령들이 있습니다.</p>\n<ul>\n<li>INCR [key]: key의 값을 1 증가시킵니다.</li>\n<li>DECR [key]: key의 값을 1 감소시킵니다.</li>\n<li>INCRBY [key] [value]: key의 값을 value 만큼 증가시킵니다.</li>\n<li>DECRBY [key] [value]: key의 값을 value 만큼 감소시킵니다.</li>\n<li>INCRBYFLOAT [key] [value]: key의 값을 value(실수) 만큼 증가시킵니다.</li>\n</ul>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Resource","subCategory":"redis"}],"date":"2025-02-17","slug":"/blog/redis/start","title":"Redis 시작하기"}}},{"node":{"html":"<h1>Nest.js의 Exception filters</h1>\n<p>Nest.js는 내부적으로 build-in exceptions layer를 가집니다. 발생한 예외가 application code에서 처리되지 않으면, exceptions layer로 넘어간 후 처리됩니다.\n이 때, 에러가 HttpException 혹은 HttpException을 상속한다면 해당 에러에 맞게 응답을 전송하고, 그 외의 경우는 아래와 같은 응답을 보냅니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"statusCode\"</span><span class=\"token operator\">:</span> <span class=\"token number\">500</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Internal server error\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>따라서 CustomError를 정의하고 싶다면 아래와 같이 HttpException을 상속 받아 정의하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ForbiddenException</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpException</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Forbidden'</span><span class=\"token punctuation\">,</span> HttpStatus<span class=\"token punctuation\">.</span><span class=\"token constant\">FORBIDDEN</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러나 Nest.js에는 미리 정의된 Exception이 @nestjs/common package에 정의돼 있습니다. 상황에 맞게 잘 사용하면 좋습니다.</p>\n<h1>Nest.js에서 에러 로깅하기</h1>\n<p>Nest.js는 HttpException Type의 오류를 자연스러운 앱의 흐름으로 보기 때문에, 따로 로깅을 하지 않습니다. 따라서 HttpException Type의 error를 로깅하기 위해선, 직접 HttpExceptionFilter를 작성해줘야 합니다.\nNest.js는 Exception Filter라는 예외 발생 시 동작하는 Filter를 제공합니다.</p>\n<p>저는 다음과 같이 ExceptionFilter를 작성했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Catch</span></span><span class=\"token punctuation\">(</span>HttpException<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HttpExceptionFilter</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ExceptionFilter</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>\n    <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Inject</span></span><span class=\"token punctuation\">(</span><span class=\"token constant\">WINSTON_MODULE_PROVIDER</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">readonly</span> logger<span class=\"token operator\">:</span> LoggerService<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>exception<span class=\"token operator\">:</span> HttpException<span class=\"token punctuation\">,</span> host<span class=\"token operator\">:</span> ArgumentsHost<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> host<span class=\"token punctuation\">.</span><span class=\"token function\">switchToHttp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">getResponse</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Response<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">getRequest</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Request<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> status <span class=\"token operator\">=</span> exception<span class=\"token punctuation\">.</span><span class=\"token function\">getStatus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>exception<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span>status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      statusCode<span class=\"token operator\">:</span> status<span class=\"token punctuation\">,</span>\n      timestamp<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      path<span class=\"token operator\">:</span> request<span class=\"token punctuation\">.</span>url<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>큰 기능은 없지만 winston logger를 이용해 logging 기능을 추가해줬습니다.</p>\n<p>필터를 전역에 적용하기 위해 app.module.ts에 해당 Exception Filter를 추가해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">providers<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> provide<span class=\"token operator\">:</span> <span class=\"token constant\">APP_FILTER</span><span class=\"token punctuation\">,</span> useClass<span class=\"token operator\">:</span> HttpExceptionFilter <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre></div>\n<h1>Winston을 이용한 logging</h1>\n<p>위의 코드에서 Logger로 Winston Logger를 사용했습니다.\nconsole.log 대신 winston을 선택한 이유가 몇가지 있습니다.</p>\n<ol>\n<li>Log level 관리. console.log에서는 console.log, console.error, console.warn 등을 따로 써야하지만, winston에서는 따로 처리하지 않아도 됩니다.</li>\n<li>자동으로 logging된 시간이 기록됩니다. 로그 분석시 매우 유용합니다.</li>\n<li>Winston은 log 포맷을 지정할 수 있습니다. ELK에서 로그를 관리할 때, 이런 포맷이 지정돼있는 형태가 유리합니다.</li>\n</ol>\n<p>저는 winston에 간단한 설정을 추가해 로그를 json 형태로 관리할 예정입니다.\nmain.ts에 다음과 같은 설정을 추가해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">bootstrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> NestFactory<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>AppModule<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    abortOnError<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    bodyParser<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    rawBody<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    logger<span class=\"token operator\">:</span> WinstonModule<span class=\"token punctuation\">.</span><span class=\"token function\">createLogger</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      transports<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">winston</span><span class=\"token punctuation\">.</span>transports<span class=\"token punctuation\">.</span><span class=\"token function\">Console</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> format<span class=\"token operator\">:</span> winston<span class=\"token punctuation\">.</span>format<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제 아래와 같이 일관된 json 형태로 로깅이됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">{\"context\":\"ExceptionsHandler\",\"level\":\"error\",\"message\":\"no token\",\"stack\":[null]}\n{\"context\":\"RouterExplorer\",\"level\":\"info\",\"message\":\"Mapped {/vote2/test, GET} route\"}</code></pre></div>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-02-15T00:00:00.000Z","slug":"/blog/about/errorhandling","title":"Nest.js는 어떻게 Error Handling을 할까?"}}},{"node":{"html":"<p>다음 <a href=\"https://expressjs.com/en/guide/error-handling.html\">Express.js 공식문서</a> 를 참고하여 작성하였습니다.</p>\n<h1>Express.js는 어떻게 Error Handling을 할까?</h1>\n<p>Express.js에는 default error handler가 있습니다. 공식 문서에 따르면, 내부적으로 error가 발생하면 다음의 정보들을 추가해 클라이언트로 전송합니다.</p>\n<ul>\n<li>res.statusCode: err.status의 값으로 설정됩니다.</li>\n<li>res.statusMessage: statusCode에 따라 설정됩니다.</li>\n<li>body: HTML 형식의 status code message</li>\n<li>err.headers object에 정의된 header</li>\n</ul>\n<p>만약 에러가 발생할 때 next() 에 아무 매개변수나 넘겨주면 Express가 에러라 판단하고 error handler로 보냅니다.</p>\n<p>Express4 까지는 비동기에서 발생한 에러는 따로 처리 해줘야 했지만, Express5부터는 비동기에서 발생한 에러도 자동으로 next(err)를 호출해주기 때문에 따로 처리할 필요가 없습니다.</p>\n<h1>Custom Error Handler는 어떻게 만들까?</h1>\n<p>Custom Error Handler를 만들 땐, 기존 middleware 형식에 (err, req, res, next) 이렇게 4개의 인자를 넘겨주면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>stack<span class=\"token punctuation\">)</span>\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Something broke!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Express.js는 정의된 middleware와 route를 순차적으로 처리합니다.\n다음과 같이 맨 마지막에 Error handler를 정의해야 오류를 처리할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">setupRoutes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// 라우터 설정</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/user\"</span><span class=\"token punctuation\">,</span> user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>ErrorHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<h1>왜 Custom Error Handler를 만들게 되었을까?</h1>\n<p>제가 기존에 정의해둔 Error Handler는 Express의 default error handler와 크게 다른게 없었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NextFunction<span class=\"token punctuation\">,</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n\n  \n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ErrorHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\"><span class=\"token literal-property property\">err</span><span class=\"token operator\">:</span> any<span class=\"token punctuation\">,</span>\n  req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n  res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span>\n  next<span class=\"token operator\">:</span> NextFunction<span class=\"token punctuation\">,</span></span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Middleware Error Handling\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> errStatus <span class=\"token operator\">=</span> err<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">||</span> <span class=\"token number\">500</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> errMsg <span class=\"token operator\">=</span> err<span class=\"token punctuation\">.</span>message <span class=\"token operator\">||</span> <span class=\"token string\">\"Something went wrong\"</span><span class=\"token punctuation\">;</span>\n  \n  res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span>errStatus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      success<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\t  <span class=\"token literal-property property\">status</span><span class=\"token operator\">:</span> errStatus<span class=\"token punctuation\">,</span>\n\t  <span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> errMsg<span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">stack</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"development\"</span> <span class=\"token operator\">?</span> err<span class=\"token punctuation\">.</span>stack <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  \n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ErrorHandler<span class=\"token punctuation\">;</span></code></pre></div>\n<p>단순히 logging을 하고, 클라이언트로 에러를 보내는 형식입니다.</p>\n<p>이 방식을 사용할 때는 다음과 같은 문제가 있었습니다.</p>\n<ol>\n<li>어떤 Error인지 구분되지 않습니다. Validation과정에서 발생한 에러인지, Database에서 발생한 에러인지 구분이 가능하다면 더 빠른 대처가 가능할 것입니다.</li>\n<li>예상한 예외에서 발생한 에러인지, 예기치 않게 발생한 에러인지 구분되지 않습니다. 에러처리가 된 곳에서 발생한 에러가 아닌 것을 따로 처리하여 앱의 안정성을 높이고 싶었습니다.</li>\n</ol>\n<p>이를 해결하기 위해 다음과 같은 Error Handler를 정의했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> NextFunction<span class=\"token punctuation\">,</span> Request<span class=\"token punctuation\">,</span> Response <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"express\"</span><span class=\"token punctuation\">;</span>\n  \n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ErrorHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\"><span class=\"token literal-property property\">err</span><span class=\"token operator\">:</span> any<span class=\"token punctuation\">,</span>\n  req<span class=\"token operator\">:</span> Request<span class=\"token punctuation\">,</span>\n  res<span class=\"token operator\">:</span> Response<span class=\"token punctuation\">,</span>\n  next<span class=\"token operator\">:</span> NextFunction<span class=\"token punctuation\">,</span></span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>isOperational<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>statusCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      success<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">...</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>errors <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">errors</span><span class=\"token operator\">:</span> err<span class=\"token punctuation\">.</span>errors <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Unexpected Error: \"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      success<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token string\">\"An unexpected error occured\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  \n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ErrorHandler<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Custom Error Type을 정의한 후, error에 isOperational 맴버를 추가하여 예상한 오류인지 구분해줍니다. 또한 각각의 Custom Error에서 status코드를 지정해줄겁니다.</p>\n<p>아래는 직접 정의한 AppError입니다. 이 AppError를 상속받는 Error들을 만들어줄 겁니다. 그럼 그 Error들은 isOperational 필드를 가지고, 각각 미리 정의된 status code를 갖게 됩니다.</p>\n<ul>\n<li>AppError</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AppError</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Error</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> readonly statusCode<span class=\"token operator\">:</span> number<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">public</span> readonly isOperational<span class=\"token operator\">:</span> boolean<span class=\"token punctuation\">;</span>\n  \n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">message</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">statusCode</span><span class=\"token operator\">:</span> number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">=</span> statusCode<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isOperational <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  \n    Error<span class=\"token punctuation\">.</span><span class=\"token function\">captureStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>constructor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>예를 들면 아래와 같습니다.</p>\n<ul>\n<li>DatabaseError</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppError <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./AppError\"</span><span class=\"token punctuation\">;</span>\n  \n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseError</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppError</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> string <span class=\"token operator\">=</span> <span class=\"token string\">\"Database error occurred\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>ValidationError</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> AppError <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"./AppError\"</span><span class=\"token punctuation\">;</span>\n  \n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ValidationError</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppError</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> readonly errors<span class=\"token operator\">:</span> string<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token function\">consructor</span><span class=\"token punctuation\">(</span>message<span class=\"token operator\">:</span> string <span class=\"token operator\">=</span> <span class=\"token string\">\"Validation error\"</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">errors</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>errors <span class=\"token operator\">=</span> errors<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이런 형태로 Custome Error를 지정해주면</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">throw new ValidationErrror();\nnext(new ValidationError());</code></pre></div>\n<p>와 같은 형식으로 사용할 수 있습니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-02-01T00:00:00.000Z","slug":"/blog/about/error","title":"Express.js는 어떻게 Error Handling을 할까?"}}},{"node":{"html":"<h1>왜 clustering 기능이 필요했을까?</h1>\n<p>스터디 매칭기능은 About 프로젝트의 주요 기능중 하나입니다.</p>\n<h2>기존의 방식</h2>\n<p>기존의 스터디 투표에는 다음과 같은 요소가 있었습니다</p>\n<ul>\n<li>1지망, 2지망 선택 가능</li>\n<li>스터디 장소 선택가능</li>\n<li>시간 선택 가능</li>\n</ul>\n<p>이를 지원하기 위해 매칭 알고리즘은 과정을 따랐습니다.</p>\n<ol>\n<li>1지망의 데이터를 대상으로 시간이 겹치는 사람을 탐색</li>\n<li>2시간이상 겹치는 사람이 n명 이상이면, 스터디 상태를 open으로 변경</li>\n<li>1지망 투표에 실패한 사람들 중 open된 장소에 2지망 투표를 한 사람이라면 그곳으로 이동</li>\n<li>스터디 매칭이 완료된 사람과 장소는 제외하고, 매칭이 실패한 장소에서 2지망 투표한 사람들을 대상으로 스터디가 열릴 수 있는지 확인.</li>\n</ol>\n<h1>기존 방식엔 어떤 문제가 있었을까?</h1>\n<p>기존의 스터디 투표 방식에는 아래와 같은 문제들이 있었습니다.</p>\n<ul>\n<li>유저가 1,2지망 장소 시간 등을 선택해야 해서 행동이 많아진다.</li>\n<li>1,2지망이 잘 겹치지 않아 가까운 거리임에도 매칭이 잘 이루어지지 않음</li>\n<li>데이터 구조의 문제이기도 하나, 기존의 데이터 구조에서는 효율적으로 알고리즘을 구현하기가 어려움.</li>\n</ul>\n<p>이에 먼저 유저가 선택해야 할 것들을 줄이고 싶었고, 전체적으로 알고리즘도 수정하고 싶었습니다.</p>\n<h1>DBSCAN 알고리즘을 활용한 알고리즘을 도입하자</h1>\n<p>이런 문제점들을 해결하기 위해 유저에게 위치(위도, 경도)만을 입력받고, 이를 밀도 기반 클러스터링으로 묶은 뒤, 적절한 스터디 장소로 보내는 방식을 채택했습니다.</p>\n<h2>밀도 기반 클러스터링(DBSCAN)</h2>\n<p>다차원 데이터를 기반으로, 가까운 포인트들을 클러스터링하는 알고리즘입니다.</p>\n<p>K-means알고리즘도 고려했으나, cluster될 개수를 미리 정해줘야 한다는 점과, 초기 centroid값을 정해줘야 한다는 점, 결과가 매번 달라진다는 점이 우리의 데이터와 잘 맞지 않는다 생각하여 DBSCAN알고리즘을 선택했습니다.</p>\n<p>DBSCAN알고리즘은 minPts(최소 점의 개수)와 epsilon(반경) 두 가지의 변수를 사용합니다.\n동작 방식을 간단히 설명하면,</p>\n<ol>\n<li>특정 점 A를 중심으로 epsilon 거리 내에 minPts이상의 점들이 존재하면 A를 core point로 판단</li>\n<li>core point끼리 epsilon 거리 내에 있다면 같은 cluster가 된다.</li>\n<li>나머지 점들은 noise point로 판단한다.</li>\n</ol>\n<p>와 같이 동작합니다.</p>\n<h1>적용</h1>\n<p>DBSCAN알고리즘은 \"density-clustering\" 라이브러리를 사용하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">DBSCANClustering</span><span class=\"token punctuation\">(</span>\n    coords<span class=\"token operator\">:</span> coordType<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    eps<span class=\"token operator\">:</span> number<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">clusters</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> noise<span class=\"token operator\">:</span> number<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token constant\">DBSCAN</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">clustering<span class=\"token punctuation\">.</span>DBSCAN</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  \n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> lat<span class=\"token punctuation\">,</span> lon <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> any</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span>lat<span class=\"token punctuation\">,</span> lon<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">const</span> minPts <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 한 지점 근처에 최소 3개 이상 모여야 클러스터로 인정</span>\n  \n    <span class=\"token keyword\">const</span> clusters <span class=\"token operator\">=</span> <span class=\"token constant\">DBSCAN</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> eps<span class=\"token punctuation\">,</span> minPts<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      clusters<span class=\"token punctuation\">,</span>\n      noise<span class=\"token operator\">:</span> <span class=\"token constant\">DBSCAN</span><span class=\"token punctuation\">.</span>noise<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 코드와 같이 위도, 경도로 구성된 배열 데이터를 만든 다음, DBSCAN알고리즘을 돌려주면 됩니다. cluster 그룹과, noise그룹이 배열 인덱스를 값으로 하는 데이터 구조로 반환됩니다.</p>\n<p>여기서 저희가 설정할 수 있는 것들은, 클러스터의 거리 eps와 최소 점 개수 minPts 두 개 뿐입니다.</p>\n<p>그러나 스터디를 위한 그룹을 만들 때는, 한 카페에 너무 많은 인원이 가는것도 안되므로 최대 인원도 제한해야 합니다. 이를 어떻게 구현할까요?</p>\n<p>방법은 간단합니다. 크기가 큰 그룹을 대상으로 더 작은 eps값을 이용해 DBSCAN 알고리즘을 다시 돌려 쪼개주면 됩니다.</p>\n<p>저는 가장 긴 클러스터가 8이 될때까지 계속 쪼개주도록 반복문을 돌렸습니다.\nDBSCAN알고리즘 관련 코드가 길어져 별도의 ClusterUtils라는 클래스로 분리했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">async</span> <span class=\"token function\">setResult</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">date</span><span class=\"token operator\">:</span> Date</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">participations</span><span class=\"token operator\">:</span> IParticipation<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> \n      <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Vote2Repository<span class=\"token punctuation\">.</span><span class=\"token function\">findParticipationsByDate</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">coords</span><span class=\"token operator\">:</span> coordType<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> participations<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">loc</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        lat<span class=\"token operator\">:</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>loc<span class=\"token punctuation\">.</span>latitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        lon<span class=\"token operator\">:</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>loc<span class=\"token punctuation\">.</span>longitude<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token comment\">//시작 거리</span>\n    <span class=\"token keyword\">let</span> eps <span class=\"token operator\">=</span> <span class=\"token number\">0.01</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> maxMember <span class=\"token operator\">=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> clusters<span class=\"token punctuation\">,</span> noise <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ClusterUtils<span class=\"token punctuation\">.</span><span class=\"token function\">DBSCANClustering</span><span class=\"token punctuation\">(</span>coords<span class=\"token punctuation\">,</span> eps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token comment\">//클러스터 결과 8명이 넘는 클러스터가 있을 경우, 더 작게 더 분해.</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>ClusterUtils<span class=\"token punctuation\">.</span><span class=\"token function\">findLongestArrayLength</span><span class=\"token punctuation\">(</span>clusters<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> maxMember<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      clusters<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">cluster</span><span class=\"token operator\">:</span> number<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cluster<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;=</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> newCoords <span class=\"token operator\">=</span> coords<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">coord<span class=\"token punctuation\">,</span> j</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> cluster<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n        <span class=\"token keyword\">let</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">clusters</span><span class=\"token operator\">:</span> newClusters<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">noise</span><span class=\"token operator\">:</span> newNoise <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span>\n          ClusterUtils<span class=\"token punctuation\">.</span><span class=\"token function\">DBSCANClustering</span><span class=\"token punctuation\">(</span>newCoords<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>eps <span class=\"token operator\">/=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n        clusters<span class=\"token punctuation\">.</span><span class=\"token function\">splice</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>newClusters<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  \n    <span class=\"token comment\">//cluster결과(인덱스)를 실제 데이터로 치환</span>\n    <span class=\"token keyword\">const</span> formedClusters <span class=\"token operator\">=</span> ClusterUtils<span class=\"token punctuation\">.</span><span class=\"token function\">transformArray</span><span class=\"token punctuation\">(</span>\n      clusters<span class=\"token punctuation\">,</span>\n      participations<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">const</span> <span class=\"token literal-property property\">places</span><span class=\"token operator\">:</span> IPlace<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>PlaceRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByStatus</span><span class=\"token punctuation\">(</span><span class=\"token string\">'active'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token comment\">//클러스터링 결과 계산</span>\n    <span class=\"token keyword\">const</span> voteResults <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> ClusterUtils<span class=\"token punctuation\">.</span><span class=\"token function\">findClosestPlace</span><span class=\"token punctuation\">(</span>\n      formedClusters<span class=\"token punctuation\">,</span>\n      places<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>Vote2Repository<span class=\"token punctuation\">.</span><span class=\"token function\">setVoteResult</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> voteResults<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>while문 외에는 대부분 데이터를 가공하고 DB에 읽고 쓰는 과정이므로, while문 부분만 보면 될 것 같습니다.</p>\n<p><img src=\"images/20241230140929.png\" alt=\"\">\nmock data로 테스트 결과, 다음과 같이 101명의 참여자가 14개의 그룹으로 잘 클러스터링 된 것을 확인할 수 있었습니다.</p>\n<h1>마무리</h1>\n<p>위 알고리즘이 실제 데이터에서 얼마나 잘 작동할지는 앞으로 지켜봐야 합니다.\n그리고 지역마다 eps값을 조정해야 하는 경우도 있을 것 같고, 유저별로 선호하는 거리가 다를 수 있다는 점도 고려해야 할 수 있습니다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-01-05T00:00:00.000Z","slug":"/blog/about/clustering","title":"위도 경도 기반 clustering 알고리즘"}}},{"node":{"html":"<p>현재 About은 Heroku를 이용해서 배포를 진행하고 있습니다.\n지난번에 비용 분석을 했을 때, Heroku에서 AWS로 옮기면 한달에 약 $84를 아낄 수 있겠다는 예측이 나와서, 실제로 AWS상에 CI/CD파이프라인을 구성해보았습니다.</p>\n<h1>구성</h1>\n<p>사용한 툴은 다음과 같습니다.</p>\n<ul>\n<li>AWS-ec2: Docker container를 실행하고 요청을 받는 주체</li>\n<li>AWS ECR: Docker image의 저장소</li>\n<li>AWS codebuild: buildspec.yml을 통해 Docker image를 빌드하고 ECR에 푸쉬</li>\n<li>AWS codedeploy: ECR에서 컨테이너를 가져와 EC2에서 실행</li>\n<li>AWS codepipeline: github코드 트래킹, build, deploy과정을 pipeline으로 만들어 실행</li>\n<li>AWS-s3: pipeline의 각 과정 결과 저장</li>\n<li>AWS-IAM: 각 과정의 권한 설정</li>\n</ul>\n<p>간단히 도식화 해보면 아래와 같습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42nWS146EMAxFQ29D7wNv8P+/6NGxZIRY9uEqxMktdnBBEMgTvu8rPM/T9e3sjQfcm1gYhpJlmQzDoJimSZZlkXEc5fP56Pm/gpbE0iBU17WueZ4riqKQqqqkLEv9BkmSvHbgIONMkjiONc08z5qibVvpuu5KjCg1BDG6m1+Cfd/Lvu+ybZteRIz2aO37/cq6rpKmqe4xBk3TaFrM4WJ0CRIdQLJUEKjZ3KIo0joCkElEN6Q8jkON4V8zvIOLHDIfVpIzDtLbo1G3AIjbTDlzzxe2yzZwSOd5CqNxzmkdU4Tszv1h/gjiRCu0CZE9D0OrVkPMEj1/mx/PFMYorgWr6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250103105340\"\n        title=\"\"\n        src=\"/static/8e9e5e26b1cc919081c82fef4a0a350c/5a190/20250103105340.png\"\n        srcset=\"/static/8e9e5e26b1cc919081c82fef4a0a350c/772e8/20250103105340.png 200w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/e17e5/20250103105340.png 400w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/5a190/20250103105340.png 800w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/c1b63/20250103105340.png 1200w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/29007/20250103105340.png 1600w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/1e1c3/20250103105340.png 1670w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>비용 분석</h1>\n<p>처음 비용 예측을 할 때는 AWS 인스턴스와 저장소 비용, IP 주소 비용 정도만 포함해서 계산했는데, 그것보다는 구조가 복잡해져서 다시 비용 분석을 해보겠습니다.</p>\n<h2>AWS EC2</h2>\n<p>Ubuntu 이미지에 ram 4Gib를 지원하는 t2.miedium을 사용. 시간당 $0.0576가 청구된다.</p>\n<p>한달에, 0.0576 * 24 * 30 = $41.472가 청구된다.</p>\n<h2>Elastic IP</h2>\n<p>매월 약 $3.5가 청구된다.</p>\n<h2>EBS 볼륨</h2>\n<p>GB당 월 $0.0912\n70GB 사용을 가정하면, 한달에 약 $6.5 비용 발생</p>\n<h2>Elastic Container Registry</h2>\n<p>GB당 월 0.10.\n10GB정도 사용한다 가정하면 한달에 약 $1 의 비용 발생</p>\n<h2>AWS Codebuild</h2>\n<p>codebuild는 build 분당 요금을 청구한다. 어떤 인스턴스를 사용하는지에 따라 다르지만, 대충 분당 $0.01가 청구된다고 생각하면 될 것 같다.</p>\n<p>빌드하는데 3분이 걸린다 가정하고, 하루에 2번 빌드가 진행된다 가정하자. 이는 매우 보수적으로 잡은 수치이다.\n0.01 * 3 * 2 * 30 = $1. 한달에 약 $1가 청구된다.\n프론트엔드 백엔드 각각이라 생각하면 한달의 $2가 청구될 것이다.</p>\n<h2>AWS Codedeploy</h2>\n<p>codedeploy는 업데이트당 $0.02의 요금을 부과한다.\n위에서와 마찬가지로 하루에 2번씩 배포된다 가정하자. 프론트 백, 두개를 생각하면</p>\n<p>0.02 * 2 * 30 * 2 = $2.4의 비용이 매달 청구된다.</p>\n<h2>AWS codepipeline</h2>\n<p>codepipeline은 파이프라인당 매월 $1를 청구한다.\n2개의 pipeline을 만들 것이므로 매월 $2가 청구된다.</p>\n<h2>AWS S3</h2>\n<p>GB당 매월 $0.023가 청구된다.\ncodepipeline과정에서 저장되는 양은 엄청나게 작으므로 고려하지 않아도 될 것 같다.</p>\n<h1>총 비용</h1>\n<p>41.5 + 3.5 + 6.5 + 1 + 2 + 2.24 + 2 = 대략 60</p>\n<p>한달에 $60 정도의 비용을 생각하면 될 것 같다.</p>\n<p>Heroku 배포가 매월 $130였으므로, $70 = 약 10만원을 매달 아낄 수 있다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2025-01-03T00:00:00.000Z","slug":"/blog/about/pipeline","title":"AWS를 이용한 CI.CD pipeline 구성"}}},{"node":{"html":"<p>현재 About은 Heroku로 Frontend와 Backend모두 배포하고 있습니다.</p>\n<h1>Heroku</h1>\n<h2>Frontend</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABi0lEQVR42pVS2UrEQBDM//+CH6E+iAeIL6Ki6KvghaImm2ST2RxzH2XPJC4qHthQTE9nUlNdPVnbMrSsQzcMqBuG7YNTbO2fYHPvGA3rESOEgO9iOXjkzKHoHMreg4mAjEmOUSlIriAIVcWwWDQoigZSmpkQ4NpBGwdLq6XVGAvjAgFQJkBbygnZRnGGs/YRiimUJald9hCjhiRoaddqLq9v8fCUoypa1DVDUdbo+gFc8PWZ2EkmgyWFElXdIC8rvC5KVMs2HW7YCkrrdNgZQ6oMZOxmhpASSuk1oY+E6433CD58us05R/WQ8mRjwJzP+6k0eTzXM60NqTDp5ziEu8cc99TaS17jr3B0mYz+udlDWrNV16MfOHkhcPPwgp3Dc+weXeD06npuYxrKV8SIZMVqmnDEKk5ZSIVhFOSHxsglEauEmMf61DJ+xMdILVtLz0HbZL4gomEmjTYY+vYb2VfEy7PnuwbLoic1EZymOxKhxH/DOw9HArKmGtAznlRaKr4jqvsPLA3VOY83eGxX56WdcRAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241223132945\"\n        title=\"\"\n        src=\"/static/3ba615688c5b9e71114d646f3c9199a9/5a190/20241223132945.png\"\n        srcset=\"/static/3ba615688c5b9e71114d646f3c9199a9/772e8/20241223132945.png 200w,\n/static/3ba615688c5b9e71114d646f3c9199a9/e17e5/20241223132945.png 400w,\n/static/3ba615688c5b9e71114d646f3c9199a9/5a190/20241223132945.png 800w,\n/static/3ba615688c5b9e71114d646f3c9199a9/ee455/20241223132945.png 863w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>대략적인 비용을 계산해보면 0.146 _ 24 _ 30 = 105.12. 즉 한달에 $105정도 청구되고 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA2klEQVR42oVQ7W7DIAzM+z/jpLXNl9ouTSBAAAPXg0XTtD9DOp1t7mxMZ4yFsQ6SEv47JWd4rSFRECr2HeIDIr0+BFh3oAsh/jRLklBKQWJecmnIKZ+1zI7kGJHZuJqF3izS9BWb2tHtxsO5iMrL6qC0h949DLHpg8aIEATu4OA6kIMNa0odUNRUHF74QsHja0U3TxvmUWEcNvSfC8bbiht5Yj5cyP2G+8T7fm26x8z4+sLl44mBPFwX3GcNaz2eL4Uun2v9Rmr8vWYW5ida/EfbwC+I/FO1W7wBuvWEraC6FjMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241223133004\"\n        title=\"\"\n        src=\"/static/528e011b15c58ab0ff981db9889395c8/5a190/20241223133004.png\"\n        srcset=\"/static/528e011b15c58ab0ff981db9889395c8/772e8/20241223133004.png 200w,\n/static/528e011b15c58ab0ff981db9889395c8/e17e5/20241223133004.png 400w,\n/static/528e011b15c58ab0ff981db9889395c8/5a190/20241223133004.png 800w,\n/static/528e011b15c58ab0ff981db9889395c8/c1b63/20241223133004.png 1200w,\n/static/528e011b15c58ab0ff981db9889395c8/29007/20241223133004.png 1600w,\n/static/528e011b15c58ab0ff981db9889395c8/27f8b/20241223133004.png 1730w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n메모리 사용량을 보면 최대 1GB의 메모리를 사용중인데, 현재 최대 1.6GB를 사용하고 있어서 평균적으로 메모리 사용량을 넘고 있는걸 확인할 수 있다.</p>\n<h2>Backend</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB5ElEQVR42o2T2W4TQRBF55P5GD6EF8Qb5ikEobDIEKRxIkJsDBl7tt6m90tVjx0lIolS0pGn2+Nbyy1Xbduj60dIpbDeNniz+IjXbz/g/dk5ODIej1ZnbIeEP2MkEgaTUanoMFkHZz2EMKgvNqgvN1j/bpBzJoAYM/TkEUIqRCLFBGMjjKO7BFif4QIJvqpP0UiB7mbE0CuIXkMMCv0g4EMslTgf8OLlAqfLDUQnsG/o3U5i13YYhYQxhpLGUkAlpgmT99BaQ5sJir5U9Ozo7hg5ZZzVDbZ7ASklhKSkUt0ykCgnTfRetb74DknVyIHEqOWx0/RpS/stzZbHEai9RNk99eb8w1gXYG1AdVUvqdUeu/2APRnU7Fo0+w43TVva5jY8ZVfaUQd+Zpoxx/OBiQWfMLEYwoIpkRHxf/g+53Qwb6bieSltYCaLy6stPn+7wKflCj/Xf29FHwt2taPV4XXpCU1jr6TSYFjwvP6FdydfsTj5gh+r6/IjHvRc6X14QS0Jtor3L6HXCdJShZKqG+VcpVSmODge4PNDYveE7wQbVzlazlgWNpJTvLyhrIAldz095yd6vivMYpFmWl2vduh2AsMw0pLOVTHjqMp5Hn5+FvwvqoyyCD4c3DwyO3fM+hzSgX9+t/EscKtLcQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241223133034\"\n        title=\"\"\n        src=\"/static/f74e373d4afba4fc4812c4e5b7f7edc5/5a190/20241223133034.png\"\n        srcset=\"/static/f74e373d4afba4fc4812c4e5b7f7edc5/772e8/20241223133034.png 200w,\n/static/f74e373d4afba4fc4812c4e5b7f7edc5/e17e5/20241223133034.png 400w,\n/static/f74e373d4afba4fc4812c4e5b7f7edc5/5a190/20241223133034.png 800w,\n/static/f74e373d4afba4fc4812c4e5b7f7edc5/39a20/20241223133034.png 859w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n대략적인 비용을 계산해보면 0.035 _ 24 _ 30 = 25.2. 즉 $25정도 청구되고 있는걸 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAoElEQVR42q1P0Q4CIQzj/7/URON5dwMGA2rHoc8+SNKsK12XBYkJp0SYGX59qgUpK2o1ZHJrDVoqPCuokpwbjvOGUhLGABoNvfeJ1ryOqQ1+mrGyjzGjMNB119z32oWBTLYp2jXModavkBnUP9qYgX31XyxfZej9+UIQyRDhCakiThRuX5h86ewzq+Z6eZfHeaKWeeljOxB86z/gZ+9HxBs5tolkbxZKeQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241223133059\"\n        title=\"\"\n        src=\"/static/72515e13d583eb1b03dce331fdd7182b/5a190/20241223133059.png\"\n        srcset=\"/static/72515e13d583eb1b03dce331fdd7182b/772e8/20241223133059.png 200w,\n/static/72515e13d583eb1b03dce331fdd7182b/e17e5/20241223133059.png 400w,\n/static/72515e13d583eb1b03dce331fdd7182b/5a190/20241223133059.png 800w,\n/static/72515e13d583eb1b03dce331fdd7182b/c1b63/20241223133059.png 1200w,\n/static/72515e13d583eb1b03dce331fdd7182b/29007/20241223133059.png 1600w,\n/static/72515e13d583eb1b03dce331fdd7182b/b8bf8/20241223133059.png 1728w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n백엔드는 최대 512 MB의 메모리를 사용할 수 있는데, 평균적으로 20% 정도의 메모리만 사용하고 있다.</p>\n<h2>총정리</h2>\n<h1>AWS EC2</h1>\n<h2>인스턴스</h2>\n<p>다음은 아시아 서울 지역에서 AWS EC2의 인스턴스별 시간당 요금이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABwElEQVR42nWUi7KDIAxE/f8vbYtgfaHVtlxOIIi9LTOOGJPNJhtopnkOwzAG1r7voW1tuN97+X69XmHbdtlP0xTGccw+bXg8HmKfY7zrOvn/fr9DM01zBLjLz+fzKc59nwBxwFYA45N8bEy0ZUAfvF8kOashq7VWgpVh3w/ynRhuhcmyLOJjDAwPexvjhyHFNBi67mBonQuz94UhACwfbeu6Job2YAg7F2MgJgxxBL0G9BWglkzguj6Sj3VhqxJRIS0pgNoznMmmIp0BfQVoi1hUQwuUhJRMxsIw7u+VKFoyflqyACrD2FdbkWjI4FxX2ACo/fgFaOIkFLFgGBP0uW0NstdjY4wpPa0BGa9lyYCmPY0NCUbtIY6MCo57zs6g6ticAfPYVION/Xq9hUFVppTL5SoqajmM0X/AqZpDUwBV5dvNyF5KJgP9AQC2XW7B50kB8LNkn1VGB5IVhlAHkJ/sPwH1pESTBJN4iSQgAkPVQVSmTGWIyt/OsqqMD4CAs3i709hEx1T/kgGtBP8CPC6H/QQIiXKWuWF469Hj+lJRPgHpkxy9qoeuikmiRIa8iyjdF1Ho4bp+FSWpfBOV/wAdVytblBGlLwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241223134501\"\n        title=\"\"\n        src=\"/static/6a1e15544b2095789b78f89bedec7702/5a190/20241223134501.png\"\n        srcset=\"/static/6a1e15544b2095789b78f89bedec7702/772e8/20241223134501.png 200w,\n/static/6a1e15544b2095789b78f89bedec7702/e17e5/20241223134501.png 400w,\n/static/6a1e15544b2095789b78f89bedec7702/5a190/20241223134501.png 800w,\n/static/6a1e15544b2095789b78f89bedec7702/c1b63/20241223134501.png 1200w,\n/static/6a1e15544b2095789b78f89bedec7702/d93d9/20241223134501.png 1243w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>현재 백엔드는 110MB정도의 메모리만 사용하고, 프론트엔드는 1.6GB정도를 사용하고 있으므로 4GB 메모리의 인스턴스를 빌리면 앱을 충분히 배포할 수 있을 것으로 보인다.</p>\n<ul>\n<li>4GB메모리가 필요할 것으로 예상되므로, t4g.medium 인스턴스를 사용한다면 시간당 $0.0416가 청구된다.</li>\n</ul>\n<h2>Public IP V4 주소</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSklEQVR42pWS6XLCMAyE/f6PSXOQO7EdQi5UfQIzpdM/zcyOVvKx3gXnvZc8z6XrWgkhyO12k3merd7vq2zbKsuyKL/Luq5PKKdfFNu2Gd/2XfhcjNEurOtartdKayVFUcjX5SLDMMocZ2HPrAJcjJD1L1FqBDGYkGNT13Vv9H3/iWGQXudt01rf9crbVgbloGma51z3cJfDwjRN4hXjONoi/TR56xOIgzk1+PAxS3PsO56M5SzLTa0sS7MMotpNWZ3nKedxyKGAH7/4rhnCHQcazQ8bXMjTyZNZioC1NK+r6mPeaBTpLK90BEszaFa2UDfvRcIPwUvvZ2nDapV/BWewB4hsh2vlpS7ooez1K1eqXigv1S4ClpeCS7Dv/ZODENMc0Wg54talLA7NIGUBUH+v/bHnZwXstwwZ8hoUoiqlXxBbj8dD/vt9A+jfAfcne0KGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241223141541\"\n        title=\"\"\n        src=\"/static/167f6b219fb28e90028a0363ceb9bc26/5a190/20241223141541.png\"\n        srcset=\"/static/167f6b219fb28e90028a0363ceb9bc26/772e8/20241223141541.png 200w,\n/static/167f6b219fb28e90028a0363ceb9bc26/e17e5/20241223141541.png 400w,\n/static/167f6b219fb28e90028a0363ceb9bc26/5a190/20241223141541.png 800w,\n/static/167f6b219fb28e90028a0363ceb9bc26/c1b63/20241223141541.png 1200w,\n/static/167f6b219fb28e90028a0363ceb9bc26/29007/20241223141541.png 1600w,\n/static/167f6b219fb28e90028a0363ceb9bc26/28884/20241223141541.png 1755w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>프론트엔드와 백엔드 각각 Elastic IP를 한개씩 제공받는다면, 2 _ 0.005 _ 24 * 30 = 7.2. 즉 $7.2정도가 매달 청구될 것이다.</li>\n</ul>\n<h2>EBS 볼륨</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABI0lEQVR42n1SCXKDMBDj/z9M04ROwCaAbU5zmGNrLaUDaaae0eBD1kpmg3sY0j38oqqsqGlaRtd11LYtw9ptviwLYazrSv+NYJ5nJhVF6S9avog9YJom/h7FUGxfvxW8Xj8pimIqy/IkchQtioLP81yREJKeacoGjDE0jiNzABQMpExIKU1aG467ixxRVRUprTZhzD1fac3rcXRnwcvlg263uycpMp7gnPsjiIh4RziUUlLqHVprffHlxGNBVDFmAxy+isHxMAw+cvUbE3cw77r+lIgFQd7xzh324f7xiNidTBKKY8F4Zhn1fX8WFEJQ4klCJNwir2/YNA0DrhBZ+7fLspzXdV3zmXNHwZ+qeKPj392xtwjiQQiRIWx9+2Ac2wyC35MnuMgF44jfAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241223134956\"\n        title=\"\"\n        src=\"/static/69987f211cad643aec352f82abac963c/5a190/20241223134956.png\"\n        srcset=\"/static/69987f211cad643aec352f82abac963c/772e8/20241223134956.png 200w,\n/static/69987f211cad643aec352f82abac963c/e17e5/20241223134956.png 400w,\n/static/69987f211cad643aec352f82abac963c/5a190/20241223134956.png 800w,\n/static/69987f211cad643aec352f82abac963c/c1b63/20241223134956.png 1200w,\n/static/69987f211cad643aec352f82abac963c/29007/20241223134956.png 1600w,\n/static/69987f211cad643aec352f82abac963c/5f7fb/20241223134956.png 1889w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>t4g.medium 인스턴스는 EBS 볼륨을 따로 사용해야 하므로, EBS 볼륨의 범용 SSD storage를 100GB 사용한다면 한달에 $9가 청구된다.</li>\n</ul>\n<p>총 비용을 정리해보면 9 + 7.2 + (0.041 _ 24 _ 30) = 46.2. 약 $46정도의 비용이 청구될 것이다.</p>\n<p>여기에 추가적으로 데이터 송수신 비용이 GB당 최대 $0.1 정도 청구될 수 있는데, 동일 지역에서 발생하는 트래픽에는 청구되지 않는듯 하다. 이 부분은 실제 운영을 해봐야 가늠할 수 있을것 같다.</p>\n<h1>비용 비교</h1>\n<h2>Heroku</h2>\n<ul>\n<li>백엔드 $25/월</li>\n<li>프론트엔드 $105/월</li>\n</ul>\n<p>총 130$/월</p>\n<h2>AWS EC2</h2>\n<ul>\n<li>인스턴스 비용 $30/월</li>\n<li>Elastic IP $7.2/월</li>\n<li>SSD storage $9/월</li>\n</ul>\n<p>총 $46/월</p>\n<h1>결론</h1>\n<p>배포를 Heroku에서 AWS EC2로 옮긴다면 매월 $84. 환화로 약 122000원 정도를 매달 절약할 수 있다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"about"}],"date":"2024-12-23T00:00:00.000Z","slug":"/blog/about/billing","title":"About billing - heroku와 AWS ec2 비용 분석"}}},{"node":{"html":"<h1>WebSocket을 왜 사용해야 할까요?</h1>\n<p>WebSocket은 하나의 TCP 연결로 클라이언트와 서버가 지속적으로 실시간 데이터를 전송할 수 있는 프로토콜 입니다. 간단히 말하면 실시간 양방향 데이터 전송 프로토콜이라 할 수 있습니다.</p>\n<p>HTTP는 매 요청마다 연결과 응답이 끝나면 다시 연결을 맺어야 합니다. 데이터를 지속적으로 주고받으려면 polling을 사용해야 하는데,  polling 방식은 서버의 자원을 많이 사용합니다.</p>\n<p>그래서 주식 현재가, 거래 데이터 같은 실시간 데이터를 주고받을 때는 WebSocket을 활용하는 것이 효율적입니다.</p>\n<h1>WebSocket 구성을 어떻게 해야할까?</h1>\n<p>Stocket simulator를 제작하면서, 한국투자증권의 API를 사용했습니다.\n프론트엔드, 백엔드, 한투 서버 이렇게 3가지를 두고 실시간 데이터를 전송하려면, WebSocket을 이중으로 구현해야 합니다.</p>\n<p>그래서 Backend와 한투 서버 사이의 WebSocket 통신과, 백엔드와 프론트 사이의 WebSocket 통신 두 가지를 함께 구성해야 했습니다.</p>\n<h1>어떤 문제가 있었을까?</h1>\n<p>구조를 설계하면서, 세 가지 문제가 있었습니다.</p>\n<ol>\n<li>WebSocket연결이 중복 생성되어 너무 많은 WebSocket연결이 생성되어 서버가 감당하지 못했습니다.</li>\n<li>페이지를 나갈 때 WebSocket 연결이 제대로 끊어지지 않아서 낭비가 발생했습니다.</li>\n<li>두 WebSocket Handler가 서로를 순환참조 하여 에러가 발생했습니다.</li>\n</ol>\n<h2>1번 문제 해결</h2>\n<p>먼저, 다음과 같은 구조를 설계했습니다.</p>\n<p>각 WebSocket 요청 별로, key를 생성하여, 그 요청을 요구하는 Session들을 저장하는 자료구조를 만들었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WebSocketSession</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> subscriptions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>WebSocket subscribe요청이 들어오면, key 값으로 같은 요청이 있는지 판단하고 없으면 그 요청을 생성하고 있다면 이미 있는 요청에 구독자로 추가됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"subscribe\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token class-name\">String</span> subscriptionKey <span class=\"token operator\">=</span> trId <span class=\"token operator\">+</span> <span class=\"token string\">\"|\"</span> <span class=\"token operator\">+</span> trKey<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token comment\">// 중복 요청 확인  </span>\n    subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">computeIfAbsent</span><span class=\"token punctuation\">(</span>subscriptionKey<span class=\"token punctuation\">,</span> k <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CopyOnWriteArraySet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User Subscribed: \"</span> <span class=\"token operator\">+</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" to \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n    eventPublisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">,</span> trType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"unsubscribe\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token function\">removeSession</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>구독을 취소할 때는, 구독자가 남아있는지 판단하여 구독자가 없다면 그 key의 연결을 아예 삭제합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">removeSession</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token class-name\">String</span> subscriptionKey <span class=\"token operator\">=</span> trId <span class=\"token operator\">+</span> <span class=\"token string\">\"|\"</span> <span class=\"token operator\">+</span> trKey<span class=\"token punctuation\">;</span>  \n    <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WebSocketSession</span><span class=\"token punctuation\">></span></span> sessions <span class=\"token operator\">=</span> subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessions <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token comment\">// session 삭제  </span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessions<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Removed session: \"</span> <span class=\"token operator\">+</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" from subscription: \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>sessions<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token comment\">// sessions가 비어 있으면 subscriptions에서 subscriptionKey 삭제</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessions<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                eventPublisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">,</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Session not found in subscription: \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No sessions found for subscription key: \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>이러한 구조를 구현하여, 같은 요청에 대해 중복된 WebSocket 연결을 생성하지 않고, 필요없는 연결을 삭제할 수 있도록 설계했습니다.</p>\n<h2>2번 문제 해결</h2>\n<p>주식 페이지를 벗어날 때, 그 주식에 대해 unsubscribe가 되지 않는 문제가 있었습니다.</p>\n<p>이 문제는 useEffect의 cleanup과 eventListener를 이용해 해결했습니다.</p>\n<p>먼저 주식 정보 페이지에 들어가면, subscibe 요청을 보냅니다.\n구독 취소를 요청하는 함수를 작성한 후, useEffect의 return에서 호출합니다. 원래라면 이 때 구독 해제가 잘 작동해야 하는데 페이지를 벗어날 때 잘 작동하지 않는 문제가 있었습니다.</p>\n<p>그래서 beforeunload eventListener에 해당 함수를 등록해두고, cleanup에서 제거해주는 방식을 채택했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isConnected<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> socketOpenData <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">\"subscribe\"</span><span class=\"token punctuation\">,</span>\n        tr_type<span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span>\n        rq_type<span class=\"token operator\">:</span> <span class=\"token string\">\"current\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token builtin\">symbol</span><span class=\"token operator\">:</span> stockSymbol<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n      <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>socketOpenData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  \n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleBeforeUnload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> unsubscribeMessage <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">\"unsubscribe\"</span><span class=\"token punctuation\">,</span>\n        tr_type<span class=\"token operator\">:</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">,</span>\n        rq_type<span class=\"token operator\">:</span> <span class=\"token string\">\"current\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token builtin\">symbol</span><span class=\"token operator\">:</span> stockSymbol<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>unsubscribeMessage<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beforeunload\"</span><span class=\"token punctuation\">,</span> handleBeforeUnload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">handleBeforeUnload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beforeunload\"</span><span class=\"token punctuation\">,</span> handleBeforeUnload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>isConnected<span class=\"token punctuation\">,</span> stockSymbol<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>3번 문제 해결</h2>\n<p>프론트-백 WebSocket에서 백-한투 WebSocket에 구독, 구독해제 정보를 보내기 위해 호출해야하고.\n백-한투 WebSocket에서 프론트-백 WebSocket에 데이터 전송을 위해 호출해야 하는데, 이 과정에서 순환 참조가 발생하여 오류가 났습니다.</p>\n<p>이 문제는 Java의 EventListener 기능을 사용하여 해결했습니다.\n한쪽에서 Event를 발행하고, Listener가 그 Event를 듣고 함수를 호출하면, 인스턴스를 직접 호출할 필요가 없어집니다.</p>\n<p>먼저, Event 객체를 만들어줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>stock<span class=\"token punctuation\">.</span>stock_simulator<span class=\"token punctuation\">.</span>event</span><span class=\"token punctuation\">;</span>  \n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>context<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">ApplicationEvent</span></span><span class=\"token punctuation\">;</span>  \n  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSocketEvent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">ApplicationEvent</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> tr_id<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> tr_key<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> tr_type<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> source<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trType<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        tr_id <span class=\"token operator\">=</span> trId<span class=\"token punctuation\">;</span>  \n        tr_key <span class=\"token operator\">=</span> trKey<span class=\"token punctuation\">;</span>  \n        tr_type <span class=\"token operator\">=</span> trType<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token comment\">//getter</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>프론트-백 WebSocket Handler에서 event를 발행합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationEventPublisher</span> eventPublisher<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">FrontendWebSocketHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationEventPublisher</span> eventPublisher<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventPublisher <span class=\"token operator\">=</span> eventPublisher<span class=\"token punctuation\">;</span>    \n<span class=\"token punctuation\">}</span>\n\neventPublisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">,</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>백-한투 WebSocket Handler에서 발행된 Event를 수신합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSocketHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">TextWebSocketHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token annotation punctuation\">@Override</span>  \n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onApplicationEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketEvent</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t    <span class=\"token class-name\">String</span> tr_id <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getTr_id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t    <span class=\"token class-name\">String</span> tr_key <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getTr_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t    <span class=\"token class-name\">String</span> tr_type <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getTr_type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t  \n\t    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n\t        <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tr_id<span class=\"token punctuation\">,</span> tr_key<span class=\"token punctuation\">,</span> tr_type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t    <span class=\"token punctuation\">}</span>  \n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>코드를 분석해봅시다</h1>\n<p>아래부터는 어떻게 두가지 WebSocket Handler를 구성했는지에 대한 자세한 코드입니다. 필요시 참고만 해주세요.</p>\n<h2>Frontend - Backend WebSocket Config</h2>\n<ul>\n<li>EnableWebsocket annotation을 통해 Spring이 WebSocket 관련 처리를 하게 해줍니다.</li>\n<li>frontendWebSocketHandler를 등록하고, /ws를 WebSocket을 위한 endpoint로 사용합니다.</li>\n<li>cors 설정으로, Frontend를 허용합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>  \n<span class=\"token annotation punctuation\">@EnableWebSocket</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSocketConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebSocketConfigurer</span> <span class=\"token punctuation\">{</span>  \n  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">FrontendWebSocketHandler</span> frontendWebSocketHandler<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">WebSocketConfig</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">FrontendWebSocketHandler</span> frontendWebSocketHandler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>frontendWebSocketHandler <span class=\"token operator\">=</span> frontendWebSocketHandler<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">registerWebSocketHandlers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketHandlerRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        registry<span class=\"token punctuation\">.</span><span class=\"token function\">addHandler</span><span class=\"token punctuation\">(</span>frontendWebSocketHandler<span class=\"token punctuation\">,</span> <span class=\"token string\">\"/ws\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// WebSocket 엔드포인트  </span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">setAllowedOriginPatterns</span><span class=\"token punctuation\">(</span>  \n                        <span class=\"token string\">\"http://localhost:5173\"</span><span class=\"token punctuation\">,</span>  \n                        <span class=\"token string\">\"https://beming-stock.kro.kr\"</span><span class=\"token punctuation\">,</span>  \n                        <span class=\"token string\">\"http://beming-stock.kro.kr\"</span><span class=\"token punctuation\">,</span>  \n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Backend - 한투 API WebSocket 설정</h2>\n<ul>\n<li>Spring에서 제공하는 WebSocket client (StandardWebSocketClient) 를 사용합니다.</li>\n<li>WebSocket key를 가져오고, 한투의 WebSocket 주소와 연결합니다.</li>\n<li>앱 실행시 자동으로 WebSocket이 연결되도록 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>  \n<span class=\"token annotation punctuation\">@EnableWebSocket</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSocketExternalConfig</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">WebSocketConfigurer</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">StockApiInterface</span> stockApi<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">WebSocketHandler</span> webSocketHandler<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">WebSocketExternalConfig</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StockApiInterface</span> stockApi<span class=\"token punctuation\">,</span> <span class=\"token class-name\">WebSocketHandler</span> webSocketHandler<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FrontendWebSocketHandler</span> frontendWebSocketHandler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stockApi <span class=\"token operator\">=</span> stockApi<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webSocketHandler <span class=\"token operator\">=</span> webSocketHandler<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">registerWebSocketHandlers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketHandlerRegistry</span> registry<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">WebSocketClient</span> webSocketClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StandardWebSocketClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token class-name\">String</span> webSocketKey <span class=\"token operator\">=</span> stockApi<span class=\"token punctuation\">.</span><span class=\"token function\">getWebSocketKey</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        webSocketHandler<span class=\"token punctuation\">.</span><span class=\"token function\">setWebSocketKey</span><span class=\"token punctuation\">(</span>webSocketKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token class-name\">WebSocketConnectionManager</span> connectionManager <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocketConnectionManager</span><span class=\"token punctuation\">(</span>  \n                webSocketClient<span class=\"token punctuation\">,</span> webSocketHandler<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ws://ops.koreainvestment.com:21000\"</span>  \n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        connectionManager<span class=\"token punctuation\">.</span><span class=\"token function\">setAutoStartup</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        connectionManager<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>프론트-백엔드 Handler</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  \n<span class=\"token annotation punctuation\">@Component</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FrontendWebSocketHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">TextWebSocketHandler</span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WebSocketSession</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> subscriptions <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationEventPublisher</span> eventPublisher<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">StockRepository</span> stockRepository<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">FrontendWebSocketHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ApplicationEventPublisher</span> eventPublisher<span class=\"token punctuation\">,</span> <span class=\"token class-name\">StockRepository</span> stockRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>eventPublisher <span class=\"token operator\">=</span> eventPublisher<span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stockRepository <span class=\"token operator\">=</span> stockRepository<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">removeSession</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">String</span> subscriptionKey <span class=\"token operator\">=</span> trId <span class=\"token operator\">+</span> <span class=\"token string\">\"|\"</span> <span class=\"token operator\">+</span> trKey<span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WebSocketSession</span><span class=\"token punctuation\">></span></span> sessions <span class=\"token operator\">=</span> subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessions <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token comment\">// session 삭제  </span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessions<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Removed session: \"</span> <span class=\"token operator\">+</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" from subscription: \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>sessions<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token comment\">// sessions가 비어 있으면 subscriptions에서 subscriptionKey 삭제 (옵션)  </span>\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessions<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                    subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                    eventPublisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">,</span> <span class=\"token string\">\"2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token punctuation\">}</span>  \n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Session not found in subscription: \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"No sessions found for subscription key: \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterConnectionEstablished</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Frontend WebSocket Connected: \"</span> <span class=\"token operator\">+</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterConnectionClosed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">,</span> <span class=\"token class-name\">CloseStatus</span> status<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>sessions <span class=\"token operator\">-></span> sessions<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Frontend WebSocket Disconnected: \"</span> <span class=\"token operator\">+</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleTextMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TextMessage</span> message<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">String</span> payload <span class=\"token operator\">=</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getPayload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">ObjectMapper</span> objectMapper <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ObjectMapper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token comment\">// JSON 데이터를 JsonNode로 파싱  </span>\n            <span class=\"token class-name\">JsonNode</span> rootNode <span class=\"token operator\">=</span> objectMapper<span class=\"token punctuation\">.</span><span class=\"token function\">readTree</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n            <span class=\"token comment\">// 각 키의 값 추출  </span>\n            <span class=\"token class-name\">String</span> type <span class=\"token operator\">=</span> rootNode<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">asText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token class-name\">String</span> trType <span class=\"token operator\">=</span> rootNode<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tr_type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">asText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token class-name\">String</span> symbol <span class=\"token operator\">=</span> rootNode<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"symbol\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">asText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//symbol  </span>\n            <span class=\"token class-name\">String</span> rq_type <span class=\"token operator\">=</span> rootNode<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rq_type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">asText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token class-name\">String</span> trId<span class=\"token punctuation\">;</span>  \n            <span class=\"token class-name\">String</span> trKey<span class=\"token punctuation\">;</span>  \n  \n            <span class=\"token class-name\">Stock</span> stockData <span class=\"token operator\">=</span> stockRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findBySymbol</span><span class=\"token punctuation\">(</span>symbol<span class=\"token punctuation\">)</span>  \n                    <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid symbol: \"</span> <span class=\"token operator\">+</span> symbol<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n            <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>rq_type<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">case</span> <span class=\"token string\">\"current\"</span><span class=\"token operator\">:</span>  \n                    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>stockData<span class=\"token punctuation\">.</span><span class=\"token function\">getCountry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"KSP\"</span><span class=\"token punctuation\">)</span>  \n                            <span class=\"token operator\">||</span> <span class=\"token class-name\">Objects</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>stockData<span class=\"token punctuation\">.</span><span class=\"token function\">getCountry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"KSD\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>  \n                        trId <span class=\"token operator\">=</span> <span class=\"token string\">\"H0STCNT0\"</span><span class=\"token punctuation\">;</span>  \n                        trKey<span class=\"token operator\">=</span>symbol<span class=\"token punctuation\">;</span>  \n                    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>  \n                        trId <span class=\"token operator\">=</span> <span class=\"token string\">\"HDFSCNT0\"</span><span class=\"token punctuation\">;</span>  \n                        trKey<span class=\"token operator\">=</span><span class=\"token string\">\"D\"</span> <span class=\"token operator\">+</span> stockData<span class=\"token punctuation\">.</span><span class=\"token function\">getCountry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> symbol<span class=\"token punctuation\">;</span>  \n                    <span class=\"token punctuation\">}</span>  \n                    <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>  \n                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Invalid rq_type: \"</span> <span class=\"token operator\">+</span> rq_type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>type <span class=\"token operator\">+</span> symbol<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token comment\">// 추가 로직  </span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"subscribe\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token class-name\">String</span> subscriptionKey <span class=\"token operator\">=</span> trId <span class=\"token operator\">+</span> <span class=\"token string\">\"|\"</span> <span class=\"token operator\">+</span> trKey<span class=\"token punctuation\">;</span>  \n  \n                <span class=\"token comment\">// 중복 요청 확인  </span>\n                subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">computeIfAbsent</span><span class=\"token punctuation\">(</span>subscriptionKey<span class=\"token punctuation\">,</span> k <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">CopyOnWriteArraySet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User Subscribed: \"</span> <span class=\"token operator\">+</span> session<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" to \"</span> <span class=\"token operator\">+</span> subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n                eventPublisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">,</span> trType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">\"unsubscribe\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token function\">removeSession</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>err<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to parse JSON payload: \"</span> <span class=\"token operator\">+</span> e<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">broadcastToSubscribers</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> trId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> trKey<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">String</span> subscriptionKey <span class=\"token operator\">=</span> trId <span class=\"token operator\">+</span> <span class=\"token string\">\"|\"</span> <span class=\"token operator\">+</span> trKey<span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WebSocketSession</span><span class=\"token punctuation\">></span></span> sessions <span class=\"token operator\">=</span> subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>subscriptionKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessions <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            sessions<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>session <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>  \n                <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                        session<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TextMessage</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                    <span class=\"token punctuation\">}</span>  \n                <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                    e<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n                <span class=\"token punctuation\">}</span>  \n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>백엔드-한투 api handler</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>  \n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">WebSocketHandler</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">TextWebSocketHandler</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationListener</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">WebSocketEvent</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>  \n    <span class=\"token annotation punctuation\">@Autowired</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">FrontendWebSocketHandler</span> frontendWebSocketHandler<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> webSocketKey<span class=\"token punctuation\">;</span>  \n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">;</span>  \n  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">setWebSocketKey</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> webSocketKey<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>webSocketKey <span class=\"token operator\">=</span> webSocketKey<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span>  \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onApplicationEvent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketEvent</span> event<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">String</span> tr_id <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getTr_id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">String</span> tr_key <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getTr_key</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">String</span> tr_type <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span><span class=\"token function\">getTr_type</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tr_id<span class=\"token punctuation\">,</span> tr_key<span class=\"token punctuation\">,</span> tr_type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeException</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span> <span class=\"token comment\">// 웹 소켓 연결시  </span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterConnectionEstablished</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WebSocket Connected: \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span>webSocketKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>session <span class=\"token operator\">=</span> session<span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> tr_id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> tr_key<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> tr_type<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>session <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>session<span class=\"token punctuation\">.</span><span class=\"token function\">isOpen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WebSocket session is not open or is null.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n        <span class=\"token comment\">// Gson 객체 생성  </span>\n        <span class=\"token class-name\">Gson</span> gson <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Gson</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token comment\">// Header 작성  </span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> header <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        header<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"approval_key\"</span><span class=\"token punctuation\">,</span> webSocketKey<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// WebSocket Key  </span>\n        header<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"custtype\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"P\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 고객 타입: 개인  </span>\n        header<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tr_type\"</span><span class=\"token punctuation\">,</span> tr_type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 거래 타입: 등록  </span>\n        header<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"content-type\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Content-Type  </span>\n  \n        <span class=\"token comment\">// Input 작성 (Body 내부의 중첩 필드)  </span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> input <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        input<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tr_id\"</span><span class=\"token punctuation\">,</span> tr_id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 거래 ID        input.put(\"tr_key\", tr_key); // 거래 Key (종목코드)  </span>\n  \n        <span class=\"token comment\">// Body 작성  </span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> body <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        body<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"input\"</span><span class=\"token punctuation\">,</span> input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token comment\">// 최종 요청 작성  </span>\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> request <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        request<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"header\"</span><span class=\"token punctuation\">,</span> header<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        request<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token comment\">// JSON 직렬화  </span>\n        <span class=\"token class-name\">String</span> jsonRequest <span class=\"token operator\">=</span> gson<span class=\"token punctuation\">.</span><span class=\"token function\">toJson</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"JSON Request: \"</span> <span class=\"token operator\">+</span> jsonRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token comment\">// WebSocket 메시지 전송  </span>\n        session<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TextMessage</span><span class=\"token punctuation\">(</span>jsonRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span> <span class=\"token comment\">// 데이터 통신시  </span>\n    <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleTextMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">,</span> <span class=\"token class-name\">TextMessage</span> message<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">String</span> payload <span class=\"token operator\">=</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">getPayload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Received Message: \"</span> <span class=\"token operator\">+</span> payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PINGPONG\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Received PING. Sending PONG...\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            session<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TextMessage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PONG\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token punctuation\">}</span>  \n  \n        <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> stockInfo <span class=\"token operator\">=</span> payload<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\^\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>stockInfo<span class=\"token punctuation\">.</span>length <span class=\"token operator\">>=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n            <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> headerInfo <span class=\"token operator\">=</span> stockInfo<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\\\|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n  \n            <span class=\"token class-name\">String</span> trId <span class=\"token operator\">=</span> headerInfo<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 메시지에서 추출한 tr_id            String trKey = headerInfo[3]; // 메시지에서 추출한 tr_key  </span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>frontendWebSocketHandler <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n                frontendWebSocketHandler<span class=\"token punctuation\">.</span><span class=\"token function\">broadcastToSubscribers</span><span class=\"token punctuation\">(</span>trId<span class=\"token punctuation\">,</span> trKey<span class=\"token punctuation\">,</span> payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n            <span class=\"token punctuation\">}</span>  \n        <span class=\"token punctuation\">}</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span> <span class=\"token comment\">// 웹소켓 통신 에러시  </span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">handleTransportError</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Throwable</span> exception<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"WebSocket Error: \"</span> <span class=\"token operator\">+</span> exception<span class=\"token punctuation\">.</span><span class=\"token function\">getMessage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        exception<span class=\"token punctuation\">.</span><span class=\"token function\">printStackTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleTransportError</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> exception<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n  \n    <span class=\"token annotation punctuation\">@Override</span> <span class=\"token comment\">// 웹 소켓 연결 종료시  </span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterConnectionClosed</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WebSocketSession</span> session<span class=\"token punctuation\">,</span> <span class=\"token class-name\">CloseStatus</span> status<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>  \n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"finished\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">afterConnectionClosed</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> status<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n    <span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"stock-simulator"}],"date":"2024-12-21","slug":"/blog/stock-simulator/websocket","title":"WebSocket architecture"}}},{"node":{"html":"<p>어느덧 블로그를 만들어 둔 지 2년이 넘게 지났습니다.\n가끔씩 글도 작성했지만, MarkDown 형식의 글만 작성하고 코드는 한 군데도 건들지 않았네요..ㅎㅎ</p>\n<p>오랜만에 블로그를 정리하고 글도 좀 더 작성하려 하기 전에, 코드를 전체적으로 한번 손보면 좋겠다 생각했습니다.</p>\n<h1>리뉴얼</h1>\n<p>가장 큰 변경점은 다음과 같습니다.</p>\n<ul>\n<li>Tailwind사용</li>\n<li>불필요한 코드 제거</li>\n<li>디자인 수정</li>\n</ul>\n<h2>Tailwind 사용</h2>\n<p>기존의 코드는 sass파일로 스타일을 분리하여 작성하고, 각각의 파일에서 import하는 방식을 사용했습니다.\n나쁜 방식은 아니지만, 파일의 양이 많아져 관리가 귀찮고 일관된 디자인을 유지하기가 어렵습니다.</p>\n<p>tailwind를 사용하면서 주목할 만한 부분은 반응형 디자인 입니다.</p>\n<ul>\n<li>tailwind.config.js</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  theme<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    screens<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      sm<span class=\"token operator\">:</span> <span class=\"token string\">\"640px\"</span><span class=\"token punctuation\">,</span>\n      md<span class=\"token operator\">:</span> <span class=\"token string\">\"768px\"</span><span class=\"token punctuation\">,</span>\n      lg<span class=\"token operator\">:</span> <span class=\"token string\">\"1024px\"</span><span class=\"token punctuation\">,</span>\n      xl<span class=\"token operator\">:</span> <span class=\"token string\">\"1280px\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// => @media (min-width: 640px) { ... }</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>다음과 같이 반응형 디자인의 기준을 나눠주고, 기존의 media query 문을 제거했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>w-full flex flex-col md:flex-row mt-12 md:mt-0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>다음과 같이 사용할 수 있습니다.</p>\n<h2>불필요한 코드 제거</h2>\n<ul>\n<li>사용하지 않는 Component 제거</li>\n<li>합칠 수 있는 코드 합치기</li>\n<li>이름 구별하기 편하게 수정\nex) MobileNavigation -> NavMobile, Nav -> NavDesktop</li>\n<li>js파일 -> tsx파일</li>\n</ul>\n<h2>디자인 수정</h2>\n<ol>\n<li>POST 페이지의 디자인 수정 <img src=\"../../images/20241106221506.png\" alt=\"\"></li>\n<li>UX를 위해 불필요한 요소 제거</li>\n</ol>","frontmatter":{"thumbnail":"gatsby.jpg","categories":[{"mainCategory":"Area","subCategory":"blog"}],"date":"2024-10-28","slug":"/blog/renew","title":"블로그 리뉴얼"}}},{"node":{"html":"<ul>\n<li>컴퓨터 아키텍처: 컴퓨터의 여러 구성 요소를 배치하는 방법.</li>\n</ul>\n<h1>기본적인 구조 요소들</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 555px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJ0lEQVR42mWQ4W6CQBCEef8nqzFK/1TRymERBEM54O44BFvth9cSYyfhNuzM7s6uJ0SU5XlIiKLT6ZSm6fZ9G4owCDa7XbgO1sEmiOP4+wGXy+V8h/d1x+12S5LDYrEEn2V5vV6HYej7Hh1qY/Rq9eb7r0vfn8/nDEBvrfUISHmRaq20Uq4dXNd1JKGob9vWaKO1zvO8aRqocTITCFMLBwaSp8VUPAloyvtbXDeNlBKP9KOxUoohVBYF9svzub/bHoEASlZSCCFLSgZvv/8AyeEgZQmN6Hg8ZlkmQsHNbGcp5oWiL8o0TV5ms6IoxmKmkx0V1vKPn+EPzjZuSbKIo9hdKc0MKO9pWwd3CHfwJ6ptH3bm6/4BF1VVcQuu8CTAP7eo69oY8wNpLwEBFucmJAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231215153014\"\n        title=\"\"\n        src=\"/static/46f2e0cd38a4d9dfed20ff42f3e0cb18/cd039/20231215153014.png\"\n        srcset=\"/static/46f2e0cd38a4d9dfed20ff42f3e0cb18/772e8/20231215153014.png 200w,\n/static/46f2e0cd38a4d9dfed20ff42f3e0cb18/e17e5/20231215153014.png 400w,\n/static/46f2e0cd38a4d9dfed20ff42f3e0cb18/cd039/20231215153014.png 555w\"\n        sizes=\"(max-width: 555px) 100vw, 555px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>폰 노이만 구조</li>\n<li>하버드 구조\n둘의 차이는 메모리 배열 뿐이다. 폰 노이만 구조는 메모리에서 명령어와 데이터를 동시에 가져올 수 없어서 조금 더 느리지만, 하버드 구조는 이를 처리하기 위한 버스가 하나 더 필요하다.</li>\n</ul>\n<h2>프로세스 코어</h2>\n<p>위 그림의 CPU는 하나뿐이다. 단일 CPU보다 높은 성능을 얻기 위해 멀티프로세서라는 개념이 탄생했다. 그러나 여러 CPU를 활용할 수 있도록 프로그램을 병렬화 하는 문제는 일반적인 경우 풀 수 없는 문제다.\n반도체 크기가 줄어들면서 성능은 좋아졌지만, 전력 소모와 단위 면적당 열 발생이 많아지며 프로세서는 전력 장벽에 부딪힌다.\n이를 해결하기 위해 CPU를 추가했는데, 이젠 CPU를 프로세스 코어라고 부르고, 코어가 여럿 들어가는 멀티코어 프로세서가 이젠 일반적으로 쓰인다.</p>\n<h2>마이크로 프로세서와 마이크로 컴퓨터</h2>\n<ul>\n<li>마이크로프로세서: 메모리와 I/O가 프로세서 코어와 같은 패키지에 들어있지 않음</li>\n<li>마이크로 컴퓨터: 모든 요소를 한 침에 패키징\n그러나 이런 용어의 경계가 뚜렷하진 않다.\n마이크로 프로세서는 보통 큰 시스템에 들어가는 부품으로 쓰이고, 마이크로 컴퓨터는 식기세척기 등에서 찾을 수 있는 작은 컴퓨터다.</li>\n</ul>\n<h1>프로시저, 서브루틴, 함수</h1>\n<p>셋은 우리가 관심을 갖는 범위 안에서는 같은 것을 뜻한다.\n함수는 코드의 반복을 없애기 위해, 코드의 유지보수가 쉽도록 하고싶을 때 사용할 수 있다.\n함수를 작동시키기 위해서는 함수를 호출하는 부분에서 함수를 실행하고 다시 원래 자리로 돌아올 방법이 필요하다.\n어디서 함수로 들어 갔는지를 어떻게 기억할까? 이 위치는 바로 프로그램 카운터의 값이다.</p>\n<h1>스택</h1>\n<p>함수가 또 다른 함수를 호출하는 경우가 있다. 지금까지는 반환값을 저장할 위치가 한군데 뿐이기 때문에 이미 들어 있던 반환 값을 덮어쓰면 되돌아갈 위치를 잊어버린다.\n그래서 재귀 함수 같은 것들이 잘 작동하려면 반환 주소를 여럿 저장할 수 있어야 한다. 그리고 함수에서 호출 지점으로 반환할 때 저장된 주소 중 어떤 주소를 사용할지도 결정할 수 있어야 한다.\n여기서 우리는 <strong>스택</strong>을 사용할 수 있다. 스택은 LIFO(Last In Frist Out)자료구조이다.\n스택에 주소를 푸시하는데 더 이상 들어갈 공간이 없으면 이를 <strong>스택 오버플로</strong>, 빈 스택에서 주소를 꺼내려 하는 경우(pop) 이를 <strong>스택 언더플로</strong>라고 부른다.\n스택은 단순히 반환 주소만 저장하지는 않는다. 지역 변수도 함께 저장해야 한다.\n이렇게 함수가 호출될 때마다 스택에 저장되는 데이터들의 모음을 <strong>스택 프레임</strong>이라고 한다.\n+) 수식을 표현하는 기법에는 중위 표기법, 전위 표기법(폴란드 표기법), 후위 표기법(역 폴란드 표기법)이 있는데, 스택을 사용하면 후위 표기법을 쉽게 구현할 수 있다.</p>\n<h1>인터럽트</h1>\n<p>요리 중에 배달기사가 오는지를 확인해야 한다고 가정하자.</p>\n<ul>\n<li>순서도: 해야할 일을 작업이 이뤄지는 순서로 표현.</li>\n<li>폴링: 배달 기사가 왔는지 계속 확인</li>\n<li>인터럽트: 해야할 일이 생기면 잠깐 중단시켜서 외부 요소에 대응. 알림벨 느낌.\n인터럽트 시스템은 적절한 신호가 들어오면 CPU 실행을 잠깐 중단시킬 수 있는 핀이나 전기 연결을 포함.</li>\n</ul>\n<h2>인터럽트 작동</h2>\n<ol>\n<li>CPU가 주의를 기울여야 하는 주변장치는 인터럽트 요청을 생성</li>\n<li>프로세서는 보통은 현재 실행 중인 명령어를 끝까지 실행</li>\n<li>실행 중인 프로그램을 잠시 중단시키고 <strong>인터럽트 핸들러</strong>라는 전혀 다른 프로그램을 실행.</li>\n<li>인터럽트 핸들러가 작업을 마치면 원래 실행 중이던 프로그램이 중단된 위치부터 다시 실행</li>\n<li>인터럽트 핸들러는 함수다.</li>\n</ol>\n<h2>고려 사항</h2>\n<ol>\n<li>언터럽트에 대한 응답 시간: 인터럽트 작업에 너무 긴 시간을 할애하면 원래 작업에 차질이 생김.</li>\n<li>인터럽트를 서비스하고 다시 돌아오려면 현재 상태를 저장할 방법이 필요. 레지스터에 저장돼 있던 값도 기억해야 한다. 스택을 통해 이를 해결한다.</li>\n</ol>\n<p>컴퓨터는 어떻게 인터럽트 핸들러의 위치를 찾을까?\n보통 인터럽트 핸들러 주소를 저장하기로 한 메모리 주소가 존재. 이 주소에는 여러 <strong>인터럽트 벡터</strong>가 들어있다.\n많은 기계가 스택 오버플로나, 메모리 예외 상황에 대한 인터럽트 백터를 제공한다.</p>\n<ul>\n<li>마스크: 인터럽트를 중단시킬 수 있음.</li>\n<li>우선순위: 인터럽트가 많이 있는 경우, 우선순위</li>\n<li>타이머: 일정 시간이 지나면 인터럽트 발생시킴</li>\n</ul>\n<h1>상대 주소 지정</h1>\n<p>여러 프로그램을 동시에 실행하려면 각 프로그램을 전환시켜줄 관리자 프로그램이 필요하다.\n이를 운영체제 또는 운영체제 커널이라고 부른다.\n우리는 OS를 시스템 프로그램이라 부르고, 다른 모든 프로그램을 사용자 프로그램, 혹은 프로세스라고 부른다.</p>\n<ul>\n<li>OS작동\n<ol>\n<li>사용자 프로그램을 메모리로 읽기</li>\n<li>상태 복원</li>\n<li>사용자 프로그램 실행</li>\n<li>타이머 인터업트</li>\n<li>사용자 프로그램 중단</li>\n<li>상태저장 -> 1번으로</li>\n</ol>\n</li>\n<li>시분할: 프로그램의 실행 시간을 조절하는 스케줄링 기법. 시간을 정해진 간격으로 나누고, 정해진 시간동안 사용자 프로그램을 실행.</li>\n<li>사용자 프로그램 상태, 문맥: 레지스터의 상태와 프로그램이 사용 중인 메모리의 상태</li>\n</ul>\n<p>프로그램을 메모리로 불러들이려면 시간이 걸린다. 프로그램을 메모리로 불러오되, 각 프로그램에게 각기 다른 공간을 허용할 수 있으면 훨씬 더 빠르게 시분할 실행이 가능하다.\n사용자 프로그램을 어떻게 하나씩 차례로 메모리에 올릴 수 있을까? 절대 주소 지정을 사용하면 1000번지에서 실행되도록 만들어진 프로그램을 2000번지에 읽어 들이면 제대로 실행되지 않을 것이다.</p>\n<ul>\n<li>인덱스 레지스터: 인덱스 레지스터에 들어있는 값 + 명령어에 들어 있는 주소 = 유효 주소</li>\n<li>상대 주소 지정: 명령어에 들어 있는 주소를 0부터 시작하는 위치로 해석하지 않고, 명령어의 주소를 기준으로 하는 상대적인 주소로 해석한다. 예를 들어, 100이라는 주소를 1번지에 저장하려면, 100을 저장하지 않고 99를 저장하는 것이다.</li>\n</ul>\n<h1>메모리 관리 장치</h1>\n<p>이제는 멀티태스킹이 필수이다.\n인덱스 레지스터와 상대 주소 지정이 도움이 될 수 있지만 충분하진 않다.\n만약 사용자 프로그램2에 버그가 있어서 1의 메모리를 덮어쓰거나 한다면 어떤 일이 벌어질까?\n이런 상황을 아예 발생하지 않게 하면 좋다.\n이를 위해 오늘날 마이크로프로세서에는 대부분 메모리 관리 장치(MMU)가 들어 있다.</p>\n<ul>\n<li>MMU: 가상 주소와 물리 주소를 구분.\n프로그램 -> (가상 주소) -> 메모리 관리 장치 -> (물리 주소) -> 메모리</li>\n</ul>\n<h2>작동 방식</h2>\n<p>MMU는 가상 메모리 주소를 두 부분으로 나눈다.</p>\n<ul>\n<li>\n<p>하위 부분: 물리적 주소 범위와 같다.</p>\n</li>\n<li>\n<p>상위 부분: 페이지 테이블이라는 RAM 영역을 통해 주소를 변환.</p>\n</li>\n<li>\n<p>페이지 테이블: 각 페이지가 물리 메모리상에서 차지하는 실제 위치 정보 들어있음.\n모든 내용은 페이지 경계 안에 있어야 한다.\n프로그램 입장에서는 가상 메모리가 연속적인 것처럼 보이지만, 실제 메모리에서 연속일 필요는 없다. 프로그램이 실행되는 도중에 프로그램이 위치한 물리적 메모리 주소가 바뀔 수도 있다. 프로그램들이 서로 협력하는 경우 여러 프로그램의 가상 메모리 중 일부가 같은 물리 메모리를 함께 공유하는 <strong>공유 메모리</strong>기능을 제공할 수도 있다.</p>\n</li>\n</ul>\n<p>현대적 프로세서의 MMU는 페이지 테이블 크기가 정해져 있다.\nMMU에 제어 비트를 추가할 수도 있다.</p>\n<ul>\n<li>\n<p>실행 불가 비트: 켜져 있으면 CPU가 이 페이지에 있는 명령어를 실행할 수 없다. 따라서 프로그램이 자기 데이터를 실행하는 경우를 막을 수 있따. 이는 보안에 좋다.</p>\n</li>\n<li>\n<p>읽기 전용 비트</p>\n</li>\n<li>\n<p>페이지 폴트 예외: 물리적 메모리에 연관되지 않은 주소에 접근할 때 발생. 스택 오버플로 등에 유용.\nMMU가 등장하며 폰 노이만 구조와 하버드 구조의 구분이 의미 없어졌다. 단일 메모리 버스만 사용하는 폰 노이만 구조도 명령어 메모리와 데이터 메모리를 분리해 제공할 수 있다.</p>\n</li>\n</ul>\n<h1>가상 메모리</h1>\n<p>OS는 희소한 하드웨어 자원을 사용하려고 경합하는 프로그램들 사이의 자원 분배를 관리한다.\nOS는 MMU를 사용해 사용자 프로그램에게 가상 메모리를 제공한다.\n페이지 폴트 메커니즘으로 인해 프로그램은 필요한 만큼 많은 메모리가 있다고 생각할 수 있게 된다.</p>\n<h2>요구불 페이징</h2>\n<ul>\n<li>요청 받은 메모리가 사용 가능한 메모리의 크기보다 크면? OS는 현재 필요하지 않은 메모리 페이지를 더 느리지만 용량이 큰 대용량 저장장치인 디스크로 옮긴다.(swap out)</li>\n<li>스왑 아웃한 페이지에 프로그램이 접근하면 운영체제는 필요한 메모리 공간을 확보하고 요청받은 페이지를 다시 메모리로 불러들인다(swap in).\n이를 스와핑이라 하는데, 스와핑이 일어나면 시스템 성능이 크게 저하된다. 이런 성능 저하를 막기 위해 여러 알고리즘이 사용된다.</li>\n<li>LRU: 최소 최근 사용: 최근에 가장 자주 사용된 페이지는 물리 메모리에 그대로 두고, 최근에 가장 덜 사용한 페이지를 스왑 아웃 함.</li>\n</ul>\n<h1>시스템 공간과 사용자 공간</h1>\n<p>멀티태스킹 시스템은 모든 프로그램에게 자신이 컴퓨터 안에서 실행되는 유일한 프로그램이라는 환상을 심어준다. 그러나 I/O 장치가 끼어들면 이런 환상을 유지하기 힘들어진다.\n사용자 프로그램이 MMU의 설정을 마음대로 바꿀 수 있다면 MMU가 프로그램을 제대로 격리하지 못할 것이다.\n여러 CPU는 이를 해결할 추가 하드웨어를 제공한다.</p>\n<ul>\n<li>컴퓨터가 시스템 모드인지 사용자 모드인지 결정하는 비트가 레지스터에 있다. I/O를 처리하는 명령어 등 일부는 특권 명령어라서 시스템 모드에서만 실행할 수 있다.</li>\n<li>트랩, 시스템 콜: 사용자 모드에서 실행중인 프로그램이 시스템 모드 프로그램에게 요청 보냄.</li>\n</ul>\n<p>이 방법은 장점이 있다.</p>\n<ol>\n<li>사용자 프로그램으로부터 OS, 다른 사용자 프로그램을 보호</li>\n<li>사용자 프로그램이 MMU등에 손을 댈 수 없기에 OS가 프로그램에 대한 자원 할당을 전적 제어</li>\n</ol>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Project","subCategory":"cs"}],"date":"2023-12-15","slug":"/blog/cs/architecture","title":"컴퓨터 아키텍처와 운영체제"}}},{"node":{"html":"<p>조합 논리는 입력에 의해서만 출력이 결정된다.\n조합 논리만으로는 흐름의 일부분을 떼어내서 기억할 수 없기 때문에 컴퓨터를 만들 수 없다.\n순차 논리는 입력의 현재 상태와 과거 상태를 함께 고려한다.</p>\n<h2>시간 표현과 상태 기억</h2>\n<p>현실에서는 주기를 이용해 시간을 측정할 수 있다.\n컴퓨터 공학은 전자공학을 사용하기 때문에 주기적인 전기 신호가 필요하다.</p>\n<h3>발진자</h3>\n<p><img src=\"images/20231210105404.png\" alt=\"\">\n인버터의 출력을 입력에 되먹임 한것이다. 따라서 출력이 0과 1사이를 진동한다.\n크리스탈을 사용하면 발진자를 만들 수 있다. 크리스탈을 전극에 연결하고 압축하면 전기를 만들어낸다. 반대로 전극에 전기를 가하면 크리스탈이 구부러진다.(피에조 전기 효과, 압전 효과)</p>\n<h3>클록</h3>\n<p>시간을 셀 수 있게 해주는 신호.\n회로의 페이스를 결정함</p>\n<p>시간을 정확히 측정하는 이유</p>\n<ul>\n<li>비디오를 일정한 속도로 플레이 하고 싶어서</li>\n<li>전파 지연을 고려해 결과가 안정적이고 올바르다고 확신할 수 있는 시점이 될 때까지 최악의 경우를 가정해 지연 시간을 기다림</li>\n</ul>\n<p>지연시간의 편차를 고려해 컴퓨터 부품들을 빈에 나눠 담는다.\n오버클로킹: 빈의 중간정도에 위치하는 부품이 고장 나지 않을 범위에서 클록을 빠르게 공급</p>\n<h3>래치</h3>\n<p>1비트를 기억하는 방법</p>\n<ul>\n<li>OR 게이트 래치\n<img src=\"images/20231210110252.png\" alt=\"\">\nout이 1이라고 가정하자. 앞으로 래치를 사용할 때는 초기값을 가정해야 하는 경우가 많다.\nin이 1로 변경되면 out도 1로 변경된다.\nin 값이 변하는 것과 관계없이 out은 1로 유지되므로, 이 회로는 1을 기억한다.</li>\n</ul>\n<p>그러나 이 래치는 out을 다시 0으로 만들 방법이 없기 때문에 추가 작업이 필요하다.</p>\n<ul>\n<li>\n<p>AND-OR게이트 래치\n<img src=\"images/20231210110510.png\" alt=\"\">\n~reset이 로우이면 reset이 하이이므로, OR게이트의 출력은 OR게이트의 입력에 되먹임 된다.\n~reset이 하이이면 되먹임이 깨지므로 out은 0이 된다.</p>\n</li>\n<li>\n<p>S-R래치\n<img src=\"images/20231210110836.png\" alt=\"\">\n간단하게 회로를 해석해보면, set이 0, reset이 0인 경우 상태를 저장, set이1, reset이 0인 경우 Q에 1출력, set이 0, reset이 1인 경우 Q에 0 출력. set, reset모두 1인 경우 비정상 입력이다.</p>\n<p>XOR게이트로 입력이 액티브 하이인 S-R래치도 만들 수 있지만, NAND게이트를 사용하는 것이 더 간단하고 전력 소모가 적다.</p>\n</li>\n</ul>\n<h3>게이트가 있는 래치</h3>\n<p><img src=\"images/20231210111459.png\" alt=\"\"></p>\n<p>S-R래치에 게이트를 추가하면, ~gate가 참인 상태에서는 입력의 변화가 그대로 출력에 나타나고, 거짓인 상태에서는 입력이 변해도 출력에 변화가 없다.</p>\n<h3>플립플롭</h3>\n<p>데이터 변경으로 인해 잘못된 결과가 생길 수 있는 가능성을 최소화 하자. (게이트가 열려 있는 동안에 상태를 바꾸지 않도록)</p>\n<ul>\n<li>\n<p>에지: 논리 수준이 한 수준에서 다른 수준으로 전이되는 중간에 데이터를 잡아 내는 것.</p>\n</li>\n<li>\n<p>플립플롭: 에지에 의해 데이터 변화가 촉발되는 래치</p>\n</li>\n<li>\n<p>D플립플롭: 양의 에지(0 -> 1)에 의해 변화가 촉발되는 플립플롭</p>\n</li>\n</ul>\n<h3>카운터</h3>\n<p>플립플롭을 응용한 회로 중 하나. 순서대로 수를 센다.</p>\n<ul>\n<li>리플 카운터: 개수를 센 결과가 왼쪽에서 오른쪽으로 퍼짐. 비동기 카운터라고도 함. 전파 지연으로 뒤로 갈 수록 결과 얻는 속도가 느려짐.</li>\n<li>동기적 카운터: 상태 변경이 동시에 일어난다. 즉, 모든 플립플롭을 같은 클록에 병렬로 연결함.</li>\n</ul>\n<h3>레지스터</h3>\n<p>클록을 공유하는 여러 D플립플롭을 한 패키지에 넣은 것.</p>\n<h2>메모리 조직과 주소 지정</h2>\n<p>레지스터보다 훨씬 많은 정보를 저장해야 한다면 어떻게 해야 할까?</p>\n<ul>\n<li>레저스터를 많이 쌓아둔다.\n어떤 레지스터를 사용할지 어떻게 지정할까? 각 레지스터에 번호를 부여해서 주소로 사용한다. 주소를 입력받아 디코더로 레지스터를 선택한다.\n다음으로 지정한 주소에 해당하는 레지스터의 출력을 선택해야 한다. 이는 실렉터를 사용하여 할 수 있다.\n<img src=\"images/20231210113302.png\" alt=\"\">\n연결을 줄이기 위해, 입력과 출력의 연결을 합치고, read/~write 신호를 통해 제어한다. enable 제어 신호는 메모리 전체를 켜거나 꺼서 여러 메모리 칩을 함께 연결하게 해준다.\n주소와 데이터에 큰 화살표를 이용한 이유는 비트를 대량으로 이동시키는 교통 수단, <strong>버스</strong>를 표현하기 위함이다.</li>\n</ul>\n<p>또 다른 문제는 메모리 크기가 늘어나면 주소로 연결해야 할 비트 수도 많아진다는 것이다. 메모리의 내부 위치는 주소를 행, 열로 나눠서 관리한다.</p>\n<p>열 주소 디코더, 행 주소 디코더로 행과 열을 지정한다.\n훨씬 더 많은 메모리가 있다면 행과 열 주소를 멀티플렉싱 하면 주소 라인의 수를 반으로 줄일 수 있다.</p>\n<h3>임의 접근 메모리(RAM)</h3>\n<p>지금까지 우리가 살펴본 메모리를 임의 접근 메모리 라고 부른다.</p>\n<ul>\n<li>정적 RAM(SRAM): 비싸지만 아주 빠르다. 각 비트에 트랜지스터가 6개 들어간다.</li>\n<li>동적 RAM(DRAM): 커패시터(capacitor)라는 아주 작은 버킷에 전자를 담고, 트랜지스터를 1개만 사용해 뚜껑을 덮는다. 이 버킷은 새기 때문에 가끔 메모리를 갱신해야 한다. 집적도다 높기 때문에 큰 메모리 칩에 사용된다.</li>\n</ul>\n<p>둘 다 휘발성(전원이 끊어지면 데이터가 사라지는) 메모리이다.</p>\n<h3>읽기 전용 메모리(ROM)</h3>\n<p>한 번만 쓸 수 있는 메모리가 더 정확한 표현이다.</p>\n<ul>\n<li>홀러리스 카드: 종이에 구멍을 뚫어 비트를 표시.</li>\n<li>코어 로프 메모리: 아폴로 호 비행 제어. 바느질을 통해 비트를 기록. 전자기 간섭의 영향 받지 않음.</li>\n<li>마스크 프로그래머블 ROM: 비트 패턴을 반도체 제조사에 보내면 비트 패턴을 마스크로 바꿔서 칩을 만들어 돌려준다.</li>\n<li>프로그래머블 ROM(PROM): 직접 프로그래밍 할 수 있지만 단 한 번만 가능.</li>\n<li>지울 수 있는 PROM(EPROM): 오류난 PROM이 산더미 산더미처럼 쌓이는것 방지. 특별한 자외선 빛 아래에 두면 저장된 내용 지울 수 있음.</li>\n<li>전기로 지울 수 있는 EPROM(EEPROM): 지우는 과정이 느리지만 전기로 지울 수 있음. 기술적으로는 RAM임.</li>\n</ul>\n<h2>블록 장치</h2>\n<h3>디스크 드라이브</h3>\n<p>자화된 판을 이용해 비트를 저장한다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 404px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAADfElEQVR42mWS60/bVhjG8y/sX9nHfavaaVo7ddK0y5e1mmhpGCpMk1q1QytDpRDKprYQKLA2VbWWQLLcHO65x3djOzZJZhIT5065JMS0kDUhF+/gdCvtjh69sl6fnx+f5z0aVsi2D9qvDNraB6wtXVardsgBKuh3Dju/vwsBgQetzt5qtt2xrYl5jWmFOaUd/904/8i0YjC7QB1/NtczNHm1Z/jBE9voU8fNgbEe3dTNwYnr/fqhh8aJ6YXHM3MftY3afWua2WW6Y9CsKE25tFfc3Tp4WVIUpfL34fZmpvyy9KpUkDZiuXTiRS61mU1XXpcVdbXdNlk83DF8qd+kNOvpbBZBUJpm5P19YX0dx3GMIGEUD6/xBBHb2qrmculYTIzFxbQU/+Ka4Y3zZRVufTKfzxMEEUQQGEEIt5vw+CiG6O1je29tIshfghDZSEibGenL60/ehw/LZYokKYahAwHKaKRsjvCiHRq2Xb0kaDtf6PXxev11U/W48Mus1RN6B5YkCUZRzO/nZmfRQACjCB+C3eiK3vocfmqggzCez+VUtvlt74z15JlrtRoXClEsyzudpMdDhbjDVyWnY/83fQJ1LgveBTLERCORpmr9Fm6/A9JWqtUqjmEoSdJmM+zzCesC2LdXbIoJAV9eoCGnD0WY1dWjWl2FjccwmPPF3ufyXqFYLIKoMIqirDaf1eJ1zcuyXCpugQEQc/Pc4uIqy7EsUzsJm13sNzcMGAqLokjT4GAwDqPU1P2gfSaIk16/H/e4eZMZQxBX0CVEheZ7ZwaBNepHoJfJZLxeD82y+OO7vMkShpyczRa2QDy+qveMTy89lwuy8n+4lXaz0eDENGbQWaa6HayXBMOG/RAxP7z068ifD6JctFKtVKvA5ujC27RvA+daHSxFif/x88L5DwwzD+/NjegcQwM23T3H/WnIGI+KJVnm+TUYwcT1yMU+kzrnpdbdbqiBV5CuD4P9X2/vyvmExHN0mGfzUqpafnOlj/+tAZwb3/X96/zVT9NRaTuaLPCJHYt9aSVAB5i4dQWFPBTkJiEvtQxzEWknLO1EkrvhZEHM7p6/9szq5TVuLHymY+xs99SnXZNnuyY/+9Fw7odHn3SOndaOnL4yckYLNPpxhx68VTUBdK578pR2LEgLmoODg1RS+k/JxEZSSqRSyfS7OrmnpXK5/A8kCCeFB7gTNwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231211210103\"\n        title=\"\"\n        src=\"/static/04de742108c90d97d85486b4a522758b/494f9/20231211210103.png\"\n        srcset=\"/static/04de742108c90d97d85486b4a522758b/772e8/20231211210103.png 200w,\n/static/04de742108c90d97d85486b4a522758b/e17e5/20231211210103.png 400w,\n/static/04de742108c90d97d85486b4a522758b/494f9/20231211210103.png 404w\"\n        sizes=\"(max-width: 404px) 100vw, 404px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<ul>\n<li>디스크 헤드: 손 역할</li>\n<li>블록: 섹터라고 불림. 디스크에서 읽고 쓰기가 가능한 가장 작은 단위.</li>\n<li>비트 밀도: bit/mm^2. 바깥쪽 트랙은 비트 밀도가 낮기 때문에 공간이 낭비된다. 최근 디스크는 방사상 영역으로 구분해 이 문제를 해결한다.</li>\n<li>탐색 시간:헤드를 한 트랙에서 다른 트랙으로 옮길 때 걸리는 시간.</li>\n</ul>\n<p>방금 헤드를 지난 데이터가 다시 필요할 경우 한바퀴 회전 기다려야 한다.\n기계 부품이 시간이 갈수록 낡는다.</p>\n<h3>자기 테이프</h3>\n<p>자화시킨 테이프를 감은 릴을 사용</p>\n<h3>광학 디스크</h3>\n<p>데이터를 읽고 쓰기 위해 자성 대신 빛을 사용. 같은 데이터를 포함하는 디스크를 대량으로 찍어낼 수 있다.\nCD, DVD</p>\n<h2>플래시 메모리와 SSD</h2>\n<h3>플래시 메모리</h3>\n<p>가장 최근 나타난 EEPROM 유형의 매체. DRAM처럼 버킷에 전자를 담지만, 버킷을 잘 만들어서 전자가 새지 않는다. RAM처럼 원하는 위치를 맘대로 읽을 수 있다.\n0을 1로 바꿀 수는 있지만, 전체를 지우지 않고 원하는 비트만 0으로 되돌릴 수는 없다. 모든 메모리를 지우는 것은 낭비가 심하므로, 블록 단위로 접근할 수 있다.\n즉, 읽을 때는 임의 접근, 쓸 때는 블록 접근 장치이다.</p>\n<h3>SSD (고체 상태 드라이브)</h3>\n<p>디스크 드라이브 모양의 패키지에 넣은 플래시 메모리.\n여러 블록의 쓴 횟수를 기억해서 모든 블록이 가능하면 똑같은 수준으로 낡도록 조정하는 프로세서가 들어있다.</p>\n<h2>오류 감지와 정정</h2>\n<p>한 줄기의 우주 방사선이 언제 메모리에 닿아서 비트가 잘못될 지 알 수 없다.</p>\n<h3>패리티</h3>\n<p>1비트 오류 감지 가능. 데이터에서 1로 설정된 비트의 수를 세고, 그 개수가 짝수인지 홀수인지 나타내는 1비트를 덧붙인다.</p>\n<ul>\n<li>짝수 패리티: 모든 값을 XOR</li>\n<li>홀수 패리티: XOR한 값의 보수</li>\n</ul>\n<h3>해밍 코드</h3>\n<h3>체크섬</h3>\n<p>정적인 데이터 블록을 검사함.\n데이터의 각 지점을 n비트 값으로 더하고, n비트를 넘어가는 값은 무시한다. n이 크면 클수록 위양성(데이터 블록에 오류가 있는데 오류가 없다고 판단하는 경우) 발생 확률이 줄어든다.</p>\n<h3>순환 중복 검사</h3>\n<h3>해시 코드</h3>\n<h2>하드웨어와 소프트웨어 비교</h2>\n<ul>\n<li>펌웨어: ROM에 담긴 소프트웨어를 가리키는 말이었으나, 플래시 메모리, RAM상에도 존재함.</li>\n</ul>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Project","subCategory":"cs"}],"date":"2023-12-11","slug":"/blog/cs/order","title":"메모리와 디스크 - 순차논리"}}},{"node":{"html":"<h1>문제</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVR42q2UjXLjIAyEef/XvObfSbCNHTtOouNbrDRp2rle75jZAUkgpJUgrDdrG04nu16vdrlcNAuXd1nzLD/tuT7rbrebhbqubb/fC8fjYZ6Pwm63k3w4FD2y60BVVXbYHzQjn8+ThaZprI7F6TFG4wJ0yFpnpLa1rute0KZkbbb1fW8pdTaOo4UeQ1sMOMDI5pid4zjlQ8jjeM4RnHWIGUzTZMMwyM4+Ug/b7dYWi4WtVit7e/tlm81Ga/SeVoxHzZ4aFMQ5G+TVem3L5dJOuRaByIA25IiaptY6KvUSNXaiRU+atWhIJZsMogYURhy2baOwCxdJN5XU+3w4ils4Kntbrfu+u59xKuQwpfbOFzfHXN1yKAlEic05fAQcetsAtQ03QCw3EJmQZY/yrstgH0Dfz6l+HKGqdrod77fbdZ4LfLj82NCf6eQQfuIMUqahqVyjYjTiSi0Vi83pYS4NXmmNTW3T5QMNnM295BUt/ZnXNQWDz1Y6ePMnJx4znjiktzA8pvZ92AtFoZsJPjkg/zQoGtrCi+GVR/Z2cWDzAgUe+zp3+pRD9igfo/068le9HEIoT8lfzE8B72QScMa79ep6Jf8W+CF9/Yc4JHU+BoBMsfxf/A4IRg5ZwCGEPxL9kfg/gf10i74vviuqRI/9C/Q56EOYXwg8/BRQRJQhzf/b/6rybyovpMx7h0XeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209224957\"\n        title=\"\"\n        src=\"/static/5a04f99ea9449994e12f2a552c4cbb11/5a190/20231209224957.png\"\n        srcset=\"/static/5a04f99ea9449994e12f2a552c4cbb11/772e8/20231209224957.png 200w,\n/static/5a04f99ea9449994e12f2a552c4cbb11/e17e5/20231209224957.png 400w,\n/static/5a04f99ea9449994e12f2a552c4cbb11/5a190/20231209224957.png 800w,\n/static/5a04f99ea9449994e12f2a552c4cbb11/48ca3/20231209224957.png 1084w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>풀이</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include&lt;iostream&gt;\n#include&lt;vector&gt;\n#include&lt;algorithm&gt;\n\nusing namespace std;\n\nconst int INF = 987654321;\n\nint n, m;\nvector&lt;int&gt; v;\nint dp[101][101];\n\nint minError(int start, int end){\n\tint minNum = v[start];\n\tint maxNum = v[end];\n\n\tint result = INF;\n\tfor (int num = minNum; num &lt;= maxNum; num++) {\n\t\tint calc = 0;\n\t\tfor (int i = start; i &lt;= end; i++) {\n\t\t\tcalc += (num - v[i]) * (num - v[i]);\n\t\t}\n\t\tresult = min(result, calc);\n\t}\n\treturn result;\n}\n\n//start이휴를 part개로 나눌때\nint solve(int start, int parts) {\n\tif (start == n) return 0;\n\tif (parts == 0) return INF;\n\n\tint &amp;ret = dp[start][parts];\n\tif (ret != -1) return ret;\n\n\tret = INF;\n\n\tfor (int partsSize = 1; start + partsSize &lt;= n; partsSize++) {\n\t\tret = min(ret, minError(start, start + partsSize - 1) + solve(start + partsSize, parts - 1));\n\t}\n\treturn ret;\n}\n\nint main(void) {\n\tmemset(dp, -1, sizeof(dp));\n\n\tcin &gt;&gt; n &gt;&gt; m;\n\tfor (int i = 0; i &lt; n; i++) {\n\t\tint a;\n\t\tcin &gt;&gt; a;\n\t\tv.push_back(a);\n\t}\n\n\tsort(v.begin(), v.end());\n\n\tcout &lt;&lt; solve(0, m);\n}</code></pre></div>\n<h1>복기</h1>\n<ul>\n<li>문제의 단순화\n이 문제를 곧이 곧대로 푸려면, 양자화 할 수 10개를 1000의 범위에서 골라야 하므로 1000C10 이라는 엄청 큰 수의 계산을 해야 하므로 문제를 풀 수 없다.\n그래서 다음과 같은 아이디어가 필요하다.\n\"주어진 수열을 정렬하면, 같은 숫자로 양자화 되는 숫자들은 항상 인접해있다.\"\n주어진 수열을 정렬하면, 인접한 숫자들은 같은 수로 양자화 되기 때문에, 수열을 m등분 하는 것으로 문제를 단순화 할 수 있다.\n따라서 solve함수를 solve(start, parts): start인덱스에서부터 parts개로 양자화 했을 때, 최소 오차를 반환. 과 같이 정의하면 문제를 쉽게 풀 수 있다.</li>\n</ul>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-12-05T00:00:00.000Z","slug":"/blog/algorithm/quantization","title":"[동적계획] 와일드카드"}}},{"node":{"html":"<h1>문제</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnklEQVR42q2U646EIAyFef83HW8oiIrosP0KmNnNZn/tJCfFFtpzoB3T932O8czXdeXzPBUxHmpTSmLTsy7fxGO15+MD5DDe+2ytzcuy5GEY8jiOinVd1TdJbJ7nPE1WMGXnnCY8jiPvgrY+xSYpbtigkMMkZh1CyBQiIXCuWIp4ibO2UqTF2evrOcMmGJAMBlaYzHZWloXZpMw5hKx93/Vg2EJew5q3bVPgh6lKDhIgMRv3GlwWpxuJ873vm8bxkVglq18SVdnIN0ES8YHURaRxaEWCAB8sWW/CaKky8bW7/PVRQtiUQWOJfRhXiVGKYimud+aLXL6x7CepPkqSzP/1M133kirx6bMLCanQv+87v99vtU0a/rb3ExoTa5DBi7ZebCgtVG29U20bAZ1ga3+C1r/aNjxEXx2tRVgPMkHdq8tM0jiNT8MTX1evibEUcc7X1xeGVIDqJbKu61Z5yGrg+6fvzzvs++7poTZGx8dI8crMbLHxe//J3cfaMviT3L3ZRDeUywiWHpvlfnT4FWVGdV7T+RT+/MNINSnrL6V4PrnTyjmgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231203210910\"\n        title=\"\"\n        src=\"/static/9118a4d79213935bcaf72afc8db0de2d/5a190/20231203210910.png\"\n        srcset=\"/static/9118a4d79213935bcaf72afc8db0de2d/772e8/20231203210910.png 200w,\n/static/9118a4d79213935bcaf72afc8db0de2d/e17e5/20231203210910.png 400w,\n/static/9118a4d79213935bcaf72afc8db0de2d/5a190/20231203210910.png 800w,\n/static/9118a4d79213935bcaf72afc8db0de2d/4ef40/20231203210910.png 1057w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>풀이</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include&lt;iostream&gt;\n#include&lt;vector&gt;\n#include&lt;string&gt;\n\nusing namespace std;\n\nint n;\nstring W;\nvector&lt;string&gt; targets;\nint dp[101][101];\n//he?p\n//heap\n//help\n//helpp\n\nbool solve(int w, int s, string fullString) {\n\tint&amp; ret = dp[w][s];\n\tif (ret != -1) return ret;\n\n\twhile (w &lt; W.size() &amp;&amp; s &lt; fullString.size() &amp;&amp; (W[w] == &#39;?&#39; || W[w] == fullString[s])){\n\t\tw++;\n\t\ts++;\n\t}\n\n\tif (w == W.size()) return s == fullString.size();\n\n\tif (W[w] == &#39;*&#39;) {\n\t\tfor (int i = 0; i &lt; fullString.size() - s; i++)\n\t\t\tif (solve(w + 1, s + i, fullString))\n\t\t\t\treturn ret = true;\n\t}\n\n\tif (W[w] != fullString[s])\n\t\treturn ret = false;\n\n\treturn ret = false;\n}\n\nint main(void) {\n\tmemset(dp, -1, sizeof(dp));\n\n\tcin &gt;&gt; W;\n\tcin &gt;&gt; n;\n\n\tfor (int i = 0; i &lt; n; i++) {\n\t\tstring s;\n\t\tcin &gt;&gt; s;\n\t\ttargets.push_back(s);\n\t}\n\n\tfor (int i = 0; i &lt; n; i++) {\n\t\tif (solve(0, 0, targets[i])) {\n\t\t\tcout &lt;&lt; targets[i];\n\t\t}\n\t}\n}</code></pre></div>\n<ul>\n<li>문제의 핵심은 * 가 몇 글자에 대응되는 가 이다. 그래서 이 부분을 재귀로 모든 경우를 테스트 해주었다.</li>\n<li>문자의 최대 길이가 100이므로, 모든 경우를 테스트 한다고 해도 경우가 100 * 100을 넘을 수는 없다.</li>\n<li>\n<ul>\n<li>가 연속으로 나올 때, 중복으로 세는 경우가 생길 수 있으므로, 메모리에 계산 값을 저장해둔다.</li>\n</ul>\n</li>\n</ul>\n<h1>복기</h1>\n<p>처음에 string::iterator를 사용해서 문제를 푸려고 했다.\n그러나 문자의 끝 확인이나, dp사용이 번거로워서 index로 풀이를 바꿨다.</p>\n<h1>알아둘 것</h1>\n<h2>string 매개변수</h2>\n<p>문제 해설에서 함수의 매개변수로 string을 사용할 때, string s와 같은 식으로 쓰지 않고, const string &#x26; s와 같이 사용했다.\ns의 길이가 길면, 재귀 함수 호출 시 마다 s를 복사 해야하기 때문에 메모리 초과가 발생할 수 있다. 따라서 call by reference로 호출 시 메모리가 낭비되지 않는다. 참조값은 변경되지 않는게 좋으므로 앞에 const까지 붙인 것 같다.</p>\n<h2>string size, length차이</h2>\n<p>size는 컨테이너의 크기를 반환한다. 해당 컨테이너에 저장된 요소의 개수를 반환해주며, 시간복잡도는 O(1)이다. 널문자도 포함하여 반환한다.\nlength는 string 클래스에 종속돼있다. 문자열의 실제 길이를 반환해주며, 시간복잡도는 O(N)이다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-12-05","slug":"/blog/algorithm/lis","title":"[동적계획] 와일드카드"}}},{"node":{"html":"<p>대게 동적 계획법을 사용하는 코드에서는 실제 답을 계산하는 과정을 별도로 구현한다.\n각 부분 문제마다 어떤 선택지를 택했을 때 최적해를 얻는지 기록해 두고, 별도의 재귀 함수를 통해 선택을 되짚어 가며 최적해를 생성해내면 된다.</p>\n<h1>코드</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">int n;\nint box[101] = { 0, };\nint dp[101] = { 0, };\nint choices[101];\n\nint solve(int idx) {\n\tint&amp; ret = dp[idx];\n\tif (ret != -1)\n\t\treturn ret;\n\n\tret = 1;\n\n\tif (idx == n) return ret;\n\n\tint bestNext = -1;\n\n\tfor (int next = idx + 1; next &lt; n; next++) {\n\t\tif (box[idx] &lt; box[next]) {\n\t\t\tint cand = solve(next) + 1;\n\t\t\tif (cand &gt; ret) {\n\t\t\t\tret = cand;\n\t\t\t\tbestNext = next;\n\t\t\t}\n\t\t}\n\t}\n\tchoices[idx + 1] = bestNext;\n\treturn ret;\n}\n\nvoid reconstruct(int start, vector&lt;int&gt; &amp; seq) {\n\tif (start != -1) seq.push_back(box[start]);\n\tint next = choices[start + 1];\n\tif (next != -1) reconstruct(next, seq);\n}</code></pre></div>\n<h1>방법</h1>\n<ol>\n<li>재귀 호출의 각 단계에서 최적해를 만들었던 선택을 별도의 배열에 저장해 둔다.</li>\n<li>별도의 재귀 함수를 이용해 이 선택을 따라가며 각 선택지를 저장하거나 출력한다.</li>\n</ol>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-12-03","slug":"/blog/algorithm/dpdp","title":"[동적계획] 실제 해 구하기"}}},{"node":{"html":"<h1>코드</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include&lt;iostream&gt;\n\nusing namespace std;\n\nint n; // max 100\nlong long dp[101] = {0,};\nconst int MOD = 1000000007;\n\nint main(void) {\n\tcin &gt;&gt; n;\n\n\tdp[0] = 1;\n\tdp[1] = 1;\n\tdp[2] = 2;\n\n\tfor (int i = 3; i &lt;= n; i++) {\n\t\tdp[i] = (dp[i - 1] + dp[i - 2]) % MOD;\n\t}\n\n\tif (n % 2 == 0) {\n\t\tcout &lt;&lt; ((dp[n] - dp[n / 2] + MOD) % MOD - dp[(n / 2) - 1] + MOD) % MOD;\n\t}\n\telse {\n\t\tcout &lt;&lt; dp[n] - dp[n / 2];\n\t}\n\n\treturn 0;\n}</code></pre></div>\n<h1>복기</h1>\n<p>처음에 n이 짝수인 경우 dp[n] - dp[n/2]만 하면 된다 생각했는데, 가운데가 ||인 경우와 =인 경우를 둘 다 생각해줘야 했다.\nMOD연산이 들어갈 때, 빼기가 들어가면 항상 MOD를 더하고  % 연산을 한번 더 해줘야 답이 제대로 나온다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-12-03","slug":"/blog/algorithm/tiling","title":"[동적계획] 비대칭 타일링"}}},{"node":{"html":"<h1>문제</h1>\n<p><img src=\"images/20231212202207.png\" alt=\"\"></p>\n<h1>코드</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include&lt;iostream&gt;\n#include&lt;vector&gt;\n#include &lt;iomanip&gt;\n\nusing namespace std;\n\nint N, D, T, S, c;\ndouble dp[101][51];\nvector&lt;int&gt; route[51];\n //dp[i][j]: i일 후에 j에 있을 확률\n\n//d일에 x에 있는 확률 반환\ndouble solve(int d, int x) {\n\tif (d == 0 &amp;&amp; x == S) return 1.0;\n\tif (d == 0) return 0;\n\n\tdouble&amp; ret = dp[d][x];\n\n\tif (ret != -1.0) return ret;\n\n\tret = 0.0;\n\n\tfor (int i = 0; i &lt; N; i++) {\n\t\tfor (int j = 0; j &lt; route[i].size(); j++) {\n\t\t\tif (route[i][j] == x)\n\t\t\t{\n\t\t\t\tret += solve(d - 1, i)/(double)route[i].size();\n\t\t\t}\n\t\t}\n\t}\n\treturn ret;\n}\n\nint main(void) {\n\tcin &gt;&gt; c;\n\n\twhile (c--) {\n\t\tfor (int i = 0; i &lt; 101; i++) {\n\t\t\tfor (int j = 0; j &lt; 51; j++) {\n\t\t\t\tdp[i][j] = -1.0;\n\t\t\t}\n\t\t}\n\t\tfor (int i = 0; i &lt; 51; i++) {\n\t\t\troute[i].clear();\n\t\t}\n\n\t\tcin &gt;&gt; N &gt;&gt; D &gt;&gt; S;\n\n\t\tfor (int i = 0; i &lt; N; i++) {\n\t\t\tfor (int j = 0; j &lt; N; j++) {\n\t\t\t\tint x;\n\t\t\t\tcin &gt;&gt; x;\n\t\t\t\tif (x == 1) {\n\t\t\t\t\troute[i].push_back(j);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcin &gt;&gt; T;\n\t\tfor (int i = 0; i &lt; T; i++) {\n\t\t\tint t;\n\t\t\tcin &gt;&gt; t;\n\t\t\tcout &lt;&lt; setprecision(8) &lt;&lt; solve(D, t) &lt;&lt; &quot; &quot;;\n\t\t}\n\t\tcout &lt;&lt; &quot;\\n&quot;;\n\t}\n\n\n\treturn 0;\n}</code></pre></div>\n<h1>복기</h1>\n<p>d일에 x에 있을 확률을 구하는 문제이기 때문에, d일에 x에 있을 확률을 반환하는 함수를 만들어 보았다.\nd일에 x에 있을 확률은 d-1일에 x에 연결된 것들에서 오는 확률을 모두 더하면 구할 수 있으므로 시도해보았다.\n이를 dp에 저장하면, 일수는 최대 100일이고 x는 최대 51개이니 많은 연산을 하지 않고 구할 수 있을 것 같았다.</p>\n<h1>다른 풀이</h1>\n<p>이 문제는 문제를 뒤에서 푸는 방식이 아닌 출발지점부터 올라가는 방식으로도 해결이 가능하다.\n함수를 days일 째에 here번 마을에 숨어 있을 때, 마지막 날에 q번 마을에 있을 조건부 확률을 반환하도록 하면 된다.</p>\n<h1>알아둘 것</h1>\n<p>문제에서 실수를 사용하기 때문에, 수를 표현할 때 1.0과 같은 식으로 써주지 않으면 형 변환 문제가 생겨 오류가 생기는 부분이 있었다.\n답을 출력할 때도, setPrecision(8)을 해주어야 정답으로 인정됐다.</p>\n<h2>마르코프 연쇄</h2>\n<ul>\n<li>유한개의 상태가 있다.</li>\n<li>매 시간마다 상태가 변경된다</li>\n<li>어떤 상태 a에서 다른 상태 b로 옮겨갈 확률은 현재 상태 a에만 좌우됨. a 이전에 어느 상태에 있었는지, 현재 시간은 얼마인지 등은 영향을 주지 않는다.</li>\n</ul>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-12-03","slug":"/blog/algorithm/talok","title":"[동적계획] 두니발 박사의 탈옥"}}},{"node":{"html":"<h1>코드</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include&lt;iostream&gt;\n\nusing namespace std;\n\nconst int MOD = 10000000;\nint n;\nint dp[101][101] = { 0, };\n\n//cnt개로 만들고 remain개 남았을때\n//remain개의 정사각형으로 이루어졌구, 맨 위 가로줄이 cnt개\nint solve(int cnt, int remain) {\n\tif (remain == cnt) return 1;\n\n\tint&amp; ret = dp[cnt][remain];\n\tif (ret != -1) return ret;\n\n\tret = 0;\n\n\tfor (int i = 1; i &lt;= remain - cnt; i++) {\n\t\tret += ((cnt + i - 1) * solve(i, remain - cnt)) % MOD;\n\t\tret %= MOD;\n\t}\n\n\treturn ret;\n}\n\nint main(void) {\n\tmemset(dp, -1, sizeof(dp));\n\n\tcin &gt;&gt; n;\n\n\tint result = 0;\n\tfor (int i = 1; i &lt;= n; i++) {\n\t\tresult += solve(i, n);\n\t\tresult %= MOD;\n\t}\n\tcout &lt;&lt; result;\n}</code></pre></div>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-12-03","slug":"/blog/algorithm/poly","title":"[동적계획] 폴리오미노"}}},{"node":{"html":"<h1>문제</h1>\n<p><img src=\"images/20231208215531.png\" alt=\"\"></p>\n<h1>풀이</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">using namespace std;\n\nstring number;\n\nconst int BIG = 987654321;\nint dp[10001];\n//dp[i]: i~끝까지 난이도 최소값\n\nint level(string s) {\n\tbool flag = false;\n\tfor (int i = 0; i &lt; s.size() - 1; i++) {\n\t\tif (s[i] != s[i + 1]) flag = true;\n\t}\n\tif (!flag) return 1;\n\n\tflag = false;\n\tint mem = s[1] - s[0];\n\tfor (int i = 1; i &lt; s.size() - 1; i++) {\n\t\tif (s[i + 1] - s[i] != mem) flag = true;\n\t}\n\tif (!flag) {\n\t\tif (mem == 1) return 2;\n\t\telse return 5;\n\t}\n\n\tif (s.size() == 3 &amp;&amp; s[0] == s[2]) return 4;\n\tif (s.size() == 4 &amp;&amp; s[0] == s[2] &amp;&amp; s[1] == s[3]) return 4;\n\tif (s.size() == 5 &amp;&amp; s[0] == s[2] == s[4] &amp;&amp; s[1] == s[3]) return 4;\n\n\treturn 10;\n}\n\nint divide(int idx) {\n\tif (idx == number.size()) return 0;\n\n\tint &amp;ret = dp[idx];\n\tif (ret != -1) return ret;\n\n\tret = BIG;\n\n\tfor (int i = 3; i &lt;= 5; i++) {\n\t\tif (idx + i &lt;= number.size())\n\t\t{\n\t\t\tret = min(ret, level(number.substr(idx, i)) + divide(idx + i));\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nint main(void) {\n\tmemset(dp, -1, sizeof(dp));\n\n\tcin &gt;&gt; number;\n\n\tcout &lt;&lt; divide(0);\n}\n\n</code></pre></div>\n<h1>복기</h1>\n<p>난이도를 반환하는 함수를 만들기 조금 귀찮은 것을 제외하면 어렵지는 않았다. 그러나 재귀함수의 탈출 조건과,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">if(idx+i &lt;= number.size())</code></pre></div>\n<p>부분에서 틀렸다. 나는 idx + i가 number.size() - 1 일 때를 탈출 조건으로 설정했는데, idx == number.size()일 때로 설정해야 마지막 숫자까지 검사가 된다는걸 깨달았다. 항상 조건의 경계 부분을 제대로 검사 해야겠다.</p>\n<h1>시간 복잡도</h1>\n<p>최대 n개의 부분 문제가 있고, 각 부분 문제를 해결하는데 최대 3개의 부분 문제를 보므로, 시간 복잡도는 O(n)이다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-12-03","slug":"/blog/algorithm/pi","title":"[동적계획] 원주율 외우기"}}},{"node":{"html":"<h2>비트</h2>\n<p>문자 언어는 다음과 같은 세 가지 구성요소로 이루어져 있다.</p>\n<ul>\n<li>기호가 들어갈 상자</li>\n<li>상자에 들어갈 기호</li>\n<li>상자의 순서\n컴퓨터에서는 이 상자를 비트라고 부른다.</li>\n</ul>\n<h2>논리 연산</h2>\n<p>다른 비트들이 표현하는 내용으로부터 새로운 비트를 만들어내는 동작</p>\n<h3>불리언 대수</h3>\n<p>비트에 대해 사용할 수 있는 연산 규칙의 집합</p>\n<ul>\n<li>NOT</li>\n<li>AND</li>\n<li>OR</li>\n<li>XOR: 두 비트의 값이 다른 경우에만 참.</li>\n</ul>\n<h3>드모르간 법칙</h3>\n<p>a AND b = ~(~a OR ~b)\na OR b = ~(~a AND ~b)</p>\n<h2>정수를 비트로 표현하는 방법</h2>\n<h3>양의 정수 표현</h3>\n<p>우리는 10진수를 쓰지만, 컴퓨터는 2진수를 사용.</p>\n<ul>\n<li>LSB(least significant bit): 가장 오른쪽의 비트.</li>\n<li>MSB(most significant bit): 가장 왼쪽의 비트</li>\n</ul>\n<h3>2진수 덧셈</h3>\n<p>두 비트를 서로 더한 결과: XOR\n올림: AND</p>\n<ul>\n<li>오버플로: MSB에서 올림이 발생하는 경우</li>\n</ul>\n<h3>음수표현</h3>\n<ul>\n<li>부호와 크기: MSB를 부호로 쓰기로 정하고, 나머지 비트로 크기를 나타냄</li>\n<li>1의 보수: 양수의 모든 비트를 뒤집음. 0을 두 가지 방식으로 표현하게 됨</li>\n<li>2의 보수: +1에 더했을 때 0이 나오는 비트 패턴을 찾고, 이를 -1이라고 하자 => 1의 보수를 취하고 1을 더하면 된다.</li>\n</ul>\n<h2>실수를 표현하는 방법</h2>\n<h3>고정 소수점 표현법</h3>\n<p>4비트가 있다면 2비트는 소수점(분수), 2비트는 정수를 나타내는데 사용.\n쓸모 있는 범위의 실수를 표현할 때, 비트가 너무 많이 필요함</p>\n<h3>부동 소수점 표현법</h3>\n<p>과학적 표기법에서 10진 소수점 왼쪽이 한 자리뿐인 소수에 10을 몇번 거듭제곱한 값을 곱했는지로 표현. ex) 1.2 * 10^-12\n가수부분은 2진 소수, 지수 부분은 2의 거듭제곱 횟수를 표현.</p>\n<ul>\n<li>같은 값을 표현하는 방법이 여러가지가 된다</li>\n<li>비트 패턴이 가능한 모든 수 표현하지는 못함</li>\n</ul>\n<h3>IEEE 부동 소수점 표준</h3>\n<ul>\n<li>가수와 지수에 대해 각각 부호 비트 사용</li>\n<li>여러 트릭을 사용해 낭비되는 비트 최소화, 반올림 쉽게 함.</li>\n</ul>\n<p>정규화: 가수를 조정해서 맨 앞에 0이 없게 만든다.\n가수의 맨 왼쪽이 1이라는 사실을 알고 있으므로, 이를 생략</p>\n<h2>2진 코드화한 10진수 시스템</h2>\n<p>BCD(binary-coded decimal)\n4진수를 사용해 10진 숫자를 하나 표현\nex) 12 = 0001 0010</p>\n<h2>2진수를 다르는 쉬운 방법</h2>\n<h3>8진 표현법</h3>\n<p>비트들을 3개씩 그룹으로 묶고, 각 그룹에 8진 숫자를 부여</p>\n<h3>15진 표현법</h3>\n<p>요즘 컴퓨터가 8비트의 배수를 사용해 만들어지기 때문에 자주 쓰임.\n비트들을 4개씩 그룹으로 묶고, 각 그룹에 16진 숫자를 부여</p>\n<h3>프로그래밍 언어의 진법 표기법</h3>\n<ul>\n<li>0으로 시작하는 숫자는 8진 숫자이다.</li>\n<li>1~9 사이의 숫자로 시작하는 숫자는 10진 숫자이다.</li>\n<li>0x가 앞에 붙은 숫자는 16진수이다.</li>\n</ul>\n<h2>비트 그룹의 이름</h2>\n<p>비트는 너무 작아서 기본 단위로 사용하기에는 유용성이 떨어진다.\n4비트 -> 니블\n8비트 -> 1바이트\n16비트 -> 하프워드\n32비트 -> 워드\n64비트 -> 더블워드</p>\n<h2>텍스트 표현</h2>\n<h3>아스키 코드</h3>\n<p>ASCII: American standard code for information interchange\n키보드에 있는 모든 기호에 대해 7비트 수 값을 할당.\n몇가지는 장치를 제어하기 위해 쓰이는 제어 문자임.</p>\n<h3>다른 표준의 진화</h3>\n<p>영어 외의 언어를 지원해야할 필요가 생김</p>\n<ul>\n<li>ISO: 국제 표준화 기구 -> ISO-646, ISO-8859\n표준이 여러개인 이유는 비트가 비싼 시절에 문자를 7, 8비트에 욱여넣으려다 보니까 그렇게 됨.\n비트 가격이 떨어지면서 <strong>유니코드</strong> 라는 새로운 표준이 만들어짐.</li>\n</ul>\n<h3>유니코드 변환 형식 8비트 (UTF - 8)</h3>\n<p>비트를 아끼기 위해 한 문자를 8비트로 표현함.\n유니코드는 문자 코드에 따라 각기 다른 인코딩을 사용해서 이 문제를 해결한다.</p>\n<ul>\n<li>UTF-8은 모든 아스키 문자를 8비트로 표현, 아스키 데이터를 인코딩 할때는 추가 공간이 필요하지 않다.</li>\n<li>아스키가 아닌 문자의 경우 아스키를 받아서 처리하는 프로그램이 깨지지 않는 방법으로 인코딩\n<br/></li>\n<li>문자를 8비트 덩어리로 나누면서, 맨 앞 비트들은 0, 10, 110, 1110과 같은 식으로 구분할 수 있게 채움. ex) 11자리 2비트 -> 5자리/6자리. 5자리는 앞에 110, 6자리는 앞에 10을 채움.</li>\n</ul>\n<h2>문자를 사용한 수 표현</h2>\n<p>2진 데이터를 송수신하고 싶지만, 아스키 코드 중 상당수가 제어문자이고, 시스템마다 이를 처리하는 방식이 달라서 어려웠다.</p>\n<h3>출력 가능하게 변경한 인코딩 (QP인코딩)</h3>\n<p>8비트 데이터를 7비트 데이터만 지원하는 통신 경로를 통해 송수신 하기 위한 인코딩 방법.</p>\n<h3>base64 인코딩</h3>\n<p>3바이트 데이터를 4문자로 표현. 3바이트 데이터의 24바트를 4*6으로 나누고, 각 덩어리의 6비트 값에 출력 가능한 문자를 할당해 표현\n원본 데이터 길이가 2바이트 남으면 =, 1바이트 남으면 == 를 붙인다.</p>\n<h3>URL 인코딩</h3>\n<p>URL에 사용할 수 없는 문자들을 %뒤에 어떤 문자의 16진 표현을 덧붙이는 방식으로 문자를 인코딩한다.</p>\n<h2>색을 표현하는 방법</h2>\n<p>컴퓨터 모니터의 각 격자에 찍는 점 픽셀.\n빨간색, 녹색, 파란색 광선을 섞에 색을 만들어내는 RGB색 모델을 사용.\n색 표현에 24비트를 사용함. -> 가장 가까운 표준인 32비트(워드)에 넣어서 사용.\n낭비되는 8비트는 투명도를 나타내는데 사용하기로 함.</p>\n<h3>색 인코딩</h3>\n<p>16진 트리플렛: # 뒤에 16진 숫자를 추가. ex) #rrggbb</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Project","subCategory":"cs"}],"date":"2023-12-03","slug":"/blog/cs/comlang","title":"컴퓨터 내부의 언어 체계"}}},{"node":{"html":"<h2>디지털 컴퓨터의 사례</h2>\n<h3>아날로그와 디지털</h3>\n<p>전자기술에서\n아날로그: 연속적\n디지털: 이산적\n실수를 표현할 수 있는 아날로그가 좋아보일 수 있지만, 정밀도에 문제가 있음.</p>\n<h3>하드웨어에서 크기가 중요한 이유</h3>\n<p>전기는 빛의 속도로 움직이고, 이 값은 고정이므로, 전자의 여행 시간을 최소화하는 방법은 부품을 가능한 가깝게 위치 시키는 것 뿐이다. 여행 시간이 줄어들면 필요한 에너지의 양도 줄어든다.</p>\n<h3>디지털을 사용하면 더 안정적인 장치를 만들 수 있다.</h3>\n<p>하드웨어가 너무 작아지면 서로 간섭하기가 쉬워진다.\n우주선 방사, 중력, 전자기력 등이 아날로그 장치에는 영향을 끼칠 수 있지만, 디지털 장치에는 판정 기준이 있기 때문에 영향을 끼치기 어렵다.</p>\n<h3>아날로그 세계에서 디지털 만들기</h3>\n<ul>\n<li>\n<p>전이 함수\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 732px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDElEQVR42nWRa5KCMBCEuf953CO4d8A/SlGIQIDwUAiPsJ8ZFrXY7SpShOnu6Rm8eZ6ttU3TPHa4C9qWd611GIZxHBdFoZTq+35ZFo8HPZzlHdZyTNOYJklyu2ldoRnH0brvwzCs4jzP67pu29ZJ7KfD80pD3/dhSxZOYgZBgMQ7HL6Ox2+ty43dd13TYFgLL4oiTgkoBGNM13XPztSUyiW21CjoskR8uQSMSlrY74mIbSQ2AixpsnyCblVVSZ8/xOZXPE3TJqaAV+kgX/4Rm3Xb9GZ6LDC6XmOWQeZtCnhsSwLK2L3DKgbMRqssy9I0xQgB19PpdHbAi0U87q//T6eXeA+yuV0qHIW6xw/YGkPChcckTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231207094239\"\n        title=\"\"\n        src=\"/static/131ac1b856650868195e292891216d39/d0cc0/20231207094239.png\"\n        srcset=\"/static/131ac1b856650868195e292891216d39/772e8/20231207094239.png 200w,\n/static/131ac1b856650868195e292891216d39/e17e5/20231207094239.png 400w,\n/static/131ac1b856650868195e292891216d39/d0cc0/20231207094239.png 732w\"\n        sizes=\"(max-width: 732px) 100vw, 732px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n외부 자극이 선형 영역 부분에 많이 닿아야 기록되는 데이터가 덜 왜곡된다.</p>\n</li>\n<li>\n<p>증폭 전이 함수\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVR42l2Qxw6EMBBD+f/vQ4BEUei9igU2wGYfyQ0fRsl4bE9iSSk/Gvu+c962re/7dV1/GnQ4fzXmee66jjqOI8NKKYuT7/tJknChVVUV03jFcXwcxzAMrutiByWEQLksi9B4xFEUIQiCgBqGYdM0iOEcxyEHtiiKNE3LspymCQG+JGHBXhYTnufZtp3nORN0odu2JeS+77quWSHLMipbmF3wuq7rSeYx3DFDTDKxUgMOb74AFiWroTEfhBLqESuN8zxNgum+QD7WxLz6f1McUdLMgWEpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231207094517\"\n        title=\"\"\n        src=\"/static/f9d18e5be09e4d6db699592046826ef7/5a190/20231207094517.png\"\n        srcset=\"/static/f9d18e5be09e4d6db699592046826ef7/772e8/20231207094517.png 200w,\n/static/f9d18e5be09e4d6db699592046826ef7/e17e5/20231207094517.png 400w,\n/static/f9d18e5be09e4d6db699592046826ef7/5a190/20231207094517.png 800w,\n/static/f9d18e5be09e4d6db699592046826ef7/c1b63/20231207094517.png 1200w,\n/static/f9d18e5be09e4d6db699592046826ef7/29007/20231207094517.png 1600w,\n/static/f9d18e5be09e4d6db699592046826ef7/9f75f/20231207094517.png 2858w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n게인이 높아지면 곡선이 가팔라지고 출력이 커진다. 그러나 게인이 너무 높아지면 입력을 충실하게 재현하지 못하기 때문에 왜곡이 생긴다.\n이때 판정 기준을 문턱값 이라고 하는데, 중간 정도의 출력이 나오기는 어렵기 때문에, 이 현상을 연속적인 공간을 이산적인 영역으로 나눌 때 사용한다.</p>\n</li>\n</ul>\n<h3>10진 숫자 대신 비트를 사용하는 이유</h3>\n<p>하드웨어에서 비트가 숫자보다 더 좋은 이유 중 하나는, 전이 함수를 각기 다른 10가지 문턱값으로 구분할 수 있는 간단한 방법이 없기 때문이다.</p>\n<h2>간단한 전기 이론 가이드</h2>\n<h3>전기는 수도 배관과 유사하다.</h3>\n<ul>\n<li>\n<p>전기선 - 도체: 금속, 전기가 통하는 물질</p>\n</li>\n<li>\n<p>전기선 - 부도체: 금속 바깥쪽을 둘러싼 부분</p>\n</li>\n<li>\n<p>스위치: 전기의 흐름을 제어할 수 있는 벨브</p>\n</li>\n<li>\n<p>전압: 전기에서 수압에 해당. 물은 압력에 의해 밀려서 움직임. 볼트(V)</p>\n</li>\n<li>\n<p>전류: 전기 흐름의 양. 암페어</p>\n</li>\n<li>\n<p>저항: 전압이 높아도 너무 가는 도체를 쓰면 저항이 커져서 전류가 커지지 못한다. 옴</p>\n</li>\n</ul>\n<p>옴의법칙: I=V/R</p>\n<h2>전기 스위치</h2>\n<p>스위치를 만드는 일은 도체 사이에 부도체를 삽입하거나 제거하는 문제일 뿐이다.</p>\n<ul>\n<li>극: 한꺼번에 연결되어 이동하는 스위치의 수</li>\n<li>투: 접점</li>\n</ul>\n<h2>비트를 처리하기 위한 하드웨어</h2>\n<h3>릴레이</h3>\n<p>스위치를 움직이기 위해 전자석을 사용하는 장치</p>\n<ul>\n<li>평상시 열린 릴레이: 코일에 전력이 들어가지 않았을때 열려있음.</li>\n<li>평상시 닫힌 릴레이: 코일에 전력이 들어가지 않았을때 닫혀있음.</li>\n</ul>\n<p>전이 함수의 문턱값이 수직임(붙냐 안붙냐)\n느리고 전기를 많이 소모하며, 벌레가 스위치 접점에 있으면 제대로 작동하지 않는다는 큰 문제가 있었다.</p>\n<h3>진공관</h3>\n<p>물체를 충분히 가열하면 전자가 튀어나오는 열전자 방출 현상을 사용한다. 진공관 안에는 야구 투수 같은 역할을 하는 캐소드와, 캐소드를 가열하는 히터, 캐소드에서 발생한 전자는 에노드로 날아간다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 225px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1klEQVR42pWTWY8BQRSF+7d78jM8SsQTI0QQYiJE29dpW2xNGm3f9cwXJfTMGMx9qNR26txzzy3p81ms1+tmszkej0ejkWEY5iPpAUxc1XU9Eonkcrl6vX46nV4FX/FgJpOJeeclMDBVVQuFQjQarVarZGHGPwJvt1tZlhXlQ9NGlUoFzdlslslzZjiTySQA5sfjcTAYCEKUCzxL6bdIUZXmOSBPJBLxeNzn8zHJZDIcwT+fz2/MAIxzXCVR3t1uN51O3W732zlcLlcwGOSo2+22Wq0LGGSj0cAP8qEk/X4fke/v0Xa7zRI2CsZb5XI5n88LMEndwKTBPXh254A8lUptNhs0ezwev99Ptb1ebyAQ4H6v17uB73pbq9U0TSsWi06nMxwOW61WKm+325fLJSkI26Ur4KpZxH6/h7zT6bBJtSwWCw+xjxaR/J1qm8khIdtYLOZwOFBks9kURQF5OBye+8yIZgqG4bQXr9Bt5gSlx10NIf9pOBwyR8KrvT2bzUgbC8Q41XXR2Hd+lfE92CmVSqFQKJ1OLxYL5hScnP/3q/7y4gZerVb0Fg/j3kBVsRedVAg/RZPRYdz5QXsBc0zTc5XC0Bv0LaMsJzEWbzglf577Df4C1KhoCDeXNbsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209113942\"\n        title=\"\"\n        src=\"/static/41c6bb0eb9faea49e40985e2d1429dad/3684f/20231209113942.png\"\n        srcset=\"/static/41c6bb0eb9faea49e40985e2d1429dad/772e8/20231209113942.png 200w,\n/static/41c6bb0eb9faea49e40985e2d1429dad/3684f/20231209113942.png 225w\"\n        sizes=\"(max-width: 225px) 100vw, 225px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n히터가 캐소드를 가열하면 전자가 튀어 나간다. 그리드가 방해하지 않으면 전자가 애노드에 도달한다.</p>\n<ul>\n<li>장점: 움직이는 부분이 없어 릴레이보다 훨씬 빠르다.</li>\n<li>단점: 전구와 마찬가지로 진공관도 아주 뜨겁고 깨지기 쉽다.</li>\n</ul>\n<h3>트랜지스터</h3>\n<p>도체와 부도체 사이를 오갈 수 있는 반도체 사용.\n도체가 가늘고 얇아지면 저항이 늘어나 열이 발생하므로 반도체를 녹일 수 있기 때문에 열을 제거 하는게 중요하다.\n반도체 물질로 이뤄진 기판 또는 슬랩 위에 만들어진다. 트랜지스터 그림을 실리콘 웨이퍼 위에 투영해서 현상하는 광식각 과정을 통해 만들어진다.</p>\n<h3>집적 회로</h3>\n<p>트랜지스터를 사용하면 AND 함수 같은 간단한 회로를 만들 때조차 부품이 너무 많이 필요하다.\n집적 회로를 사용하면 복잡한 시스템을 트랜지스터 하나를 만드는 정도의 비용으로 만들 수 있다.</p>\n<h2>논리 게이트</h2>\n<p>집적 회로(IC) 패밀리: 논리 연산을 수행하는 회로가 미리 들어가 있다. 이런 회로를 논리 게이트라고 부른다.\n하드웨어 설계자가 밑바닥부터 모든 회로를 설계할 필요 없이, IC를 선으로 연결해 복잡한 회로를 쉽게 만들 수 있다.</p>\n<ul>\n<li>AND 게이트</li>\n<li>OR 게이트</li>\n<li>XOR 게이트</li>\n<li>인버터</li>\n</ul>\n<p>트랜지스터-트랜지스터 논리나, CMOS에서 가장 단순한 회로는 NAND나 NOR이다.</p>\n<h3>이력 현상을 활용한 잡음 내성 향상</h3>\n<p>현실 세계에서는 천천히 변하는 신호가 많다(잡음이 있다).\n잡음으로 인해 입력 신호가 문턱 값을 여러 번 오가면, 출력 신호에 글리치(작은 오류)가 생긴다.</p>\n<ul>\n<li>이력 현상: 판정 기준이 이력에 따라 달라짐.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 368px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABr0lEQVR42nVSTY+iQBDt//87PHqdOXhSD7BqYiTOgAzQ3Th8GflqwCCMyj5g3bAz7AtUquG91KuqJlEUCSEQ4zhGkiRJGIZpmgZBsF6vd7udJEmz2UxRFFVVD9oB+NA/1HfVtm2SZVnTNI/Ho3miz/f7PaOsqqrNZlPXdfMvwMmzjMRRjMP9fu81iMiRaJrmeR7EsiT334cAB04J3m+Ve/Hry6umarfbTerEPyujQZJn+ah4Op0yxmB4u91+I/yxnedEpGK0517juu7/xJkQBHMeFS+XS0RZlieTyV87Q07bM6z3//qZtcO4tbzFYoFIKdV1fTjR5/DusExgfVi5T8qyXK1WSAzD6MU/bRd5QbBr3/e9AXA9FGU3n8/P5zPqO66LmRdFcblcrh0uHaIwIqfTybIs9gTtnl+yjJ5tmxuGyamVJCmWggkVHYTAzRJwR5oxgIGySK5VJdK0/voapZHA99S3N0r5yfcs03IcB0YM/RB2WwC8zyOlzPcDz3UYt532yHVVK8sr9px8om9um4YBBufcbo8s7fYPpHGMtk3T4oz7ns8pOx6PNuNVVf8GRiETqz/Q/2UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209115510\"\n        title=\"\"\n        src=\"/static/e261d19a229081df5c485a8fbcfa8483/2b727/20231209115510.png\"\n        srcset=\"/static/e261d19a229081df5c485a8fbcfa8483/772e8/20231209115510.png 200w,\n/static/e261d19a229081df5c485a8fbcfa8483/2b727/20231209115510.png 368w\"\n        sizes=\"(max-width: 368px) 100vw, 368px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n출력이 0이면 오른쪽 곡선을 사용하고, 출력이 1이면 왼쪽 곡선을 사용한다. 출력값이 반전되려면 값이 많이 변해야 하므로 잡음 내성이 커진다.</li>\n</ul>\n<h3>차동 신호</h3>\n<p>이력을 도입해도 충분하지 않은 경우, 두 개의 상대적인 위치를 사용해 값을 결정한다.</p>\n<ul>\n<li>드라이버: 입력 신호를 반전관계 출력으로 변환</li>\n<li>리시버: 반전관계 두 입력을 받아 단일 신호로 변환\n연선 케이블링이 계발됨. 한 쌍의 선을 꼬아서 신호 전송.</li>\n</ul>\n<h3>전파 지연</h3>\n<p>입력의 변화가 출력에 영향을 미칠 때까지 걸리는 시간.\n제조 과정에서 생기는 편차, 연결된 부품 수에 따라 달라지는 통계 값임.\n논리 회로의 최대 속도를 제한한다.</p>\n<h2>출력 유형</h2>\n<h3>토템폴 출력</h3>\n<h3>오픈 컬렉터 출력</h3>\n<h3>트라이스테이트 츨력</h3>\n<h2>게이트를 조합한 복잡한 회로</h2>\n<p>게이트를 사용하면서 하드웨어 설계 과정이 아주 단순해졌다.</p>\n<ul>\n<li>소규모 집적 회로</li>\n<li>중간 규모 집적 회로: 특별히 자주 사용되는 조합</li>\n<li>대규모 집적 회로</li>\n</ul>\n<h3>가산기</h3>\n<p>두 비트를 더한 값은 각 비트의 XOR이고, 올림은 두 비트의 AND라는 사실을 가지고 구현해보자.</p>\n<ul>\n<li>\n<p>반가산기\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVR42p2T30taYRjHz7FZbZ5lzs7G6ccMMWdYnW2NtoKiC1k2byJIug4Cr+etKAxD74Qu/QcEx0C2IUO8cHbT0Jsh3neRPy4ETQhiHD19n3oFi06DXvjwcI7v832+53keOe768Jz2eQJeud3uTx6PZ1EURYFeqqqqmfMSLIBh8AyMAiMQwZLVan2O6AqHw1/b7bZaKBROo9Ho/n2iFjAP7CzOkSPwHoT0er2TCtrt9s/NZvMCImqj0VAjkcgeJdtsthGEx8wYfQ33COjuKDTMxOkMSpK0Va1Wz7rdLmmqmUzmDxU2m80OxBmwwkS5dbBJxcBbIIMD8BFswyG5/iDLcqDVaikkVqvV1EAgsEvJyWRygBUdosIc65vIHgyALiyBKfDaYrFQTzdisdiPSqWi5HK5v8FgcOd/g+FuTZv6NsZ6SZ8+YTQaFw0Gw4vexTvE+F4+3yd0Q1AQhFl6iMfjX0ql0s9isfg9kUgculyucXZP15fP3+eQhjFqMpmWEd+l0+lj6l2n0/lHMZVKfetzyff1cEhLkAYh9F7m8/lfJHSBg6CUy+VzuF/DT7MYmsxWjvo+cVuwtz5v6LLD4ZAQpWw2+5sEFUW5cojlPqHlZw71LI+G+1RrOORuGrtHezWJ1Tgic/V6vQN3rVAo5GWfrOMecrxe75zf71/z+XyrTqdzSuP/f9XPS2saweDLSzKxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209121629\"\n        title=\"\"\n        src=\"/static/0cd1c40f7d1ab97f95ff25bfbb69d624/5a190/20231209121629.png\"\n        srcset=\"/static/0cd1c40f7d1ab97f95ff25bfbb69d624/772e8/20231209121629.png 200w,\n/static/0cd1c40f7d1ab97f95ff25bfbb69d624/e17e5/20231209121629.png 400w,\n/static/0cd1c40f7d1ab97f95ff25bfbb69d624/5a190/20231209121629.png 800w,\n/static/0cd1c40f7d1ab97f95ff25bfbb69d624/c1b63/20231209121629.png 1200w,\n/static/0cd1c40f7d1ab97f95ff25bfbb69d624/29007/20231209121629.png 1600w,\n/static/0cd1c40f7d1ab97f95ff25bfbb69d624/29114/20231209121629.png 1920w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n두 비트만 더할때는 이걸로 충분하지만, 올림을 처리하려면 세 번째 입력이 필요하다.</p>\n</li>\n<li>\n<p>전가산기\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 220px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACK0lEQVR42mNgYGBgAWJWBgjgLy0t9ZkzZ44lkM0EFQPRbFA2w////xmBFDYMB/xArM7Pz28EpEWbm5snAzX9P3r06CQgnweIBd3d3RPOnTu3fu3atX5IhuIE3ECswsXFZQykRYAuzAIZ+OjRo6e8vLzeQDEuQUFB6wcPHnz89+/f/9bW1gCQjyQlJUVAlkEdJAXEEjAD+YBYnpOT0wxI2/T29k67efPmuRkzZjgD+XJALK2goOD//Pnzn2/fvn2Xm5trBbIEaqAQEuaCGSgHtcECiM3ExMR0QYaAFDEzM4NcoxoWFma3Z8+e/MmTJ6sR42UWaKArA7EkVAMsQvSkpaVlAgMDZaBBAzOMKS0tjbW+vp4JW6SAADOygSAFUEMVysvLE968efML6N1vy5cvD0ezEMbGiG2QgSrIBgJtB7lcbOrUqeHfv38HxdP/zZs3rwCFuaWlpeHGjRsnrF692g1XEKAbyAS1ma2wsNDj2rVrJ69evboZGMM60EgUBEbcaZAlK1asSAEFm4qKiihyxGBzIdhb7e3txseOHdsLTJdzsrOzpaBhyX3r1q0jIAOBabMEyGcXERFRhUYm3EAtUCQAMcgVOsB0qQ+kFauqqrJgXt60adNioJiAiYmJ1datW5fv2LEjDluEwIAANJGCaAEpKSlhkEUTJ04M+fbt2/8fP378X79+fTp6pKDFNN7kBJYEelN45syZnkCDjZHyN+P+/ftZgAazoBsCAKGw3/HB5C0aAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209122201\"\n        title=\"\"\n        src=\"/static/c3409fec3f08d25b6015bba1eebcf628/c8042/20231209122201.png\"\n        srcset=\"/static/c3409fec3f08d25b6015bba1eebcf628/772e8/20231209122201.png 200w,\n/static/c3409fec3f08d25b6015bba1eebcf628/c8042/20231209122201.png 220w\"\n        sizes=\"(max-width: 220px) 100vw, 220px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n전가산기를 연결해서 여러 비트를 더하는 가산기를 만들 수 있다.</p>\n</li>\n<li>\n<p>리플 자리올림 가산기: 자리 올림이 아래쪽 비트부터 바로 위쪽 비트로 물결처럼 퍼져나감. 비트를 하나 처리할 때마다 게이트 2개에 해당하는 출력 시간 지연이 발생</p>\n</li>\n<li>\n<p>올림 예측 가산기: AND, OR개수를 늘려서 전파 지연을 줄이지만, 전력 소모가 더 커짐</p>\n</li>\n</ul>\n<h3>디코더</h3>\n<p>인코딩된 수를 개별 집합으로 만들어줌.\nex) 3:8디코더\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 91.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRElEQVR42p2S2VKDQBRE+f8PJEBVUPZNwiqLQPQ4kwACsaL9wkDdnl64yucK0zS9H6Gu677vGbjeIecV+ZDvDJmmmWVZkiRvd6RpGsexbdvz2Axl/QKZ0c0Q56qqVFV9ETifz1EU/UbG/3WFtm19319/v5GHYagFmqbBnuM4e+U8z0+n06sAuRZlOOSB43meYRi42mejrSAIOIzjOAk8mxmUZanruieAjJz5JjM3X8YQ9R4q4xbz/IjL5YLG35RJ5Au4rgt/yWxZFrH5ijeG9mTaxjDVfghwuJHpoBHoug7PYRjuyfxnTdNcAWRktGdts6Gsxz8zYxtyURSSv5DpuRcgCbfubXN+WJi0xOoQhjV6VBgcBOiFM50d25ZlbHYbw1waCrBqOF+WZN51OscCGx79BLL8TjrHPxcxdqAsNQ+xCSLJX03lDzZvLkUdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209122740\"\n        title=\"\"\n        src=\"/static/35609cd9f8458c2192231bcbf3cd2d05/5a190/20231209122740.png\"\n        srcset=\"/static/35609cd9f8458c2192231bcbf3cd2d05/772e8/20231209122740.png 200w,\n/static/35609cd9f8458c2192231bcbf3cd2d05/e17e5/20231209122740.png 400w,\n/static/35609cd9f8458c2192231bcbf3cd2d05/5a190/20231209122740.png 800w,\n/static/35609cd9f8458c2192231bcbf3cd2d05/0a867/20231209122740.png 986w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n8진 숫자를 단일 비트의 집합으로 되돌려줌.</p>\n<h3>디멀티플렉서(디먹스)</h3>\n<p>입력을 몇 가지 출력 중 한 곳으로 전달\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 340px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXUlEQVR42p2U2W6CQBSGef+XqrS9sCZe6AUJCaFaUMCNHRcQ+8WTTLA2DO1cTOQ4/3L+M2DcHlfbtrfBy3jG8Pt0OiVJst/vB4EFcz6f0zTd7XbsTdMAZteAr9crpzkax3FVVbBQyfOcyuVy0YBxyFEAqgrm676g04APh0Nd1+JcNQ8X/ruMv4Oh/2GPxzAMgyCAtw+MZhRFy+XyeDyq2MkJRpSJsA+MiO/7tNcVF//I6tNGRPUsVQShgxTxv/UsFGVZbrdbfWByGYqiYGYCBkMEg+aMCOKr1cpxHB6xytjx7Hmefs7qkvmez+66Lhj0B9mWE2SGVcEwYVpghLTTPq7uXTKe+YgaOv6WEfQpw41UlmW8EvJikFywXtM5KWBBihzYbDbML7+vKAxhN2hyPB7bts19nM/n5LT4XJgvo9lsZpqj6XRqWRYsBEHl/fUNPEFOPiYMwvjHB0TZ/gZBhVNrh5ce5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209123006\"\n        title=\"\"\n        src=\"/static/fc9638c091ab15d0c2b9b4036cbd00b5/9f933/20231209123006.png\"\n        srcset=\"/static/fc9638c091ab15d0c2b9b4036cbd00b5/772e8/20231209123006.png 200w,\n/static/fc9638c091ab15d0c2b9b4036cbd00b5/9f933/20231209123006.png 340w\"\n        sizes=\"(max-width: 340px) 100vw, 340px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n입력 신호인 D를 디코더 입력 S0, S1에 따라 네 가지 출력 중 하나로 전달한다.</p>\n<h3>실렉터(멀티플렉서, 먹스)</h3>\n<p>여러 입력 중 한가지를 선택함.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 483px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVR42pWUCW+CQBCF/f9/zCvRKmIjVJRDQUHwAM8g/ewoIVqhnYRkF/bNvHnzllqWZVEUWZa1Wq0Oh0P2iOsjsvdR4/F9/3w+J0myXC7n83kYhnmWCnCapq7rgj+dTuzZ7na7xWLBSxiRtAzM0dFoVK/Xp9NpsRRZ1uu14zgsymgHQQDP/X7/2u1sNispfgfT7fF4LH4QMOTLwHEca5rWaDQ8z3tSCAlt275cLhVqQ7t4SFKYptnv95niu7ZvYCbMeJ7oCZ7JPbXzC+1ms4mwOSYXrKJnoc3AyPJvwYQ2fpCepT10ErbQrla73W5TBMHFZ5PJBDpkZM4lDr3TxkwMRtd1TtPCeDymJovqi4FJkp8Ag0nhgmeki2owZSm43W6hLR2mj7i+jzs4Dzmd/Tlq3Ad1MIBt4PtU/tJ1+Tewxl4Iic+wEHKyxcVcQba9Xg9f3K7kR7eraxpgx7Y/h0P04wOCt1otRVEMw2BLOobS6XQQdbPZqKpqmuY3i19Iy94dbG8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20231209123232\"\n        title=\"\"\n        src=\"/static/0c8fb0b53ce86dc86410dfbf4939a5bf/77a9e/20231209123232.png\"\n        srcset=\"/static/0c8fb0b53ce86dc86410dfbf4939a5bf/772e8/20231209123232.png 200w,\n/static/0c8fb0b53ce86dc86410dfbf4939a5bf/e17e5/20231209123232.png 400w,\n/static/0c8fb0b53ce86dc86410dfbf4939a5bf/77a9e/20231209123232.png 483w\"\n        sizes=\"(max-width: 483px) 100vw, 483px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Project","subCategory":"cs"}],"date":"2023-12-01","slug":"/blog/cs/combination","title":"전자 회로의 조합 논리"}}},{"node":{"html":"<h1>문제</h1>\n<p><img src=\"../_resources/%EB%8B%A4%EC%9A%B4%EB%A1%9C%EB%93%9C-1.png\" alt=\"다운로드.png\"></p>\n<h1>풀이</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include &lt;iostream&gt;\n#define MAX 987654321\n\nusing namespace std;\n\nint connected[10][5] = {\n    {0, 1, 2, -1, -1},\n    {3, 7, 9, 11, -1},\n    {4, 10, 14, 15, -1},\n    {0, 4, 5, 6, 7},\n    {6, 7, 8, 10, 12},\n    {0, 2, 14, 15, -1},\n    {3, 14, 15, -1, -1},\n    {4, 5, 7, 14, 15},\n    {1, 2, 3, 4, 5},\n    {3, 4, 5, 9, 13}\n};\n\nbool isDone(int* clocks) {\n    for (int i = 0; i &lt; 16; i++) {\n        if (clocks[i] != 12) return false;\n    }\n    return true;\n}\n\nint countCnt(int* runCnt) {\n    int sum = 0;\n    for (int i = 0; i &lt; 16; i++) {\n        sum += runCnt[i];\n    }\n    return sum;\n}\n\nvoid turn(int* clocks, int connectNum, int dir) {\n    for (int i = 0; i &lt; 5; i++) {\n        int clockNum = connected[connectNum][i];\n        if (clockNum != -1) {\n            clocks[clockNum] = (clocks[clockNum] + (3 * dir));\n            if (clocks[clockNum] == 15) clocks[clockNum] = 3;\n            else if (clocks[clockNum] == 0) clocks[clockNum] = 12;\n        }\n    }\n}\n\nint runrun(int swtch) {\n    if (swtch == 10)\n    {\n        return isDone(clocks) ? 0 : MAX;\n    }\n\n    int result = MAX;\n\n    for (int i = 0; i &lt; 4; i++) {\n        result = min(result, i + runrun(swtch + 1));\n        turn(clocks, swtch, 1);\n    }\n    /*for (int i = 0; i &lt; 10; i++) {\n        if (runCnt[i] &lt; 3) {\n            runCnt[i]++;\n            turn(clocks, i, 1);\n            result = min(runrun(runCnt), result);\n\n            turn(clocks, i, -1);\n            runCnt[i]--;\n        }\n    }*/\n\n    return result;\n}\n\nint main(void)\n{\n    int x;\n    int runCnt[16] = { 0, };\n\t\tint clocks[16];\n\n    for (int i = 0; i &lt; 16; i++) {\n        cin &gt;&gt; x;\n        clocks[i] = x;\n    }\n\n    int result = runrun(0);\n    if (result == MAX) cout &lt;&lt; -1;\n    else cout &lt;&lt; result;\n\n    return 0;\n}\n</code></pre></div>\n<h1>복기</h1>\n<p>처음에 재귀 호출을</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">for (int i = 0; i &lt; 10; i++) {\n\tif (runCnt[i] &lt; 3) {\n\t\trunCnt[i]++;\n\t\tturn(clocks, i, 1);\n\t\tresult = min(runrun(runCnt), result);\n\n\t\tturn(clocks, i, -1);\n\t\trunCnt[i]--;\n\t}\n}</code></pre></div>\n<p>이렇게 짰었는데, 중복이 생기면서 무한으로 실행된다는걸 알았다.</p>\n<h2>수정할 점</h2>\n<ul>\n<li>네이밍</li>\n<li>재귀함수 작성</li>\n</ul>\n<h1>알아두면 좋은 것</h1>\n<p>완전 탐색에 자주나오는 유형이 있다.</p>\n<h2>모든 순열 만들기</h2>\n<p>가능한 순열의 수: N!\nN이 10을 넘어간다면 시간안에 해결 어려우므로 다른 방법 생각\nC++ 에서는 STL에 next_permutation() 함수가 자동으로 계산해줌</p>\n<h2>모든 조합 만들기</h2>\n<p>nCr = n-1Cr + n-1Cr-1</p>\n<h2>2^n가지 경우의 수 만들기</h2>\n<p>ex) n개의 질문의 답이 예/아니오 인 경우 답의 모든 조합의 수\n각 조합을 하나의 n비트 정수로 표현하면 반복문 하나로 모든 조합 간단하게 시도할 수 있다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-11-29","slug":"/blog/algorithm/clock","title":"[분할정복] 시계 맞추기"}}},{"node":{"html":"<h1>문제</h1>\n<p>정수 수열 S의 부분 수열이란 S에서 0개 이상의 숫자를 지우고 남은 수열을 말합니다. 이때 남은 숫자들이 순 증가 하면 이를 증가 부분 수열이라 합니다. 주어진 수열에서 얻을 수 있는 증가 부분 수열 중 가장 긴 수열의 길이를 찾아봅시다.\n이를 최대 증가 부분 수열 (LIS, Longest Increasing Subsequence)라고 합니다.</p>\n<h1>풀이</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include&lt;iostream&gt;\n\nusing namespace std;\n\nint n;\nint box[101] = { 0, };\nint dp[101] = {0, };\n\nint solve(int idx) {\n\tint&amp; ret = dp[idx];\n\tif (ret != -1)\n\t\treturn ret;\n\n\tret = 1;\n\n\tif (idx == n) return ret;\n\n\tfor (int i = idx + 1; i &lt; n; i++) {\n\t\tif(box[i] &gt; box[idx])\n\t\t\tret = max(ret, 1 + solve(i));\n\t}\n\treturn ret;\n}\n\nint main(void) {\n\tcin &gt;&gt; n;\n\tmemset(dp, -1, sizeof(dp));\n\n\tfor (int i = 0; i &lt; n; i++) {\n\t\tcin &gt;&gt; box[i];\n\t}\n\n\tint result = 0;\n\tfor (int i = 0; i &lt; n; i++) {\n\t\tresult = max(result, solve(i));\n\t}\n\n\tcout &lt;&lt; result;\n\n\treturn 0;\n}</code></pre></div>\n<h1>개념</h1>\n<h2>최적 부분 구조</h2>\n<p>현재까지 어떤 경로로 이 부분 문제에 도달했건 남은 부분 문제를 항상 최적으로 풀어도 답을 구할 수 있는 문제를 최적 부분 구조라고 합니다.</p>\n<h1>복기</h1>\n<ul>\n<li>증가하는 부분 수열을 만들려면 수 하나를 선택하고, 뒤의 수 중 더 큰 수를 골라서 그 수에서 시작하는 증가 부분 수열을 다시 만드는 걸 반복하면 됩니다.</li>\n<li>직전에 고른 수보다 큰 수를 고르는 조건만 추가하면, 그 수에서 시작하는 가장 긴 증가 부분 수열을 구하는걸 반복해서 답을 구할 수 있습니다.</li>\n<li>그래서 solve()함수가 주어진 idx에 대해 거기서 시작하는 최대 증가 부분 수열의 길이를 반환하도록 작성했습니다.</li>\n<li>처음에는 solve(0)만을 호출하면 문제가 해결될 줄 알았는데, 이렇게 하면 0번 인덱스에서 시작하는 답만 구하게 돼서, 반복문으로 모든 수에서 시작하는 경우를 고려해야 합니다.</li>\n</ul>\n<h1>시간복잡도</h1>\n<p>각 경우에 n번 반복에서 n번 재귀 호출을 실행하므로 시간복잡도는 O(n^2)이 됩니다.</p>\n<h1>추가</h1>\n<p>이분탐색을 활용해 O(nlogn)의 시간복잡도로 문제를 해결할 수 있다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-11-27","slug":"/blog/algorithm/lis","title":"[동적계획] LIS"}}},{"node":{"html":"<h1>문제</h1>\n<p><img src=\"../_resources/32ad52f56402638ed6732855f8efdcfb.png\" alt=\"32ad52f56402638ed6732855f8efdcfb.png\"></p>\n<h1>풀이</h1>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include&lt;iostream&gt;\n\nusing namespace std;\nint wood[20001];\n\n//start~end 판자로 만들 수 있는 최대 울타리 크기\nint divide(int start, int end) {\n\tif (start == end) return wood[start];\n\n\tint mid = (start + end) / 2;\n\n\tint leftMax = divide(start, mid);\n\tint rightMax = divide(mid + 1, end);\n\tint ret = max(leftMax, rightMax);\n\n\tint lo = mid; int hi = mid + 1;\n\tint height = min(wood[lo], wood[hi]);\n\n\tret = max(ret, 2 * (height));\n\n\twhile (lo &gt; start || hi &lt; end) {\n\t\tif (hi &lt; end &amp;&amp; (wood[lo - 1] &lt; wood[hi + 1] || lo == start)) {\n\t\t\thi++;\n\t\t\theight = min(height, wood[hi]);\n\t\t}\n\t\telse {\n\t\t\tlo--;\n\t\t\theight = min(height, wood[lo]);\n\t\t}\n\t\tret = max(ret, (hi - lo + 1) * height);\n\t}\n\n\treturn ret;\n}\n\nint main(void) {\n\tint N;\n\n\tcin &gt;&gt; N;\n\n\tfor (int i = 0; i &lt; N; i++) {\n\t\tcin &gt;&gt; wood[i];\n\t}\n\n\tcout &lt;&lt; divide(0, N - 1);\n\n\treturn 0;\n}</code></pre></div>\n<h1>아이디어</h1>\n<p>무식한 풀이로 가능한 모든 경우의 수를 계산해보면, (r - l + 1) * min(h[i])에 대해 가능한 r과 l을 2중 for문으로 돌아봐야하므로 시간복잡도가 O(n^2)이 되고, 최대 입력이 20000개 이므로 해결이 어렵다.\n따라서 분할 정복을 사용해 왼쪽 구간, 오른쪽 구간, 겹치는 구간을 계산해 최대값을 구하면 더 빠른 시간에 풀 수 있다.</p>\n<h1>복기</h1>\n<p>재귀를 통해 반으로 나누고 함수가 그 구간에서의 최대값을 반환하도록 하면, 재귀 호출의 결과로 왼쪽 구간 최대값, 오른쪽 구간 최대값을 얻을 수 있다.\n그리고 함수를 합치는 과정에서 중간에 있는 값을 구하면 된다. 함수를 합치는 과정을 무식하게 푸려다가 실패했는데, 책에서는 mid값과 mid + 1값에서 시작하여 좌우로 높이가 높은 사각형을 선택하며 범위를 넓히는 식으로 탐색했다.</p>\n<h1>시간복잡도</h1>\n<p>재귀 호출 외에 하는 일은 두 부분에 걸쳐있는 사각형을 찾는 작업이고, 이는 O(N)이다.\n문제를 항상 절반으로 나눠서 해결하므로 재귀 호출하는 부분은 O(logN)이 걸리고, 재귀호출마다 사각형을 찾으므로 결과적으로 시간복잡도는 O(NlogN)이 된다.</p>","frontmatter":{"thumbnail":"default.jpg","categories":[{"mainCategory":"Area","subCategory":"algorithm"}],"date":"2023-11-27","slug":"/blog/algorithm/fence","title":"[분할정복] 울타리 잘라내기"}}},{"node":{"html":"<h1>VPC</h1>\n<h2>JOB-TO-BE-DONE</h2>\n<h3>trainers</h3>\n<ul>\n<li>Create personal plans for customers, tailored for their preferences and capabilities</li>\n<li>Save times</li>\n<li>Avoid frustration and repetition</li>\n</ul>\n<h3>gmygoers</h3>\n<ul>\n<li>Feel accomplished</li>\n<li>Have instant help available</li>\n<li>Have a regular and personal workout plan</li>\n<li>Have a flexible workout schedule</li>\n<li>Be organized</li>\n<li>Blow off steam/relieve stress</li>\n<li>Gain strength, self confidence</li>\n<li>Broaden social connections</li>\n<li>Track one's progress</li>\n</ul>\n<h2>GAINS</h2>\n<h3>trainers</h3>\n<ul>\n<li>More free time for one on one advice and meetings</li>\n<li>More flexible avaiability to accept new customers</li>\n<li>More new customer leads to increase in income</li>\n<li>Less frustration due to less repetition</li>\n</ul>\n<h3>gymgoers</h3>\n<ul>\n<li>Confidence and Guided experience</li>\n<li>Efficient use of time</li>\n<li>Sustained motivation to continue and improve</li>\n<li>Consistent progression</li>\n<li>Goal achievement</li>\n</ul>\n<h2>PAINS</h2>\n<h3>trainers</h3>\n<ul>\n<li>Time management</li>\n<li>Overwhelmed by plan creation and updates</li>\n<li>Managing diverse client needs</li>\n</ul>\n<h3>gymgoers</h3>\n<ul>\n<li>Plateus and lack of progress</li>\n<li>Lack of knowledge and guidance</li>\n<li>Uncertainiy about progression and adjustment</li>\n<li>Uncomfortable in a gym environment due to lack of certainty</li>\n<li>Social comfort: not feeling certain on specific performance or goals</li>\n</ul>\n<h2>PRODUCTS&#x26;SERVICES</h2>\n<h3>trainers</h3>\n<ul>\n<li>Client management dashboards</li>\n<li>AI-Driven plan creation</li>\n<li>Data driven plan updates</li>\n</ul>\n<h3>gymgoers</h3>\n<ul>\n<li>Personalised workout plans</li>\n<li>Support on the fitness journey</li>\n<li>Interactive training log, progression tracker</li>\n</ul>\n<h2>GAIN CREATORS</h2>\n<h3>trainers</h3>\n<ul>\n<li>Automated plan updates for customers</li>\n<li>AI's help to expand knowledge in the field</li>\n<li>Motivation due to organisation and accurate planning</li>\n</ul>\n<h3>gymgoers</h3>\n<ul>\n<li>Real-time adjustments, based on user feedback</li>\n<li>Motivation due to organisation and accurate planning</li>\n<li>Continuous adaptive algorithms for personalisation</li>\n<li>Instant feedback and support</li>\n<li>Boost confidence in knowledge and general understanding of the sport</li>\n</ul>\n<h2>PAIN RELIEVERS</h2>\n<h3>trainers</h3>\n<ul>\n<li>Time efficienct and enhanced services</li>\n<li>Customer satisfaction and increased income</li>\n</ul>\n<h3>gymgoers</h3>\n<ul>\n<li>Achievements and visible results</li>\n<li>Dynamic progress breakthroughts</li>\n<li>Guided journey with milestone tracking</li>\n</ul>\n<h1>Interview</h1>\n<h1>Survey</h1>\n<h1>BMC</h1>\n<h2>Key partners</h2>\n<ul>\n<li>App stores</li>\n<li>Coaches</li>\n<li>Server Host</li>\n<li>Investors</li>\n<li>Payment processors</li>\n<li>Fitness influencers/bloggers</li>\n<li>Gyms</li>\n<li>Health and wellness organizations</li>\n</ul>\n<h2>Key Activities</h2>\n<ul>\n<li>platform dev &#x26; maintenace</li>\n<li>Marketing &#x26; Ads</li>\n<li>Hiring programmers</li>\n<li>Hiring Coaches</li>\n<li>Constant development and improvement of the AI algorithms</li>\n<li>Regular Updates based on users feedback</li>\n</ul>\n<h2>Key resources</h2>\n<ul>\n<li>Fitness experts for content and guidance</li>\n<li>Server</li>\n<li>Tech platform</li>\n<li>Talented Employees, especially developers</li>\n<li>AI-System</li>\n</ul>\n<h2>Value Proposition</h2>\n<ul>\n<li>AI-driven personalized training plans</li>\n<li>Real-time adjustments</li>\n<li>guided fitness journey with milestones</li>\n<li>Client management dashboards for coaches</li>\n<li>Time efficiency and enhanced services</li>\n</ul>\n<h2>Customer Relationship</h2>\n<ul>\n<li>Customer feedback</li>\n<li>Interactive training logs and progression trackers</li>\n</ul>\n<h2>Channels</h2>\n<ul>\n<li>App</li>\n<li>Website</li>\n<li>Community</li>\n<li>App store</li>\n</ul>\n<h2>Customer Segments</h2>\n<ul>\n<li>Gym-Goers that dont see desired results</li>\n<li>Individuals that want to go to the gym but lack knowledge</li>\n<li>Coaches that focus on personal clients</li>\n</ul>\n<h2>Cost Structure</h2>\n<ul>\n<li>Maintenance costs</li>\n<li>Marketing &#x26; ads</li>\n<li>Development cost</li>\n<li>Employee cost</li>\n<li>legal fees/licensing</li>\n</ul>\n<h2>Revenue Streams</h2>\n<ul>\n<li>Subscription model/freemium model with free basic features and paid premium ones</li>\n<li>Single custom plan sells</li>\n<li>Monthly or Yearly subscription</li>\n</ul>\n<h1>Mission &#x26; Vision</h1>\n<h1>Customer Segment</h1>\n<p><img src=\"../_resources/da1652bac84bb505068777393f7b4630.png\" alt=\"da1652bac84bb505068777393f7b4630.png\"></p>\n<p><img src=\"../_resources/b807e8183e461f74a92c1dc80c8fafa6.png\" alt=\"b807e8183e461f74a92c1dc80c8fafa6.png\"></p>\n<h1>Meso analysis(Porter 5 forces)</h1>\n<h1>Macro analysis(DESTEP)</h1>\n<h1>Competitor analysis</h1>\n<h1>MVP</h1>\n<h2>MoSCoW</h2>\n<ul>\n<li>Must have</li>\n<li>Should have</li>\n<li>Could have</li>\n<li>World have</li>\n</ul>\n<h2>vision to MVP</h2>","frontmatter":{"thumbnail":"bookreport.jpg","categories":[{"mainCategory":"Project","subCategory":"exchange"}],"date":"2023-11-25","slug":"/blog/becoming02","title":"Our Becoming the next successful online startup"}}},{"node":{"html":"<h1>BMC</h1>\n<p>BMC란 Business Model Canvas의 약자로, Business Model을 체계적으로 시각화하고 구체화하기 위해 사용하는 도구입니다. 9가지 Part로 나뉘어 있습니다.</p>\n<ul>\n<li>Customer Segments: 제품이나 서비스를 제공할 주요 고객 집단입니다.</li>\n<li>Value Propositions: 제품이나 서비스가 고객에게 제공하는 가치를 정의합니다.</li>\n<li>Channels: 고객과 커뮤니케이션 할 방법을 다룹니다.</li>\n<li>Customer Relationships: 고객과의 관계 구축 및 유지 방법을 정의합니다.</li>\n<li>Revenue Streams: Business가 수익을 창출하는 방법을 다룹니다.</li>\n<li>Key Resources: 비즈니스 모델을 운영하고 가치 제안을 하기 위한 주요 자원을 다룹니다.</li>\n<li>Key Activities: 가치를 전달하고 Business를 운영하는 데 필요한 주요 활동을 다룹니다.</li>\n<li>Key Partnerships: 비즈니스 운영에 필요한 외부 파트너 및 공급망을 정의합니다.</li>\n<li>Cost Structure: 비즈니스 운영에 드는 주요 비용을 분석합니다.</li>\n</ul>\n<h2>Our BMC</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXUlEQVR42m1Q7XKCQBDz/R+m/dPpU3S0pXZUBMGvEw+QYtUioOlmAcfp+GPh7pJNstsbvVZwns9wngqMXi4wwxKb6QHLrxzJTM7uUc/r8QHWOyNyT/J2QuyXiKa/2EpZrxBuhe8F0MujCtswxybIcEqBbFEjHO4QOKkSrF/A7UfwBhapNK3HP/DfLXbhRQV5ptlNMJnVMPLg9a24FdJUYzXaI/zcaRKmikU0DSoRqfVtLXgs6WP/rAmZltO0gkKcX5RMV979jwTuIGqa1PmKfIkmlQhyBQ23xH4Fxe8ES2QiyIZuRNPuiyZ0J8ZKgyYh02bzqybkPyVPdHIVFHA+zODJLqwQCNCdzSRy/MmbwcxJ2sQynvTwzx12Z/JvIxtZNJ0Jcj90ZZHAEQMRM5OjNpnJQf/EOV2XnlwVJNg5JH6lKWnSFe9MyuJdE7ZYl+q+evx0Lo+qWXpTj/D/gn9QVKKocA/KegAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102155912\"\n        title=\"\"\n        src=\"/static/37f3a8c4720ba6b83ad7960bd6e49a9f/5a190/20241102155912.png\"\n        srcset=\"/static/37f3a8c4720ba6b83ad7960bd6e49a9f/772e8/20241102155912.png 200w,\n/static/37f3a8c4720ba6b83ad7960bd6e49a9f/e17e5/20241102155912.png 400w,\n/static/37f3a8c4720ba6b83ad7960bd6e49a9f/5a190/20241102155912.png 800w,\n/static/37f3a8c4720ba6b83ad7960bd6e49a9f/c1b63/20241102155912.png 1200w,\n/static/37f3a8c4720ba6b83ad7960bd6e49a9f/ea964/20241102155912.png 1312w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>Mission &#x26; Vision</h1>\n<p>Team의 Mission과 Vision을 정의하고, 사용할 이름을 BrainStorming했습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABmklEQVR42iWRy2sTURSH51/UYMxjIbhQjCL0IS7sVigFly6kiGBLWxC16EaSJjU+YittajJpMmNmkhjzqjZNZjKTsXnM50m7+ODAufd3vnuPYusr2Noybn0N3DzYWRgcMbILON0f/OvPyOEJs9qz8kyHJhMrKxzCsCjoclfDd45RrKMYfuUhvjHPVI8x/RkD4z4D4wnd7B3GWoxRSdDuMS7dxis/kmF5/hafYmaW6BnP8Vqv4fQd/dwDlF/JKzQ/RWikw9Q/Ruh8jeJrt3CMZaq7Ueq7oUuk10wHGZYWGA1U3EYC43CVSnYVq7oOZ9sMiksoRjyAuRPBTEYwEiH0D0F6BzdxzRW0eJRqKnzRN2ZnEkH66gITp4BVi9MpvZCg97SOX14Enzc3xTB1ld9iV0tdp/U5TPtLmLPvN7DLj6kkr4l9gO5+iNO9EN1MAFuVpzsqvcoODfWZBL7Brq2L5Rr+ny0UJ3cXtzCPo84x0heZlBfxBU+mOc1X8j8bnHe2Lmlv4LbfiqHOuHfA8CQtS/wmS9wDZ1/qDP8BkoCRkSB5J9AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102160002\"\n        title=\"\"\n        src=\"/static/f82d8d12e42570da0fea352783e59a77/5a190/20241102160002.png\"\n        srcset=\"/static/f82d8d12e42570da0fea352783e59a77/772e8/20241102160002.png 200w,\n/static/f82d8d12e42570da0fea352783e59a77/e17e5/20241102160002.png 400w,\n/static/f82d8d12e42570da0fea352783e59a77/5a190/20241102160002.png 800w,\n/static/f82d8d12e42570da0fea352783e59a77/c1b63/20241102160002.png 1200w,\n/static/f82d8d12e42570da0fea352783e59a77/29007/20241102160002.png 1600w,\n/static/f82d8d12e42570da0fea352783e59a77/39e47/20241102160002.png 1735w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>Customer Segmentation</h1>\n<p>Customer Segmentation의 목표는 목표 고객을 더 명확히 이해하고, 알맞은 제품, 서비스, 마케팅 전략을 제공하기 위해 고객을 특정 기준에 따라 여러 그룹으로 나누는 것입니다.</p>\n<ol>\n<li>Gym Goers<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAADQ0lEQVR42kVTC1MTVxjdv2+1NYJQighSpCqmtjM6AwYS5FEQFLQJgpDnLpvsJvt+57Gb07PX1u7MmXv3ft893/m+syv9/MzG6gsLK8TduT5mlgws/Gpi8amJpXULS79ZmH9iiPfFNRO/rJnf94XFAX54qOPefB93ZnU8WDEgrfDCq6KF58+ZUNDw5x8OTo4iHO4HAgd7Ad68dlDe9rFT8rh6jIc4+xBjY8PB/fs6HpK0UNAx/4iE60UHGy9MEhpYW9MxM6vix59u8fixjt2Kj0rZF+sOibY2Xezv+Vhepqp7MuZnrzHzoMk7OubmVCytDiA9+91iokFo2NxUUXzZwcpyHS+57u3qeFfRUNpS8ZYobXWxW+5RQBurT75iffkYT1dPUCw2sFDYx8JiFVL5wEWWZsiyKdI0RyZgOSGuWxpaigHPHyJJJlA1C6puYzxOEURDfLlR0LrtQ9FMXF7KeLOpQ3p/5pNgjDgZ4r9nQsK+4ZDAQFc3SRgjjiOYtg3bcTAcJnB5lsdVkik9A8PRGMenEaSTM48VR7C8ANPpVGAySdFlUrOloN3pwrJ9nk3geZ5Avg+jEXQWE+hbLDjG+9MQ0v5fFklSuEFEZek3hZMMPVZuNBVBOqBa1/WgKApkWcZgMEAyTElki7imWxzJGB/PqfDw+H/CvO1smolZ5go7chey0oNp5arG0DQNvV6PLQ8RUZFyqwtCWe5R4Qif/445w1OHhrAdEjp+IAxh1+hyPjf1NlXKcL2QMxqh2+1CVVWqSUTLN/UOqrUr1BsdBGGMi4sE0sczR1Qf2B7hIuHFLANV+YKw3pDhuCGCIBDqclLTNEkwQqt9iwbjObHj+Li+GkH69MkVCm2aYns+Z/ON0PMTtqSJgY/GmTDLsizYtiXmHLHFfLZ5uz0aEydU/HUIqVb1mZzBo2Q/iv91GiIpd7jVVsUMozjmniNoNKjGQZgrZPw676KZdxGg3ZxAuqqG4JfNColAmk6Q0WXXCdDvm+jrBgI/ZEoKg+7qNGbCzyyhKZbpirhpOhjRZblOwg/8yavnJo6OOqhULlHaruJtqYrt7Rp2di4EStznZ/n6fV9ivPwFhwdNfD4f4KYW47KW4h86Wzd5t0taZgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102162959\"\n        title=\"\"\n        src=\"/static/b041554f835591593bcf093e0e912668/5a190/20241102162959.png\"\n        srcset=\"/static/b041554f835591593bcf093e0e912668/772e8/20241102162959.png 200w,\n/static/b041554f835591593bcf093e0e912668/e17e5/20241102162959.png 400w,\n/static/b041554f835591593bcf093e0e912668/5a190/20241102162959.png 800w,\n/static/b041554f835591593bcf093e0e912668/e2e58/20241102162959.png 1069w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>Trainers <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAADSElEQVR42lVSa08bVxDd/69KTfuBhEKrthAc0lSkMZCAY2zHLx4FOySKMRjvy7v2et8v79N7OnvTVOqVRjuanXvuOWeGe3HqovLGxotDG9v7Bn78ZYmnOzqePdfx055BQfmu/l9t87mBrYqBp1T7blNj/SdtD0cNF9WWB+5N3cFJzUKtYeP9mYvdlxralzZa5xY69O38beGkYaBa01mtdWHh8qOD3rWNjW0Vv1c0HByaqB6bOKrb4N71XNR7Og7rOqodHhs7Ir7flLBdmaFxbqLWM3BGQGd9C29bBhoE+NsrFU+2RPzws4g/jzWctkzU2xaaVy64100V++c11G9uUen8hZ23V9j4dYzdgwmaFwqBzXDakQhMwHFTRK0rYe/1BJu7d9jaG+PgnYiLAT3Y1XHcNsF9GJpo3LQhaDImMx6GayOOc8yXHvqDRwxHM8oDzBYOHkQN9/wcmuHC9lYQVAPSwsJMs2E7IQb35OHF2EccxdQQwA8jxEmKogBUzcJoIhKAAtP2saai5/twPRfr9RrBKoU8N/AoKJAIOIpSfOIJcCj4CMIQS8thEcUJXSiQpgXCMMGKLpZ5UZS1FEmSoDwRqUiSAr4fI6b/eV7gdmqBG0jEMI6gE5jpeHD9AFm2RrjKYJgedNNll/M8J/AVgiBATgxXUUZEUix1B9qytCnDF9khhrJHF2I4BPTtMMAwgyAq4ElSnJDEIMR0OoXjOKwnIPaCqOL+gYfjRUiTHHcqAV5LNtb0epJm7OXSnyz/ylA3HAqX8pTJVRQFrvvVw5LhlJ/h8+cxY0gQGCkkuSvqjKHl+oyl6ZaMU2L4rxzdpmFEZHqMxWIBQRAYaGmDSkMZ3U0wmcpM8u1MB9dXliQxpQmvWCTEpDTYJRmiNIckL5i8kAYnSRJjGUURUzCnlbl/EKAuDGQ0mCtJAXe11FmzbrksPAItp+wTwxJQEOdMcpZlME2TgZbyo3jNhjYaP5IKh2wDBnMV3I2jkSQPFk04pZUom0vAcrnN0kPyJ6G8IN9iYqbIMrFJaVA5PFruxwlZQEtdkKqhQQxPLQl9i8cZ/wXV4SVe9dt42W1iv9PEH70PLMr8W+1/ebdF/R0cfbpGQx7hvc7jH13oQZHIKtxYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102163020\"\n        title=\"\"\n        src=\"/static/578ab1d169e9ffc1dabd09c1e765d323/5a190/20241102163020.png\"\n        srcset=\"/static/578ab1d169e9ffc1dabd09c1e765d323/772e8/20241102163020.png 200w,\n/static/578ab1d169e9ffc1dabd09c1e765d323/e17e5/20241102163020.png 400w,\n/static/578ab1d169e9ffc1dabd09c1e765d323/5a190/20241102163020.png 800w,\n/static/578ab1d169e9ffc1dabd09c1e765d323/d5bfb/20241102163020.png 1072w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ol>\n<h1>Porter's 5 forces</h1>\n<p>Porter's 5 forces는 우리가 제공하는 서비스의 산업에서의 경쟁 강도를 평가하기 위해 작성합니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABi0lEQVR42nWRTW+bQBCG+f//o4eqF1dqDz1FzoeVNopbtQF7d2HBYJtgB/B3bCfh6WBqpU2aw6OB0cy878w6H0zFO1XxXld0p+AV4Ao3RUXPC+h1rvDaZ/ROL3DPv+GqCLdsav6HkyxhtGqw8wp/Dv5MWMCgrwnabRl4Tk/QJycE2j7XzF/j9EVNCXXsS0JLoZZo6ihiegtJsScu94dvI0LmWPeCusdR+V7UKsJywyi9xi7EpQzwiweUNJbKsuq0ub88YxoMDyJmsibId1gZYKU3EOp4cBimt6TJVwbhKbfBR+Kowzjpoiabg+r68oLxpxbZ5xbL7nWzRbok/nEjeCQ/a3ok339howzH5FtMsaV2qoonYYef30tOHMp6hdun+tKivOqQBcnBtRE3+u5B2D8z3WGylaw8a27yN/pPTq3qO1aMhgUDKVZr+V80t3rZc8SpH8TM/qV+lGCyZSw3i2UNP5piwwmxTYmGObp8fNVzxNFvDcw2ZDoisWOsqwg9w0DHxMM7TPn05sDfvZ2bBE9tPawAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102163423\"\n        title=\"\"\n        src=\"/static/7c6ab2fbb6ab944c737934ab3feb4c76/5a190/20241102163423.png\"\n        srcset=\"/static/7c6ab2fbb6ab944c737934ab3feb4c76/772e8/20241102163423.png 200w,\n/static/7c6ab2fbb6ab944c737934ab3feb4c76/e17e5/20241102163423.png 400w,\n/static/7c6ab2fbb6ab944c737934ab3feb4c76/5a190/20241102163423.png 800w,\n/static/7c6ab2fbb6ab944c737934ab3feb4c76/c1b63/20241102163423.png 1200w,\n/static/7c6ab2fbb6ab944c737934ab3feb4c76/7e881/20241102163423.png 1521w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\nPorter's 5 forces 분석 결과, 신규 경쟁자의 진입이 너무 쉽고, 대체 당하기 쉽다는 결론을 얻었습니다.\n기존에는 Gym Goers와 Trainers 모두를 Target으로 했는데, 이 시점부터는 Gym Goers에게만 집중하기로 하였습니다.</p>\n<h1>DESTEP</h1>","frontmatter":{"thumbnail":"bookreport.jpg","categories":[{"mainCategory":"Project","subCategory":"exchange"}],"date":"2023-11-20","slug":"/exchange/foursix","title":"Becoming the next successful online startup"}}},{"node":{"html":"<h1>About Mollaskular</h1>\n<h1>VPC</h1>\n<p>VPC란 Value Proposition Canvas의 약자로, 고객이 필요로 하는 가치를 중심으로 제품/서비스를 설계하는 데 도움이 되는 framework 입니다.</p>\n<p>다음과 같은 항목들이 포함됩니다.</p>\n<h2>value proposition</h2>\n<ul>\n<li>Products &#x26; services: this is a list of all the Products and Services a value proposition is built around</li>\n<li>Gain creators: describe how your products and services create customer gains.</li>\n<li>Pain relievers: describe how your products and services alleviate customer pains.</li>\n</ul>\n<h2>Customer Profile</h2>\n<ul>\n<li>Customer jobs: describe what customers are trying to get done in their work and in their lives, as expressed in their own words.</li>\n<li>Gains: describe the outcomes want to achieve or the concrete benefits they are seeking.</li>\n<li>Pains: describe the bad outcomes, risks, and obstacles related to customer jobs.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAADy0lEQVR42l2UW4/bVBSF5/ci/kD/ABISL7wgJMQLiIq+FIQAUdR2Lp12LnEmM7k5vsaOfez4ksvYceJk0n7sJB2oeFjax9vnLO+91j4+ClYZ53kPtZqQrQvS9b3EA9L/4d98PWfyYUmn1+WrJ3/w8ucWMzm7ouLo73GLzxvf0p3bsjEX4jFqeUBSp4zrhPgTRPt3spZ9yTZH10c8++wLvvnyL+zJkqNEvjhZ5eR5hO45mL7DUPm4grd9ixvTomXZ3FkW2sDCCEYYI48by+HWcbHjgDTy+OHrc549+ZGjcDVFVZGQjGjKJs1y0UcjfOVyqZu86+lopi0fc2m7DoMwxAo8GgNT8g5Nw4YPOWGe8/r77ziKhDBYxKSxidG/pt06xzKa2OYNodfGd+8YWjd4zi2uRMfQMPUGs8wmUTrzyZByHhKtEsKHyYEwXERMco8gGKDCAZEyyFKHZOwQyzqU/Di29+9UaJAmDmWpWImWVTVmKQiLiLASQrVrWQjjTOGIblEa0B260pZPOB7x8DDlQSZhUyWsdyhjVoJqrgThHvW9IiyFcLWrsJ4RFCHvNwuyeUGQ5sSTKdvtA5uyZBkJgeRq36cYGZSBzSJ29rEMbQrPpJJ1MA0I6+mhwmihSKdTTnoJL9uKXy5doumSreGzeK2xbttsizm5pxNbHQKvh6adYYrWltUiF3n8eYB6JIzF5SDJ+OnM5veGy69agNH12R43KE+alM+PpcKA6chEtZtojVPenL3g6uIVV5fH2IOmdKkOLT8SRlnO0zOT5xcWzy49zJ7o9+qKxatrit/OWAuhqTe5OH1B4/pEKjyldfNmHzt378SH+EAYS5muiHrpTri2cq7MhJNOQDxb8t4X8d+1WfeGfNjUGLomY/UWS4h7dxdEoz5zmY554orLn1SoRMO+SvHThPl9SjZLWYuzD9uC7XrG9n2xd3u7ztmsUjbLA3au14LNQq7jo8uPpmSzMbo4asQxrVHM7D5mnloyhwMymbud8Lv5WwthLfO3w6bO9rO4Fqgy/o9wLBqaKuJ4EHJuKU5NRSeI0cSAq+szGpevOTn5k2uJt3KTuu2LvXY34vTueSvE4acVqipmJDPV1dvYbg9v2GVg6+j2gKE3oNPV6PUa6INbbLtDvy9X0Lql2bpA7zelwvSjKdPdYE/xi5iymrKUdooqZbGcUMqmUlq5F43ulxkL+bXtYinaFoKqnlCtCnmWvGgYSIWBnD/a/Tj1wqG/6OFK0pE72i/7so73GH7EYR3t9wzLMWbp0SnuZH/IUAjdMqVfa/wDikAg22/aJeQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102152253\"\n        title=\"\"\n        src=\"/static/932b73e445ca10538b437cc4441d40ff/5a190/20241102152253.png\"\n        srcset=\"/static/932b73e445ca10538b437cc4441d40ff/772e8/20241102152253.png 200w,\n/static/932b73e445ca10538b437cc4441d40ff/e17e5/20241102152253.png 400w,\n/static/932b73e445ca10538b437cc4441d40ff/5a190/20241102152253.png 800w,\n/static/932b73e445ca10538b437cc4441d40ff/8ae78/20241102152253.png 1096w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2>Our VPC</h2>\n<p>VPC는 지속적인 업데이트가 필요합니다.\nV1을 작성한 후, 이후의 interview, Survey를 통해 여러 차례 업데이트 해주었습니다.\n</br>\n</br></p>\n<ul>\n<li>v1 <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC+klEQVR42j2SSWxTVxSGnwRSWrqAigKBBqKkDKW0qkqZgiEVkyCFSkyKGxrjOEAiYMEsARLsWhVBJJAqEIg5C8qiSkFeMFUg2jxjG8dOHT/PsY2d9/zshCR2gA3wcfMiWPw6V+fc++uccz+pRb7Frw9auRvy4EgEkZNBHMkQ/ucZlEHNUGBgRIoRVaMWKuhEhvJEizmRVwkP6oRFTvJrSfxRhX8Dbh4rbuRwB+2hDkJ9z4gN9hAZyBAvaoZiBZXkC53cmyL+fDcPY0/pzMXIvy6SftVLVNSlA55rnFFuoQ/1E+hN4VHDeHrCuNIKHSJ2pEPGxWElhFm8oHHo6gm+2VnDzMblfLl9JbYzh1H6UqSEqWR98gejb6znhPIXmZe9eLQwcqYLZ4+CSw3iTgeNzqJFldTLPJaWA3yybjYVliVM/nkBk2rnUWlZSs3xRoL9aaQm5zlGXVrLx9c3YJVP4x9ICSXx9MfxDibwZiNExOjamwKtsp2P1s/m821LmGIzMb52rmE8d9c6SmpmcNp+DanZdZ6xf9ZS3tbI2JtmVjw8xj8ZH57uAHLUiyPaSVc+QepFnv2XfmOc+TtKG6r4rG4eZRYTlQ0/UGGtptQ8H/PJPUi73ReZbm9m4f1DVNxuYuG9g7TF23nsd3HfJ/Ooy4lPjRJ/rnLk+ilm2JZRubWaab8sprzexLStJibUz6dk8xzMp4Rhs/M8pW0WpvzdwKb/fselh/hfi+FWQ/j0GF41QmJIR39bpNVh59ON3/J102q+2rGKsi1VlNUtYta25YzZOIcW+xWkRudZpBs/sd97mbBAxC/Gc6gK3nyM4ECarly38bPD2CTFp2w5uZeStTOZWL+AydYqxpu/Z9SaL/jxmM1ATNrpusBRz1W0Yh9P9TDtWgCn6PJJNkinYM2biYwgM5QV2OSMR83njlNuq2aC2ONUq4m6ln10ZmMGi5JruIO+jLH4gJCST36I78/xYtYYO1IYQWcYbJ8wuBOQBVYKOQH2M2EWKfTwDu+GlImDN5tBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102151949\"\n        title=\"\"\n        src=\"/static/92e1990286bfe0fb06f2f94317ede783/5a190/20241102151949.png\"\n        srcset=\"/static/92e1990286bfe0fb06f2f94317ede783/772e8/20241102151949.png 200w,\n/static/92e1990286bfe0fb06f2f94317ede783/e17e5/20241102151949.png 400w,\n/static/92e1990286bfe0fb06f2f94317ede783/5a190/20241102151949.png 800w,\n/static/92e1990286bfe0fb06f2f94317ede783/c1b63/20241102151949.png 1200w,\n/static/92e1990286bfe0fb06f2f94317ede783/29007/20241102151949.png 1600w,\n/static/92e1990286bfe0fb06f2f94317ede783/2643c/20241102151949.png 1747w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>v2 <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAUlEQVR42l1SS2sTURidP+NGUIMU0xiTGmttkxgwQfG5cimUmpKkiUmaJm2JT6RFcO9CrFbRjWgeM8lMOknrayfuBGcSpHWhCI2Uwum5d2oFF4fvMed+373njHK+fQfDjTzOmrcQac0haBQRMkoyBhmjZhmn2f+HWQT1EmLmTYSZC27YmJXcSGseylAji/1vxuFnPKZl4K6ncIQYqCXgqsQlMcQDY4yj+gwCXH64OolTzEeI4ea0A30afi0LJWzMYaCawMlmQR4Y0QsYauTkQHctKfsCgjwolrHnrqUwpjuLxOCjahqD6hR8agaK3d/At/46un82iB/oESJarP/C3oVFnsR/XDHj6+Z3fPltQXnV+4indgcvex+wbK/hidWRtcDz7hpedN/t1QJLdhvLu/0lcp+x99gyUVv/jD62oHjqWex7fQ0+LUcNs/DU03yC0HIKB9/G4VVvyJ6DDJ+dxgH2feSKbyK6KpO42FnEz+0+FL+Wh6t6Xeok9DtO/QLNPE3iIOoiXHbcd0wRmrnrSWpYlHxRe7U0rr5/iF/bm1ACjQI3jkvBvRzgUVPMk3Q6QTfjGDVm6HCRBwsyP9HM4VBlYo8v/gxRX15d5EDeMGbep+0lXnkBV1Yf4Bzr6MpdnCGCelnm0ZV7EjEi0rrNm87jQnsBl/hMgZBRxsSnR/KGO5r682Wrb/ORAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102152041\"\n        title=\"\"\n        src=\"/static/e1db08b1c168e78c6d139039c4761161/5a190/20241102152041.png\"\n        srcset=\"/static/e1db08b1c168e78c6d139039c4761161/772e8/20241102152041.png 200w,\n/static/e1db08b1c168e78c6d139039c4761161/e17e5/20241102152041.png 400w,\n/static/e1db08b1c168e78c6d139039c4761161/5a190/20241102152041.png 800w,\n/static/e1db08b1c168e78c6d139039c4761161/c1b63/20241102152041.png 1200w,\n/static/e1db08b1c168e78c6d139039c4761161/29007/20241102152041.png 1600w,\n/static/e1db08b1c168e78c6d139039c4761161/f0293/20241102152041.png 2250w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>v3 <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABpElEQVR42k2Ry24TQRBF/XOID2HLL7AAZREWCEUEggSCDT+AICBEhDcOr8gyCjZ2MI4hEI/teXqmX9Mz9qHGC0RLV11d6rpVt24rTnOsW1PoUmAx1uNKgStR0QC1+IwKe3jvqddgiogi/CrvikoSxhmU0yirBJpWevYU9/MRavqAcPYGmwdUvqA5cf82Sfc6+bdb1JUn+/WKcHAPdbaLK37jy0QaavR5hr/QwlMI4ck1gvZV0uMr6Mkey+FjTPCWut6wGh9gRjew033y5SnJcE+a7KL/PCcePaFy56y6KxbPJlSHMZt3OS23bOPmh5TzF9i4S3Z5TNrfwUQ9dDLCRieks0+sssVWejNZFrwn6t+hEhVmnKI7IfZjQv1FCJVdi3ZQZrO94+F91OwIZ1IWvZusvh8IRGYWEJ7uoC9fouYdkX4XmwzQtkZrvYXSipZWBQ2UyiWpyOMfeJezke569no7rV12xKgSO28TjR6SjmXnyUSmnYmhXmqberUlbTXB/7CuohRHS3HRWvm4+CDL1/iqcVUkqgydTfGy47px2Zh/tQ3hX97ABF5iSTQJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102152144\"\n        title=\"\"\n        src=\"/static/4b7ac4cd66cfebd28ff3e0a293ad9cd0/5a190/20241102152144.png\"\n        srcset=\"/static/4b7ac4cd66cfebd28ff3e0a293ad9cd0/772e8/20241102152144.png 200w,\n/static/4b7ac4cd66cfebd28ff3e0a293ad9cd0/e17e5/20241102152144.png 400w,\n/static/4b7ac4cd66cfebd28ff3e0a293ad9cd0/5a190/20241102152144.png 800w,\n/static/4b7ac4cd66cfebd28ff3e0a293ad9cd0/c1b63/20241102152144.png 1200w,\n/static/4b7ac4cd66cfebd28ff3e0a293ad9cd0/29007/20241102152144.png 1600w,\n/static/4b7ac4cd66cfebd28ff3e0a293ad9cd0/14747/20241102152144.png 1914w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n<h1>Interview</h1>\n<p>Interview는 많은 데이터를 모으긴 힘들지만, 좋은 퀄리티의 디테일한 정보를 수집할 수 있는 방법입니다.\n인터뷰 질문을 작성하고, 근처 헬스장을 방문하여 각 Member당 가능한 만큼의 인터뷰를 모아오기로 했습니다.</p>\n<ul>\n<li>Mingwan <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACBklEQVR42kWT25LaQAxE+f8v2+dUKrtkDfjuscd3G3Ont1uG5GEKSmO1Wkeaza+PPX5/hMi2I4pgxml84Lo8cD8DReKRJxXGdsF5vttRvHYdkrDAMl7xuAA3xnAHtiWwqVyNOExRFh59O6IpO0zdyRIllscVqrzB0Bwx92fcToAvOgTbEMkhh0truLzFVLX4LO7YKOHwnSDe58iikgIl6rJfHaaedzHCXWqOyqyh+yc6PyGNnIlVRUvBBsd6wKd7UpAu9n8jHILEKqp6Uw6WWPAu+DrYXUpBJcthW43mcM9iyklpZCgbCtKhy2pjpeOdxHr09WxsFJOYp1BbDVboLRjRtWMHMtD6GZf+yJYfq8OKDPTx+/TN/L/lIEZMF4qJoeL6ZseuhKZj8ZoFJPhVPl8M6UIVlViSS+tHSxQzFZRwV082LDkUw4wMJVi7Hk014Tae2DIdZhyCqomjmES7jB8MJigcKihh/RfDt0MNUXcalstanPt5FRQnOVOCpmZu6EAMNfFon1miNkDsbA/pTEPRBui+IkdjKEFVCF9TVJJ+/cuJhMIgtfbMKdfjzpbVgbpa10zxFgt3+E/OKWvbp27BabriwhdyOT5sZSQoIaFYF5iLT47P6yood+pMdwfy7/kwzKEg3yhwPa5i/w5jWh89MwNPbnqC5pAtu8xbXEctL81gU/4B+uSFIith17EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102153352\"\n        title=\"\"\n        src=\"/static/fc0fac3692b96355afbf5413bc8e16e7/5a190/20241102153352.png\"\n        srcset=\"/static/fc0fac3692b96355afbf5413bc8e16e7/772e8/20241102153352.png 200w,\n/static/fc0fac3692b96355afbf5413bc8e16e7/e17e5/20241102153352.png 400w,\n/static/fc0fac3692b96355afbf5413bc8e16e7/5a190/20241102153352.png 800w,\n/static/fc0fac3692b96355afbf5413bc8e16e7/97bfd/20241102153352.png 1078w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>Kevin <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABf0lEQVR42k1S13LDMAzz/39cH3rXkTaJ4y1b3nslKEE3vT7wbEkgCEByPl582LjB1G8oswalbTE0CyrbIUtKtOWIqdtQ5z1iP9P9phh+MS36esYy3LGOD2zTA07kG1hT6oEJc3iXUIlsUsH99hF5qQxqde98chF6BllcoikHxfpujMhPkQQWXTXB8S6RLjg1CS3cc4A0LlCkjQ6gIgILUR/cEm1W5dWo2FD2TJRrrxKyOU9rtcbNwE2Qm0oJrDRWeaf2clPjJgRxkOmgpuhVsQ4VDGsedjgmPNSRnYSJNHQynQqpnGrGZpV1jatEwC/zJN67RhoNXRDf1aKQKpjH2K4qPZKMKsmMqpkhm6jOaoY3Vcgzqj7UWnXDnNWyLw1kn7pVDzV0WpWpaVSoJRKy4fzpqu3wZvQS537/u2EW1w6nHMEfz4M1yxMiYJ8h9cBjhVp9ez3h6/2iFzG2C+4L5KkcRezUbnCeU1gHwVFP4BPMnFWdOOBF0vJ/HP/nbscP16iocPdy/8IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102153325\"\n        title=\"\"\n        src=\"/static/7c698c9bb075eb43751236dfffd94298/5a190/20241102153325.png\"\n        srcset=\"/static/7c698c9bb075eb43751236dfffd94298/772e8/20241102153325.png 200w,\n/static/7c698c9bb075eb43751236dfffd94298/e17e5/20241102153325.png 400w,\n/static/7c698c9bb075eb43751236dfffd94298/5a190/20241102153325.png 800w,\n/static/7c698c9bb075eb43751236dfffd94298/c1b63/20241102153325.png 1200w,\n/static/7c698c9bb075eb43751236dfffd94298/29007/20241102153325.png 1600w,\n/static/7c698c9bb075eb43751236dfffd94298/719d0/20241102153325.png 1779w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>EL <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 84%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACVElEQVR42o2U2ZbaQAxE+///L5kNMN7xim12BkbRlbsJmTMPeajTYKulUqlkt8kaSVa55EklXTXI7SyGz5PI9fgl94tI30wSLVJJ16W0m62M3cHeEfMdLo8rTVhIU26lryc57T7lvL/py/sj+dQfLFlXjdLVo4ztXu5XsWIBgYRLokLWVNezzjsp00ZKZU0BkhNYl70QF2snhmUmVVpLlbdSF53G9tJqsf1wFsflNCql0JZJwmXa4iSA6lykZZIW2hHy5Jo00//chQR3h26vDLXi4i3SC4kmGiwZ6JtRdZrb7rXNIqllkzemZ9/sDEixH05WeOqPM8Ms3kim+sznRqvVxjbX/4g/M+xscEhDu8u3tQECg+o5tDsDyR1TRoe66IXfYGsMJjmMl3nKypAChRYL+jZeFk6DPjtMF3FUXGg12l6+xzZNS6y6HaerJaTYGs30XXhfKQmYz2Q6ewYJR3sEITgtUzUEn3bXv0P5SB5xTJoilU9GbOjMhrLSYKbIJXTi2cdrZL77Ur+h7+uvhbz/Xtrz95eV3oktNvKIl7mMOhhHG7H3IZVhgB6tbg0+hOHGMyy998JJwdbrhxeZtENs9CFh4o2bRLn5i6nNGm6tCxLTHhNlTc1COrAZk8GlflNIGq8ys0VoZXiyTZAD5Gbu2jTNg+0UsHQXNe/lcPsRfAAwNsxSP2FDVP7bkV9H4lz4ADx/Zb7/pjJJmGgw8tbDTI1vtW3+u58+Qc8gIfZgMyI/vNkRqZcqtbVFMrPN/yRkmmwIm4L/jGGze5xg1L1ms/4AGR39NVkU08QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102153245\"\n        title=\"\"\n        src=\"/static/e73abe809f97f2ccd2ebc65bf60260c4/5a190/20241102153245.png\"\n        srcset=\"/static/e73abe809f97f2ccd2ebc65bf60260c4/772e8/20241102153245.png 200w,\n/static/e73abe809f97f2ccd2ebc65bf60260c4/e17e5/20241102153245.png 400w,\n/static/e73abe809f97f2ccd2ebc65bf60260c4/5a190/20241102153245.png 800w,\n/static/e73abe809f97f2ccd2ebc65bf60260c4/c1b63/20241102153245.png 1200w,\n/static/e73abe809f97f2ccd2ebc65bf60260c4/e5ca1/20241102153245.png 1332w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n<li>Thaha <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABd0lEQVR42nVSR5LDMAzz/9+3k+Ie994d1w2WYJLjHjC0ZAkEQBlFUqMtR5wrcCwvxbm+sD/f+N2ALK7gmg/EQY40LAUF4keu60S+dS3fY7vA8J0IiSyqrAPJi6RBkdYo0wbzsOG1A3Xey5kCWVQJSuTSoJD/bMRv7oVegq4aYTh3H/bNg3V14VkBPDtUsDMvUTkbPdxYVGUIpIZ+qjWSWuedinkOuzoyeNARO66QRXJBFQpBHtdKus4nyqwFnRBUQsXcq4SsKXrBILENWKcThmeFMEUd4YsyWxRTKQ/xwLm9LZdpi7FbNIZlPLBMh/yXOu6qjlBCdrVuYtcOVBFtUR1tsCstM/Trj6lRMIZcHVQf1J/BlJLhBIMWSEZVzNI1Ax0SDzH0QwgZunlxNDde5H5fzxiaWeqktZWBzP0Kg0+EKvg8aI/1+3wIfTZCeL/YCvvuaY7vJ1RoY7rhcJTwWEjwP0hIWxwaM6YTfRlCzLi+WW8yPE75D6WAo4DFQDP5AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102153302\"\n        title=\"\"\n        src=\"/static/111f413dff7212177249e31f6dac8f93/5a190/20241102153302.png\"\n        srcset=\"/static/111f413dff7212177249e31f6dac8f93/772e8/20241102153302.png 200w,\n/static/111f413dff7212177249e31f6dac8f93/e17e5/20241102153302.png 400w,\n/static/111f413dff7212177249e31f6dac8f93/5a190/20241102153302.png 800w,\n/static/111f413dff7212177249e31f6dac8f93/c1b63/20241102153302.png 1200w,\n/static/111f413dff7212177249e31f6dac8f93/32b38/20241102153302.png 1471w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></li>\n</ul>\n<h1>Survey</h1>\n<p>Survey는 너무 길지 않은 정해진 질문 만을 할 수 있지만, 많은 양의 데이터를 모을 수 있는 방법입니다.</p>\n<h2>질문 선정</h2>\n<p>1차로는 Brainstorming을 통해 12가지의 질문을 선정했습니다.\nSurvey의 특성을 고려해 질문의 개수를 최대한 줄여 최종 Survey를 선정했습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 535px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 202.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEl0lEQVR42p1W23KjVhDk/38jL1t5TlUqqeRlUynHu7ZuFiAJJECAuAgQoLtX1mR6EFhyvF4pD1NHwmY009PdZ5TPYZt+Un+hT9qv9PPod/pk/EZ/+F/ICV0az2wOqznnq4y29Exr2tPmuKNgb5G3M8jfmZQfclq+bEn5e/JIfxp39Nl+kPjLbdHjTCU/C8mOXXKTWRNeOqMgj5uIioziciGRbUtaHTekqNaA+gOVNPN0jnTqD1Vq6V1qaRxqm3RrSKZv0cgd03BqSgxsg08OxyDdHlJYzrnyHSk9S6Pu8Ik6oz4Z3kSqmoQOTYIqkAjPvDSQKqMyoXiZ8DmnsKgC1S72JbfMFVqJS9O5zy/b5MSe4BQvU4kgj5qXkAhRHta0ZvxWx+3FueR2JaFXRKSOB+QyPhH/MsrGP9X/KHH2DC8hqZwvfB5ev0vCZJfTyDGltTpp/dJ7Ub/4vVC8MiQncslk/KxwKljUlfyf4JZDavM0MQB/ETbgnrd2U8L5bkEWJ4vLlCn7QhsmbYXb/gK7cww/TDhd+MIzjfmoTYbyWbdHpE4GNGCOWScKAQ4oBiz4KLES7TLqmxo9ah1pOV6l8hKGExQxFd9WzUDqzx+3vF+QwQromaoMBly0o6qadJOLdm8bCk/Z5ikjEVoTM2AKgUbQrpcFlD8vr5684vKUn0YqtfWeaBKtQiU4Q255xjDclBBTfjI0NoKOiB9ywx8apfCkb2o52edSYc9QuZpIItsWle9xwlu5yLSZ0Qh2xBTRmCoYCJLCMHDeTGy3CKjHFYIi83VGM24ZgdZrd7mlSm65JJ0JDT1jEMUzUDtwfJO2oRzE6ri7vmVIDwOpDXaa+NyyJ3QCBKATCH+V9GarmJWii1K67NqdQY8e+nyvqB35AUgONMp2xXUJoRQQGToesIZxR0DHsHu0jXht+8cm0UxZd5DMlKRQDRJi0gh8BwQCQ1zBAAW9mzBYz/lm69Bd+57uuw/SOi4pYIY2wUmc6TavPkvk8uw9BgixjelYqAPFoBrQZsWX9vmU69hKXD4/h0CxU+80ZVOMAdOG0+DatCNPfsDB5E9Tx5AQFQNcuS2T9aJJyi0n4octmbIqisHWgJabtuuo292+fgcU8MkLc1B5a3jgDaFuG0OqKvPkjqkN4u118N7EJaEdTMWtITVIEGsFXBtnsllcUKa+Z+o7+21S2RxAFWAHHKsFqVJKvX5AKXXFwFdwPLk6KIQoD6sTD7OZ2BeWIyxOwATWD3WgQnyHwf4omgqdzBfssGlBcoj77lcZjn0yjI8wrJ9f8LA77NNd657+6XwVgqOV83+8xcKU5DlnHk4FRwQw3LN9oSqAvjlW5L32KlD8MpKJwlyBm9zJZSIrXHUlhHJiB7xqWZrmAePWpjtuF9gJfrydVtblNJOGGVyVMN0XTGaVvvQe+SrtSsAT0Xq+X14491XEhttU22pckVru4qrFxa4UKEDut/JLt9+RnsXm0B08VW3zpDv8Ge3Kgs7UwQZREdhtvFHWldgV0wDp8YONOcCxsdP0xzo9sUkgNGz9/AyVN3ITyf13XX4rvX8BAasYHBWTPIQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20241102154326\"\n        title=\"\"\n        src=\"/static/4b16c9529ab751b5ed73e2b1b05dde44/b5245/20241102154326.png\"\n        srcset=\"/static/4b16c9529ab751b5ed73e2b1b05dde44/772e8/20241102154326.png 200w,\n/static/4b16c9529ab751b5ed73e2b1b05dde44/e17e5/20241102154326.png 400w,\n/static/4b16c9529ab751b5ed73e2b1b05dde44/b5245/20241102154326.png 535w\"\n        sizes=\"(max-width: 535px) 100vw, 535px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2>결과</h2>\n<p>Survey의 홍보는 QR코드를 붙힌 포스터를 만들어 교내 Board에 부착하였고, 각종 단톡방과 Reddit 커뮤니티를 사용했습니다.</p>\n<p>그 결과 250건 정도의 결과를 얻었고 VPC 업데이트에 반영하였습니다.</p>","frontmatter":{"thumbnail":"bookreport.jpg","categories":[{"mainCategory":"Project","subCategory":"exchange"}],"date":"2023-11-20","slug":"/exchange/onethree","title":"Becoming the next successful online startup"}}},{"node":{"html":"<h1>Goal</h1>\n<ul>\n<li>Investigate/Validate the feasibility of your own idea and pivot whenever required.</li>\n<li>Apply the Business Model Canvas(BMC) and Value Proposition Canvas(VPC) to your team's idea</li>\n<li>Develop an ICT-related product or service according to the 'Lean Start-up Method'</li>\n<li>Present your idea to investors and other potential stakeholders</li>\n<li>Generate leads/customers for your start-up</li>\n<li>Reflect on your own functioning in the position as entrepreneur</li>\n</ul>\n<h2>Start Up = Small Business?</h2>\n<p>Small business: organized for profit, and not dominant in its field<br>\nStart Up: designed</p>\n<h1>Startup Fails</h1>\n<ol>\n<li>no market needs</li>\n<li>run out of cash</li>\n<li>not the right team</li>\n<li>get outcompeted</li>\n<li>poor marketing</li>\n</ol>\n<h1>How to succeed</h1>\n<h2>know your industry</h2>\n<ul>\n<li>DESTEP/PESTED analysis</li>\n<li>Competetion analysis(core business of them)</li>\n<li>SWOT analysis</li>\n</ul>\n<h2>know your idea</h2>\n<ul>\n<li>survey</li>\n<li>interviews</li>\n<li>online research</li>\n<li>crowd testing</li>\n</ul>\n<h1>team</h1>\n<h2>Business Lead</h2>\n<ul>\n<li>channel selection</li>\n<li>marketing &#x26; sales</li>\n<li>vision &#x26; strategy</li>\n<li>business model</li>\n<li>customer discover</li>\n</ul>\n<h2>StoryTeller</h2>\n<ul>\n<li>content strategy</li>\n<li>blogging</li>\n<li>visual content</li>\n<li>curation &#x26; aggregation</li>\n</ul>\n<h2>Designer</h2>\n<ul>\n<li>ux/ui</li>\n<li>graphic design</li>\n<li>mental model</li>\n<li>wireframing</li>\n<li>brand visualization</li>\n</ul>\n<h2>Coder</h2>\n<ul>\n<li>prototyping</li>\n<li>testing</li>\n<li>APIs</li>\n<li>frontend</li>\n<li>backend</li>\n</ul>\n<hr>\n<h1>Interview</h1>\n<h2>timeline interviews</h2>\n<ul>\n<li>what problems they currently have</li>\n<li>outcome they are trying to achieve</li>\n<li>difficult or frustrating with the current solutions</li>\n</ul>\n<p>Dont ask them what they want, what they are trying to achieve.</p>\n<p>Need 8-10 interviews per customer segment</p>\n<h1>Survey</h1>\n<h2>sample size</h2>\n<p>250 people should be enough. Use sample calculator</p>\n<h1>VPC</h1>\n<h2>value proposition</h2>\n<ul>\n<li>Products &#x26; services: this is a list of all the Products and Services a value proposition is built around</li>\n<li>Gain creators: describe how your products and services create customer gains.</li>\n<li>Pain relievers: describe how your products and services alleviate customer pains.</li>\n</ul>\n<h2>Customer Profile</h2>\n<ul>\n<li>Customer jobs: describe what customers are trying to get done in their work and in their lives, as expressed in their own words.</li>\n<li>Gains: describe the outcomes want to achieve or the concrete benefits they are seeking.</li>\n<li>Pains: describe the bad outcomes, risks, and obstacles related to customer jobs.</li>\n</ul>\n<h2>assessment</h2>\n<p><img src=\"../_resources/6e2eb3330c06eaf7fc4a3942c093f536.png\" alt=\"6e2eb3330c06eaf7fc4a3942c093f536.png\"></p>\n<h1>BMC</h1>\n<h1>Segment Customer</h1>\n<h2>purpose</h2>\n<ul>\n<li>create and communicate targeted marketing</li>\n<li>select the best communication channel</li>\n<li>identify ways to improve products</li>\n<li>establish better customer relationships</li>\n<li>test pricing options</li>\n<li>focus on the most profitable customers</li>\n<li>improve customer service</li>\n<li>upsell and cross-sell other products and services</li>\n</ul>\n<h2>b2b factors</h2>\n<ul>\n<li>firmographics (industry, years in business, turnover, number of employees, location)</li>\n<li>Needs (what they are looking for in a product)</li>\n<li>Sophistication (a target company's awareness of the problem your product sorves)</li>\n</ul>\n<h2>b2c factors</h2>\n<p>age, gender, marital status, location, life stage</p>\n<h2>decision</h2>\n<ul>\n<li>To what degree you need to segment, based on the business model/idea -> indicated by VPC</li>\n<li>the availability of existing data</li>\n<li>budget and time to conduct research</li>\n</ul>\n<h2>process</h2>\n<ol>\n<li>decide to segment</li>\n<li>collect data</li>\n<li>explore data</li>\n<li>extract segments</li>\n<li>profile segments</li>\n<li>descrive segments</li>\n<li>select the target segment</li>\n<li>customize marketing</li>\n<li>evaluate and monitor</li>\n</ol>\n<h1>DESTEP analysis(Macro)</h1>\n<ul>\n<li>focussed on environment: mostly country-focussed</li>\n<li>broad vision</li>\n<li>input for SWOT analysis and strategies</li>\n</ul>\n<h2>Demographic</h2>\n<ul>\n<li>population composition</li>\n<li>density</li>\n<li>geographical characteristics and differences</li>\n<li>infrastructure</li>\n</ul>\n<h2>Economic</h2>\n<ul>\n<li>Market characteristics</li>\n<li>power relationships</li>\n<li>financial data</li>\n<li>economic climat</li>\n<li>growth perspectives</li>\n</ul>\n<h2>Social &#x26; cultural</h2>\n<ul>\n<li>standards &#x26; values</li>\n<li>communication</li>\n<li>behaviour</li>\n<li>lifestyle</li>\n<li>social trends</li>\n</ul>\n<h2>Technologincal</h2>\n<ul>\n<li>know-how</li>\n<li>innovation</li>\n<li>trends</li>\n<li>technical problems</li>\n<li>probability of success</li>\n</ul>\n<h2>Ecological</h2>\n<ul>\n<li>nature resources</li>\n<li>energy</li>\n<li>emissions</li>\n<li>waste</li>\n<li>safety</li>\n</ul>\n<h2>Political &#x26; legal</h2>\n<ul>\n<li>legislation</li>\n<li>licences</li>\n<li>subsidy schemes</li>\n<li>political climate</li>\n<li>political plans</li>\n</ul>\n<h1>MESO Analysys</h1>\n<h2>New Entrants threat in Industry</h2>\n<h2>Competition in the industry</h2>\n<h2>Bargaining Power of suppliers</h2>\n<h2>Threat of existing substitutes</h2>\n<h2>Bargaining Power of Customer</h2>","frontmatter":{"thumbnail":"bookreport.jpg","categories":[{"mainCategory":"Project","subCategory":"exchange"}],"date":"2023-11-20","slug":"/blog/becoming01","title":"Becoming the next successful online startup"}}},{"node":{"html":"<p>2023년 2학기 교환학생 생활에 관한 포스트 입니다.\n네덜란드에서 Hague University of Applied Science에 다녔습니다.</p>\n<h1>수업</h1>\n<p>이번학기에 저는 Becoming the next successful online startup이라는 수업에 참여했습니다.\nOnline Startup을 런칭하기 위해 필요한 내용들을 배우고 직접 적용해보는 수업입니다.</p>\n<h1>교수님</h1>\n<ul>\n<li>Jelle <a href=\"https://www.linkedin.com/in/jellehylarides\">링크드인</a></li>\n<li>Richard <a href=\"https://www.linkedin.com/in/richard-ramesh-jitan-rai-70205026/\">링크드인</a></li>\n<li>Anil <a href=\"https://www.linkedin.com/in/anil-manraj-245a0083/\">링크드인</a></li>\n</ul>\n<h1>Group</h1>\n<h3>Team <b>Molluskular</b></h3>\n<ul>\n<li>Mingwan Chae - Developer</li>\n<li>Kevin - Designer, Marketor</li>\n<li>EL - Designer</li>\n<li>Thaha Jemni - Developer</li>\n</ul>","frontmatter":{"thumbnail":"bookreport.jpg","categories":[{"mainCategory":"Project","subCategory":"exchange"}],"date":"2023-11-20","slug":"/exchange/record","title":"Becoming the next successful online startup"}}},{"node":{"html":"<h2>Telefunc란</h2>\n<p>Telefunc는 기존 서버와 통신하는 방식인 rest api나 graphql과 다르게, fontend에서 backend의 함수를 직접 호출하는 것처럼 사용할 수 있는 방식을 제공한다.</p>\n<h2>Telefunc사용 이유</h2>\n<p>우리 프로젝트는 backend가 복잡하게 구성되진 않을 것 같아서 nextjs의 api routes를 서버로 사용하려 했다.\r\n그러던 중, Telefunc를 사용하면 nextjs에서 Backend를 따로 분리하지 않아도 된다는걸 알게 됐고, 프로젝트에 한번 적용해보기로 했다.</p>\n<h2>사용</h2>\n<ul>\n<li>/next.config.js</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> withTelefunc <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"telefunc/next\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>default\r\n\r\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">withTelefunc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li>/pages/_app.tsx</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\r\n<span class=\"token keyword\">const</span> isBrowser <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> window <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isBrowser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  config<span class=\"token punctuation\">.</span>telefuncUrl <span class=\"token operator\">=</span> <span class=\"token string\">'/api/_telefunc'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token operator\">...</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>-pages/api/_telefunc.ts\r\n위의 _app.tsx에서 설정한 telefuncUrl에서 아래와 같이 설정해두면 알아서 Telefunc함수 호출을 http request로 바꿔주는 방식인듯 하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> telefunc<span class=\"token punctuation\">,</span> config <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"telefunc\"</span>\r\n<span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> NextApiRequest<span class=\"token punctuation\">,</span> NextApiResponse <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"next\"</span>\r\n<span class=\"token keyword\">import</span> assert <span class=\"token keyword\">from</span> <span class=\"token string\">\"assert\"</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getIronSession <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"iron-session\"</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">SESSION_OPTION</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../config/cookie\"</span>\r\n\r\nconfig<span class=\"token punctuation\">.</span>telefuncUrl <span class=\"token operator\">=</span> <span class=\"token string\">\"/api/_telefunc\"</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">telefuncMiddleware</span><span class=\"token punctuation\">(</span>\r\n  <span class=\"token parameter\"><span class=\"token literal-property property\">req</span><span class=\"token operator\">:</span> NextApiRequest<span class=\"token punctuation\">,</span>\r\n  <span class=\"token literal-property property\">res</span><span class=\"token operator\">:</span> NextApiResponse</span>\r\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> session <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getIronSession</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> <span class=\"token constant\">SESSION_OPTION</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> url<span class=\"token punctuation\">,</span> method<span class=\"token punctuation\">,</span> body <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req\r\n  <span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>url <span class=\"token operator\">&amp;&amp;</span> method<span class=\"token punctuation\">)</span>\r\n  <span class=\"token keyword\">const</span> httpRequest <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n    url<span class=\"token punctuation\">,</span>\r\n    method<span class=\"token punctuation\">,</span>\r\n    body<span class=\"token punctuation\">,</span>\r\n    <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> session <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token keyword\">const</span> httpResponse <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">telefunc</span><span class=\"token punctuation\">(</span>httpRequest<span class=\"token punctuation\">)</span>\r\n  res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span>httpResponse<span class=\"token punctuation\">.</span>statusCode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>httpResponse<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>/TelefuncContext.ts</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> IronSession <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'iron-session'</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token string\">'telefunc'</span><span class=\"token punctuation\">;</span>\r\n\r\ndeclare module <span class=\"token string\">'telefunc'</span> <span class=\"token punctuation\">{</span>\r\n  namespace Telefunc <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Context</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token literal-property property\">session</span><span class=\"token operator\">:</span> IronSession<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<ul>\n<li>/components/Nav.tsx</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> onGetUser<span class=\"token punctuation\">,</span> onLogout <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../router/login.telefunc'</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Nav</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token operator\">...</span>\r\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">const</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">onGetUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">logout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">await</span> <span class=\"token function\">onLogout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setUser</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    router<span class=\"token punctuation\">.</span><span class=\"token function\">reload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>nav<span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>Flex justifyContent<span class=\"token operator\">=</span><span class=\"token string\">\"space-between\"</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>Link href<span class=\"token operator\">=</span><span class=\"token string\">\"/\"</span><span class=\"token operator\">></span>\r\n          <span class=\"token operator\">&lt;</span>strong<span class=\"token operator\">></span>Univting<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>strong<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">{</span>user <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>\r\n          <span class=\"token operator\">&lt;</span>Button background<span class=\"token operator\">=</span><span class=\"token string\">\"none\"</span> onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>logout<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\r\n            Logout\r\n          <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Button<span class=\"token operator\">></span>\r\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Flex<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>nav<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Telefunc 설정을 마치면 이제 frontend에서 ~.telefunc.ts 파일에 정의한 함수를 import하고 호출하여 사용할 수 있다.</p>","frontmatter":{"thumbnail":"univting.png","categories":[{"mainCategory":"Archive","subCategory":"univting"}],"date":"2023-01-04","slug":"/blog/univting/telefunc","title":"유니브팅 - Telefunc"}}},{"node":{"html":"<h2>Chakra UI란</h2>\n<p>Chakra UI는 React앱을 빌드할때 사용가능한 블록들을 제공합니다. Chakra UI의 블록들은 props로 style을 받기 때문에 따로 css를 사용할 필요가 없습니다.</p>\n<h2>Chakra UI 사용이유</h2>\n<p>앞서 말한것처럼 따로 css를 사용할 필요가 없는것도 장점이고, display:flex같이 자주 사용하는 것들을 이미 &#x3C;Flex> 처럼 하나의 블록으로 정의 해뒀기 때문에 개발 시간이 더 단축됩니다.</br>\r\n이 외에도 Chakra설정파일을 이용하면 자주 사용하는 color나 size등을 변수처럼 저장해두고 사용할 수도 있습니다.</br>\r\n또한 이전 프로젝트를 할때, classname을 생각해내는게 머리가 아팠는데, Chakra를 사용하면 classname도 지정해줄 필요가 없습니다.</p>\n<h2>사용</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Flex<span class=\"token punctuation\">,</span> Image<span class=\"token punctuation\">,</span> Text <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@chakra-ui/react\"</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> IChatting<span class=\"token punctuation\">,</span> IUser <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../global\"</span>\r\n\r\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">Props</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token literal-property property\">chat</span><span class=\"token operator\">:</span> IChatting<span class=\"token punctuation\">;</span>\r\n  <span class=\"token literal-property property\">user</span><span class=\"token operator\">:</span> IUser<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Chat</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> chat<span class=\"token punctuation\">,</span> user <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> Props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\r\n    <span class=\"token operator\">&lt;</span>Flex\r\n      alignItems<span class=\"token operator\">=</span><span class=\"token string\">\"center\"</span>\r\n      flexDirection<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>chat<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">===</span> user<span class=\"token operator\">?.</span>id <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"row-reverse\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"row\"</span><span class=\"token punctuation\">}</span>\r\n      margin<span class=\"token operator\">=</span><span class=\"token string\">\"5px 0\"</span>\r\n    <span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>Image\r\n        borderRadius<span class=\"token operator\">=</span><span class=\"token string\">\"full\"</span>\r\n        objectFit<span class=\"token operator\">=</span><span class=\"token string\">\"cover\"</span>\r\n        boxSize<span class=\"token operator\">=</span><span class=\"token string\">\"50px\"</span>\r\n        src<span class=\"token operator\">=</span><span class=\"token string\">\"/profile.jpg\"</span>\r\n        alt<span class=\"token operator\">=</span><span class=\"token string\">\"profile\"</span>\r\n        margin<span class=\"token operator\">=</span><span class=\"token string\">\"0 5px\"</span>\r\n      <span class=\"token operator\">/</span><span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span>Flex flexDirection<span class=\"token operator\">=</span><span class=\"token string\">\"column\"</span><span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>Text\r\n          <span class=\"token keyword\">as</span><span class=\"token operator\">=</span><span class=\"token string\">\"b\"</span>\r\n          fontSize<span class=\"token operator\">=</span><span class=\"token string\">\"md\"</span>\r\n          alignSelf<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>chat<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">===</span> user<span class=\"token operator\">?.</span>id <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"end\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">></span>\r\n          <span class=\"token punctuation\">{</span><span class=\"token comment\">/* {chat.name} */</span><span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\r\n        <span class=\"token operator\">&lt;</span>Text\r\n          padding<span class=\"token operator\">=</span><span class=\"token string\">\"5px 10px\"</span>\r\n          backgroundColor<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\r\n            chat<span class=\"token punctuation\">.</span>user_id <span class=\"token operator\">===</span> user<span class=\"token operator\">?.</span>id <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">?</span> <span class=\"token string\">\"red.100\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"blackAlpha.200\"</span>\r\n          <span class=\"token punctuation\">}</span>\r\n          borderRadius<span class=\"token operator\">=</span><span class=\"token string\">\"5px\"</span>\r\n          fontSize<span class=\"token operator\">=</span><span class=\"token string\">\"sm\"</span>\r\n        <span class=\"token operator\">></span>\r\n          <span class=\"token punctuation\">{</span>chat<span class=\"token punctuation\">.</span>description<span class=\"token punctuation\">}</span>\r\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Text<span class=\"token operator\">></span>\r\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Flex<span class=\"token operator\">></span>\r\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Flex<span class=\"token operator\">></span>\r\n  <span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"thumbnail":"univting.png","categories":[{"mainCategory":"Archive","subCategory":"univting"}],"date":"2023-01-03","slug":"/blog/univting/chakra","title":"유니브팅 - Chakra UI"}}},{"node":{"html":"<h2>와이어프레임</h2>\n<p>와이어 프레임 이름 그대로 선으로 틀을 잡는 것이다. 간단하게 웹페이지의 구조를 잡는 과정이다.</p>\n<p>우리는 mpv설계를 위해 와이어프레임이 필요하고, 아직 디자인이 하나도 정해지지 않은 상태이기 때문에, 동작만 가능한 정도의 간단한 와이어프레임을 설계하기로 했다.</p>\n<p>유저플로우를 참고해서 필요한 페이지를 만들었다.</p>\n<h2>도구</h2>\n<p>figma를 이용해 와이어 프레임을 짰다.</p>\n<h2>설계</h2>\n<p><img src=\"../images/univting2.png\" alt=\"화면 캡처 2023-01-01 222226.png\"></p>\n<p>와이어 프레임을 기반으로 기능을 구현해보고, 나중에 디자인을 입힐 계획이다.</p>","frontmatter":{"thumbnail":"univting.png","categories":[{"mainCategory":"Archive","subCategory":"univting"}],"date":"2023-01-02","slug":"/blog/univting/wireframe","title":"유니브팅 - 와이어 프레임 설계"}}},{"node":{"html":"<h2>유저플로우</h2>\n<p>유저 플로우란 유저가 우리의 프로그램을 사용할 때, 어떤 식으로 행동할 수 있을지를 설계 해놓은 것을 말한다.</p>\n<p>우리는 유저 플로우를 먼저 설계하여 프로젝트의 흐름을 잡고, 유저 플로우를 참고해 와이어 프레임을 만들기로 했다.</p>\n<h2>정의</h2>\n<p>타원: entry point</p>\n<p>다이아몬드: condition (위 갈랫길: Yes, 아래 갈랫길: No)</p>\n<p>직사각형: page</p>\n<p>평행사변형: action</p>\n<h2>설계</h2>\n<p><img src=\"../images/univting1.png\" alt=\"univting1.png\"></p>\n<p>이번 프로젝트에서 중요한 점은 프로젝트가 미팅 신청단계, 미팅 진행단계, 미팅 종료단계로 나뉜다는 점이다.</p>\n<p>따라서 미팅 신청단계인지, 프로필이 작성되어 있는지, 미팅에 등록된 상태인지를 고려하여 유저플로우를 설계했다.</p>","frontmatter":{"thumbnail":"univting.png","categories":[{"mainCategory":"Archive","subCategory":"univting"}],"date":"2023-01-01","slug":"/blog/univting/userflow","title":"유니브팅 - 유저 플로우 설계"}}},{"node":{"html":"<ol>\n<li>sass, scss 사용하기</li>\n</ol>\n<p>먼저 sass와 gatsby 플러그인을 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install sass gatsby-plugin-sass</code></pre></div>\n<p>그 후, gatsby-config.js에 gatsby-plugin-sass를 추가해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">plugins: [`gatsby-plugin-sass`],</code></pre></div>\n<ol start=\"2\">\n<li>이미지 사용하기</li>\n</ol>\n<p>먼저, 필요한 플러그인을 설치해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install gatsby-plugin-image gatsby-plugin-sharp gatsby-source-filesystem gatsby-transformer-sharp</code></pre></div>\n<p>그리고 gatsby-config.js파일에 포함시켜준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">module.exports = {\n  plugins: [\n    `gatsby-plugin-image`,\n    `gatsby-plugin-sharp`,\n    `gatsby-transformer-sharp`, // Needed for dynamic images\n  ],\n}</code></pre></div>\n<p>이미지는 static image와 dynamic image로 구분할 수 있다.</p>\n<p>먼저, static image를 사용하는 방법을 보자.\ngatsby를 처음 설치하면 src/pages/index.js파일에 StaticImage 태그로 감싸진 부분을 볼 수 있다.\n이것과 같은 방식으로 사용하면 되는데, 이미지를 src/images같은 폴더에 넣어주고 StaticImage를 사용해주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import { StaticImage } from \"gatsby-plugin-image\"\n\nexport function Dino() {\n  return &lt;StaticImage src=\"../images/dino.png\" alt=\"A dinosaur\" />\n}</code></pre></div>\n<p>외부의 이미지를 사용할 땐 src부분에 url을 적어줘도 된다.</p>\n<p>StaticImage태그에는 아래와 같이 사용할 수 있는 여러 옵션이 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;StaticImage\n      src=\"../images/dino.png\"\n      alt=\"A dinosaur\"\n      placeholder=\"blurred\"\n      layout=\"fixed\"\n      width={200}\n      height={200}\n/></code></pre></div>\n<p>자세한 내용은 아래 사이트에서 확인할 수 있다.\n<a href=\"https://www.gatsbyjs.com/docs/reference/built-in-components/gatsby-plugin-image\">https://www.gatsbyjs.com/docs/reference/built-in-components/gatsby-plugin-image</a></p>\n<p>다음으로 Dynamic image를 사용하는 방법이다.\nDynamic image를 사용하기 위해서는 graphql로 이미지를 불러와야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">query {\n  blogPost(id: { eq: $Id }) {\n    title\n    body\n    author\n    avatar {\n      childImageSharp {\n        gatsbyImageData(\n          width: 200\n          placeholder: BLURRED\n          formats: [AUTO, WEBP, AVIF]\n        )\n      }\n    }\n  }\n}</code></pre></div>\n<p>이런식으로 graphql에서 image를 로딩하면 된다. 옵션도 줄 수 있다.\n이제 image를 표현하려면 getImage함수와 GatsbyImage태그를 사용하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"\\import\"><pre class=\"language-\\import\"><code class=\"language-\\import\">import { GatsbyImage, getImage } from &quot;gatsby-plugin-image&quot;\n\nfunction BlogPost({ data }) {\n  const image = getImage(data.blogPost.avatar)\n  return (\n    &lt;section&gt;\n      &lt;h2&gt;{data.blogPost.title}&lt;/h2&gt;\n      &lt;GatsbyImage image={image} alt={data.blogPost.author} /&gt;\n      &lt;p&gt;{data.blogPost.body}&lt;/p&gt;\n    &lt;/section&gt;\n  )\n}\n\nexport const pageQuery = graphql`\n  query {\n    blogPost(id: { eq: $Id }) {\n      title\n      body\n      author\n      avatar {\n        childImageSharp {\n          gatsbyImageData(\n            width: 200\n            placeholder: BLURRED\n            formats: [AUTO, WEBP, AVIF]\n          )\n        }\n      }\n    }\n  }\n`</code></pre></div>","frontmatter":{"thumbnail":"gatsby.jpg","categories":[{"mainCategory":"Area","subCategory":"blog"}],"date":"2022-10-02","slug":"/blog/gatsby05","title":"gatsby로 블로그 만들기 05"}}},{"node":{"html":"<p>component에서 graphql 데이터 불러오기</p>\n<p>우리는 src/pages에 있는 파일들에서 graphql을 사용할 때 아래와 같은 방법을 사용했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export const pageQuery = graphql`\n  query ($id: String!) {\n    markdownRemark(id: { eq: $id }) {\n      html\n      frontmatter {\n        date(formatString: \"MMMM DD, YYYY\")\n        title\n      }\n    }\n  }\n`</code></pre></div>\n<p>그러나 src/components의 component에서 위와같은 방법으로 접근하려 하면 오류가 발생한다. 따라서 우리는 gatsby에 포함돼 있는 useStaticQuery를 사용해서 graphql을 사용해야 한다. 예시를 한번 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import React from \"react\"\nimport { graphql, useStaticQuery, Link } from \"gatsby\"\nimport CategoryItem from \"./CategoryItem\"\nimport \"./CategoryList.scss\"\n\nconst CategoryList = ({ category }) => {\n  const data = useStaticQuery(graphql`\n    query {\n      allMarkdownRemark(sort: { order: DESC, fields: [frontmatter___date] }) {\n        edges {\n          node {\n            frontmatter {\n              thumbnail\n              categories\n              date\n              slug\n              title\n            }\n          }\n        }\n      }\n    }\n  `)\n  let { allMarkdownRemark } = data\n  let { edges } = allMarkdownRemark\n  edges = edges.filter(edge => edge.node.frontmatter.categories === category)\n\n  return (\n    &lt;div className=\"category-list\">\n      &lt;span className=\"name\">\n        &lt;Link to={`/${category}`}>{category}&lt;/Link>\n      &lt;/span>\n      &lt;div className=\"items\">\n        {edges.map((edge, i) => (\n          &lt;CategoryItem key={i} info={edge.node.frontmatter} />\n        ))}\n      &lt;/div>\n    &lt;/div>\n  )\n}\n\nexport default CategoryList\n</code></pre></div>\n<p>그냥 component안에서 return전에 useStaticQuery로 graphql을 사용하고 결과를 변수에 저장하면 변수를 통해서 모든 데이터에 접근할 수 있다.</p>\n<p>끝이다.</p>","frontmatter":{"thumbnail":"gatsby.jpg","categories":[{"mainCategory":"Area","subCategory":"blog"}],"date":"2022-10-01","slug":"/blog/gatsby04","title":"gatsby로 블로그 만들기 04"}}},{"node":{"html":"<p>카테고리 분류하기</p>\n<p>markdown으로 작성된 포스트를 읽는 페이지를 만드는 것까지 성공했다면, 카테고리를 구분하는 것도 매우 쉽게 가능하다.</p>\n<p>먼저, 우리가 작성했던 포스트의 frontmatter에 categories 필드를 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">slug: \"/blog/my-first-post\"\ndate: \"2021-04-09\"\ntitle: \"My first blog post\"\ncategories: \"algorithm\"</code></pre></div>\n<p>이렇게 해주는 것만으로도 우리는 이제 graphql을 이용해 categories필드의 내용을 불러올 수 있다.</p>\n<p>이제 {MarkdownRemark.frontmatter<strong>slug}.js를 만들 때와 마찬가지로 src/pages폴더에 {MarkdownRemark.frontmatter</strong>categories}.js 파일을 만들어주자. 이렇게 파일을 만들면 <a href=\"http://localhost:8000/%EC%B9%B4%ED%85%8C%EA%B3%A0%EB%A6%AC%EC%9D%B4%EB%A6%84\">http://localhost:8000/카테고리이름</a> 의 링크로 접속할 수 있다. {MarkdownRemark.frontmatter<strong>categories}.js안의 내용을 수정해서 페이지를 꾸며주기만 하면 된다.\n참고로 페이지에서 전달반은 카테고리의 이름은, props.params.frontmatter</strong>categories에 접근하면 값을 얻을 수 있다.</p>\n<p>예시로 내가 만든 {MarkdownRemark.frontmatter__categories}.js 코드를 올려놓겠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import { graphql } from \"gatsby\"\nimport * as React from \"react\"\nimport Layout from \"../components/layout\"\nimport CategoryItem from \"../components/CategoryItem\"\nimport \"./categories.scss\"\n\nexport default function BlogPostTemplate({ data, params }) {\n  let posts = data.allMarkdownRemark.edges.filter(\n    edge => edge.node.frontmatter.categories === params.frontmatter__categories\n  )\n  return (\n    &lt;Layout>\n      &lt;div className=\"category-page\">\n        &lt;span className=\"category-title\">{params.frontmatter__categories}&lt;/span>\n        &lt;div className=\"category-item-box\">\n          {posts.map((post, i) => (\n            &lt;CategoryItem\n              key={i}\n              info={post.node.frontmatter}\n              categoryPage={true}\n            />\n          ))}\n        &lt;/div>\n      &lt;/div>\n    &lt;/Layout>\n  )\n}\n\nexport const pageQuery = graphql`\n  query {\n    allMarkdownRemark(sort: { order: DESC, fields: [frontmatter___date] }) {\n      edges {\n        node {\n          frontmatter {\n            thumbnail\n            categories\n            date\n            slug\n            title\n          }\n        }\n      }\n    }\n  }\n`\n</code></pre></div>\n<p>간단히 설명하면 모든 포스트를 불러와서 category이름이 일치하는 것만 필터링하여 화면에 표시해줬다.</p>\n<p>마지막으로 다른 페이지에서 graphql을 사용해 categories에 접근하려면 아래의 구문을 통해서 중복없이 어떤 카테고리들이 있는지 뽑아올 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">query {\n    allMarkdownRemark(limit: 2000) {\n      group(field: frontmatter___categories) {\n        fieldValue\n        totalCount\n      }\n    }\n  }</code></pre></div>","frontmatter":{"thumbnail":"gatsby.jpg","categories":[{"mainCategory":"Area","subCategory":"blog"}],"date":"2022-09-30","slug":"/blog/gatsby03","title":"gatsby로 블로그 만들기 03"}}},{"node":{"html":"<p>카테고리 나누기, 글 페이지 만들기, scss적용, 이미지, component에서 graphql사용</p>\n<p>블로그 기능을 갖추기 위해서는 category를 나누는 기능과 markdown으로 작성한 글을 읽을 수 있는 페이지가 필요하다.</p>\n<ol>\n<li>글 읽는 페이지</li>\n</ol>\n<p>우리는 github page로 블로그를 호스팅하기 위해 markdown 형식으로 블로그의 글을 작성할 것이다. 그러기 위해선 우리가 markdown으로 쓴 글을 프로젝트의 폴더에 넣어놨을 때 그걸 읽어줄 페이지가 필요하다.\n<a href=\"https://www.gatsbyjs.com/docs/how-to/routing/adding-markdown-pages/\">https://www.gatsbyjs.com/docs/how-to/routing/adding-markdown-pages/</a>\n공식문서는 이 페이지에서 확인 가능하다.</p>\n<p>먼저,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install gatsby-source-filesystem\nnpm install gatsby-transformer-remark</code></pre></div>\n<p>으로 gatsby-source-filesystem와 gatsby-transformer-remark 설치해준다.\ngatsby-source-filesystem는 local의 filesystem을 gatsby 앱에 포함시켜주기 위해 사용되고, gatsby-transformer-remark는 markdown파일의 frontmatter metadata들을 인식시키고 내용을 html에 포함시켜준다.</p>\n<p>참고로 frontmatter이란 YAML로 markdown 파일을 작성하기전에 써주는\n\"---\"로 감싸진 내용을 말한다.</p>\n<p>이제 src폴더에 원하는 이름으로 markdown포스트들을 담을 폴더를 만들어준다. 나는 blog라는 이름으로 지어서 src/blog폴더를 만들었다.</p>\n<p>다음으로 gatsby-config.js 파일의 plugins 배열에 다음 내용을 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">plugins: [\n    {\n      resolve: `gatsby-source-filesystem`,\n      options: {\n        name: `blog`,\n        path: `${__dirname}/src/blog`,\n      },\n    },\n\t `gatsby-transformer-remark`,\n  ],</code></pre></div>\n<p>테스트를 위해 markdown 파일 하나를 src/blog폴더에 만들어보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">---\nslug: \"/blog/my-first-post\"\ndate: \"2022-04-09\"\ntitle: \"My first blog post\"\n---\nmy first post. 내 첫글.</code></pre></div>\n<p>위에서 말한 frontmatter까지 포함돼있다.</p>\n<p>이제 준비는 끝났다. 다음으로 src/pages폴더에 {MarkdownRemark.frontmatter<strong>slug}.js라는 이름의 파일을 만들어주자. 이 이름으로 파일을 만들면 gatsby가 markdown으로 작성된 글의 frontmatter에 포함된 slug의 내용을 읽어서 그 값에 맞는 주소로 페이지를 만들어 준다.\n{MarkdownRemark.frontmatter</strong>slug}.js의 내용은 공식 문서의 내용을 그대로 가져와서 써보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import React from \"react\"\nimport { graphql } from \"gatsby\"\nexport default function Template({\n  data, // this prop will be injected by the GraphQL query below.\n}) {\n  const { markdownRemark } = data // data.markdownRemark holds your post data\n  const { frontmatter, html } = markdownRemark\n  return (\n    &lt;div className=\"blog-post-container\">\n      &lt;div className=\"blog-post\">\n        &lt;h1>{frontmatter.title}&lt;/h1>\n        &lt;h2>{frontmatter.date}&lt;/h2>\n        &lt;div\n          className=\"blog-post-content\"\n          dangerouslySetInnerHTML={{ __html: html }}\n        />\n      &lt;/div>\n    &lt;/div>\n  )\n}\nexport const pageQuery = graphql`\n  query ($id: String!) {\n    markdownRemark(id: { eq: $id }) {\n      html\n      frontmatter {\n        date(formatString: \"MMMM DD, YYYY\")\n        slug\n        title\n      }\n    }\n  }\n`\n</code></pre></div>\n<p>끝이다. 이제 <a href=\"http://localhost:8000/blog/my-first-post/%EB%A1%9C\">http://localhost:8000/blog/my-first-post/로</a> 접속하면 아래와 같이 뜰것이다.\n(이미지)</p>\n<p>간혹 옛날에 쓴 블로그들의 글을 보면 gatsby-node.js의 내용을 수정해서 글 페이지를 만들던데, 검색해본 결과 그 방법은 이제 사용하지 않는 것 같다. 나도 옛날 글들을 보고 헷갈려서 많이 헤맸었다.</p>\n<p>위의 코드를 보면 export const pageQuery부분에 graphql을 사용한 것을 볼 수 있다. gatsby에서는 graphql을 사용해서 데이터를 가져온다고 한다. 나도 graphql은 간단하게만 공부해서 자세히 모른지만 gatsby에서 사용하는데 문제는 없었다. 저런식으로 graphql구문을 export해주면 component의 props로 값이 전달된다. 위 예에서는</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">props.data.markdownRemark.frontmatter\nprops.data.markdownRemark.html</code></pre></div>\n<p>로 markdown파일의 내용에 접근할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm run develop</code></pre></div>\n<p>을 실행한 후, <a href=\"http://localhost:8000/%5C_%5C_%5C_graphql\">http://localhost:8000/\\_\\_\\_graphql</a> 에 접속하면 graphql로 접속할 수 있는 데이터들을 전부 볼 수 있고 grapgql구문도 만들어주니 한번씩 확인해보는 것이 좋다.</p>\n<p>추가로 src/pages가 아닌 src/components에서 위의 문법처럼 graphql에 접근하면 오류가 발생하므로 다른 방법으로 접근해야 하는데 다음에 설명하겠다. 다음 포스트에서는 카테고리를 만드는 방법에 대해 설명해보겠다.</p>","frontmatter":{"thumbnail":"gatsby.jpg","categories":[{"mainCategory":"Area","subCategory":"blog"}],"date":"2022-09-29","slug":"/blog/gatsby02","title":"gatsby로 블로그 만들기 02"}}},{"node":{"html":"<p>이전에 github pages와 jekyll을 이용해서 블로그를 만든적이 있는데, 글을 안쓴지 좀 오래됐다. 앞으로 다시 포스팅을 작성하려 하는데 그 전에 블로그를 한번 리메이크 하고 싶었다. jekyll로 만든 블로그를 그냥 수정해서 사용해도 되지만, 그동안 react에 대해 많이 공부하기도 했고, gatsby가 더 좋다는 말을 어디선가 들어서 이 참에 gatsby로 블로그를 만들어 보기로 했다.\ngatsby에 대해 아예 백지 상태에서 진행해야 됐기 때문에 좀 애를 먹었지만, 공식 문서가 나름 따라하기 쉽게 돼있어서 적당히 구글링 하며 만들었더니 3일 정도만에 나름 블로그 형태를 갖춘 블로그를 만들 수 있었다.(디자인은 하지 않았지만..)\n공식문서는 전부 영어로 작성되어 있었고 한글 자료는 많지 않았어서 내가 블로그를 만들었던 과정을 한번 기록해보려 한다.</p>\n<ol>\n<li>설치</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install -g gatsby-cli</code></pre></div>\n<p>기존에 만들어져 있는 테마를 사용하려면 아래 방법으로 프로젝트를 만들고,</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gatsby new \"폴더 이름\" \"테마 경로\"</code></pre></div>\n<p>처음부터 본인이 만드려면 아래 방법으로 프로젝트를 만들면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gatsby new \"폴더 이름\"</code></pre></div>\n<p>나는 처음부터 만들고 싶어서 후자의 방법을 선택했다.</p>\n<p>위 과정을 끝내면 다음과 같은 파일 구조가 만들어진다.\n(이미지)</p>\n<ol start=\"2\">\n<li>\n<p>실행\ncd \"폴더이름\" 으로 생성된 폴더로 이동한 다음, gatsby develop을 실행하면 로컬에서 개발상황을 확인할 수 있다.\n실행하면 cmd창에\n<a href=\"http://localhost:8000/\">http://localhost:8000/</a>\n<a href=\"http://localhost:8000/%5C_%5C_%5C_graphql\">http://localhost:8000/\\_\\_\\_graphql</a>\n이렇게 두 개의 주소가 안내된다.\n첫번째 주소로 개발 상황을 확인할 수 있고, 두번째 주소로 graphql로 가져올 수 있는 데이터의 구조를 확인할 수 있다.</p>\n</li>\n<li>\n<p>구조\n설치된 폴더의 구조를 간단히 살펴보자. 먼저, src/pages폴더의 page-2.js, using-ssr.js파일은 지워줘도 상관없다.\n우리는 src/components의 header.js, layout.js와 src/pages의 index.js정도를 수정하고 몇개의 파일을 추가해서 블로그를 만들것이다.</p>\n</li>\n</ol>\n<p>gatsby에서는 src/pages폴더에 파일을 추가하면 그 파일의 이름이 url의 경로가 된다. 예를들어 src/pages/hello.js 파일을 생성하면 <a href=\"http://localhost:8000//hello%EB%A1%9C\">http://localhost:8000//hello로</a> 접속했을 때 이 페이지의 내용이 표시된다. next.js를 사용해 봤다면 쉽게 적응할 수 있을 것이다.</p>\n<p>먼저, layout.js는 말그대로 이를 사용한 모든 페이지에 적용되는 레이아웃이다. props로 children을 받아 return하기 때문에</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;Layout>\n\tcontents\n&lt;/Layout></code></pre></div>\n<p>이와같은 형태로 page를 작성하면 contents부분이 Layout component의 {children}부분에 들어간다. 이 component에 모든 페이지에 적용될 것들을 넣어두면 중복하여 작성하지 않아도 된다.</p>\n<p>다음으로, header.js는 말그대로 페이지의 header부분을 나타낸다. react를 사용해서 꾸미고 싶은 header 형태로 꾸며주면 된다. 기본적으로 layout.js에 포함돼있기 때문에 모든 페이지에 표시된다.</p>\n<p>마지막으로 index.js는 처음 내 블로그에 접속했을 때 보여질 페이지이다. 위에서 설명했던 것처럼</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&lt;Layout>\n\tcontents\n&lt;/Layout></code></pre></div>\n<p>구조이기 때문에 Layout 태그 안의 내용을 수정하여 꾸미면 된다.</p>","frontmatter":{"thumbnail":"gatsby.jpg","categories":[{"mainCategory":"Area","subCategory":"blog"}],"date":"2022-09-28","slug":"/blog/gatsby01","title":"gatsby로 블로그 만들기 01"}}}]}}}