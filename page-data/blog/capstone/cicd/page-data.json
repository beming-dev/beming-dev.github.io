{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-tsx","path":"/blog/capstone/cicd/","result":{"data":{"markdownRemark":{"html":"<h1>Argo CD</h1>\n<p>ArgoCDëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„ ì–¸ì  ë©”ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ Git ì €ì¥ì†Œì— ë‘ê³ , í´ëŸ¬ìŠ¤í„° ìƒíƒœë¥¼ Gitì— ì €ì¥ëœ ìƒíƒœì™€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¹„êµí•˜ê³  ë™ê¸°í™” í•´ ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. Git commitë§Œìœ¼ë¡œ ë°°í¬, ë¡¤ë°±, ë“œë¦¬í”„íŠ¸ ê°ì§€ ë“±ì˜ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</p>\n<p>Kubernetes ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìë™ ë°°í¬ë¥¼ ìœ„í•œ CD íˆ´ë¡œ, Helmë˜ëŠ” Kustomizeë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>\n<p>Gitì €ì¥ì†Œë¥¼ ë‹¨ì¼ ì¶œì²˜ë¡œ ì‚¼ì•„, ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ Gitì— ë‘ë©´, ArgoCDê°€ ì£¼ê¸°ì ìœ¼ë¡œ Gitì—ì„œ desired stateë¥¼ ê°€ì ¸ì™€ í´ëŸ¬ìŠ¤í„°ì˜ live stateì™€ ë¹„êµí•˜ê³ , ì°¨ì´ê°€ ìˆë‹¤ë©´ kubectl apply, kubectl deleteì™€ ê°™ì€ ëª…ë ¹ìœ¼ë¡œ ìë™ ë™ê¸°í™”ë¥¼ í•©ë‹ˆë‹¤.</p>\n<hr>\n<h1>ê³¼ì • ê¸°ë¡</h1>\n<p>ì•„ë˜ëŠ” ì œê°€ git, ArgoCDë¥¼ ì´ìš©í•´ CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì„±í•œ ë°©ë²•ì…ë‹ˆë‹¤.\nSpring backend ë°°í¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.</p>\n<h2>Git Repository ì¤€ë¹„</h2>\n<p>ë¨¼ì €, ë‘ê°€ì§€ì˜ Git Repositoryê°€ ì¤€ë¹„ë¼ì•¼ í•©ë‹ˆë‹¤.</p>\n<ul>\n<li>ë°±ì—”ë“œ Repository</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">backend<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\nâ”œâ”€â”€ <span class=\"token punctuation\">.</span>github<span class=\"token operator\">/</span>\nâ”‚\tâ””â”€â”€ workflows<span class=\"token operator\">/</span>\nâ”‚\t\tâ””â”€â”€ ci<span class=\"token operator\">-</span>cd<span class=\"token punctuation\">.</span>yml\nâ”œâ”€â”€ src<span class=\"token operator\">/</span>â€¦           # Spring Boot ì†ŒìŠ¤\nâ”œâ”€â”€ pom<span class=\"token punctuation\">.</span>xml\nâ””â”€â”€ Dockerfile</code></pre></div>\n<p>Docker imageê°€ ë¹Œë“œ ë˜ëŠ” Dockerfileê³¼, github actionì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” yamlíŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>\n<ul>\n<li>ci/cdìš© repo</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">infra<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\nâ”œâ”€â”€ argocd<span class=\"token operator\">/</span>\nâ”‚   â”œâ”€â”€ backend<span class=\"token operator\">-</span>app<span class=\"token punctuation\">.</span>yaml\nâ”œâ”€â”€ <span class=\"token keyword\">base</span><span class=\"token operator\">/</span>\nâ”‚   â”œâ”€â”€ backend<span class=\"token operator\">-</span>deployment<span class=\"token punctuation\">.</span>yaml\nâ”‚   â”œâ”€â”€ backend<span class=\"token operator\">-</span>service<span class=\"token punctuation\">.</span>yaml\nâ”‚   â””â”€â”€ kustomization<span class=\"token punctuation\">.</span>yaml\nâ”‚   â””â”€â”€ <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">.</span>yaml\nâ””â”€â”€ overlays<span class=\"token operator\">/</span>\n    â””â”€â”€ production<span class=\"token operator\">/</span>\n\t    â””â”€â”€ patches<span class=\"token operator\">/</span>\n\t\tâ”‚   â””â”€â”€ backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml\n\t\tâ”‚   â””â”€â”€ backend<span class=\"token operator\">-</span>replicas<span class=\"token punctuation\">.</span>yaml\n        â””â”€â”€ kustomization<span class=\"token punctuation\">.</span>yaml\n        â””â”€â”€ sealedsecret<span class=\"token operator\">-</span>backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml</code></pre></div>\n<h2>ë¨¼ì €, CI íŒŒì´í”„ë¼ì¸ì„ ì„¤ì •í•´ë´…ì‹œë‹¤.</h2>\n<p>backend repositoryì˜ ci-cd.yamlíŒŒì¼ì— ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># .github/workflows/backend-deploy.yml</span>\n\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Backend CI/CD Pipeline\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>main<span class=\"token punctuation\">]</span>\n    <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"backend/**\"</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># 1. ì†ŒìŠ¤ ì½”ë“œ ì²´í¬ì•„ì›ƒ</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout code\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n\n      <span class=\"token comment\"># 2. Docker Buildx ì„¤ì • (ìµœì‹  ë²„ì „ ì‚¬ìš©)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up Docker Buildx\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/setup<span class=\"token punctuation\">-</span>buildx<span class=\"token punctuation\">-</span>action@v3\n\n      <span class=\"token comment\"># 3. Docker Hub ë¡œê·¸ì¸ (ì‹œí¬ë¦¿ ì´ë¦„ì€ ì‹¤ì œ ì„¤ì •ì— ë§ê²Œ í™•ì¸)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Login to Docker Hub\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/login<span class=\"token punctuation\">-</span>action@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_USERNAME <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># ë˜ëŠ” secrets.DOCKER_USER</span>\n          <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.DOCKERHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># ë˜ëŠ” secrets.DOCKER_TOKEN</span>\n\n      <span class=\"token comment\"># 4. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ (context ê²½ë¡œ ìˆ˜ì •)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build &amp; Push image\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> docker/build<span class=\"token punctuation\">-</span>push<span class=\"token punctuation\">-</span>action@v5\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">context</span><span class=\"token punctuation\">:</span> ./backend/chatirumae <span class=\"token comment\"># &lt;-- backend ë””ë ‰í† ë¦¬ë¥¼ ë¹Œë“œ ì»¨í…ìŠ¤íŠ¸ë¡œ ëª…ì‹œ</span>\n          <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n          <span class=\"token key atrule\">tags</span><span class=\"token punctuation\">:</span> beming/chat<span class=\"token punctuation\">-</span>irumae<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">:</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n      <span class=\"token comment\"># 5. GitOps(Infra) ë¦¬í¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout infra repo\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">repository</span><span class=\"token punctuation\">:</span> ChatIrumae/gitops\n          <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.INFRA_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># GitOps ë¦¬í¬ì§€í† ë¦¬ì— push ê¶Œí•œì´ ìˆëŠ” í† í°</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> infra\n\n      <span class=\"token comment\"># 6. yq ì„¤ì¹˜ (ë§¤ìš° ì¤‘ìš”!)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install yq\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> mikefarah/yq@v4.34.1 <span class=\"token comment\"># yq ì„¤ì¹˜ ì•¡ì…˜ ì‚¬ìš©</span>\n\n      <span class=\"token comment\"># 7. Kustomize ì´ë¯¸ì§€ íƒœê·¸ ì—…ë°ì´íŠ¸ (yq ì‹¤í–‰)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Kustomize image tag\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cd infra/base/backend</span>\n\n          REPO_NAME=$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.event.repository.name <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          IMAGE_NAME=\"beming/chat<span class=\"token punctuation\">-</span>irumae<span class=\"token punctuation\">-</span>backend\"\n          NEW_TAG=$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n          echo \"ğŸ”§ Updating image $IMAGE_NAME to tag $NEW_TAG\"\n\n          <span class=\"token comment\"># yqë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ íƒœê·¸ ì—…ë°ì´íŠ¸</span>\n          yq e '(.images<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">|</span> select(.name == \"'\"$IMAGE_NAME\"'\") ).newTag = \"'\"$NEW_TAG\"'\"' <span class=\"token punctuation\">-</span>i kustomization.yaml\n\n          echo \"âœ… Diff after update<span class=\"token punctuation\">:</span>\"\n          git <span class=\"token punctuation\">-</span>C ../../.. diff <span class=\"token comment\"># infra ë£¨íŠ¸ì—ì„œ diff ì‹¤í–‰</span>\n\n      <span class=\"token comment\"># 8. ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ (git add ê²½ë¡œ ìˆ˜ì •)</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Commit &amp; Push infra changes\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          cd infra\n          git config user.name \"github-actions[bot]\"\n          git config user.email \"github-actions[bot]@users.noreply.github.com\"\n          git add base/backend/kustomization.yaml # &lt;-- ìˆ˜ì •í•œ íŒŒì¼ë§Œ ëª…ì‹œì ìœ¼ë¡œ add</span>\n\n          <span class=\"token comment\"># ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹</span>\n          if <span class=\"token tag\">!</span> git diff <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>staged <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>quiet; then\n            <span class=\"token key atrule\">git commit -m \"chore(backend)</span><span class=\"token punctuation\">:</span> Bump $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.repository <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> image to $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.sha <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\"\n            git push\n          else\n            echo \"No changes to commit.\"\n          fi\n</code></pre></div>\n<p>ìœ„ yamlíŒŒì¼ì„ ê°„ë‹¨íˆ ì„¤ëª…í•˜ë©´, main ë¸Œëœì¹˜ì— ì½”ë“œê°€ push ë˜ë©´, \bDockerfileì„ buildí•˜ì—¬ Docker hubì— pushí•©ë‹ˆë‹¤.</p>\n<p>ê·¸ëŸ° ë‹¤ìŒ, ci-cd repositoryë¡œ ì´ë™í•œ í›„, ë°©ê¸ˆ pushí•œ ì´ë¯¸ì§€ì˜ íƒœê·¸ê°’ì„ kustomization.yamlíŒŒì¼ì— ì•Œë ¤ì£¼ë©° í•´ë‹¹ repositoryì— ì»¤ë°‹ì„ ë„£ìŠµë‹ˆë‹¤.</p>\n<p>ì´ ì»¤ë°‹ì€ ë‚˜ì¤‘ì— argoCDë¥¼ íŠ¸ë¦¬ê±°í•˜ëŠ” ì—­í• ì„ í•  ê²ƒì…ë‹ˆë‹¤.</p>\n<p>ì´ ê³¼ì •ì—ì„œ ì„¸ê°€ì§€ í™˜ê²½ë³€ìˆ˜ë¥¼ git backend repositoryì— ë“±ë¡í•´ì•¼ í•©ë‹ˆë‹¤.</p>\n<ul>\n<li>DOCKER_USER: Docker hub username</li>\n<li>DOCKER_TOKEN: Docker hubì—ì„œ ë°œê¸‰í•´ì£¼ëŠ” í† í°</li>\n<li>INFRA_TOKEN: gitì—ì„œ ë°œê¸‰ë°›ì€ ci-cd repositoryì— ì ‘ê·¼ ê°€ëŠ¥í•œ í† í°</li>\n</ul>\n<p>INFRA_TOKENì€ git profile í´ë¦­ -> settings -> developer settings -> personal access tokens -> Tokens(classic)ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<p>í™˜ê²½ë³€ìˆ˜ëŠ” backend repositoryì— ì ‘ì† í›„, setting -> Secrets and Variables -> actions ì—ì„œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<h2>ArgoCDë¥¼ ì„¤ì •í•´ë´…ì‹œë‹¤.</h2>\n<p>ì´ì œ kubernetesê°€ ì„¤ì¹˜ë¼ìˆëŠ”, kubectl ëª…ë ¹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•©ë‹ˆë‹¤.</p>\n<p>kubernetesì— argoCDë¥¼ ì„¤ì¹˜í•´ì¤ì‹œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 1) Argo CD ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±</span>\nkubectl create namespace argocd\n\n<span class=\"token comment\"># 2) Argo CD ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì¹˜</span>\nkubectl apply <span class=\"token parameter variable\">-n</span> argocd <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-f</span> https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\n\n<span class=\"token comment\"># 3) ì„œë²„ ì ‘ê·¼ì„ ìœ„í•´ í¬íŠ¸í¬ì›Œë”© (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©)</span>\nkubectl <span class=\"token parameter variable\">-n</span> argocd port-forward svc/argocd-server <span class=\"token number\">8080</span>:443</code></pre></div>\n<p>ì´ì œ public_ip:8080 ë²ˆ í¬íŠ¸ë¡œ ì ‘ì†í•˜ë©´ argoCDì˜ ë¡œê·¸ì¸ ì°½ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në¬¼ë¡  ì¸ìŠ¤í„´ìŠ¤ì˜ ë°©í™”ë²½ì—ì„œ 8080ë²ˆ í¬íŠ¸ê°€ í—ˆìš©ë¼ìˆì–´ì•¼ í•©ë‹ˆë‹¤.</p>\n<p>ì´ˆê¸° IDê°’ì€ adminì´ê³ ,\në¹„ë°€ë²ˆí˜¸ëŠ” ì•„ë˜ì˜ ëª…ë ¹ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># admin ë¹„ë°€ë²ˆí˜¸ = Argo CD server Pod ì´ë¦„</span>\nkubectl <span class=\"token parameter variable\">-n</span> argocd get pods <span class=\"token parameter variable\">-l</span> app.kubernetes.io/name<span class=\"token operator\">=</span>argocd-server <span class=\"token parameter variable\">-o</span> name <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d<span class=\"token string\">'/'</span> <span class=\"token parameter variable\">-f2</span>\n\n<span class=\"token comment\"># ì•ˆë˜ë©´ ì•„ë˜ì˜ ë°©ë²•ì„ ì‚¬ìš©</span>\nargocd admin initial-password <span class=\"token parameter variable\">-n</span> argocd</code></pre></div>\n<p>ë¡œê·¸ì¸ì— ì„±ê³µí–ˆë‹¤ë©´, ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n![[Pasted image 20250714114029.png]]</p>\n<h2>ì´ì œ cicd repositoryì˜ ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •ì„ í•´ë´…ì‹œë‹¤.</h2>\n<p>ì•„ê¹Œì „ì— ì•„ë˜ì™€ ê°™ì´ ê½¤ ë³µì¡í•œ êµ¬ì¡°ë¥¼ êµ¬ì„±í•´ë’€ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">infra<span class=\"token operator\">-</span>repo<span class=\"token operator\">/</span>\nâ”œâ”€â”€ argocd<span class=\"token operator\">/</span>\nâ”‚   â”œâ”€â”€ backend<span class=\"token operator\">-</span>app<span class=\"token punctuation\">.</span>yaml\nâ”œâ”€â”€ <span class=\"token keyword\">base</span><span class=\"token operator\">/</span>\nâ”‚   â”œâ”€â”€ backend<span class=\"token operator\">-</span>deployment<span class=\"token punctuation\">.</span>yaml\nâ”‚   â”œâ”€â”€ backend<span class=\"token operator\">-</span>service<span class=\"token punctuation\">.</span>yaml\nâ”‚   â””â”€â”€ kustomization<span class=\"token punctuation\">.</span>yaml\nâ”‚   â””â”€â”€ <span class=\"token keyword\">namespace</span><span class=\"token punctuation\">.</span>yaml\nâ””â”€â”€ overlays<span class=\"token operator\">/</span>\n    â””â”€â”€ production<span class=\"token operator\">/</span>\n\t    â””â”€â”€ patches<span class=\"token operator\">/</span>\n\t\tâ”‚   â””â”€â”€ backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml\n\t\tâ”‚   â””â”€â”€ backend<span class=\"token operator\">-</span>replicas<span class=\"token punctuation\">.</span>yaml\n        â””â”€â”€ kustomization<span class=\"token punctuation\">.</span>yaml\n        â””â”€â”€ sealedsecret<span class=\"token operator\">-</span>backend<span class=\"token operator\">-</span>env<span class=\"token punctuation\">.</span>yaml</code></pre></div>\n<p>ë¨¼ì €, argoCDì˜ ì§„ì…ì ì€ /overlays/production/kustomization.yaml íŒŒì¼ì…ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization\n<span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ../../../base/backend\n  <span class=\"token punctuation\">-</span> sealedsecret<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>env.yaml\n<span class=\"token key atrule\">patches</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>replicas.yaml\n    <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env.yaml\n    <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n</code></pre></div>\n<p>ì´ íŒŒì¼ì„ ë¡œë“œí•˜ë©´ì„œ</p>\n<ul>\n<li><code class=\"language-text\">resources</code> ë¡œ ì§€ì •ëœ <code class=\"language-text\">../../../base</code> ë””ë ‰í† ë¦¬ì™€</li>\n<li><code class=\"language-text\">sealedsecret-backend-env.yaml</code> ì„ ìˆœì„œëŒ€ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.</li>\n</ul>\n<p>ê·¸ëŸ° ë‹¤ìŒ, /base/kustomization.yamlì— ìˆëŠ” íŒŒì¼ì„ ì½ìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> backend<span class=\"token punctuation\">-</span>deploy.yaml\n  <span class=\"token punctuation\">-</span> backend<span class=\"token punctuation\">-</span>svc.yaml\n  <span class=\"token punctuation\">-</span> namespace.yaml\n\n<span class=\"token key atrule\">images</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> beming/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>back\n    <span class=\"token key atrule\">newTag</span><span class=\"token punctuation\">:</span> placeholder<span class=\"token punctuation\">-</span>backend\n\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kustomize.config.k8s.io/v1beta1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Kustomization</code></pre></div>\n<ul>\n<li><code class=\"language-text\">backend-deploy.yaml</code>, <code class=\"language-text\">backend-svc.yaml</code>, <code class=\"language-text\">namespace.yaml</code> ì„ ì°¨ë¡€ë¡œ ì½ìŠµë‹ˆë‹¤.</li>\n<li><code class=\"language-text\">images</code> ë¸”ë¡ì— ë”°ë¼ Deploymentì˜ <code class=\"language-text\">image:</code> í•„ë“œë¥¼ ì¹˜í™˜í•˜ëŠ”ë°, ì´ ë•Œ tagê°’ì€ ì•„ê¹Œì „ì˜ github actionì—ì„œ ì¹˜í™˜í•˜ì—¬ commitì„ ë„£ì–´ì¤ë‹ˆë‹¤.</li>\n</ul>\n<p>/base/backend-deploy.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token comment\"># baseì—ì„œëŠ” 1ë¡œ ë‘ê³ , overlaysì—ì„œ í”„ë¡œë•ì…˜/ìŠ¤í…Œì´ì§• ë³µì œ ìˆ˜ ì¡°ì •</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># CIì—ì„œ placeholder-backendë¥¼ ì‹¤ì œ SHA/tagë¡œ êµì²´í•©ë‹ˆë‹¤</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> beming/chat<span class=\"token punctuation\">-</span>irumae<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">:</span>placeholder<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># envFrom:</span>\n          <span class=\"token comment\">#   - secretRef:</span>\n          <span class=\"token comment\">#       name: backend-env</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3001</span>\n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http\n          <span class=\"token comment\"># ì„ íƒ: í—¬ìŠ¤ì²´í¬</span>\n          <span class=\"token comment\"># readinessProbe:</span>\n          <span class=\"token comment\">#   httpGet:</span>\n          <span class=\"token comment\">#     path: /actuator/health</span>\n          <span class=\"token comment\">#     port: http</span>\n          <span class=\"token comment\">#   initialDelaySeconds: 20</span>\n          <span class=\"token comment\">#   periodSeconds: 10</span>\n          <span class=\"token comment\"># livenessProbe:</span>\n          <span class=\"token comment\">#   httpGet:</span>\n          <span class=\"token comment\">#     path: /actuator/health</span>\n          <span class=\"token comment\">#     port: http</span>\n          <span class=\"token comment\">#   initialDelaySeconds: 60</span>\n          <span class=\"token comment\">#   periodSeconds: 20</span>\n          <span class=\"token comment\"># ì„ íƒ: ë¦¬ì†ŒìŠ¤ ìš”ì²­Â·ì œí•œ</span>\n          <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"100m\"</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"128Mi\"</span>\n            <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n              <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"500m\"</span>\n              <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"512Mi\"</span>\n</code></pre></div>\n<p>/base/spring-svc.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>service\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3001</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3001</span>\n      <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30081</span></code></pre></div>\n<p>/base/namespace.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"apiversion:v1\"><pre class=\"language-apiversion:v1\"><code class=\"language-apiversion:v1\">kind: Namespace\nmetadata:\n  name: backend-namespace</code></pre></div>\n<p>/patches/backend-env.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spring-backend # base/backend-deploy.yaml ì˜ metadata.name ê³¼ ë°˜ë“œì‹œ ì¼ì¹˜\nspec:\n  template:\n    metadata:\n      # (ì„ íƒ) í”„ë¡œë•ì…˜ í™˜ê²½ì„ ë‚˜íƒ€ë‚´ëŠ” ë¼ë²¨ ì¶”ê°€\n      labels:\n        environment: production\n    spec:\n      containers:\n        - name: spring-backend # base ì˜ container name ê³¼ ì¼ì¹˜\n          # 1) í”„ë¡œë•ì…˜ í”„ë¡œíŒŒì¼ í™œì„±í™”ë¥¼ ìœ„í•œ í™˜ê²½ë³€ìˆ˜\n          env:\n            - name: SPRING_PROFILES_ACTIVE\n              value: production\n            - name: JAVA_OPTS\n              value: \"-Xms512m -Xmx1g\"\n          # 2) ë¦¬ì†ŒìŠ¤ ìš”ì²­(requests) / ì œí•œ(limits)\n          resources:\n            requests:\n              cpu: \"500m\"\n              memory: \"512Mi\"\n            limits:\n              cpu: \"1\"\n              memory: \"1Gi\"</code></pre></div>\n<p>/patches/backend-replicas.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: spring-backend # base/backend-deploy.yaml ì— ì •ì˜ëœ Deployment ì´ë¦„ê³¼ ë™ì¼í•´ì•¼ í•©ë‹ˆë‹¤\nspec:\n  replicas: 3 # í”„ë¡œë•ì…˜ì—ì„œ ì›í•˜ëŠ” ë³µì œë³¸ ìˆ˜\n</code></pre></div>\n<p>ì•„ë˜ëŠ” GPTê°€ ê·¸ë ¤ì¤€ ëŒ€ëµì ì¸ ê³¼ì •ì…ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 1. Git í´ë¡  ë° overlays/production ë¡œ ì§„ì…\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 2. Kustomize load overlays/...    â”‚\nâ”‚    â”œâ”€â”€ import base/ (resources)    â”‚\nâ”‚    â””â”€â”€ import sealedsecret...      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 3. base/kustomization.yaml ì ìš©   â”‚\nâ”‚    â”œâ”€ backend-deploy.yaml      â”‚\nâ”‚    â”œâ”€ backend-svc.yaml         â”‚\nâ”‚    â””â”€ namespace.yaml               â”‚\nâ”‚    + images.newTag ì¹˜í™˜            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 4. overlays/sealedsecret ì¶”ê°€     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 5. patches ë³‘í•©                   â”‚\nâ”‚    - replicas ë³€ê²½                â”‚\nâ”‚    - envFrom secretRef ì¶”ê°€       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 6. ìµœì¢… ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì¶œë ¥            â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â†“\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ 7. Argo CDê°€ kubectl apply (sync) â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n</code></pre></div>\n<h2>í™˜ê²½ë³€ìˆ˜ ì§€ì •</h2>\n<p>ì œê°€ ê°€ì¥ ì• ë¨¹ì—ˆë˜ ë¶€ë¶„ì€ ë°”ë¡œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì§€ì •í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.\ní™˜ê²½ë³€ìˆ˜ê°€ public repositoryì— ë…¸ì¶œë˜ì§€ ì•Šìœ¼ë©´ì„œ, ArgoCDì— ì•Œë ¤ì¤„ ìˆ˜ ìˆëŠ” ê·¸ëŸ° ë°©ë²•ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.</p>\n<p>ìœ„ì˜ ê³ ë¯¼ì„ í•´ê²°í•˜ê¸° ìœ„í•´, Sealed Secret Controllerë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.\në¨¼ì € ì•„ë˜ì™€ ê°™ì´ Sealed Secret Controllerë¥¼ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl apply <span class=\"token punctuation\">\\</span>\n  <span class=\"token parameter variable\">-f</span> https://github.com/bitnami-labs/sealed-secrets/releases/latest/download/controller.yaml</code></pre></div>\n<p>ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ìœ¼ë¡œ secretíŒŒì¼ì„ ìƒì„±í•´ì¤ë‹ˆë‹¤.</p>\n<p>secret-plain.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env\n  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>namespace\n<span class=\"token key atrule\">stringData</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">FRONT_BASE_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"https://beming-stock.kro.kr\"</span>\n  <span class=\"token key atrule\">JWT_SECRET</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"randomstrlongerthan32fortestdonotusethisvalue\"</span></code></pre></div>\n<p>ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ Sealed Secretì„ ìƒì„±í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubeseal <span class=\"token parameter variable\">--format</span> yaml <span class=\"token punctuation\">\\</span>\n  <span class=\"token operator\">&lt;</span> secret-plain.yaml <span class=\"token operator\">></span> sealedsecret.yaml</code></pre></div>\n<p>ì´ì œ ê²°ê³¼ë¡œ ì•”í˜¸í™”ëœ sealedsecretíŒŒì¼ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•´ë‹¹íŒŒì¼ì„ í”„ë¡œì íŠ¸ì˜ /overlays/production ë°‘ì— ìœ„ì¹˜ì‹œì¼œì¤ë‹ˆë‹¤.</p>\n<p>ê·¸ í›„, /overlays/production/kustomization.yamlì˜ resourcesì—,\nsealedsecret.yaml ê³¼ ê°™ì´ ë“±ë¡í•´ì¤ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> ../../base\n  <span class=\"token punctuation\">-</span> sealedsecret<span class=\"token punctuation\">-</span>backend<span class=\"token punctuation\">-</span>env.yaml</code></pre></div>\n<p>ë§ˆì§€ë§‰ìœ¼ë¡œ, backend-env.yamlíŒŒì¼ì— secret ì´ë¦„ì„ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> spring<span class=\"token punctuation\">-</span>backend\n          <span class=\"token comment\"># CIì—ì„œ placeholder-backendë¥¼ ì‹¤ì œ SHA/tagë¡œ êµì²´í•©ë‹ˆë‹¤</span>\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> beming/stock<span class=\"token punctuation\">-</span>simulator<span class=\"token punctuation\">-</span>back<span class=\"token punctuation\">:</span>placeholder<span class=\"token punctuation\">-</span>backend\n          <span class=\"token key atrule\">envFrom</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">secretRef</span><span class=\"token punctuation\">:</span>\n                <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> backend<span class=\"token punctuation\">-</span>env</code></pre></div>\n<p>ì´ì œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ í™˜ê²½ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.</p>\n<p>ëª¨ë“  ê³¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´, ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n![[Pasted image 20250714134954.png]]</p>\n<h2>ë°°í¬ í™•ì¸</h2>\n<p>ì„±ê³µì ìœ¼ë¡œ ë°°í¬ëë‹¤ë©´ apië¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆì–´ì•¼ê² ì£ ?</p>\n<p>ì €í¬ëŠ” serviceë¥¼ ìƒì„±í•˜ëŠ” backend.svc.yaml íŒŒì¼ì—ì„œ, 30080ë²ˆ í¬íŠ¸ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œì‹œì¼°ìŠµë‹ˆë‹¤.</p>\n<p>ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ EXTERNAL_IPê°’ì„ í™•ì¸í•´ì¤ì‹œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl get services <span class=\"token parameter variable\">-n</span> backend-namespace\n\n<span class=\"token comment\"># ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.</span>\nNAME TYPE CLUSTER-IP EXTERNAL-IP PORT<span class=\"token punctuation\">(</span>S<span class=\"token punctuation\">)</span> AGE\nspring-backend NodePort <span class=\"token number\">10.107</span>.223.38 <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span> <span class=\"token number\">80</span>:30080/TCP 3h31m</code></pre></div>\n<p>ì €ì˜ ê²½ìš°ëŠ” EXTERNAL_IPê°€ ë¹„ì–´ìˆëŠ”ë°, ì´ëŸ° ê²½ìš°ëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ publicIPë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ ë©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl http://${EXTERNAL_IP}:30080/actuator/health</code></pre></div>\n<p>ìœ„ì˜ ê²°ê³¼ë¡œ ì œëŒ€ë¡œ ëœ ì‘ë‹µì´ ì˜¨ë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤. ì´ì œ ë°±ì—”ë“œë¥¼ kubernetesì— ìë™ìœ¼ë¡œ ë°°í¬í•˜ëŠ” CI/CíŒŒì´í”„ë¼ì¸ì´ êµ¬ì„±ëìŠµë‹ˆë‹¤.</p>\n<h1>íŠ¸ëŸ¬ë¸” ìŠˆíŒ…</h1>\n<h2>ArgoCDê°€ ì ‘ì†ì´ ë˜ì§€ ì•ŠìŒ</h2>\n<p>ì²˜ìŒì— ArgoCDë¡œ í¬íŠ¸í¬ì›Œë”©ì´ ì œëŒ€ë¡œ ë˜ì§€ ì•Šì•„ ì ‘ì†ì´ ë¶ˆê°€í–ˆìŠµë‹ˆë‹¤.</p>\n<p>í•´ê²°ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>\n<ul>\n<li>ì¸ìŠ¤í„´ìŠ¤ì˜ ë°©í™”ë²½ ì„¤ì •ì„ ì—´ì–´ì¤€ë‹¤</li>\n<li>ì•„ë˜ì™€ ê°™ì´ ëª¨ë“  ì¸í„°í˜ì´ìŠ¤ì— ëŒ€í•´ í¬íŠ¸ í¬ì›Œë”©ì„ ê±¸ì–´ì¤€ë‹¤.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl port-forward \\\n  --address 0.0.0.0 \\\n  svc/argocd-server -n argocd 8080:443</code></pre></div>\n<p>ì´ì œ http://&#x3C;EC2 í¼ë¸”ë¦­IP>:8080\nìœ¼ë¡œ ì ‘ì†ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<p>ì•„ë˜ì™€ ê°™ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰í•˜ë©´ ì¢€ ë” í¸ë¦¬í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nohup kubectl -n argocd port-forward svc/argocd-server 8080:443 --address 0.0.0.0 \\\n  > ./argocd-port-forward.log 2>&amp;1 &amp;</code></pre></div>\n<h2>ì´ë¯¸ì§€ pullì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°</h2>\n<p>argoCD UIì—ì„œ syncë²„íŠ¼ì„ ëˆŒëŸ¬ backend deployë¥¼ í•˜ë©´, Docker image pull ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.</p>\n<p>ê·¸ ì´ìœ ëŠ” ì €í¬ê°€ Docker imageì˜ tagê°’ì„ gitì—ì„œ ì»¤ë°‹ìœ¼ë¡œ ì˜¬ë ¤ì£¼ë„ë¡ í•´ë’€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</p>\n<p>ì´ ìƒí™©ì„ í”¼í•˜ê³  ì‹¶ë‹¤ë©´, tagê°’ì„ latestë¡œ í•´ì„œ í•­ìƒ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ í•˜ë˜ê°€,\ngithub actionì„ íŠ¸ë¦¬ê±° ì‹œì¼œì„œ argoCDë¥¼ ì‘ë™ì‹œí‚¤ë©´ ë©ë‹ˆë‹¤.</p>\n<p>íƒœê·¸ê°’ì´ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ëŠ” argoCDì˜ UI logì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>\n<h2>ë°°í¬ì— ì„±ê³µí–ˆëŠ”ë° ArgoCDì—ì„œ ì˜¤ë¥˜ê°€ ëœ¨ëŠ” ê²½ìš°</h2>\n<p>ì €í¬ëŠ” ì•±ì´ ì‚´ì•„ìˆë‹¤ëŠ” ì‹ í˜¸ë¥¼ /actuator/health ë¼ìš°íŠ¸ì—ì„œ ì‹ í˜¸ë¥¼ ë°›ë„ë¡ yamlíŒŒì¼ì— ì„¤ì •í•´ë’€ìŠµë‹ˆë‹¤.</p>\n<p>ì´ ì‹ í˜¸ë¥¼ ë°›ê¸° ìœ„í•´ì„œëŠ”, actuator ì˜ì¡´ì„±ì„ Springì— ì¶”ê°€í•´ë‘¬ì•¼ í•©ë‹ˆë‹¤.</p>\n<p>gradle ê¸°ì¤€ ì•„ë˜ ëª…ë ¹ì„ build.gradleì— ì¶”ê°€í•©ë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">implementation 'org.springframework.boot:spring-boot-starter-actuator'</code></pre></div>\n<p>application.propertiesì—ì„œ endpointë¥¼ ë…¸ì¶œì‹œí‚µë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server.port=3000\nmanagement.server.port=${server.port}\nmanagement.endpoints.web.exposure.include=health,info\nmanagement.endpoint.health.show-details=always</code></pre></div>\n<p>ì´ë ‡ê²Œ í•˜ê³  Docker imageë¥¼ ë‹¤ì‹œ ë¹Œë“œí•˜ë©´ í•´ë‹¹ ë¼ìš°íŠ¸ê°€ ì˜ ì‘ë™í•©ë‹ˆë‹¤.</p>\n<p>ì°¸ê³ ë¡œ server.portê°’ì€ Dockerfileì˜ Exposeê°’ê³¼ë„ ì¼ì¹˜í•´ì•¼ í•˜ê³ , yamlíŒŒì¼ì—ì„œë„ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ì˜ ì‹ ê²½ì¨ì¤˜ì•¼ ì œëŒ€ë¡œ ë™ì‘í•©ë‹ˆë‹¤.</p>","frontmatter":{"date":"July 30, 2025","title":"MSA - Kubernetes, ArgoCD ë°°í¬ìë™í™”"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#argo-cd\">Argo CD</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B3%BC%EC%A0%95-%EA%B8%B0%EB%A1%9D\">ê³¼ì • ê¸°ë¡</a></p>\n<ul>\n<li><a href=\"#git-repository-%EC%A4%80%EB%B9%84\">Git Repository ì¤€ë¹„</a></li>\n<li><a href=\"#%EB%A8%BC%EC%A0%80-ci-%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8%EC%9D%84-%EC%84%A4%EC%A0%95%ED%95%B4%EB%B4%85%EC%8B%9C%EB%8B%A4\">ë¨¼ì €, CI íŒŒì´í”„ë¼ì¸ì„ ì„¤ì •í•´ë´…ì‹œë‹¤.</a></li>\n<li><a href=\"#argocd%EB%A5%BC-%EC%84%A4%EC%A0%95%ED%95%B4%EB%B4%85%EC%8B%9C%EB%8B%A4\">ArgoCDë¥¼ ì„¤ì •í•´ë´…ì‹œë‹¤.</a></li>\n<li><a href=\"#%EC%9D%B4%EC%A0%9C-cicd-repository%EC%9D%98-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EC%84%A4%EC%A0%95%EC%9D%84-%ED%95%B4%EB%B4%85%EC%8B%9C%EB%8B%A4\">ì´ì œ cicd repositoryì˜ ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •ì„ í•´ë´…ì‹œë‹¤.</a></li>\n<li><a href=\"#%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%A7%80%EC%A0%95\">í™˜ê²½ë³€ìˆ˜ ì§€ì •</a></li>\n<li><a href=\"#%EB%B0%B0%ED%8F%AC-%ED%99%95%EC%9D%B8\">ë°°í¬ í™•ì¸</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%8A%B8%EB%9F%AC%EB%B8%94-%EC%8A%88%ED%8C%85\">íŠ¸ëŸ¬ë¸” ìŠˆíŒ…</a></p>\n<ul>\n<li><a href=\"#argocd%EA%B0%80-%EC%A0%91%EC%86%8D%EC%9D%B4-%EB%90%98%EC%A7%80-%EC%95%8A%EC%9D%8C\">ArgoCDê°€ ì ‘ì†ì´ ë˜ì§€ ì•ŠìŒ</a></li>\n<li><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-pull%EC%9D%B4-%EC%8B%A4%ED%8C%A8%ED%95%98%EB%8A%94-%EA%B2%BD%EC%9A%B0\">ì´ë¯¸ì§€ pullì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°</a></li>\n<li><a href=\"#%EB%B0%B0%ED%8F%AC%EC%97%90-%EC%84%B1%EA%B3%B5%ED%96%88%EB%8A%94%EB%8D%B0-argocd%EC%97%90%EC%84%9C-%EC%98%A4%EB%A5%98%EA%B0%80-%EB%9C%A8%EB%8A%94-%EA%B2%BD%EC%9A%B0\">ë°°í¬ì— ì„±ê³µí–ˆëŠ”ë° ArgoCDì—ì„œ ì˜¤ë¥˜ê°€ ëœ¨ëŠ” ê²½ìš°</a></li>\n</ul>\n</li>\n</ul>"}},"pageContext":{"id":"54ce4110-dc75-593c-83fb-bec3dcf7ea86","frontmatter__slug":"/blog/capstone/cicd","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":["2018336255","2540505676","2678393935","2810064759","3398502926"],"slicesMap":{}}