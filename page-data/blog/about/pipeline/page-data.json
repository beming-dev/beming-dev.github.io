{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-tsx","path":"/blog/about/pipeline/","result":{"data":{"markdownRemark":{"html":"<p>현재 About은 Heroku를 이용해서 배포를 진행하고 있습니다.\n지난번에 비용 분석을 했을 때, Heroku에서 AWS로 옮기면 한달에 약 $84를 아낄 수 있겠다는 예측이 나와서, 실제로 AWS상에 CI/CD파이프라인을 구성해보았습니다.</p>\n<h1>구성</h1>\n<p>사용한 툴은 다음과 같습니다.</p>\n<ul>\n<li>AWS-ec2: Docker container를 실행하고 요청을 받는 주체</li>\n<li>AWS ECR: Docker image의 저장소</li>\n<li>AWS codebuild: buildspec.yml을 통해 Docker image를 빌드하고 ECR에 푸쉬</li>\n<li>AWS codedeploy: ECR에서 컨테이너를 가져와 EC2에서 실행</li>\n<li>AWS codepipeline: github코드 트래킹, build, deploy과정을 pipeline으로 만들어 실행</li>\n<li>AWS-s3: pipeline의 각 과정 결과 저장</li>\n<li>AWS-IAM: 각 과정의 권한 설정</li>\n</ul>\n<p>간단히 도식화 해보면 아래와 같습니다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42nWS146EMAxFQ29D7wNv8P+/6NGxZIRY9uEqxMktdnBBEMgTvu8rPM/T9e3sjQfcm1gYhpJlmQzDoJimSZZlkXEc5fP56Pm/gpbE0iBU17WueZ4riqKQqqqkLEv9BkmSvHbgIONMkjiONc08z5qibVvpuu5KjCg1BDG6m1+Cfd/Lvu+ybZteRIz2aO37/cq6rpKmqe4xBk3TaFrM4WJ0CRIdQLJUEKjZ3KIo0joCkElEN6Q8jkON4V8zvIOLHDIfVpIzDtLbo1G3AIjbTDlzzxe2yzZwSOd5CqNxzmkdU4Tszv1h/gjiRCu0CZE9D0OrVkPMEj1/mx/PFMYorgWr6AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"20250103105340\"\n        title=\"\"\n        src=\"/static/8e9e5e26b1cc919081c82fef4a0a350c/5a190/20250103105340.png\"\n        srcset=\"/static/8e9e5e26b1cc919081c82fef4a0a350c/772e8/20250103105340.png 200w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/e17e5/20250103105340.png 400w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/5a190/20250103105340.png 800w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/c1b63/20250103105340.png 1200w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/29007/20250103105340.png 1600w,\n/static/8e9e5e26b1cc919081c82fef4a0a350c/1e1c3/20250103105340.png 1670w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h1>비용 분석</h1>\n<p>처음 비용 예측을 할 때는 AWS 인스턴스와 저장소 비용, IP 주소 비용 정도만 포함해서 계산했는데, 그것보다는 구조가 복잡해져서 다시 비용 분석을 해보겠습니다.</p>\n<h2>AWS EC2</h2>\n<p>Ubuntu 이미지에 ram 4Gib를 지원하는 t2.miedium을 사용. 시간당 $0.0576가 청구된다.</p>\n<p>한달에, 0.0576 * 24 * 30 = $41.472가 청구된다.</p>\n<h2>Elastic IP</h2>\n<p>매월 약 $3.5가 청구된다.</p>\n<h2>EBS 볼륨</h2>\n<p>GB당 월 $0.0912\n70GB 사용을 가정하면, 한달에 약 $6.5 비용 발생</p>\n<h2>Elastic Container Registry</h2>\n<p>GB당 월 0.10.\n10GB정도 사용한다 가정하면 한달에 약 $1 의 비용 발생</p>\n<h2>AWS Codebuild</h2>\n<p>codebuild는 build 분당 요금을 청구한다. 어떤 인스턴스를 사용하는지에 따라 다르지만, 대충 분당 $0.01가 청구된다고 생각하면 될 것 같다.</p>\n<p>빌드하는데 3분이 걸린다 가정하고, 하루에 2번 빌드가 진행된다 가정하자. 이는 매우 보수적으로 잡은 수치이다.\n0.01 * 3 * 2 * 30 = $1. 한달에 약 $1가 청구된다.\n프론트엔드 백엔드 각각이라 생각하면 한달의 $2가 청구될 것이다.</p>\n<h2>AWS Codedeploy</h2>\n<p>codedeploy는 업데이트당 $0.02의 요금을 부과한다.\n위에서와 마찬가지로 하루에 2번씩 배포된다 가정하자. 프론트 백, 두개를 생각하면</p>\n<p>0.02 * 2 * 30 * 2 = $2.4의 비용이 매달 청구된다.</p>\n<h2>AWS codepipeline</h2>\n<p>codepipeline은 파이프라인당 매월 $1를 청구한다.\n2개의 pipeline을 만들 것이므로 매월 $2가 청구된다.</p>\n<h2>AWS S3</h2>\n<p>GB당 매월 $0.023가 청구된다.\ncodepipeline과정에서 저장되는 양은 엄청나게 작으므로 고려하지 않아도 될 것 같다.</p>\n<h1>총 비용</h1>\n<p>41.5 + 3.5 + 6.5 + 1 + 2 + 2.24 + 2 = 대략 60</p>\n<p>한달에 $60 정도의 비용을 생각하면 될 것 같다.</p>\n<p>Heroku 배포가 매월 $130였으므로, $70 = 약 10만원을 매달 아낄 수 있다.</p>","frontmatter":{"date":"January 03, 2025","title":"AWS를 이용한 CI.CD pipeline 구성"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EA%B5%AC%EC%84%B1\">구성</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B9%84%EC%9A%A9-%EB%B6%84%EC%84%9D\">비용 분석</a></p>\n<ul>\n<li><a href=\"#aws-ec2\">AWS EC2</a></li>\n<li><a href=\"#elastic-ip\">Elastic IP</a></li>\n<li><a href=\"#ebs-%EB%B3%BC%EB%A5%A8\">EBS 볼륨</a></li>\n<li><a href=\"#elastic-container-registry\">Elastic Container Registry</a></li>\n<li><a href=\"#aws-codebuild\">AWS Codebuild</a></li>\n<li><a href=\"#aws-codedeploy\">AWS Codedeploy</a></li>\n<li><a href=\"#aws-codepipeline\">AWS codepipeline</a></li>\n<li><a href=\"#aws-s3\">AWS S3</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%B4%9D-%EB%B9%84%EC%9A%A9\">총 비용</a></p>\n</li>\n</ul>"}},"pageContext":{"id":"bf31dbdd-7da1-5a9f-aed1-c0412d5b9c79","frontmatter__slug":"/blog/about/pipeline","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":["2018336255","2540505676","2678393935","2810064759","3398502926"],"slicesMap":{}}